{"version":3,"sources":["api/mockAPI/utils.js","api/actions/errors.js","api/actions/status.js","api/constants/index.js","api/actions/utils.js","libs/apiUtils.js","api/reducers/utils.js","api/reducers/sessions.js","api/reducers/users.js","api/reducers/applicants.js","api/actions/applicants.js","api/reducers/applications.js","api/reducers/positions.js","api/reducers/instructors.js","api/actions/instructors.js","api/reducers/contract_templates.js","api/actions/contract_templates.js","api/actions/positions.js","api/actions/applications.js","api/reducers/assignments.js","api/actions/wage_chunks.js","api/actions/assignments.js","api/actions/globals.js","api/reducers/status.js","api/reducers/ddahs.js","api/reducers/globals.js","api/actions/ddahs.js","api/actions/init.js","api/actions/users.js","api/actions/sessions.js","api/actions/offers.js","views/dev_frame/mockAPI.js","views/dev_frame/active-user-switch.js","views/dev_frame/index.js","views/notifications/index.js","components/forms/common-controls.js","components/diff-table.js","libs/utils.ts","components/advanced-filter-table.tsx","components/instructors.js","components/edit-field-widgets.js","views/instructors/delete-instructor-dialog.js","views/instructors/editable-instructors-list.js","views/instructors/add-instructor-dialog.js","components/action-buttons.tsx","components/export-button.js","components/import-button.js","libs/importExportUtils.js","libs/exportUtils.ts","libs/diffUtils.ts","views/instructors/import-export.js","components/layout.tsx","views/instructors/index.js","components/forms/session-editor.js","views/sessions/add-session-dialog.js","components/table-utils.tsx","components/sessions.js","views/sessions/index.tsx","components/forms/position-editor.js","views/positions/add-position-dialog.js","components/positions-list.js","views/positions/position-list.js","views/positions/import-export.js","views/positions/index.js","views/offertable/constants.js","views/offertable/actions.js","views/offertable/index.js","components/forms/assignment-editor.js","views/assignments/add-assignment-dialog.js","views/assignments/assignment-details.tsx","views/assignments/offer-actions.js","components/assignments-list.js","views/assignments/import-export.js","views/assignments/index.js","components/forms/contract-template-editor.js","views/contract_template/contract-template-dialog.js","components/contract-templates-list.js","views/contract_template/contract-template-list.js","views/contract_template/upload-contract-template-button.tsx","views/contract_template/index.js","components/active-user.js","components/filterable-menu.js","components/active-session.js","views/header/index.tsx","views/admin/landing.tsx","views/instructor/landing.tsx","components/applicants.tsx","views/applicants/editable-applicants-list.tsx","views/applicants/add-applicant-dialog.tsx","views/applicants/import-export.tsx","views/applicants/index.tsx","components/ddahs.tsx","views/ddahs/add-ddah-dialog.tsx","views/ddah-table/actions.tsx","views/ddahs/import-export.tsx","views/ddah-table/index.tsx","views/ddah-table/constants.tsx","views/ddahs/index.tsx","views/routes/index.js","components/header.js","views/admin/header.js","views/instructor/header.tsx","views/offertable/reducers.js","views/ddah-table/reducers.tsx","rootReducer.js","store.js","index.js","App.jsx","libs/urlUtils.js","api/defs/prop-types.js","api/mockAPI/data.js","api/mockAPI/sessions.ts","api/mockAPI/contract_templates.js","api/mockAPI/active_user.js","api/mockAPI/instructors.js","api/mockAPI/positions.js","api/mockAPI/wage_chunks.js","api/mockAPI/applications.js","api/mockAPI/applicants.js","api/mockAPI/assignments.js","api/mockAPI/debug.js","api/mockAPI/ddahs.js","api/mockAPI/index.js","api/defs/doc-generation.js"],"names":["sum","ret","numbers","num","splitDateRangeAtNewYear","start_date","end_date","Date","december","getFullYear","january","toISOString","getUnusedId","data","prop","ids","map","x","filter","max","Math","isNaN","round","random","find","obj","s","findAllById","includes","deleteInArray","splice","indexOf","getAttributesCheckMessage","props","id","required","unique","Object","entries","requirements","MockAPIController","ownData","this","query","rawFind","utorid","Error","JSON","stringify","newId","newItem","push","value","item","validateProp","updateIfFound","validateNew","create","wageChunkArrayToStartAndEndDates","wageChunks","startDates","endDates","sort","length","joinWithConjunction","items","join","formatInstructorsContact","instructors","first_name","last_name","email","wageChunkArrayToPayPeriodDescription","rateData","wageChunk","rate","hours","min","values","toLocaleDateString","month","day","year","filterNullProps","key","errorUnlessRole","role","targetRule","base64abc","split","base64codes","Uint8Array","i","getBase64Code","charCode","code","bytesToBase64","bytes","result","l","base64ToBytes","str","index","buffer","missingOctets","endsWith","n","j","charCodeAt","subarray","base64decode","decoder","TextDecoder","decode","forEach","char","defaultNotifProps","position","autoDismiss","title","fetchError","payload","error","message","upsertError","deleteError","apiError","apiInteractionStart","type","apiInteractionEnd","arrayToHash","indexBy","Array","isArray","d","actionFactory","splitObjByProps","filtered","hasOwnProperty","call","flattenIdFactory","inPropName","outPropName","isArrayOfIds","validatedApiDispatcher","dispatcher","propTypes","name","description","onErrorDispatch","args","dispatch","propTypeCheck","a","arg","PropTypes","checkPropTypes","wasPropTypesError","statusId","uuid","console","warn","Function","FETCH_INIT","credentials","headers","ApiError","resp","errorMessage","captureStackTrace","ApiFetchError","response","status","path","statusText","_ensurePath","startsWith","_processFetchResponse","json","apiGET","fetch","method","apiPOST","body","upsertItem","modelData","didUpdate","newModelData","createBasicReducerObject","FETCH_MANY","FETCH_ONE","UPSERT_ONE","DELETE_ONE","state","action","_modelData","deletedItem","createReducer","initialState","handlers","_storePath","pushToPath","dir","unshift","reducer","_origCreateReducer","_localStoreSelector","localState","e","createLocalStoreSelector","combineReducers","model","pushToPathCallbacks","newReducer","_origCombineReducers","func","basicReducers","sessionsReducer","activeSession","usersReducer","users","active_user","active_role","insertIfMissing","target","source","missingItems","some","concat","applicantsReducer","fetchApplicantsSuccess","fetchOneApplicantSuccess","upsertOneApplicantSuccess","deleteOneApplicantSuccess","fetchApplicants","toString","getState","activeRoleSelector","activeSessionId","sessions","upsertApplicant","any","isRequired","bySession","session","activeSessionSelector","deleteApplicant","exportApplicants","formatter","format","applicants","applicantsSelector","upsertApplicants","dispatchers","applicant","Promise","all","localStoreSelector","createSelector","applicationsReducer","positionsReducer","positionId","instructorsReducer","fetchInstructorsSuccess","fetchOneInstructorSuccess","upsertOneInstructorSuccess","deleteOneInstructorSuccess","fetchInstructors","upsertInstructor","deleteInstructor","exportInstructors","instructorsSelector","upsertInstructors","instructor","contractTemplatesReducer","fetchContractTemplatesSuccess","fetchAllContractTemplatesSuccess","upsertOneContractTemplateSuccess","deleteOneContractTemplateSuccess","fetchContractTemplates","upsertContractTemplate","fetchAllContractTemplates","previewContractTemplate","template_id","downloadContractTemplate","content","atob","File","file_name","mime_type","uploadContractTemplate","file","arrayBuffer","rawContent","contractTemplatesSelector","allContractTemplatesSelector","fetchPositionsSuccess","fetchOnePositionSuccess","upsertOnePositionSuccess","deleteOnePositionSuccess","fetchPositions","instructorsToInstructorIds","contractTemplateToContractTemplateId","instructorToInstructorId","applicantToApplicantId","prepForApi","preference","upsertPosition","deletePosition","exportPositions","positions","positionsSelector","upsertPositions","_positionsSelector","contractTemplates","instructorsById","contractTemplatesById","applicantsById","instructor_ids","contract_template_id","instructor_preferences","rest","contract_template","applicant_id","instructor_id","fetchApplicationsSuccess","fetchOneApplicationSuccess","upsertOneApplicationSuccess","deleteOneApplicationSuccess","positionToPositionId","fetchApplications","_applicationsSelector","applications","positionsById","position_preferences","position_id","setWageChunks","assignmentId","assignment_id","_wageChunksByAssignmentId","assignmentsReducer","fetchWageChunksForAssignmentSuccess","upsertWageChunksForAssignmentSuccess","upsertOneWageChunkSuccess","deleteOneWageChunkSuccess","fetchWageChunksForAssignment","upsertWageChunksForAssignment","assignment","fetchAssignment","wageChunksByAssignmentSelector","fetchAssignmentsSuccess","fetchOneAssignmentSuccess","upsertOneAssignmentSuccess","deleteOneAssignmentSuccess","fetchAssignments","upsertAssignment","wage_chunks","exportAssignments","assignments","assignmentsSelector","wageChunkPromises","upsertAssignments","wageChunksMatchAssignment","totalHours","_assignmentsSelector","getWageChunksForAssignment","setGlobals","globals","globalsSelector","setGlobalsInUrl","searchParams","URLSearchParams","val","append","window","history","pushState","newUrl","URL","location","search","setMockAPIState","options","skipInit","mockAPI","initFromStage","ui","otherGlobals","storedActiveSession","statusReducer","ongoingInteraction","ongoingInteractionsList","ddahsReducer","globalReducer","fetchDdahsSuccess","fetchOneDdahSuccess","upsertOneDdahSuccess","deleteOneDdahSuccess","approveOneDdahSuccess","emailOneDdahSuccess","fetchDdahs","assignmentToAssignmentId","approveDdah","emailDdah","upsertDdah","exportDdahs","ddahs","ddahsSelector","upsertDdahs","ddah","downloadDdahAcceptedList","computeDdahHours","duties","_ddahsSelector","accepted_date","emailed_date","total_hours","toggleMockApi","enableMockAPI","require","replaceGlobalFetch","restoreGlobalFetch","prepareGlobals","stage","startAfterStage","shouldRunStage","queryStage","initOrder","stageDependent","sessionsSelector","parsedGlobals","asyncActions","assign","parseURLSearchString","fetchActiveUser","activeRole","setActiveUserRole","fetchSessions","matchingSession","setActiveSession","fetchActions","fetchActiveUserSuccess","fetchUsersSuccess","upsertUserSuccess","setActiveUserRoleSuccess","currentRole","roles","fetchUsers","user","debugOnlyFetchUsers","debugOnlySetActiveUser","usersSelector","activeUserSelector","fetchSessionsSuccess","fetchOneSessionSuccess","upsertOneSessionSuccess","deleteOneSessionSuccess","setActiveSessionAction","upsertSession","deleteSession","currentActiveSession","fetchOfferSuccess","setOfferAcceptedSuccess","setOfferRejectedSuccess","offerCreateSuccess","offerEmailSuccess","offerNagSuccess","offerWithdrawSuccess","setOfferForAssignmentAccepted","setOfferForAssignmentRejected","offerForAssignmentWithdraw","offerForAssignmentCreate","offerForAssignmentEmail","offerForAssignmentNag","ToggleMockApi","active","ButtonGroup","Button","variant","onClick","connect","ident","BootstrapNavLink","Nav","Link","as","NavLink","activeClassName","to","children","swaggerData","openapi","info","servers","url","paths","mockApiRoutesAsSwaggerPaths","ConnectedActiveUserButton","activeUser","setActiveUser","React","useState","dropdownVisible","setDropdownVisible","useEffect","className","Dropdown","onSelect","onToggle","desiredVisibility","show","alignRight","Toggle","Menu","flip","Item","eventKey","ConnectedToggleMockApi","ConnectedNotifications","notifications","Notifications","fieldEditorFactory","boundData","setBoundData","setAttrFactory","attr","coerceFunc","newVal","newData","inputAttrs","valueFunc","Number","slice","Fragment","Form","Label","Control","onChange","DialogRow","icon","iconNode","Row","style","alignItems","Children","child","Group","Col","createDiffCell","accessor","Cell","get","row","original","_original","changed","changes","createDiffColumnsFromColumns","columns","column","strip","trim","formatDate","dateString","normalizedDateString","toJSON","date","formatDownloadUrl","href","replace","IndeterminateCheckbox","from","r","forwardRef","ref","indeterminate","current","SortableHeader","sortIcon","isSorted","isSortedDesc","getHeaderProps","getSortByToggleProps","render","getResizerProps","isResizing","FilterBar","count","filterStrings","setFilterStrings","toLowerCase","displayFilterStrings","normalizedFilterStrings","placeholder","onKeyDown","keyCode","firstString","saveFirstFilterString","filterString","Badge","pill","updatedFilterStrings","oldString","removeFilterString","EMPTY_OBJECT","idsToIndicesObject","AdvancedFilterTable","filterable","selected","setSelected","filterMethod","useCallback","rows","filterName","every","colName","match","table","useTable","filterTypes","custom","globalFilter","autoResetGlobalFilter","autoResetSortBy","autoResetSelectedRows","hiddenColumns","col","selectedRowIds","useBlockLayout","useResizeColumns","useGlobalFilter","useSortBy","useRowSelect","hooks","visibleColumns","Header","getToggleAllRowsSelectedProps","getToggleRowSelectedProps","maxWidth","scrollRef","useRef","setGlobalFilter","shallowEqual","renderRow","prepareRow","getRowProps","classNames","isSelected","cells","cell","getCellProps","handleScroll","scrollTop","scrollTo","newFilter","getTableProps","headerGroups","headerGroup","getHeaderGroupProps","getTableBodyProps","width","height","onScroll","itemCount","itemSize","totalColumnsWidth","overflow","DEFAULT_COLUMNS","minWidth","InstructorsList","InstructorsDiffList","modifiedInstructors","DEFAULT_INSTRUCTOR","InstructorEditor","instructorProps","setInstructor","newInstructor","createFieldEditor","EditFieldDialog","onHide","fieldVal","setFieldVal","inProgress","setInProgress","isDate","cancelClick","spinner","Spinner","animation","size","changeIndicator","Modal","closeButton","Title","Body","currentTarget","Footer","doSave","EditFieldIcon","memo","hidden","EditableField","editable","dialogShow","setDialogShow","renderEditIcon","setRenderEditIcon","onMouseEnter","DeleteInstructorDialog","onDelete","EditableCell","field","applicantId","ConnectedInstructorsList","inDeleteMode","deleteDialogVisible","setDeleteDialogVisible","instructorToDelete","setInstructorToDelete","generateCell","instructorCurrentlyAssignedHash","resizable","BLANK_INSTRUCTOR","ConnectedAddInstructorDialog","setNewInstructor","conflicts","delayShow","immediateShow","matchingInstructor","getConficts","Alert","disabled","wrapIcon","Icon","ActionsList","ActionHeader","ActionButton","ActionMenuButton","menu","menuOpen","setMenuOpen","menuHeight","setMenuHeight","menuSizerRef","clientHeight","dropright","closed","ExportActionButton","clickCallback","option","FaDownload","ImportDialog","dialogOpen","onCancel","onClose","onConfirm","dialogContent","onFileChange","parentSetInProgress","label","fileInputLabel","setFileInputLabel","fileArrayBuffer","setFileArrayBuffer","fileContents","setFileContents","_setInProgress","rawData","parse","fileType","workbook","XLSX","read","firstSheet","SheetNames","utils","sheet_to_json","Sheets","dialogClassName","Container","event","files","reader","FileReader","onload","readAsArrayBuffer","then","ImportActionButton","setDialogOpen","handleClose","FaUpload","validate","schema","requiredKeys","deleteReferences","keyMap","findMatchingKey","targetKey","fuzzySet","FuzzySet","keys","matches","matchedKey","SpreadsheetRowMapper","unmatchedKeys","empiricalKeyMap","unknownKeys","log","matchByUtoridOrName","people","nameHash","person","parseDate","sec","chrono","normalizeImport","dateColumns","baseName","rowMapper","formatRow","newRow","dataToFile","formatters","dataFormat","filePrefix","fileName","book_new","sheet","aoa_to_sheet","toSpreadsheet","book_append_sheet","bookType","write","toJson","prepareMinimal","rate1","rate2","contractTemplate","template_name","template_file","position_code","position_title","hours_per_assignment","qualifications","ad_hours_per_assignment","ad_num_assignments","ad_open_date","ad_close_date","desired_num_assignments","current_enrollment","current_waitlisted","contract_override_pdf","chunk","chunk1","chunk2","tmp","wageChunksMatchPositionAndSession","student_number","phone","b","order","duty","prepareFull","minInstructor","context","minApplicant","minPosition","template","instructorList","minAssignment","minDdah","matchingAssignment","diffImport","instructorsListFromField","list","minimal","_prop","oldVal","isSame","importedInstructors","matchingPosition","oldInstructors","newInstructors","importedPositions","importedAssignments","existingAssignments","assignmentHash","hashAssignment","importedApplicants","matchingApplicant","importedDdahs","existingDdahs","matchingDdah","ddahDutiesToString","applicant_utorid","isMinimalAssignment","obj1","obj2","keys1","getChanged","diffed","ConnectedExportInstructorsAction","useDispatch","exportType","setExportType","prepareData","FileSaver","saveAs","doExport","instructorSchema","First","Surname","Last","primaryKey","ConnectedImportInstructorAction","setImportInProgress","useSelector","fileContent","setFileContent","setDiffed","processingError","setProcessingError","changedInstructors","newDiff","DialogContent","newItems","modifiedDiffSpec","ContentArea","AdminInstructorsView","addDialogVisible","setAddDialogVisible","setInDeleteMode","importInProgress","SessionEditor","setSession","step","BLANK_SESSION","ConnectedAddSessionDialog","newSession","setNewSession","getConflicts","generateHeaderCell","header","sessionId","ConfirmDeleteDialog","ConnectedSessionsList","sessionToDelete","setSessionToDelete","_upsertSession","MissingActiveSessionWarning","extraText","AdminSessionsView","activeSessionInfo","DEFAULT_POSITION","PositionEditor","positionProp","setPosition","defaultContractTemplate","ignoreDiacritics","multiple","labelKey","selectedContractTypes","BLANK_POSITION","ConnectedAddPositionDialog","newPosition","setNewPosition","defaultTemplate","PositionsDiffList","modifiedPositions","PositionsList","hashInstructorList","EditInstructorsDialog","allInstructors","EditInstructorsCell","ConnectedPositionsList","positionToDelete","setPositionToDelete","_upsertPosition","numAssignmentsByPositionCode","reduce","acc","ConnectedExportPositionsAction","positionSchema","Start","End","ConnectedImportPositionsAction","changedPositions","AdminPositionsView","POSITION_COLUMNS_FOR_INSTRUCTOR_VIEW","InstructorPositionsView","heading","offerTableSelector","offerTable","ApplicantCell","StatusCell","word","formattedStatus","active_offer_status","charAt","toUpperCase","activeOfferUrlToken","active_offer_url_token","download","AssignmentCell","ConnectedOfferTable","offer","selectedAssignmentIds","_setSelected","generateApplicantCell","DEFAULT_ASSIGNMENT","note","AssignmentEditor","assignmentProp","setAssignment","splitDateRanges","assignmentAndWageChunksMatch","range","wageChunkAdjuster1","wageChunkAdjuster2","newHours","BLANK_ASSIGNMENT","ConnectedAddAssignmentDialog","newAssignment","setNewAssignment","WagechunkDetails","ConnectedAssignmentDetails","ConnectedViewAssignmentDetailsAction","selectedAssignments","dialogVisible","setDialogVisible","aHash","bHash","assignmentDetails","FaSearchDollar","OfferTest","canCreate","canEmail","canNag","canWithdraw","canAccept","canReject","ConnectedOfferActionButtons","actionPermitted","AssignmentsDiffList","modifiedAssignments","AssignmentsList","formatDateForSpreadsheet","createPayPeriodHeaders","maxNumPeriods","formatWageChunksToList","ConnectedExportAssignmentsAction","setExportInProgress","assignmentsForSpreadsheet","active_offer_recent_activity_date","undefined","assignmentSchema","Hours","ConnectedImportAssignmentsAction","AdminAssignmentsView","InstructorAssignmentsView","DEFAULT_CONTRACT_TEMPLATE","ContractTemplateEditor","contractTemplateProp","setContractTemplate","availableTemplates","templates","templateFile","BLANK_CONTRACT_TEMPLATE","ConnectedAddContractTemplateDialog","newContractTemplate","setNewContractTemplate","matchingTemplate","ContractTemplatesList","TemplatePreviewDialog","isLoading","setIsLoading","cachedPreview","setCachedPreview","ModalHeader","boder","flexGrow","srcDoc","ConnectedContractTemplateList","previewVisible","setPreviewVisible","previewingTemplate","setPreviewingTemplate","rowData","previewClicked","ConnectedUploadContractTemplateAction","setFile","AdminContractTemplatesView","ActiveUserDisplay","isActiveRole","FilterableMenuContents","clearFilter","setFilter","sessionList","toArray","emptyListMessage","FormControl","autoFocus","tabIndex","FilterableMenu","activeItemId","ActiveSessionDisplay","ConnectedActiveSessionDisplay","ConnectedActiveUserDisplay","ConnectedLandingView","ApplicantsDiffList","modifiedApplicants","ApplicantsList","DEFAULT_APPLICANT","ApplicantEditor","applicantProps","setApplicant","newApplicant","ConnectedApplicantsList","applicantToDelete","setApplicantToDelete","assignmentsHash","_upsertApplicant","BLANK_APPLICANT","ConnectedAddApplicantDialog","setNewApplicant","ConnectedExportApplicantsAction","applicantSchema","changedApplicants","AdminApplicantsView","DdahsDiffList","modifiedDdahs","modifiedDdah","DdahsList","flattenedDdahs","DEFAULT_DDAH","DdahEditor","ddahProps","setDdah","editableAssignment","assignmentNode","nextOrder","hoursMismatch","upsertDuty","newDuties","removeDuty","stringToNativeType","BLANK_DDAH","ConnectedAddDdahDialog","newDdah","setNewDdah","assignmentsWithDdahHash","assignmentsWithoutDdah","_upsertDdah","ddahTableSelector","ddahsTable","prepareDdahsSpreadsheet","maxDuties","dutyHeaders","_","flattenDuties","ConnectedExportDdahsAction","selectedDdahIds","ConnectedImportDdahsAction","changedDdahs","unwrapped","Position","normalized","normalizeDdahImports","createDdahSpreadsheets","ddahsByAssignmentId","allDdahs","posSet","Set","add","ddahsByPosition","arraysByKeyToZip","arrays","zip","JSZip","array","sanitized_position_code","rawSpreadsheet","binary","generateAsync","blob","ConnectedDownloadPositionDdahTemplatesAction","spreadsheets","ConnectedDownloadDdahsAcceptedListAction","downloadClicked","ddahIssues","getReadableStatus","readableStatus","IssuesCell","issue_code","issues","PreviewCell","DdahPreviewModal","onApprove","onEdit","ddahPreview","DdahPreview","url_token","getFirstInstructorsName","ConnectedDdahEditorModal","editor","onSave","ConnectedDdahsTable","editVisible","setEditVisible","previewDdah","setPreviewDdah","onPreviewClick","approved","approved_date","readable_status","ddahAssignmentIdsHash","textAlign","setSelectedRows","AdminDdahsView","selectedDdahs","FaMailBulk","FaCheck","AdminRoutes","exact","InstructorRoutes","BootstrapNavItem","routes","infoComponents","mainRoute","useRouteMatch","params","activeMainRoutes","route","availableSubroutes","substring","subroutes","subroute","fullroute","Navbar","activeKey","defaultActiveKey","AdminHeader","InstructorHeader","offerTableReducer","ddahsTableReducer","notificationReducer","form","formReducer","persistConfig","storage","whitelist","persistedReducer","persistReducer","rootReducer","store","createStore","composeWithDevTools","applyMiddleware","thunk","persistor","persistStore","configureStore","DevFrame","expand","Brand","Collapse","spec","docExpansion","Component","ReactDOM","document","getElementById","generatePropTypes","oneOfType","number","string","apiResponse","shape","oneOf","apiResponseSuccess","apiResponseError","idOnly","contractTemplateMinimal","arrayOf","instructor_preference","preference_level","active_offer_nag_count","reportingTag","position_start_date","position_end_date","first_time_ta","bool","instructor_contact_desc","pay_period_desc","installments","ta_coordinator_name","ta_coordinator_email","rejected_date","withdrawn_date","nag_count","application","session_id","comments","program","department","previous_uoft_experience","yip","annotation","position_preference","signature","revised_date","contract_templates_by_filename","mockData","available_contract_templates","contract_templates","contract_templates_by_session","1","2","positions_by_session","assignments_by_session","offers","previous_uoft_ta_experience","Session","filteredData","findAll","sessionsRoutes","documentCallback","summary","returns","wrappedPropTypes","docApiPropTypes","post","upsert","posts","ContractTemplate","findAllBySession","file_contents","newTemplate","templatesRoutes","getTemplateHtml","templateContent","encodedContent","TextEncoder","encode","upsertBySession","upload","User","matchingUser","activeUserRoutes","getActiveUser","Instructor","instructorsRoutes","activeInstructor","getFromActiveUser","instructorPositions","getForInstructor","instructorIdsSet","has","rawPosition","_session_id","bySessionsList","positionsRoutes","WageChunk","Assignment","rawWageChunk","getSession","session_start_date","getPosition","existingWageChunks","findAllByAssignment","upsertByAssignment","wageChunkRoutes","Application","applicationsRoutes","Applicant","applicantIds","applicantsRoutes","findAllBySessionAndInstructor","existingApplicant","comment","ActiveOffer","findByAssignment","getWageChunkInfo","activeOffer","getActiveOffer","upsertedAssignment","findAssociatedSession","dateRanges","perChunkDelta","positionIds","_ensureAssignment","_noActiveOffer","baseOffer","getAssignment","getApplicant","getInstructors","getContractTemplate","assignmentsRoutes","existingAssignment","setAllByAssignment","withdrawByAssignment","rejectByAssignment","acceptByAssignment","createByAssignment","emailByAssignment","nagByAssignment","Debug","getAllData","makeSnapshot","constructor","snapshot","clearData","debugRoutes","found_user","restoreSnapshot","Ddah","assignmentIds","ddahsRoutes","ddah_id","existingDdah","overwriteFields","sortByOrder","MockAPI","seedData","routePrefix","getRoutes","exclude","postRoutes","_getRoutesParsers","authenticateActiveUserBasedOnRole","_postRoutesParsers","routeStr","Route","delay","_origFetch","init","parsedURL","pathname","mockResponse","responseObj","Response","Blob","resolve","setTimeout","CallAtom","createCallChain","chain","propTypesProxy","callChain","handler","receiver","Reflect","apply","thisArg","lastProp","pop","ownKeys","Proxy","PROPTYPES_TO_SWAGGER_TYPES","object","wrappedPropTypesToSwagger","pt","requiredList","swaggerVal","wrapInStandardApiResponseForSwagger","properties","enum","urlTemplateToSwagger","parsed","RouteParser","templateVars","subs","templateVar","decodeURI","reverse","documentedCallbackToSwagger","docs","responses","default","prefixRoles","parameters","in","requestBody","templatePath","tags","applicableTags","sortedRet","attrs"],"mappings":"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","file":"static/js/main.e50b04c9.chunk.js","sourcesContent":["/**\n * A collection of utility functions to help with the mock API\n */\n\n/**\n * Adds the arguments passed in.\n *\n * @export\n * @param {} numbers\n * @returns {number}\n */\nexport function sum(...numbers) {\n    let ret = 0;\n    for (const num of numbers) {\n        ret += +num;\n    }\n    return ret;\n}\n\n/**\n * Given a date range, returns an array of one or two ranges depending\n * on whether the date range includes a new-years.\n *\n * @export\n * @param {(string|Date)} start_date\n * @param {(string|Date)} end_date\n * @returns {{start_date: string, end_date:string}[]}\n */\nexport function splitDateRangeAtNewYear(start_date, end_date) {\n    start_date = new Date(start_date);\n    end_date = new Date(end_date);\n    // For `Date`, 11 is december\n    const december = new Date(start_date.getFullYear(), 11, 31);\n    // For `Date`, 12 will be the first month of the subsequent year\n    const january = new Date(start_date.getFullYear(), 12, 1);\n    if (start_date <= december && end_date > december) {\n        return [\n            {\n                start_date: start_date.toISOString(),\n                end_date: december.toISOString(),\n            },\n            {\n                start_date: january.toISOString(),\n                end_date: end_date.toISOString(),\n            },\n        ];\n    }\n    return [\n        {\n            start_date: start_date.toISOString(),\n            end_date: end_date.toISOString(),\n        },\n    ];\n}\n\n/**\n * Generates an unused Id based on the `prop` attribute.\n *\n * @export\n * @param {object[]} data - array of data with `prop` attributes\n * @param {string} [prop=\"id\"] - attribute to key on\n * @returns {number|string}\n */\nexport function getUnusedId(data, prop = \"id\") {\n    const ids = data.map((x) => +x[prop]).filter((x) => x != null);\n    const max = Math.max(0, ...ids);\n    if (isNaN(max)) {\n        // Somehow there was some other type mixed in with the ids. In this case,\n        // generate a random string\n        return \"id-\" + Math.round(Math.random() * 10000);\n    }\n    return max + 1;\n}\n\n/**\n * Find `obj` in `data` based on a matching attribute of `prop`.\n * Returns matching object or `undefined` if no match was found.\n *\n * @export\n * @param {*} obj\n * @param {*} [data=[]]\n * @param {string} [prop=\"id\"]\n * @returns {undefined|object}\n */\nexport function find(obj, data = [], prop = \"id\") {\n    // We really do want to use `==` and not `===` here.\n    // Sometimes ids are given as ints and sometimes as strings;\n    // we should work interchangibly with both.\n    // eslint-disable-next-line\n    return data.find((s) => s[prop] == obj[prop]);\n}\n\n/**\n * Filter `data` to be a list which only includes items\n * with ids listed in `ids`.\n *\n * @export\n * @param {string[]} [ids=[]]\n * @param {object[]} [data=[]]\n * @param {string} [prop=\"id\"]\n * @returns {object[]}\n */\nexport function findAllById(ids = [], data = [], prop = \"id\") {\n    // ids can be numbers or strings; make sure we get a match in either case.\n    ids = ids.map((x) => \"\" + x);\n    return data.filter((x) => ids.includes(\"\" + x[prop]));\n}\n\n/**\n * Delete the first occurance of `obj` in `data`\n *\n * @export\n * @param {*} obj\n * @param {*} [data=[]]\n */\nexport function deleteInArray(obj, data = []) {\n    data.splice(data.indexOf(obj), 1);\n}\n\n/**\n * Verify whether attributes are nonempty/unique. If they fail these\n * checks, return an appropriate error message. If they pass, return `false`.\n *\n * @export\n * @param {object} obj\n * @param {object[]} [data=[]]\n * @param {boolean} [props={ name: { required: true, unique: true } }]\n * @returns {string|false} - `false` if all checks succeed. Otherwise an appropriate error message.\n */\nexport function getAttributesCheckMessage(\n    obj,\n    data = [],\n    props = { id: { required: true, unique: true } }\n) {\n    for (const [prop, requirements] of Object.entries(props)) {\n        // Required attributes cannot be null or the empty string\n        // Note: `== null` check null and undefined\n        if (requirements.required && (obj[prop] == null || obj[prop] === \"\")) {\n            return `Property ${prop} cannot be empty`;\n        }\n        // Search the data for something with a matching prop. If we find\n        // anything, we are not unique\n        if (requirements.unique && find(obj, data, prop)) {\n            return `Duplicate entry exists for property ${prop} with value ${obj[prop]}`;\n        }\n    }\n    return false;\n}\n\n/**\n * Base class for mockAPI controllers. These handle\n * the mockAPI data and queries thereof.\n *\n * @export\n * @class MockAPIController\n */\nexport class MockAPIController {\n    constructor(data, ownData) {\n        this.data = data;\n        this.ownData = ownData;\n    }\n    /**\n     * Finds all instances of the given item; returns an array copy.\n     *\n     * @returns {object[]}\n     * @memberof MockAPIController\n     */\n    // eslint-disable-next-line\n    findAll(...args) {\n        return [...this.ownData];\n    }\n    /**\n     * Finds a single instance of an item\n     *\n     * @param {({id: number}|number)} query\n     * @returns {object}\n     * @memberof MockAPIController\n     */\n    find(query) {\n        return this.rawFind(query);\n    }\n    /**\n     * Not to be overridden. The return value of this object\n     * must be an unmangled version of the actual data stored (so that it can be\n     * mutated, for example.)\n     *\n     * @param {*} query\n     * @returns\n     * @memberof MockAPIController\n     */\n    rawFind(query) {\n        if (query == null) {\n            return null;\n        }\n        if (query.id != null) {\n            return find(query, this.ownData);\n        }\n        if (query.utorid != null) {\n            return find({ utorid: query }, this.ownData);\n        }\n        return find({ id: query }, this.ownData);\n    }\n    /**\n     * Delete the given object (by id).\n     *\n     * @param {{id: number}} obj\n     * @memberof MockAPIController\n     */\n    delete(obj) {\n        obj = this.rawFind(obj);\n        if (!obj) {\n            throw new Error(`Cannot delete object ${JSON.stringify(obj)}`);\n        }\n        deleteInArray(obj, this.ownData);\n        return obj;\n    }\n    /**\n     * Get an unused ID\n     *\n     * @returns {number}\n     * @memberof MockAPIController\n     */\n    unusedId() {\n        if (!this.ownData) {\n            throw new Error(\n                \"Cannot get unused ID when `ownData` hasn't been set\"\n            );\n        }\n        return getUnusedId(this.ownData);\n    }\n    /**\n     * Creates a new item instance; no validation is performed.\n     *\n     * @param {object} obj - the new instance data\n     * @memberof MockAPIController\n     */\n    create(obj) {\n        const newId = getUnusedId(this.ownData);\n        const newItem = { ...obj, id: newId };\n        this.ownData.push(newItem);\n        return newItem;\n    }\n    /**\n     * Validates the properties of a new item instance. Throws an error\n     * if the properties are invalid/incompatable.\n     *\n     * @param {object} obj\n     * @memberof MockAPIController\n     */\n    // eslint-disable-next-line\n    validateNew(obj) {\n        throw new Error(\"Subclasses must implement `validateNew()`\");\n    }\n\n    /**\n     * Validates a property of an item instance. Throws an error\n     * if this property are invalid/incompatable.\n     *\n     * @param {object} obj\n     * @param {string} prop\n     * @memberof MockAPIController\n     */\n    // eslint-disable-next-line no-unused-vars\n    validateProp(prop, value, id) {\n        return true;\n    }\n    /**\n     * Update an item if it can be found. Otherwise, return null.\n     *\n     * @param {*} obj\n     * @returns {(object|null)}\n     * @memberof MockAPIController\n     */\n    updateIfFound(obj) {\n        const item = this.rawFind(obj);\n        if (!item) {\n            return null;\n        }\n        // We've found a matching item. Update all non-null\n        // properties\n        for (const prop in obj) {\n            if (prop != null) {\n                this.validateProp(prop, obj[prop], obj.id);\n                item[prop] = obj[prop];\n            }\n        }\n        return item;\n    }\n    /**\n     * Upsert an item. `validateNew` will be run on the item before it is created.\n     * Null/undefined parameters will not be updated.\n     *\n     * @param {object} obj\n     * @returns {object}\n     * @memberof MockAPIController\n     */\n    upsert(obj) {\n        if (this.rawFind(obj)) {\n            return this.updateIfFound(obj);\n        }\n        this.validateNew(obj);\n        return this.create(obj);\n    }\n}\n\n/**\n * Extract the earliest start date and latest end date from\n * an array of wage chunks.\n *\n * @export\n * @param {[object]} wageChunks\n * @returns {{start_date: date, end_date: date}}\n */\nexport function wageChunkArrayToStartAndEndDates(wageChunks) {\n    const startDates = wageChunks.map((x) => x.start_date);\n    const endDates = wageChunks.map((x) => x.end_date);\n    startDates.sort();\n    endDates.sort();\n    return {\n        start_date: startDates[0],\n        end_date: endDates[endDates.length - 1],\n    };\n}\n\n/**\n * Join an array of strings with the conjunction \"and\", if suitable.\n *\n * @param {[string]} items\n * @returns {string}\n */\nfunction joinWithConjunction(items) {\n    if (items == null || items.length === 0) {\n        return \"\";\n    }\n    if (items.length === 1) {\n        return items[0];\n    }\n    if (items.length === 2) {\n        return `${items[0]} and ${items[1]}`;\n    }\n    items = [...items];\n    items[items.length - 1] = \"and \" + items[items.length - 1];\n    return items.join(\", \");\n}\n\n/**\n * Format a list of instructors to appear in a contract.\n *\n * @export\n * @param {[object]} instructors\n * @returns {string}\n */\nexport function formatInstructorsContact(instructors) {\n    if (!instructors) {\n        return [];\n    }\n    const contacts = instructors.map(\n        (x) => `${x.first_name} ${x.last_name} <${x.email}>`\n    );\n    return joinWithConjunction(contacts);\n}\n\n/**\n * Take an array of wage chunks and create a formatted string describing every separate\n * pay period. If there are multiple wage chunks with the same rate, their hours are combined\n * and the pay window is made large enough to contain those chunks.\n *\n * @export\n * @param {[object]} wageChunks\n * @returns {string}\n */\nexport function wageChunkArrayToPayPeriodDescription(wageChunks) {\n    // Every different pay rate needs to be explained separately\n    // So first make a hash based on pay rates\n    const rateData = {};\n    for (const wageChunk of wageChunks) {\n        let { rate, start_date, end_date, hours } = wageChunk;\n        start_date = new Date(start_date);\n        end_date = new Date(end_date);\n        rateData[rate] = rateData[rate] || { hours: 0, rate };\n        const data = rateData[rate];\n        data.hours += hours;\n        data.start_date = data.start_date || start_date;\n        data.start_date = Math.min(data.start_date, start_date);\n        data.end_date = data.end_date || end_date;\n        data.end_date = Math.max(data.end_date, end_date);\n    }\n    const descriptions = Object.values(rateData).map(\n        ({ hours, rate, start_date, end_date }) => {\n            start_date = new Date(start_date);\n            end_date = new Date(end_date);\n\n            return `${hours} hours at $${rate}/hour from ${start_date.toLocaleDateString(\n                \"EN-ca\",\n                { month: \"long\", day: \"numeric\", year: \"numeric\" }\n            )} to ${end_date.toLocaleDateString(\"EN-ca\", {\n                month: \"long\",\n                day: \"numeric\",\n                year: \"numeric\",\n            })}`;\n        }\n    );\n\n    return joinWithConjunction(descriptions);\n}\n\n/**\n * Return a copy of `obj` but filter out any properties whose value\n * is `null` or `undefined`.\n *\n * @export\n * @param {*} obj\n * @returns\n */\nexport function filterNullProps(obj) {\n    const ret = {};\n    for (const key in obj) {\n        if (obj[key] != null) {\n            ret[key] = obj[key];\n        }\n    }\n    return ret;\n}\n\nexport function errorUnlessRole({ role }, targetRule = \"admin\") {\n    if (role !== targetRule) {\n        throw new Error(`Invalid route for user with role '${role}'`);\n    }\n}\n\n/**\n * Recursively traverse the object `obj` and delete any property with key `prop`.\n *\n * @export\n * @param {*} obj\n * @param {string} [prop=\"id\"]\n * @returns\n */\nexport function recursiveDeleteProp(obj, prop = \"id\") {\n    if (typeof obj != \"object\" || obj == null) {\n        return;\n    }\n    if (Array.isArray(obj)) {\n        for (const elm of obj) {\n            recursiveDeleteProp(elm, prop);\n        }\n        return;\n    }\n    delete obj[prop];\n    for (const elm of Object.values(obj)) {\n        recursiveDeleteProp(elm, prop);\n    }\n}\n\n//\n// Base64 Encoding functions from\n// https://gist.github.com/enepomnyaschih/72c423f727d395eeaa09697058238727\n//\n\n/*\nMIT License\nCopyright (c) 2020 Egor Nepomnyaschih\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n/*\n// This constant can also be computed with the following algorithm:\nconst base64abc = [],\n\tA = \"A\".charCodeAt(0),\n\ta = \"a\".charCodeAt(0),\n\tn = \"0\".charCodeAt(0);\nfor (let i = 0; i < 26; ++i) {\n\tbase64abc.push(String.fromCharCode(A + i));\n}\nfor (let i = 0; i < 26; ++i) {\n\tbase64abc.push(String.fromCharCode(a + i));\n}\nfor (let i = 0; i < 10; ++i) {\n\tbase64abc.push(String.fromCharCode(n + i));\n}\nbase64abc.push(\"+\");\nbase64abc.push(\"/\");\n*/\nconst base64abc = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\".split(\n    \"\"\n);\n\n// This constant can also be computed with the following algorithm:\nconst l = 256,\n    base64codes = new Uint8Array(l);\nfor (let i = 0; i < l; ++i) {\n    base64codes[i] = 255; // invalid character\n}\nbase64abc.forEach((char, index) => {\n    base64codes[char.charCodeAt(0)] = index;\n});\nbase64codes[\"=\".charCodeAt(0)] = 0; // ignored anyway, so we just need to prevent an error\n//const base64codes = [\n//\t255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n//\t255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n//\t255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 62, 255, 255, 255, 63,\n//\t52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 255, 255, 255, 0, 255, 255,\n//\t255, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,\n//\t15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 255, 255, 255, 255, 255,\n//\t255, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,\n//\t41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51\n//];\n\nfunction getBase64Code(charCode) {\n    if (charCode >= base64codes.length) {\n        throw new Error(\"Unable to parse base64 string.\");\n    }\n    const code = base64codes[charCode];\n    if (code === 255) {\n        throw new Error(\"Unable to parse base64 string.\");\n    }\n    return code;\n}\n\nexport function bytesToBase64(bytes) {\n    let result = \"\",\n        i,\n        l = bytes.length;\n    for (i = 2; i < l; i += 3) {\n        result += base64abc[bytes[i - 2] >> 2];\n        result += base64abc[((bytes[i - 2] & 0x03) << 4) | (bytes[i - 1] >> 4)];\n        result += base64abc[((bytes[i - 1] & 0x0f) << 2) | (bytes[i] >> 6)];\n        result += base64abc[bytes[i] & 0x3f];\n    }\n    if (i === l + 1) {\n        // 1 octet yet to write\n        result += base64abc[bytes[i - 2] >> 2];\n        result += base64abc[(bytes[i - 2] & 0x03) << 4];\n        result += \"==\";\n    }\n    if (i === l) {\n        // 2 octets yet to write\n        result += base64abc[bytes[i - 2] >> 2];\n        result += base64abc[((bytes[i - 2] & 0x03) << 4) | (bytes[i - 1] >> 4)];\n        result += base64abc[(bytes[i - 1] & 0x0f) << 2];\n        result += \"=\";\n    }\n    return result;\n}\n\nexport function base64ToBytes(str) {\n    if (str.length % 4 !== 0) {\n        throw new Error(\"Unable to parse base64 string.\");\n    }\n    const index = str.indexOf(\"=\");\n    if (index !== -1 && index < str.length - 2) {\n        throw new Error(\"Unable to parse base64 string.\");\n    }\n    let missingOctets = str.endsWith(\"==\") ? 2 : str.endsWith(\"=\") ? 1 : 0,\n        n = str.length,\n        result = new Uint8Array(3 * (n / 4)),\n        buffer;\n    for (let i = 0, j = 0; i < n; i += 4, j += 3) {\n        buffer =\n            (getBase64Code(str.charCodeAt(i)) << 18) |\n            (getBase64Code(str.charCodeAt(i + 1)) << 12) |\n            (getBase64Code(str.charCodeAt(i + 2)) << 6) |\n            getBase64Code(str.charCodeAt(i + 3));\n        result[j] = buffer >> 16;\n        result[j + 1] = (buffer >> 8) & 0xff;\n        result[j + 2] = buffer & 0xff;\n    }\n    return result.subarray(0, result.length - missingOctets);\n}\n\nexport function base64encode(str, encoder = new TextEncoder()) {\n    return bytesToBase64(encoder.encode(str));\n}\n\nexport function base64decode(str, decoder = new TextDecoder()) {\n    return decoder.decode(base64ToBytes(str));\n}\n","import { error } from \"react-notification-system-redux\";\n\n// these properties are for `react-notification-system-redux`\nconst defaultNotifProps = {\n    position: \"tr\",\n    autoDismiss: 10,\n    title: \"Error\",\n};\n\nexport const fetchError = (payload) =>\n    error({\n        ...defaultNotifProps,\n        title: \"Error fetching data\",\n        message: payload,\n    });\n\nexport const upsertError = (payload) =>\n    error({\n        ...defaultNotifProps,\n        title: \"Error updating/inserting data\",\n        message: payload,\n    });\n\nexport const deleteError = (payload) =>\n    error({\n        ...defaultNotifProps,\n        title: \"Error deleting data\",\n        message: payload,\n    });\n\n// General error for when a more specific error\n// type is not known\nexport const apiError = (payload) =>\n    error({\n        ...defaultNotifProps,\n        title: \"API Error\",\n        message: payload,\n    });\n","import { API_INTERACTION_START, API_INTERACTION_END } from \"../constants\";\n\n// actions\nexport const apiInteractionStart = (id, message) => ({\n    type: API_INTERACTION_START,\n    payload: { id, message },\n});\nexport const apiInteractionEnd = (id) => ({\n    type: API_INTERACTION_END,\n    payload: { id },\n});\n","export const API_INTERACTION_START = \"API_INTERACTION_START\";\nexport const API_INTERACTION_END = \"API_INTERACTION_END\";\n\n/* Constants were batch-created with the following code:\n\n    let wrap = x => x.map(y => `export const ${y} = \"${y}\";`);\n    console.log(\n        [\n            \"session\",\n            \"instructor\",\n            \"position\",\n            \"assignment\",\n            \"offer\",\n            \"contract_template\",\n            \"application\",\n            \"wage_chunk\"\n        ]\n            .map(x => {\n                x = x.toUpperCase();\n                return [`// \\`${x.toLowerCase()}\\`-related constants`]\n                    .concat(\n                        wrap([\n                            `FETCH_${x}S_SUCCESS`,\n                            `FETCH_ONE_${x}_SUCCESS`,\n                            `UPSERT_ONE_${x}_SUCCESS`,\n                            `DELETE_ONE_${x}_SUCCESS`\n                        ])\n                    )\n                    .join(\"\\n\");\n            })\n            .join(\"\\n\\n\")\n    );\n*/\n\n// `session`-related constants\nexport const FETCH_SESSIONS_SUCCESS = \"FETCH_SESSIONS_SUCCESS\";\nexport const FETCH_ONE_SESSION_SUCCESS = \"FETCH_ONE_SESSION_SUCCESS\";\nexport const UPSERT_ONE_SESSION_SUCCESS = \"UPSERT_ONE_SESSION_SUCCESS\";\nexport const DELETE_ONE_SESSION_SUCCESS = \"DELETE_ONE_SESSION_SUCCESS\";\nexport const SET_ACTIVE_SESSION = \"SET_ACTIVE_SESSION\";\n\n// `instructor`-related constants\nexport const FETCH_INSTRUCTORS_SUCCESS = \"FETCH_INSTRUCTORS_SUCCESS\";\nexport const FETCH_ONE_INSTRUCTOR_SUCCESS = \"FETCH_ONE_INSTRUCTOR_SUCCESS\";\nexport const UPSERT_ONE_INSTRUCTOR_SUCCESS = \"UPSERT_ONE_INSTRUCTOR_SUCCESS\";\nexport const DELETE_ONE_INSTRUCTOR_SUCCESS = \"DELETE_ONE_INSTRUCTOR_SUCCESS\";\nexport const ADD_INSTRUCTOR_TO_POSITION_SUCCESS =\n    \"ADD_INSTRUCTOR_TO_POSITION_SUCCESS\";\n\n// `position`-related constants\nexport const FETCH_POSITIONS_SUCCESS = \"FETCH_POSITIONS_SUCCESS\";\nexport const FETCH_ONE_POSITION_SUCCESS = \"FETCH_ONE_POSITION_SUCCESS\";\nexport const UPSERT_POSITIONS_SUCCESS = \"UPSERT_POSITIONS_SUCCESS\";\nexport const UPSERT_ONE_POSITION_SUCCESS = \"UPSERT_ONE_POSITION_SUCCESS\";\nexport const DELETE_ONE_POSITION_SUCCESS = \"DELETE_ONE_POSITION_SUCCESS\";\n\n// `assignment`-related constants\nexport const FETCH_ASSIGNMENTS_SUCCESS = \"FETCH_ASSIGNMENTS_SUCCESS\";\nexport const FETCH_ONE_ASSIGNMENT_SUCCESS = \"FETCH_ONE_ASSIGNMENT_SUCCESS\";\nexport const UPSERT_ONE_ASSIGNMENT_SUCCESS = \"UPSERT_ONE_ASSIGNMENT_SUCCESS\";\nexport const DELETE_ONE_ASSIGNMENT_SUCCESS = \"DELETE_ONE_ASSIGNMENT_SUCCESS\";\n\n// `offer`-related constants\nexport const FETCH_OFFERS_SUCCESS = \"FETCH_OFFERS_SUCCESS\";\nexport const FETCH_ONE_OFFER_SUCCESS = \"FETCH_ONE_OFFER_SUCCESS\";\nexport const UPSERT_ONE_OFFER_SUCCESS = \"UPSERT_ONE_OFFER_SUCCESS\";\nexport const DELETE_ONE_OFFER_SUCCESS = \"DELETE_ONE_OFFER_SUCCESS\";\nexport const SET_OFFER_ACCEPTED_SUCCESS = \"SET_OFFER_ACCEPTED_SUCCESS\";\nexport const SET_OFFER_REJECTED_SUCCESS = \"SET_OFFER_REJECTED_SUCCESS\";\nexport const OFFER_CREATE_SUCCESS = \"OFFER_CREATE_SUCCESS\";\nexport const OFFER_EMAIL_SUCCESS = \"OFFER_EMAIL_SUCCESS\";\nexport const OFFER_NAG_SUCCESS = \"OFFER_NAG_SUCCESS\";\nexport const OFFER_WITHDRAW_SUCCESS = \"OFFER_WITHDRAW_SUCCESS\";\n\n// `contract_template`-related constants\nexport const FETCH_CONTRACT_TEMPLATES_SUCCESS =\n    \"FETCH_CONTRACT_TEMPLATES_SUCCESS\";\nexport const FETCH_ONE_CONTRACT_TEMPLATE_SUCCESS =\n    \"FETCH_ONE_CONTRACT_TEMPLATE_SUCCESS\";\nexport const UPSERT_ONE_CONTRACT_TEMPLATE_SUCCESS =\n    \"UPSERT_ONE_CONTRACT_TEMPLATE_SUCCESS\";\nexport const DELETE_ONE_CONTRACT_TEMPLATE_SUCCESS =\n    \"DELETE_ONE_CONTRACT_TEMPLATE_SUCCESS\";\nexport const FETCH_ALL_CONTRACT_TEMPLATES_SUCCESS =\n    \"FETCH_ALL_CONTRACT_TEMPLATES_SUCCESS\";\n\n// `application`-related constants\nexport const FETCH_APPLICATIONS_SUCCESS = \"FETCH_APPLICATIONS_SUCCESS\";\nexport const FETCH_ONE_APPLICATION_SUCCESS = \"FETCH_ONE_APPLICATION_SUCCESS\";\nexport const UPSERT_ONE_APPLICATION_SUCCESS = \"UPSERT_ONE_APPLICATION_SUCCESS\";\nexport const DELETE_ONE_APPLICATION_SUCCESS = \"DELETE_ONE_APPLICATION_SUCCESS\";\n\n// `wage_chunk`-related constants\nexport const FETCH_WAGE_CHUNKS_SUCCESS = \"FETCH_WAGE_CHUNKS_SUCCESS\";\nexport const FETCH_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS =\n    \"FETCH_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS\";\nexport const UPSERT_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS =\n    \"UPSERT_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS\";\nexport const FETCH_ONE_WAGE_CHUNK_SUCCESS = \"FETCH_ONE_WAGE_CHUNK_SUCCESS\";\nexport const UPSERT_ONE_WAGE_CHUNK_SUCCESS = \"UPSERT_ONE_WAGE_CHUNK_SUCCESS\";\nexport const DELETE_ONE_WAGE_CHUNK_SUCCESS = \"DELETE_ONE_WAGE_CHUNK_SUCCESS\";\n\n// `applicant`-related constants\nexport const FETCH_APPLICANTS_SUCCESS = \"FETCH_APPLICANTS_SUCCESS\";\nexport const FETCH_ONE_APPLICANT_SUCCESS = \"FETCH_ONE_APPLICANT_SUCCESS\";\nexport const UPSERT_ONE_APPLICANT_SUCCESS = \"UPSERT_ONE_APPLICANT_SUCCESS\";\nexport const DELETE_ONE_APPLICANT_SUCCESS = \"DELETE_ONE_APPLICANT_SUCCESS\";\nexport const ADD_APPLICANT_TO_SESSION_SUCCESS =\n    \"ADD_APPLICANT_TO_SESSION_SUCCESS\";\n\n// `user`/`active_user` constants\nexport const FETCH_ACTIVE_USER_SUCCESS = \"FETCH_ACTIVE_USER_SUCCESS\";\nexport const SET_ACTIVE_USER_ROLE_SUCCESS = \"SET_ACTIVE_USER_ROLE_SUCCESS\";\nexport const FETCH_USERS_SUCCESS = \"FETCH_USERS_SUCCESS\";\nexport const UPSERT_USERS_SUCCESS = \"UPSERT_USERS_SUCCESS\";\n\n// `ddah`-related constants\nexport const FETCH_DDAHS_SUCCESS = \"FETCH_DDAHS_SUCCESS\";\nexport const FETCH_ONE_DDAH_SUCCESS = \"FETCH_ONE_DDAH_SUCCESS\";\nexport const UPSERT_ONE_DDAH_SUCCESS = \"UPSERT_ONE_DDAH_SUCCESS\";\nexport const DELETE_ONE_DDAH_SUCCESS = \"DELETE_ONE_DDAH_SUCCESS\";\nexport const DDAH_APPROVE_SUCCESS = \"DDAH_APPROVE_SUCCESS\";\nexport const DDAH_EMAIL_SUCCESS = \"DDAH_EMAIL_SUCCESS\";\nexport const DDAH_ACCEPT_SUCCESS = \"DDAH_ACCEPT_SUCCESS\";\nexport const DDAH_REJECT_SUCCESS = \"DDAH_REJECT_SUCCESS\";\n\n// `debug` constants\nexport const DEBUG_SET_ACTIVE_USER_SUCCESS = \"DEBUG_SET_ACTIVE_USER_SUCCESS\";\n\n// global constants\nexport const SET_GLOBALS = \"SET_GLOBALS\";\n","import uuid from \"uuid-random\";\nimport PropTypes from \"prop-types\";\nimport { apiError } from \"./errors\";\nimport { apiInteractionStart, apiInteractionEnd } from \"./status\";\n\n/**\n * Turn an array of items into a hash of items indexed\n * by the value of `indexBy`\n *\n * @export\n * @param {array} l\n * @param {string} [indexBy=\"id\"]\n * @returns {object[]}\n */\nexport function arrayToHash(l, indexBy = \"id\") {\n    if (!Array.isArray(l)) {\n        return l;\n    }\n    const ret = {};\n    for (const d of l) {\n        ret[d[indexBy]] = d;\n    }\n    return ret;\n}\n\n/**\n * Creates an action function that returns an object of the form\n * ```\n *    {\n *        type: TYPE,\n *        payload: payload\n *    }\n * ```\n * This factory function can be used if your action is of this standard form.\n *\n * @export\n * @param {string} type\n * @returns {function(object): {type: string, payload: object}}\n */\nexport function actionFactory(type) {\n    return (payload) => ({\n        type,\n        payload,\n    });\n}\n\n/**\n * Split an object into two objects. One with only properties listed in\n * `props` and the other with all remaining properties.\n *\n * @param {*} obj - object to be split\n * @param {*} [props=[]] - list of properties to split out\n * @returns {[object, object]} list of two objects. The first contains all properties not listed in `props`. The second contains all properties listed in `props`\n */\nexport function splitObjByProps(obj, props = []) {\n    const ret = {},\n        filtered = {};\n    for (const prop of props) {\n        if (Object.hasOwnProperty.call(obj, prop)) {\n            filtered[prop] = obj[prop];\n        }\n    }\n    for (const prop in obj) {\n        if (!Object.hasOwnProperty.call(filtered, prop)) {\n            ret[prop] = obj[prop];\n        }\n    }\n    return [ret, filtered];\n}\n\n/**\n * Create a function that takes an `obj` object. It effectively does\n * `obj[outPropName] = obj[inPropName].id; delete obj[inPropName]` but\n * is non-destructive.\n *\n * @export\n * @param {string} inPropName\n * @param {string} outPropName\n * @param {boolean} [isArrayOfIds=false]\n * @returns\n */\nexport function flattenIdFactory(\n    inPropName,\n    outPropName,\n    isArrayOfIds = false\n) {\n    return function (obj) {\n        // if the `inPropName` field doesn't exist, don't change anything\n        // and don't error!\n        if (obj[inPropName] == null) {\n            return obj;\n        }\n        const [ret, filtered] = splitObjByProps(obj, [inPropName]);\n        if (isArrayOfIds) {\n            ret[outPropName] = filtered[inPropName].map((x) => x.id);\n        } else {\n            ret[outPropName] = filtered[inPropName].id;\n        }\n        return ret;\n    };\n}\n/**\n * Create a dispatcher that validates `payload` accoring to the specified\n * `propTypes`. If validation fails, a warning will be printed to the console\n * and exectution of the dispatcher will stop. This function also wraps the\n * dispatch in `apiInteractionStart` and `apiInteractionEnd` actions.\n *\n * If the action only accepts one argument, then `propTypes` should be a single\n * `PropTypes` object (e.g., `{id: PropTypes.any.isRequired}`). If the action\n * accepts multiple arguments, `propTypes` should be an array (of length the number\n * of accepted arguments) of `PropTypes` objects.\n *\n * @export\n * @param {object} obj An object with information to create an action\n * @param {function} obj.dispatcher The action that will be dispatched after validation passes\n * @param {string} obj.name The name of the action\n * @param {string} obj.description A description of what the action does\n * @param {?(PropTypes|PropTypes[])} obj.propTypes A PropTypes object or an array of PropTypes objects\n * @param {?(function|boolean)} obj.onErrorDispatch Function that returns an action to be executed on error, or boolean `true` to autogenerate an error action\n * @returns {function} A redux-thunk action\n */\nexport function validatedApiDispatcher({\n    dispatcher,\n    // eslint-disable-next-line react/forbid-foreign-prop-types\n    propTypes,\n    name,\n    description,\n    onErrorDispatch,\n}) {\n    return (...args) => {\n        // we return a new dispatcher that performs some validation\n        // and then dispatches as usual\n        return async (dispatch) => {\n            // validate `args`. `args` is an array containing the arguments.\n            // if propTypes is an array, it lists the propTypes for every argument,\n            // otherwise there is just one argument.\n\n            let wasPropTypesError = false;\n            // This function performs the actual PropType check with extra arguments that\n            // will make the warnings in the console more descriptive\n            function propTypeCheck(propTypes, arg) {\n                PropTypes.checkPropTypes(\n                    propTypes,\n                    arg || {},\n                    \"api action argument\",\n                    name,\n                    () => {\n                        wasPropTypesError = true;\n                    }\n                );\n            }\n            if (Array.isArray(propTypes)) {\n                if (propTypes.length !== args.length) {\n                    wasPropTypesError = true;\n                } else {\n                    for (let i = 0; i < propTypes.length; i++) {\n                        propTypeCheck(propTypes[i], args[i]);\n                    }\n                }\n            } else if (propTypes) {\n                propTypeCheck(propTypes, args[0]);\n            }\n            if (wasPropTypesError) {\n                dispatch(\n                    apiError(\n                        `Invalid arguments to ${name} while attempting action \"${description}\"`\n                    )\n                );\n                return;\n            }\n\n            // Declare the start of an API interaction. Generate a `statusId`\n            // so that we can specify which API interaction is ending (since multiple\n            // ones may be going at the same time).\n            const statusId = uuid();\n            dispatch(apiInteractionStart(statusId, description));\n            try {\n                // We need to await so that promise errors get thrown\n                // as real errors\n                return await dispatch(dispatcher(...args));\n            } catch (e) {\n                console.warn(\"API Error\", e);\n                if (onErrorDispatch) {\n                    if (onErrorDispatch instanceof Function) {\n                        dispatch(onErrorDispatch(e));\n                    } else {\n                        dispatch(\n                            apiError(\n                                `Error encountered during \"${description}\"`\n                            )\n                        );\n                    }\n                } else {\n                    throw e;\n                }\n            } finally {\n                // Always declare the API interaction done, even\n                // if there was an error somewhere along the way.\n                dispatch(apiInteractionEnd(statusId));\n            }\n        };\n    };\n}\n","/*\n * A collection of untilty functions for interfacing with the API\n */\n\nconst API_URL = \"/api/v1\";\nconst FETCH_INIT = {\n    credentials: \"same-origin\",\n    headers: {\n        \"Content-Type\": \"application/json\",\n    },\n};\n\n/**\n * Error thrown whenever an api call returns with `status===\"error\"`\n *\n * @class ApiError\n * @extends {Error}\n */\nclass ApiError extends Error {\n    constructor(resp) {\n        const errorMessage = resp.message;\n        super(errorMessage);\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, ApiFetchError);\n        }\n        this.response = resp;\n        this.status = resp.status;\n    }\n}\n\n/**\n * Error thrown whenever an api fetch request\n * returns with a status other than 200\n *\n * @class ApiFetchError\n * @extends {ApiError}\n */\nclass ApiFetchError extends ApiError {\n    constructor(resp, path) {\n        const errorMessage = `Got status ${resp.status} ${\n            resp.statusText\n        } when fetching ${API_URL + path}`;\n        super({ message: errorMessage });\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, ApiFetchError);\n        }\n        this.response = resp;\n        this.status = resp.status;\n    }\n}\n\n// Ensure that `path` starts with a `/`\nfunction _ensurePath(path) {\n    return path.startsWith(\"/\") ? path : \"/\" + path;\n}\n\n// Process a `fetch` response from the API.\n// Successful responses from the API should be of\n// the form `{status: (\"success\"|\"error\"), message: \"...\", payload: ...}.\n// Throw an error on a failed HTTP request or a `status !== \"success\"`\n// response from the API.\nasync function _processFetchResponse(resp, path) {\n    if (resp.status === 200) {\n        const json = await resp.json();\n        if (json.status !== \"success\") {\n            // If we got random JSON instead of {status: ..., message: ..., payload: ...}\n            // There will be no `json.message`. Provide a default message that will get\n            // overridden in this case\n            throw new ApiError({\n                message: \"Server response did not have `status === 'success`\",\n                ...json,\n            });\n        }\n        return json.payload;\n    }\n    // if we made it this far, there was a bad status\n    // returned during fetch\n    throw new ApiFetchError(resp, path);\n}\n\n/**\n * Do a GET requestion on the specified api route\n *\n * @param {string} path\n * @returns {Promise<object>} Promise containing the processed JSON response\n * @throws {(ApiError|ApiFetchError|Error)} Throws an error if the fetch fails or returns with `status===\"error\"`\n */\nasync function apiGET(path) {\n    // remove a leading \"/\" if there is one in `path`\n    path = _ensurePath(path);\n    const resp = await fetch(API_URL + path, {\n        ...FETCH_INIT,\n        method: \"GET\",\n    });\n    return await _processFetchResponse(resp, path);\n}\n\n/**\n * Do a POST requestion on the specified api route\n *\n * @param {string} path\n * @param {object} [body={}]\n * @returns {Promise<object>} Promise containing the processed JSON response\n * @throws {(ApiError|ApiFetchError|Error)} Throws an error if the fetch fails or returns with `status===\"error\"`\n */\nasync function apiPOST(path, body = {}) {\n    // remove a leading \"/\" if there is one in `path`\n    path = _ensurePath(path);\n    const resp = await fetch(API_URL + path, {\n        ...FETCH_INIT,\n        method: \"POST\",\n        body: JSON.stringify(body),\n    });\n    return await _processFetchResponse(resp, path);\n}\n\nexport { API_URL, ApiError, ApiFetchError, apiGET, apiPOST };\n","/*\n * A set of utility functions to help with creating reducers\n */\n\nimport { combineReducers as _origCombineReducers } from \"redux\";\nimport { createReducer as _origCreateReducer } from \"redux-create-reducer\";\n\n/**\n * Either updates the item `modelData`\n * with id == newItem.id, or appends it.\n *\n * @param {object} modelData\n * @param {object} newItem\n * @returns {object} An updated version of modelData\n */\nexport function upsertItem(modelData, newItem) {\n    let didUpdate = false;\n    const newModelData = modelData.map((item) => {\n        if (item.id === newItem.id) {\n            didUpdate = true;\n            return newItem;\n        }\n        return item;\n    });\n    if (!didUpdate) {\n        newModelData.push(newItem);\n    }\n    return newModelData;\n}\n\n/**\n * Create a basic reducer for the operations\n *   FETCH_MANY\n *   FETCH_ONE\n *   UPSERT_ONE\n *   DELETE_ONE\n * A basic reducer assumes that `state._modelData` is\n * an array and that each item in that array has an `id`\n * that can be used to determine upserts and deletes, etc..\n *\n * @param {string} FETCH_MANY\n * @param {string} FETCH_ONE\n * @param {string} UPSERT_ONE\n * @param {string} DELETE_ONE\n * @returns {object} An object of reducers suitable for passing to `createReducer`\n */\nexport function createBasicReducerObject(\n    FETCH_MANY,\n    FETCH_ONE,\n    UPSERT_ONE,\n    DELETE_ONE\n) {\n    return {\n        [FETCH_MANY]: (state, action) => ({\n            ...state,\n            _modelData: action.payload,\n        }),\n        [FETCH_ONE]: (state, action) => ({\n            ...state,\n            _modelData: upsertItem(state._modelData, action.payload),\n        }),\n        [UPSERT_ONE]: (state, action) => ({\n            ...state,\n            _modelData: upsertItem(state._modelData, action.payload),\n        }),\n        [DELETE_ONE]: (state, action) => {\n            const deletedItem = action.payload;\n            return {\n                ...state,\n                _modelData: state._modelData.filter(\n                    (item) => item.id !== deletedItem.id\n                ),\n            };\n        },\n    };\n}\n\n/**\n * Wraps \"redux-create-reducer\"'s version of `createReducer` to add\n * a `_storePath` attribute to the initial state and the reducer.\n * `_storePath` is used by `localStoreSelector` to return the local\n * state when passed in the global state. (For example, if\n *    `state = { a: b: localState }`, then `localStoreSelector(state) === localState`.)\n *\n * @param {object} initialState\n * @param {object} handlers\n * @returns\n */\nexport function createReducer(initialState, handlers) {\n    const path = [];\n    function pushToPath(dir) {\n        path.unshift(dir);\n    }\n    // Every isolated state should have a unique id, so generate\n    // a random one.\n    const _storePath = { id: Math.random(), path, pushToPath };\n\n    // add _storePath to the initial state and to the\n    // new reducer\n    initialState._storePath = _storePath;\n    const reducer = _origCreateReducer(initialState, handlers);\n    reducer._storePath = _storePath;\n\n    // For convenience, attach a local store selector to the reducer\n    reducer._localStoreSelector = createLocalStoreSelector(_storePath);\n\n    return reducer;\n}\n\n/**\n * Search `state` for a local state in the location of `_storePath.path`.\n * For example, if `_storePath.path = [\"a\", \"b\"]`, this function will\n * return `state.a.b`.\n *\n * @param {object} state Redux state\n * @param {object} _storePath The `_storePath` object to use for searching `state`\n * @returns\n */\nfunction _localStoreSelector(state, _storePath) {\n    if (state._storePath && state._storePath.id === _storePath.id) {\n        return state;\n    }\n    try {\n        let localState = state;\n        for (const dir of _storePath.path) {\n            localState = localState[dir];\n        }\n        return localState;\n    } catch (e) {\n        // eslint-disable-next-line\n        console.error(\n            \"Searching\",\n            state,\n            \"for local state with path\",\n            _storePath.join(\".\"),\n            \"but encountered an error\"\n        );\n    }\n    return state;\n}\n\n/**\n * Create a selector that, when passed in the global redux state, will search\n * and return a local state based on the information in `_storePath`. This selector\n * can be passed either the local state or the global state. If it is passed the local\n * state, it checks that the `state._storePath.id` field matches `_storePath.id`;\n * if so, this selector immediately returns `state`. Otherwise, use `_storePath.path`\n * to search for the local state. For example, if `_storePath.path = [\"a\", \"b\"]`,\n * the returned selector will return `state.a.b`.\n *\n * @export\n * @param {object} _storePath\n * @param {array} _storePath.path The path to search in the redux state\n * @param {array} _storePath.id The unique id of the local state\n * @returns {Function} A selector that returns the local state (based on `_storePath`) when passed the global state\n */\nexport function createLocalStoreSelector(_storePath) {\n    return (state) => _localStoreSelector(state, _storePath);\n}\n\n/**\n * Wraps \"redux\"'s `combineReducers` function so that `reducer._storePath.pushToPath`\n * is called on all child reducers.\n *\n * Redux's `combineReducers` function creates a new reducer from `model` that dispatches\n * actions to all reducers listed in `model`, but passes them an isolated part of the\n * store instead of passing in the full redux store as `state`. This is great for writing\n * reducers, but it makes things complicated for writing selectors, since, in general,\n * a selector will get passed the whole state, not the isolated part of the state that\n * `combineReducers` supplies. This wrapped version of `combineReducers` adds to a `path`\n * variable that is present in each reducer and which can be passed to a smart selector.\n *\n * @export\n * @param {object} model An object whose values are reducers\n * @returns {Function} A reducer\n */\nexport function combineReducers(model) {\n    const pushToPathCallbacks = [];\n    // recursively call all `pushToPath` functions.\n    // They have been stored in `pushToPathCallbacks`\n    function pushToPath(dir) {\n        for (const func of pushToPathCallbacks) {\n            func(dir);\n        }\n    }\n\n    for (const [dir, reducer] of Object.entries(model)) {\n        if (reducer._storePath) {\n            reducer._storePath.pushToPath(dir);\n            pushToPathCallbacks.push(reducer._storePath.pushToPath);\n        }\n    }\n\n    const newReducer = _origCombineReducers(model);\n    newReducer._storePath = { pushToPath };\n\n    return newReducer;\n}\n","import {\n    FETCH_SESSIONS_SUCCESS,\n    FETCH_ONE_SESSION_SUCCESS,\n    UPSERT_ONE_SESSION_SUCCESS,\n    DELETE_ONE_SESSION_SUCCESS,\n    SET_ACTIVE_SESSION,\n} from \"../constants\";\nimport { createBasicReducerObject, createReducer } from \"./utils\";\n\nconst initialState = {\n    _modelData: [],\n    activeSession: null,\n};\n\n// basicReducers is an object whose keys are FETCH_SESSIONS_SUCCESS, etc,\n// and values are the corresponding reducer functions\nconst basicReducers = createBasicReducerObject(\n    FETCH_SESSIONS_SUCCESS,\n    FETCH_ONE_SESSION_SUCCESS,\n    UPSERT_ONE_SESSION_SUCCESS,\n    DELETE_ONE_SESSION_SUCCESS\n);\n\nexport const sessionsReducer = createReducer(initialState, {\n    ...basicReducers,\n    [SET_ACTIVE_SESSION]: (state, action) => ({\n        ...state,\n        activeSession: action.payload,\n    }),\n});\n","import {\n    FETCH_USERS_SUCCESS,\n    FETCH_ACTIVE_USER_SUCCESS,\n    SET_ACTIVE_USER_ROLE_SUCCESS,\n} from \"../constants\";\nimport { createReducer } from \"./utils\";\n\nconst initialState = {\n    users: [],\n    active_user: {},\n    active_role: null,\n};\n\nexport const usersReducer = createReducer(initialState, {\n    [FETCH_ACTIVE_USER_SUCCESS]: (state, action) => ({\n        ...state,\n        active_user: action.payload,\n    }),\n    [FETCH_USERS_SUCCESS]: (state, action) => ({\n        ...state,\n        users: action.payload,\n    }),\n    [SET_ACTIVE_USER_ROLE_SUCCESS]: (state, action) => ({\n        ...state,\n        active_role: action.payload,\n    }),\n});\n","import {\n    FETCH_APPLICANTS_SUCCESS,\n    FETCH_ONE_APPLICANT_SUCCESS,\n    UPSERT_ONE_APPLICANT_SUCCESS,\n    DELETE_ONE_APPLICANT_SUCCESS,\n    ADD_APPLICANT_TO_SESSION_SUCCESS,\n} from \"../constants\";\nimport { createBasicReducerObject, createReducer } from \"./utils\";\n\nconst initialState = {\n    _modelData: [],\n};\n\n// basicReducers is an object whose keys are FETCH_SESSIONS_SUCCESS, etc,\n// and values are the corresponding reducer functions\nconst basicReducers = createBasicReducerObject(\n    FETCH_APPLICANTS_SUCCESS,\n    FETCH_ONE_APPLICANT_SUCCESS,\n    UPSERT_ONE_APPLICANT_SUCCESS,\n    DELETE_ONE_APPLICANT_SUCCESS\n);\n\n/**\n * Produces an array that is the union of `target` and `source`.\n *\n * @param {object[]} target\n * @param {object[]} source\n */\nfunction insertIfMissing(target, source) {\n    const missingItems = [];\n    for (let item of target) {\n        if (!source.some((x) => x.id === item.id)) {\n            // the current item is new\n            missingItems.push(item);\n        }\n    }\n    if (missingItems.length > 0) {\n        return target.concat(missingItems);\n    }\n    return target;\n}\n\nexport const applicantsReducer = createReducer(initialState, {\n    ...basicReducers,\n    [ADD_APPLICANT_TO_SESSION_SUCCESS]: (state, action) => ({\n        ...state,\n        _modelData: insertIfMissing(state._modelData, action.payload),\n    }),\n});\n","import PropTypes from \"prop-types\";\nimport {\n    FETCH_APPLICANTS_SUCCESS,\n    FETCH_ONE_APPLICANT_SUCCESS,\n    UPSERT_ONE_APPLICANT_SUCCESS,\n    DELETE_ONE_APPLICANT_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport { actionFactory, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { applicantsReducer } from \"../reducers/applicants\";\nimport { createSelector } from \"reselect\";\nimport { activeRoleSelector } from \"./users\";\nimport { activeSessionSelector } from \"./sessions\";\n\n// actions\nexport const fetchApplicantsSuccess = actionFactory(FETCH_APPLICANTS_SUCCESS);\nconst fetchOneApplicantSuccess = actionFactory(FETCH_ONE_APPLICANT_SUCCESS);\nconst upsertOneApplicantSuccess = actionFactory(UPSERT_ONE_APPLICANT_SUCCESS);\nconst deleteOneApplicantSuccess = actionFactory(DELETE_ONE_APPLICANT_SUCCESS);\n\n// dispatchers\nexport const fetchApplicants = validatedApiDispatcher({\n    name: \"fetchApplicants\",\n    description: \"Fetch applicants\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        // When we fetch applicants, we only want the applicants associated with the current session\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiGET(\n            `/${role}/sessions/${activeSessionId}/applicants`\n        );\n        dispatch(fetchApplicantsSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchApplicant = validatedApiDispatcher({\n    name: \"fetchApplicant\",\n    description: \"Fetch applicant\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(`/${role}/applicants/${payload.id}`);\n        dispatch(fetchOneApplicantSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertApplicant = validatedApiDispatcher({\n    name: \"upsertApplicant\",\n    description: \"Add/insert applicant\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload, bySession = true) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        let data;\n        if (bySession) {\n            const session = activeSessionSelector(getState());\n            data = await apiPOST(\n                `/${role}/sessions/${session.id}/applicants`,\n                payload\n            );\n        } else {\n            data = await apiPOST(`/${role}/applicants`, payload);\n        }\n        dispatch(upsertOneApplicantSuccess(data));\n        return data;\n    },\n});\n\nexport const deleteApplicant = validatedApiDispatcher({\n    name: \"deleteApplicant\",\n    description: \"Delete applicant\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(`/${role}/applicants/delete`, payload);\n        dispatch(deleteOneApplicantSuccess(data));\n    },\n});\n\nexport const exportApplicants = validatedApiDispatcher({\n    name: \"exportApplicants\",\n    description: \"Export applicants\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (formatter, format = \"spreadsheet\") => async (\n        dispatch,\n        getState\n    ) => {\n        if (!(formatter instanceof Function)) {\n            throw new Error(\n                `\"formatter\" must be a function when using the export action.`\n            );\n        }\n        // Re-fetch all applicants from the server in case things happened to be out of sync.\n        await dispatch(fetchApplicants());\n        const applicants = applicantsSelector(getState());\n\n        return formatter(applicants, format);\n    },\n});\n\nexport const upsertApplicants = validatedApiDispatcher({\n    name: \"upsertApplicants\",\n    description: \"Upsert applicants\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (applicants) => async (dispatch) => {\n        if (applicants.length === 0) {\n            return;\n        }\n        const dispatchers = applicants.map((applicant) =>\n            dispatch(upsertApplicant(applicant))\n        );\n        await Promise.all(dispatchers);\n        // Re-fetch all applicants from the server in case things happened to be out of sync.\n        return await dispatch(fetchApplicants());\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nexport const localStoreSelector = applicantsReducer._localStoreSelector;\nexport const applicantsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\n","import {\n    FETCH_APPLICATIONS_SUCCESS,\n    FETCH_ONE_APPLICATION_SUCCESS,\n    UPSERT_ONE_APPLICATION_SUCCESS,\n    DELETE_ONE_APPLICATION_SUCCESS,\n} from \"../constants\";\nimport { createBasicReducerObject, createReducer } from \"./utils\";\n\nconst initialState = {\n    _modelData: [],\n};\n\n// basicReducers is an object whose keys are FETCH_SESSIONS_SUCCESS, etc,\n// and values are the corresponding reducer functions\nconst basicReducers = createBasicReducerObject(\n    FETCH_APPLICATIONS_SUCCESS,\n    FETCH_ONE_APPLICATION_SUCCESS,\n    UPSERT_ONE_APPLICATION_SUCCESS,\n    DELETE_ONE_APPLICATION_SUCCESS\n);\n\nexport const applicationsReducer = createReducer(initialState, basicReducers);\n","import {\n    FETCH_POSITIONS_SUCCESS,\n    FETCH_ONE_POSITION_SUCCESS,\n    UPSERT_ONE_POSITION_SUCCESS,\n    DELETE_ONE_POSITION_SUCCESS,\n    ADD_INSTRUCTOR_TO_POSITION_SUCCESS,\n} from \"../constants\";\nimport { createBasicReducerObject, createReducer } from \"./utils\";\n\nconst initialState = {\n    _modelData: [],\n};\n\n// basicReducers is an object whose keys are FETCH_SESSIONS_SUCCESS, etc,\n// and values are the corresponding reducer functions\nconst basicReducers = createBasicReducerObject(\n    FETCH_POSITIONS_SUCCESS,\n    FETCH_ONE_POSITION_SUCCESS,\n    UPSERT_ONE_POSITION_SUCCESS,\n    DELETE_ONE_POSITION_SUCCESS\n);\n\nexport const positionsReducer = createReducer(initialState, {\n    ...basicReducers,\n    [ADD_INSTRUCTOR_TO_POSITION_SUCCESS]: (state, action) => {\n        const positionId = action.payload.position.id;\n        const instructors = action.payload.instructors;\n\n        // update the instructors list, but only if we're in the\n        // right position\n        function updateInstructors(position) {\n            if (position.id !== positionId) {\n                return position;\n            }\n            return {\n                ...position,\n                instructors: instructors,\n            };\n        }\n\n        return {\n            ...state,\n            _modelData: state._modelData.map(updateInstructors),\n        };\n    },\n});\n","import {\n    FETCH_INSTRUCTORS_SUCCESS,\n    FETCH_ONE_INSTRUCTOR_SUCCESS,\n    UPSERT_ONE_INSTRUCTOR_SUCCESS,\n    DELETE_ONE_INSTRUCTOR_SUCCESS,\n} from \"../constants\";\nimport { createBasicReducerObject, createReducer } from \"./utils\";\n\nconst initialState = {\n    _modelData: [],\n};\n\n// basicReducers is an object whose keys are FETCH_SESSIONS_SUCCESS, etc,\n// and values are the corresponding reducer functions\nconst basicReducers = createBasicReducerObject(\n    FETCH_INSTRUCTORS_SUCCESS,\n    FETCH_ONE_INSTRUCTOR_SUCCESS,\n    UPSERT_ONE_INSTRUCTOR_SUCCESS,\n    DELETE_ONE_INSTRUCTOR_SUCCESS\n);\n\nexport const instructorsReducer = createReducer(initialState, basicReducers);\n","import PropTypes from \"prop-types\";\nimport {\n    FETCH_INSTRUCTORS_SUCCESS,\n    FETCH_ONE_INSTRUCTOR_SUCCESS,\n    UPSERT_ONE_INSTRUCTOR_SUCCESS,\n    DELETE_ONE_INSTRUCTOR_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport { actionFactory, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { instructorsReducer } from \"../reducers/instructors\";\nimport { createSelector } from \"reselect\";\nimport { activeRoleSelector } from \"./users\";\n\n// actions\nexport const fetchInstructorsSuccess = actionFactory(FETCH_INSTRUCTORS_SUCCESS);\nconst fetchOneInstructorSuccess = actionFactory(FETCH_ONE_INSTRUCTOR_SUCCESS);\nconst upsertOneInstructorSuccess = actionFactory(UPSERT_ONE_INSTRUCTOR_SUCCESS);\nconst deleteOneInstructorSuccess = actionFactory(DELETE_ONE_INSTRUCTOR_SUCCESS);\n\n// dispatchers\nexport const fetchInstructors = validatedApiDispatcher({\n    name: \"fetchInstructors\",\n    description: \"Fetch instructors\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(`/${role}/instructors`);\n        dispatch(fetchInstructorsSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchInstructor = validatedApiDispatcher({\n    name: \"fetchInstructor\",\n    description: \"Fetch instructor\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(`/${role}/instructors/${payload.id}`);\n        dispatch(fetchOneInstructorSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertInstructor = validatedApiDispatcher({\n    name: \"upsertInstructor\",\n    description: \"Add/insert instructor\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(`/${role}/instructors`, payload);\n        dispatch(upsertOneInstructorSuccess(data));\n        return data;\n    },\n});\n\nexport const deleteInstructor = validatedApiDispatcher({\n    name: \"deleteInstructor\",\n    description: \"Delete instructor\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(`/${role}/instructors/delete`, payload);\n        dispatch(deleteOneInstructorSuccess(data));\n    },\n});\n\nexport const exportInstructors = validatedApiDispatcher({\n    name: \"exportInstructors\",\n    description: \"Export instructors\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (formatter, format = \"spreadsheet\") => async (\n        dispatch,\n        getState\n    ) => {\n        if (!(formatter instanceof Function)) {\n            throw new Error(\n                `\"formatter\" must be a function when using the export action.`\n            );\n        }\n        // Re-fetch all instructors from the server in case things happened to be out of sync.\n        await dispatch(fetchInstructors());\n        const instructors = instructorsSelector(getState());\n\n        return formatter(instructors, format);\n    },\n});\n\nexport const upsertInstructors = validatedApiDispatcher({\n    name: \"upsertInstructors\",\n    description: \"Upsert instructors\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (instructors) => async (dispatch) => {\n        if (instructors.length === 0) {\n            return;\n        }\n        const dispatchers = instructors.map((instructor) =>\n            dispatch(upsertInstructor(instructor))\n        );\n        await Promise.all(dispatchers);\n        // Re-fetch all instructors from the server in case things happened to be out of sync.\n        return await dispatch(fetchInstructors());\n    },\n});\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nexport const localStoreSelector = instructorsReducer._localStoreSelector;\nexport const instructorsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\n","import {\n    FETCH_CONTRACT_TEMPLATES_SUCCESS,\n    FETCH_ONE_CONTRACT_TEMPLATE_SUCCESS,\n    UPSERT_ONE_CONTRACT_TEMPLATE_SUCCESS,\n    DELETE_ONE_CONTRACT_TEMPLATE_SUCCESS,\n    FETCH_ALL_CONTRACT_TEMPLATES_SUCCESS,\n} from \"../constants\";\nimport { createBasicReducerObject, createReducer } from \"./utils\";\n\nconst initialState = {\n    _modelData: [],\n    all: [],\n};\n\n// basicReducers is an object whose keys are FETCH_*_SUCCESS, etc,\n// and values are the corresponding reducer functions\nconst basicReducers = createBasicReducerObject(\n    FETCH_CONTRACT_TEMPLATES_SUCCESS,\n    FETCH_ONE_CONTRACT_TEMPLATE_SUCCESS,\n    UPSERT_ONE_CONTRACT_TEMPLATE_SUCCESS,\n    DELETE_ONE_CONTRACT_TEMPLATE_SUCCESS\n);\n\nexport const contractTemplatesReducer = createReducer(initialState, {\n    ...basicReducers,\n    [FETCH_ALL_CONTRACT_TEMPLATES_SUCCESS]: (state, action) => ({\n        ...state,\n        all: action.payload,\n    }),\n});\n","import PropTypes from \"prop-types\";\nimport {\n    FETCH_CONTRACT_TEMPLATES_SUCCESS,\n    UPSERT_ONE_CONTRACT_TEMPLATE_SUCCESS,\n    DELETE_ONE_CONTRACT_TEMPLATE_SUCCESS,\n    FETCH_ALL_CONTRACT_TEMPLATES_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport { actionFactory, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { contractTemplatesReducer } from \"../reducers/contract_templates\";\nimport { createSelector } from \"reselect\";\nimport { activeRoleSelector } from \"./users\";\nimport { bytesToBase64 } from \"../mockAPI/utils\";\n\n// actions\nexport const fetchContractTemplatesSuccess = actionFactory(\n    FETCH_CONTRACT_TEMPLATES_SUCCESS\n);\nconst fetchAllContractTemplatesSuccess = actionFactory(\n    FETCH_ALL_CONTRACT_TEMPLATES_SUCCESS\n);\nconst upsertOneContractTemplateSuccess = actionFactory(\n    UPSERT_ONE_CONTRACT_TEMPLATE_SUCCESS\n);\nconst deleteOneContractTemplateSuccess = actionFactory(\n    DELETE_ONE_CONTRACT_TEMPLATE_SUCCESS\n);\n\n// dispatchers\nexport const fetchContractTemplates = validatedApiDispatcher({\n    name: \"fetchContractTemplates\",\n    description: \"Fetch contract_templates\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiGET(\n            `/${role}/sessions/${activeSessionId}/contract_templates`\n        );\n        dispatch(fetchContractTemplatesSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertContractTemplate = validatedApiDispatcher({\n    name: \"upsertContractTemplate\",\n    description: \"Add/insert contract_template\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiPOST(\n            `/${role}/sessions/${activeSessionId}/contract_templates`,\n            payload\n        );\n        dispatch(upsertOneContractTemplateSuccess(data));\n        return data;\n    },\n});\n\nexport const deleteContractTemplate = validatedApiDispatcher({\n    name: \"deleteContractTemplate\",\n    description: \"Delete contract_template from a session\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiPOST(\n            `/${role}/sessions/${activeSessionId}/contract_templates/delete`,\n            payload\n        );\n        dispatch(deleteOneContractTemplateSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchAllContractTemplates = validatedApiDispatcher({\n    name: \"fetchAllContractTemplates\",\n    description: \"Fetch all available contract_templates\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(`/${role}/available_contract_templates`);\n        dispatch(fetchAllContractTemplatesSuccess(data));\n        return data;\n    },\n});\n\nexport const previewContractTemplate = validatedApiDispatcher({\n    name: \"previewContractTemplate\",\n    description:\n        \"Preview the html content of a contract template. No redux state is set by this call, but the contents of the template is returned.\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (template_id) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(\n            `/${role}/contract_templates/${template_id}/view`\n        );\n        return data;\n    },\n});\n\nexport const downloadContractTemplate = validatedApiDispatcher({\n    name: \"downloadContractTemplate\",\n    description:\n        \"Download the content of a contract template. No redux state is set by this call, but a `File` object with the contents of the template is returned.\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (template_id) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(\n            `/${role}/contract_templates/${template_id}/download`\n        );\n        // The data comes in encoded as base64, so we decode it as binary data.\n        const content = new Uint8Array(\n            atob(data.content)\n                .split(\"\")\n                .map((x) => x.charCodeAt(0))\n        );\n        return new File([content], data.file_name, {\n            type: data.mime_type,\n        });\n    },\n});\n\nexport const uploadContractTemplate = validatedApiDispatcher({\n    name: \"uploadContractTemplate\",\n    description: \"Upload the `File` object as a contract template\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (file) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n\n        // We are expected to upload data in base64, so convert the file\n        // object to base64.\n        const file_name = file.name;\n        const rawContent = new Uint8Array(await file.arrayBuffer());\n        const content = bytesToBase64(rawContent);\n\n        const data = await apiPOST(`/${role}/contract_templates/upload`, {\n            file_name,\n            content,\n        });\n\n        dispatch(fetchAllContractTemplatesSuccess(data));\n        return data;\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nexport const localStoreSelector = contractTemplatesReducer._localStoreSelector;\nexport const contractTemplatesSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\nexport const allContractTemplatesSelector = createSelector(\n    localStoreSelector,\n    (state) => state.all\n);\n","import PropTypes from \"prop-types\";\nimport {\n    FETCH_POSITIONS_SUCCESS,\n    FETCH_ONE_POSITION_SUCCESS,\n    UPSERT_ONE_POSITION_SUCCESS,\n    DELETE_ONE_POSITION_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    validatedApiDispatcher,\n    arrayToHash,\n    flattenIdFactory,\n    splitObjByProps,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { positionsReducer } from \"../reducers/positions\";\nimport { createSelector } from \"reselect\";\nimport { instructorsSelector } from \"./instructors\";\nimport { contractTemplatesSelector } from \"./contract_templates\";\nimport { activeRoleSelector } from \"./users\";\nimport { applicantsSelector } from \"./applicants\";\n\n// actions\nexport const fetchPositionsSuccess = actionFactory(FETCH_POSITIONS_SUCCESS);\nconst fetchOnePositionSuccess = actionFactory(FETCH_ONE_POSITION_SUCCESS);\nconst upsertOnePositionSuccess = actionFactory(UPSERT_ONE_POSITION_SUCCESS);\nconst deleteOnePositionSuccess = actionFactory(DELETE_ONE_POSITION_SUCCESS);\n\n// dispatchers\nexport const fetchPositions = validatedApiDispatcher({\n    name: \"fetchPositions\",\n    description: \"Fetch positions\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(\n            `/${role}/sessions/${activeSessionId}/positions`\n        );\n        dispatch(fetchPositionsSuccess(data));\n    },\n});\n\nexport const fetchPosition = validatedApiDispatcher({\n    name: \"fetchPosition\",\n    description: \"Fetch position\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(\n            `/${role}/sessions/${activeSessionId}/positions/${payload.id}`\n        );\n        dispatch(fetchOnePositionSuccess(data));\n    },\n});\n\n// Some helper functions to convert the data that the UI uses\n// into data that the API can use\nconst instructorsToInstructorIds = flattenIdFactory(\n    \"instructors\",\n    \"instructor_ids\",\n    true\n);\nconst contractTemplateToContractTemplateId = flattenIdFactory(\n    \"contract_template\",\n    \"contract_template_id\"\n);\n\nconst instructorToInstructorId = flattenIdFactory(\n    \"instructor\",\n    \"instructor_id\"\n);\n\nconst applicantToApplicantId = flattenIdFactory(\"applicant\", \"applicant_id\");\n\nfunction prepForApi(data) {\n    const [ret, filtered] = splitObjByProps(data, [\"instructor_preferences\"]);\n\n    if (filtered[\"instructor_preferences\"]) {\n        ret[\"instructor_preferences\"] = filtered[\n            \"instructor_preferences\"\n        ].map((preference) =>\n            applicantToApplicantId(instructorToInstructorId(preference))\n        );\n    }\n\n    return contractTemplateToContractTemplateId(\n        instructorsToInstructorIds(ret)\n    );\n}\n\nexport const upsertPosition = validatedApiDispatcher({\n    name: \"upsertPosition\",\n    description: \"Add/insert position\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/sessions/${activeSessionId}/positions`,\n            prepForApi(payload)\n        );\n        dispatch(upsertOnePositionSuccess(data));\n    },\n});\n\nexport const deletePosition = validatedApiDispatcher({\n    name: \"deletePosition\",\n    description: \"Delete position\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/positions/delete`,\n            prepForApi(payload)\n        );\n        dispatch(deleteOnePositionSuccess(data));\n    },\n});\n\nexport const exportPositions = validatedApiDispatcher({\n    name: \"exportPositions\",\n    description: \"Export positions\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (formatter, format = \"spreadsheet\") => async (\n        dispatch,\n        getState\n    ) => {\n        if (!(formatter instanceof Function)) {\n            throw new Error(\n                `\"formatter\" must be a function when using the export action.`\n            );\n        }\n        // Re-fetch all positions from the server in case things happened to be out of sync.\n        await dispatch(fetchPositions());\n        const positions = positionsSelector(getState());\n\n        return formatter(positions, format);\n    },\n});\n\nexport const upsertPositions = validatedApiDispatcher({\n    name: \"upsertPositions\",\n    description: \"Upsert a list of positions\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (positions) => async (dispatch) => {\n        if (positions.length === 0) {\n            return;\n        }\n        const dispatchers = positions.map((position) =>\n            dispatch(upsertPosition(position))\n        );\n        await Promise.all(dispatchers);\n        // Re-fetch all positions from the server in case things happened to be out of sync.\n        await dispatch(fetchPositions());\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nexport const localStoreSelector = positionsReducer._localStoreSelector;\nconst _positionsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\n/**\n * Get the positions, but populate the `instructors` array with the full instructor\n * information.\n */\nexport const positionsSelector = createSelector(\n    [\n        _positionsSelector,\n        instructorsSelector,\n        contractTemplatesSelector,\n        applicantsSelector,\n    ],\n    (positions, instructors, contractTemplates, applicants) => {\n        // Hash the instructors by `id` for fast lookup\n        const instructorsById = arrayToHash(instructors);\n        const contractTemplatesById = arrayToHash(contractTemplates);\n        const applicantsById = arrayToHash(applicants);\n\n        // Leave all the data alone, except replace the `instructor_ids` list\n        // with the full instructor data.\n        return positions.map(\n            ({\n                instructor_ids,\n                contract_template_id,\n                instructor_preferences,\n                ...rest\n            }) => ({\n                ...rest,\n                // When the instructor list references an instructor that we haven't loaded\n                // we don't want the frontend to crash, so filter out any null instructors\n                instructors: instructor_ids\n                    .map((x) => instructorsById[x])\n                    .filter((x) => x),\n                contract_template: contractTemplatesById[contract_template_id],\n                instructor_preferences: (instructor_preferences || []).map(\n                    ({ applicant_id, instructor_id, ...rest }) => ({\n                        instructor: instructorsById[instructor_id],\n                        applicant: applicantsById[applicant_id],\n                        ...rest,\n                    })\n                ),\n            })\n        );\n    }\n);\n","import PropTypes from \"prop-types\";\nimport {\n    FETCH_APPLICATIONS_SUCCESS,\n    FETCH_ONE_APPLICATION_SUCCESS,\n    UPSERT_ONE_APPLICATION_SUCCESS,\n    DELETE_ONE_APPLICATION_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    arrayToHash,\n    validatedApiDispatcher,\n    flattenIdFactory,\n    splitObjByProps,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { applicationsReducer } from \"../reducers/applications\";\nimport { createSelector } from \"reselect\";\nimport { applicantsSelector } from \"./applicants\";\nimport { activeRoleSelector } from \"./users\";\nimport { positionsSelector } from \"./positions\";\n\n// actions\nexport const fetchApplicationsSuccess = actionFactory(\n    FETCH_APPLICATIONS_SUCCESS\n);\nconst fetchOneApplicationSuccess = actionFactory(FETCH_ONE_APPLICATION_SUCCESS);\nconst upsertOneApplicationSuccess = actionFactory(\n    UPSERT_ONE_APPLICATION_SUCCESS\n);\nconst deleteOneApplicationSuccess = actionFactory(\n    DELETE_ONE_APPLICATION_SUCCESS\n);\n\nconst applicantToApplicantId = flattenIdFactory(\"applicant\", \"applicant_id\");\nconst positionToPositionId = flattenIdFactory(\"position\", \"position_id\");\nfunction prepForApi(data) {\n    const [ret, filtered] = splitObjByProps(data, [\"position_preferences\"]);\n\n    if (filtered[\"position_preferences\"]) {\n        ret[\"position_preferences\"] = filtered[\n            \"position_preferences\"\n        ].map((preference) => positionToPositionId(preference));\n    }\n\n    return applicantToApplicantId(ret);\n}\n\n// dispatchers\nexport const fetchApplications = validatedApiDispatcher({\n    name: \"fetchApplications\",\n    description: \"Fetch applications\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiGET(\n            `/${role}/sessions/${activeSessionId}/applications`\n        );\n        dispatch(fetchApplicationsSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchApplication = validatedApiDispatcher({\n    name: \"fetchApplication\",\n    description: \"Fetch application\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiGET(\n            `/${role}/sessions/${activeSessionId}/applications/${payload.id}`\n        );\n        dispatch(fetchOneApplicationSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertApplication = validatedApiDispatcher({\n    name: \"upsertApplication\",\n    description: \"Add/insert application\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiPOST(\n            `/${role}/sessions/${activeSessionId}/applications`,\n            prepForApi(payload)\n        );\n        dispatch(upsertOneApplicationSuccess(data));\n        return data;\n    },\n});\n\nexport const deleteApplication = validatedApiDispatcher({\n    name: \"deleteApplication\",\n    description: \"Delete application\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiPOST(\n            `/${role}/sessions/${activeSessionId}/applications/delete`,\n            prepForApi(payload)\n        );\n        dispatch(deleteOneApplicationSuccess(data));\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nexport const localStoreSelector = applicationsReducer._localStoreSelector;\nexport const _applicationsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\n\n// Get the current list of applications and recompute `applicant_id` and `position_id`\n// to have corresponding `applicant` and `position` objects\nexport const applicationsSelector = createSelector(\n    [_applicationsSelector, applicantsSelector, positionsSelector],\n    (applications, applicants, positions) => {\n        if (applications.length === 0) {\n            return [];\n        }\n\n        const applicantsById = arrayToHash(applicants);\n        const positionsById = arrayToHash(positions);\n\n        // Change `applicant_id` to the corresponding `applicant` object\n        // and similarly, change each `position_id` in each entry of\n        // `position_preferences` to corresponding `position` object.\n        return applications.map(\n            ({ position_preferences, applicant_id, ...rest }) => ({\n                ...rest,\n                applicant: applicantsById[applicant_id] || {},\n                position_preferences: (position_preferences || []).map(\n                    ({ position_id, ...rest }) => ({\n                        position: positionsById[position_id],\n                        ...rest,\n                    })\n                ),\n            })\n        );\n    }\n);\n","import {\n    FETCH_ASSIGNMENTS_SUCCESS,\n    FETCH_ONE_ASSIGNMENT_SUCCESS,\n    UPSERT_ONE_ASSIGNMENT_SUCCESS,\n    DELETE_ONE_ASSIGNMENT_SUCCESS,\n    FETCH_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS,\n    UPSERT_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS,\n} from \"../constants\";\nimport { createBasicReducerObject, createReducer } from \"./utils\";\n\nconst initialState = {\n    _modelData: [],\n    // Since we don't want to fetch all wage chunks all the time,\n    // we fetch them on a per-assignment basis and store them here.\n    _wageChunksByAssignmentId: {},\n};\n\n// basicReducers is an object whose keys are FETCH_SESSIONS_SUCCESS, etc,\n// and values are the corresponding reducer functions\nconst basicReducers = createBasicReducerObject(\n    FETCH_ASSIGNMENTS_SUCCESS,\n    FETCH_ONE_ASSIGNMENT_SUCCESS,\n    UPSERT_ONE_ASSIGNMENT_SUCCESS,\n    DELETE_ONE_ASSIGNMENT_SUCCESS\n);\n\n/**\n * Given a list of all the wage chunks for a particular assignment,\n * sets the _wageChunksByAssignmentId hash appropriately.\n *\n * @param {*} state\n * @param {{payload: object}} action\n * @returns\n */\nfunction setWageChunks(state, action) {\n    const assignmentId = (action.payload[0] || {}).assignment_id;\n    if (!assignmentId) {\n        return state;\n    }\n    return {\n        ...state,\n        _wageChunksByAssignmentId: {\n            ...state._wageChunksByAssignmentId,\n            [assignmentId]: action.payload,\n        },\n    };\n}\n\nexport const assignmentsReducer = createReducer(initialState, {\n    ...basicReducers,\n    // wage chunks are closely associated with assignments, so their actions happen\n    // here\n    [FETCH_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS]: setWageChunks,\n    [UPSERT_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS]: setWageChunks,\n});\n","import PropTypes from \"prop-types\";\nimport {\n    UPSERT_ONE_WAGE_CHUNK_SUCCESS,\n    DELETE_ONE_WAGE_CHUNK_SUCCESS,\n    FETCH_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS,\n    UPSERT_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport { actionFactory, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { createSelector } from \"reselect\";\nimport { assignmentsReducer } from \"../reducers/assignments\";\nimport { fetchAssignment } from \"./assignments\";\nimport { activeRoleSelector } from \"./users\";\n\n// actions\nconst fetchWageChunksForAssignmentSuccess = actionFactory(\n    FETCH_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS\n);\nconst upsertWageChunksForAssignmentSuccess = actionFactory(\n    UPSERT_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS\n);\nconst upsertOneWageChunkSuccess = actionFactory(UPSERT_ONE_WAGE_CHUNK_SUCCESS);\nconst deleteOneWageChunkSuccess = actionFactory(DELETE_ONE_WAGE_CHUNK_SUCCESS);\n\n// dispatchers\nexport const fetchWageChunksForAssignment = validatedApiDispatcher({\n    name: \"fetchWageChunksForAssignment\",\n    description: \"Fetch wage chunks associated with an assignment\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        // When we fetch wage chunks for an assignment, we only get the wage chunks for that particular assignment\n        const { id: assignmentId } = payload;\n        const data = await apiGET(\n            `/${role}/assignments/${assignmentId}/wage_chunks`\n        );\n        dispatch(fetchWageChunksForAssignmentSuccess(data));\n    },\n});\n\nexport const upsertWageChunksForAssignment = validatedApiDispatcher({\n    name: \"upsertWageChunksForAssignment\",\n    description: \"Fetch wage chunks associated with an assignment\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment, payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        // When we fetch wage chunks for an assignment, we only get the wage chunks for that particular assignment\n        const { id: assignmentId } = assignment;\n        const data = await apiPOST(\n            `/${role}/assignments/${assignmentId}/wage_chunks`,\n            payload\n        );\n        dispatch(upsertWageChunksForAssignmentSuccess(data));\n        // After we update a wage chunk, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const upsertWageChunk = validatedApiDispatcher({\n    name: \"upsertWageChunk\",\n    description: \"Add/insert wage chunk\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(`/${role}/wage_chunks`, payload);\n        dispatch(upsertOneWageChunkSuccess(data));\n    },\n});\n\nexport const deleteWageChunk = validatedApiDispatcher({\n    name: \"deleteWageChunk\",\n    description: \"Delete a wage chunk\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(`/${role}/wage_chunks/delete`, payload);\n        dispatch(deleteOneWageChunkSuccess(data));\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\n\n// wage chunk data is stored with the assignments in the redux store\nexport const localStoreSelector = assignmentsReducer._localStoreSelector;\nexport const wageChunksByAssignmentSelector = createSelector(\n    localStoreSelector,\n    (state) =>\n        function (assignment) {\n            const assignment_id = assignment.id;\n            if (!state._wageChunksByAssignmentId[assignment_id]) {\n                return [];\n            }\n            return state._wageChunksByAssignmentId[assignment_id];\n        }\n);\n","import PropTypes from \"prop-types\";\nimport {\n    FETCH_ASSIGNMENTS_SUCCESS,\n    FETCH_ONE_ASSIGNMENT_SUCCESS,\n    UPSERT_ONE_ASSIGNMENT_SUCCESS,\n    DELETE_ONE_ASSIGNMENT_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    validatedApiDispatcher,\n    arrayToHash,\n    flattenIdFactory,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { assignmentsReducer } from \"../reducers/assignments\";\nimport { createSelector } from \"reselect\";\nimport { applicantsSelector } from \"./applicants\";\nimport { positionsSelector } from \"./positions\";\nimport { activeRoleSelector } from \"./users\";\nimport {\n    fetchWageChunksForAssignment,\n    wageChunksByAssignmentSelector,\n    upsertWageChunksForAssignment,\n} from \"./wage_chunks\";\n\n// actions\nexport const fetchAssignmentsSuccess = actionFactory(FETCH_ASSIGNMENTS_SUCCESS);\nconst fetchOneAssignmentSuccess = actionFactory(FETCH_ONE_ASSIGNMENT_SUCCESS);\nconst upsertOneAssignmentSuccess = actionFactory(UPSERT_ONE_ASSIGNMENT_SUCCESS);\nconst deleteOneAssignmentSuccess = actionFactory(DELETE_ONE_ASSIGNMENT_SUCCESS);\n\n// dispatchers\nexport const fetchAssignments = validatedApiDispatcher({\n    name: \"fetchAssignments\",\n    description: \"Fetch assignments\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiGET(\n            `/${role}/sessions/${activeSessionId}/assignments`\n        );\n        dispatch(fetchAssignmentsSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchAssignment = validatedApiDispatcher({\n    name: \"fetchAssignment\",\n    description: \"Fetch assignment\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(`/${role}/assignments/${payload.id}`);\n        dispatch(fetchOneAssignmentSuccess(data));\n        return data;\n    },\n});\n\n// Some helper functions to convert the data that the UI uses\n// into data that the API can use\nconst applicantToApplicantId = flattenIdFactory(\"applicant\", \"applicant_id\");\nconst positionToPositionId = flattenIdFactory(\"position\", \"position_id\");\nfunction prepForApi(data) {\n    return positionToPositionId(applicantToApplicantId(data));\n}\n\nexport const upsertAssignment = validatedApiDispatcher({\n    name: \"upsertAssignment\",\n    description: \"Add/insert assignment\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        let data = await apiPOST(`/${role}/assignments`, prepForApi(payload));\n        dispatch(upsertOneAssignmentSuccess(data));\n        if (payload.wage_chunks) {\n            await dispatch(\n                upsertWageChunksForAssignment(data, payload.wage_chunks)\n            );\n            // The wage chunks could have changed the number of \"hours\" for the assignment.\n            // Refetch it to make sure the data isn't stale.\n            data = await dispatch(fetchAssignment(data));\n        }\n        dispatch(upsertOneAssignmentSuccess(data));\n        return data;\n    },\n});\n\nexport const deleteAssignment = validatedApiDispatcher({\n    name: \"deleteAssignment\",\n    description: \"Delete assignment\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/delete`,\n            prepForApi(payload)\n        );\n        dispatch(deleteOneAssignmentSuccess(data));\n    },\n});\n\nexport const exportAssignments = validatedApiDispatcher({\n    name: \"exportAssignments\",\n    description: \"Export assignments\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (formatter, format = \"spreadsheet\") => async (\n        dispatch,\n        getState\n    ) => {\n        if (!(formatter instanceof Function)) {\n            throw new Error(\n                `\"formatter\" must be a function when using the export action.`\n            );\n        }\n        // Re-fetch all assignments from the server in case things happened to be out of sync.\n        await dispatch(fetchAssignments());\n        const assignments = assignmentsSelector(getState());\n\n        // Normally, wage chunk information is not fetched with an assignment. This information\n        // must be fetched separately.\n        const wageChunkPromises = assignments.map((assignment) =>\n            dispatch(fetchWageChunksForAssignment(assignment))\n        );\n        await Promise.all(wageChunkPromises);\n        // Attach the wage chunk information to each assignment\n        for (const assignment of assignments) {\n            assignment.wage_chunks = wageChunksByAssignmentSelector(getState())(\n                assignment\n            );\n        }\n\n        return formatter(assignments, format);\n    },\n});\n\nexport const upsertAssignments = validatedApiDispatcher({\n    name: \"upsertAssignments\",\n    description: \"Upsert a list of assignments\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignments) => async (dispatch) => {\n        if (assignments.length === 0) {\n            return;\n        }\n        const dispatchers = assignments.map((assignment) =>\n            dispatch(upsertAssignment(assignment))\n        );\n        await Promise.all(dispatchers);\n        // Re-fetch all assignments from the server in case things happened to be out of sync.\n        await dispatch(fetchAssignments());\n    },\n});\n\n// selectors\n\n/**\n * Returns whether the number of hours for the `assignment` and the sum\n * total hours of `wageChunks` match.\n *\n * @param {*} assignment\n * @param {*} wageChunks\n * @returns\n */\nfunction wageChunksMatchAssignment(assignment, wageChunks) {\n    if (!wageChunks) {\n        return true;\n    }\n    let totalHours = 0;\n    for (const chunk of wageChunks) {\n        totalHours += chunk.hours;\n    }\n    return totalHours === assignment.hours;\n}\n\n// Each reducer is given an isolated state; instead of needing to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nexport const localStoreSelector = assignmentsReducer._localStoreSelector;\n/**\n * Get just the assignment data as it appears in the store; i.e., it has references to\n * id's of applicants and positions.\n */\nconst _assignmentsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\n/**\n * Get the current assignments. This selector is memoized and will only\n * be recomputed when assignments, applicants, or positions change. If wageChunks\n * have been loaded for the assignment, they are included, otherwise they are null.\n */\nexport const assignmentsSelector = createSelector(\n    [\n        _assignmentsSelector,\n        applicantsSelector,\n        positionsSelector,\n        wageChunksByAssignmentSelector,\n    ],\n    (assignments, applicants, positions, getWageChunksForAssignment) => {\n        if (assignments.length === 0) {\n            return [];\n        }\n        applicants = arrayToHash(applicants);\n        positions = arrayToHash(positions);\n        return assignments.map((assignment) => {\n            const { position_id, applicant_id, ...rest } = assignment;\n            const wage_chunks = getWageChunksForAssignment(assignment);\n            return {\n                ...rest,\n                position: positions[position_id] || {},\n                applicant: applicants[applicant_id] || {},\n                // Only return wage chunks if they match the current assignment. This\n                // ensures stale (previously-loaded) wage chunks don't get served.\n                wage_chunks: wageChunksMatchAssignment(assignment, wage_chunks)\n                    ? wage_chunks\n                    : null,\n            };\n        });\n    }\n);\n","import { validatedApiDispatcher } from \"./utils\";\nimport { apiError } from \"./errors\";\nimport { activeSessionSelector } from \"./sessions\";\nimport { initFromStage } from \"./init\";\n\nexport const setGlobals = validatedApiDispatcher({\n    name: \"setGlobals\",\n    description: \"Sets global variables\",\n    onErrorDispatch: (e) => apiError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const globals = { ...globalsSelector(getState()), ...payload };\n\n        // Store the globals in the URL\n        await dispatch(setGlobalsInUrl(globals));\n\n        // Now store the globals in the Redux store\n        dispatch({ type: \"SET_GLOBALS\", payload: globals });\n    },\n});\n\n/**\n * Sets the specified values to be part of the URL\n */\nexport const setGlobalsInUrl = validatedApiDispatcher({\n    name: \"setGlobalsInUrl\",\n    description: \"Stores global variables in the URL\",\n    onErrorDispatch: (e) => apiError(e.toString()),\n    dispatcher: (payload) => async () => {\n        // Create a new URL with the globals set in it\n        const searchParams = new URLSearchParams();\n        for (const [key, val] of Object.entries(payload)) {\n            searchParams.append(key, JSON.stringify(val));\n        }\n\n        // If we have globals to store, push them onto the url\n        if (window.history.pushState && (\"\" + searchParams).length > 0) {\n            let newUrl = new URL(window.location);\n            newUrl.search = \"?\" + searchParams;\n            newUrl = \"\" + newUrl;\n            if (\"\" + newUrl !== \"\" + window.location) {\n                window.history.pushState({ path: newUrl }, \"\", newUrl);\n            }\n        }\n    },\n});\n\nexport const setMockAPIState = validatedApiDispatcher({\n    name: \"setMockAPIState\",\n    description: \"Activates or deactivates the mockAPI\",\n    onErrorDispatch: (e) => apiError(e.toString()),\n    dispatcher: (payload, options = { skipInit: false }) => async (\n        dispatch\n    ) => {\n        await dispatch(setGlobals({ mockAPI: payload }));\n\n        if (!options.skipInit) {\n            await dispatch(initFromStage(\"toggleMockAPI\"));\n        }\n    },\n});\n\nexport const globalsSelector = (state) => {\n    // Peel off the `activeSession` if it is stored in globals.\n    // We want to always use the \"real\" active session and want\n    // to avoid multiple sources of truth.\n    // eslint-disable-next-line\n    const { activeSession, ...otherGlobals } = state.ui.globals;\n    const storedActiveSession = activeSessionSelector(state);\n    if (storedActiveSession != null && storedActiveSession.id != null) {\n        return { ...otherGlobals, activeSession: storedActiveSession.id };\n    }\n    return otherGlobals;\n};\n","import { createReducer } from \"./utils\";\nimport { API_INTERACTION_START, API_INTERACTION_END } from \"../constants\";\n\nconst initialState = {\n    ongoingInteraction: false,\n    ongoingInteractionsList: [],\n};\n\n// Keep a list of all ongoing interactions that are in progress.\n// This way we could display a spinner or some-such while interactions\n// are going on. Interactions will be mostly network-based interactions.\nexport const statusReducer = createReducer(initialState, {\n    [API_INTERACTION_START]: (state, action) => ({\n        ...state,\n        ongoingInteraction: true,\n        ongoingInteractionsList: [\n            ...state.ongoingInteractionsList,\n            action.payload,\n        ],\n    }),\n    [API_INTERACTION_END]: (state, action) => {\n        // remove the current interaction\n        const ongoingInteractionsList = state.ongoingInteractionsList.filter(\n            (i) => i.id !== action.payload.id\n        );\n        return {\n            ...state,\n            ongoingInteraction: ongoingInteractionsList.length > 0,\n            ongoingInteractionsList: ongoingInteractionsList,\n        };\n    },\n});\n","import {\n    FETCH_DDAHS_SUCCESS,\n    FETCH_ONE_DDAH_SUCCESS,\n    UPSERT_ONE_DDAH_SUCCESS,\n    DELETE_ONE_DDAH_SUCCESS,\n} from \"../constants\";\nimport { createBasicReducerObject, createReducer } from \"./utils\";\n\nconst initialState = {\n    _modelData: [],\n};\n\n// basicReducers is an object whose keys are FETCH_SESSIONS_SUCCESS, etc,\n// and values are the corresponding reducer functions\nconst basicReducers = createBasicReducerObject(\n    FETCH_DDAHS_SUCCESS,\n    FETCH_ONE_DDAH_SUCCESS,\n    UPSERT_ONE_DDAH_SUCCESS,\n    DELETE_ONE_DDAH_SUCCESS\n);\n\nexport const ddahsReducer = createReducer(initialState, basicReducers);\n","import { createReducer } from \"redux-create-reducer\";\nimport { SET_GLOBALS } from \"../constants\";\n\nexport const globalReducer = createReducer(\n    {},\n    {\n        [SET_GLOBALS]: (state, action) => ({\n            ...state,\n            ...action.payload,\n        }),\n    }\n);\n","import PropTypes from \"prop-types\";\nimport {\n    FETCH_DDAHS_SUCCESS,\n    FETCH_ONE_DDAH_SUCCESS,\n    UPSERT_ONE_DDAH_SUCCESS,\n    DELETE_ONE_DDAH_SUCCESS,\n    DDAH_APPROVE_SUCCESS,\n    DDAH_EMAIL_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    validatedApiDispatcher,\n    arrayToHash,\n    flattenIdFactory,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { createSelector } from \"reselect\";\nimport { activeRoleSelector } from \"./users\";\nimport { ddahsReducer } from \"../reducers\";\nimport { assignmentsSelector } from \"./assignments\";\n\n// actions\nconst fetchDdahsSuccess = actionFactory(FETCH_DDAHS_SUCCESS);\nconst fetchOneDdahSuccess = actionFactory(FETCH_ONE_DDAH_SUCCESS);\nconst upsertOneDdahSuccess = actionFactory(UPSERT_ONE_DDAH_SUCCESS);\nconst deleteOneDdahSuccess = actionFactory(DELETE_ONE_DDAH_SUCCESS);\nconst approveOneDdahSuccess = actionFactory(DDAH_APPROVE_SUCCESS);\nconst emailOneDdahSuccess = actionFactory(DDAH_EMAIL_SUCCESS);\n\n// dispatchers\nexport const fetchDdahs = validatedApiDispatcher({\n    name: \"fetchDdahs\",\n    description: \"Fetch DDAHs\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiGET(`/${role}/sessions/${activeSessionId}/ddahs`);\n        dispatch(fetchDdahsSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchDdah = validatedApiDispatcher({\n    name: \"fetchDdah\",\n    description: \"Fetch a DDAH\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(`/${role}/ddahs/${payload.id}`);\n        dispatch(fetchOneDdahSuccess(data));\n        return data;\n    },\n});\n\n// Some helper functions to convert the data that the UI uses\n// into data that the API can use\nconst assignmentToAssignmentId = flattenIdFactory(\n    \"assignment\",\n    \"assignment_id\"\n);\nfunction prepForApi(data) {\n    const ret = assignmentToAssignmentId(data);\n    delete ret.applicant;\n    return ret;\n}\n\nexport const approveDdah = validatedApiDispatcher({\n    name: \"approveDdah\",\n    description: \"Set a DDAH's status to approved\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        let data = await apiPOST(`/${role}/ddahs/${payload.id}/approve`);\n        dispatch(approveOneDdahSuccess(data));\n        // The previous action doesn't actually update the redux store,\n        // so we dispatch a fake upsert action to make sure the store gets updated\n        // with the new data.\n        dispatch(upsertOneDdahSuccess(data));\n        return data;\n    },\n});\n\nexport const emailDdah = validatedApiDispatcher({\n    name: \"emailDdah\",\n    description: \"Email a DDAH\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        let data = await apiPOST(`/${role}/ddahs/${payload.id}/email`);\n        dispatch(emailOneDdahSuccess(data));\n        // The previous action doesn't actually update the redux store,\n        // so we dispatch a fake upsert action to make sure the store gets updated\n        // with the new data.\n        dispatch(upsertOneDdahSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertDdah = validatedApiDispatcher({\n    name: \"upsertDdah\",\n    description: \"Add/insert a DDAH\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        let data = await apiPOST(`/${role}/ddahs`, prepForApi(payload));\n        dispatch(upsertOneDdahSuccess(data));\n        return data;\n    },\n});\n\nexport const deleteDdah = validatedApiDispatcher({\n    name: \"deleteDdah\",\n    description: \"Delete a DDAH\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/delete`,\n            prepForApi(payload)\n        );\n        dispatch(deleteOneDdahSuccess(data));\n    },\n});\n\nexport const exportDdahs = validatedApiDispatcher({\n    name: \"exportDdahs\",\n    description: \"Export DDAHs\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (formatter, format = \"spreadsheet\") => async (\n        dispatch,\n        getState\n    ) => {\n        if (!(formatter instanceof Function)) {\n            throw new Error(\n                `\"formatter\" must be a function when using the export action.`\n            );\n        }\n        // Re-fetch all assignments from the server in case things happened to be out of sync.\n        await dispatch(fetchDdahs());\n        const ddahs = ddahsSelector(getState());\n\n        return formatter(ddahs, format);\n    },\n});\n\nexport const upsertDdahs = validatedApiDispatcher({\n    name: \"upsertDdahs\",\n    description: \"Upsert a list of DDAHs\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (ddahs) => async (dispatch) => {\n        if (ddahs.length === 0) {\n            return;\n        }\n        const dispatchers = ddahs.map((ddah) => dispatch(upsertDdah(ddah)));\n        await Promise.all(dispatchers);\n        // Re-fetch all assignments from the server in case things happened to be out of sync.\n        await dispatch(fetchDdahs());\n    },\n});\n\nexport const downloadDdahAcceptedList = validatedApiDispatcher({\n    name: \"downloadDdahAcceptedList\",\n    description: \"Download a pdf list of accepted DDAHs for the active session\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: activeSessionId } = getState().model.sessions.activeSession;\n        const data = await apiGET(\n            `/${role}/sessions/${activeSessionId}/ddahs/accepted_list.pdf`\n        );\n\n        // The data comes in encoded as base64, so we decode it as binary data.\n        const content = new Uint8Array(\n            atob(data.content)\n                .split(\"\")\n                .map((x) => x.charCodeAt(0))\n        );\n        return new File([content], data.file_name, {\n            type: data.mime_type,\n        });\n    },\n});\n\n// selectors\n\n/**\n * Compute the status of a DDAH (e.g., accepted/rejected)\n *\n * @param {*} ddah\n * @returns\n */\nfunction computeDdahStatus(ddah) {\n    if (ddah.accepted_date) {\n        return \"accepted\";\n    }\n    if (ddah.emailed_date) {\n        return \"emailed\";\n    }\n    return null;\n}\n\n/**\n * Compute the total number of hours for all duties for the current DDAH\n *\n * @param {*} ddah\n * @returns\n */\nfunction computeDdahHours(ddah) {\n    let ret = 0;\n    for (const duty of ddah.duties) {\n        ret += duty.hours;\n    }\n    return ret;\n}\n\n// Each reducer is given an isolated state; instead of needing to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nexport const localStoreSelector = ddahsReducer._localStoreSelector;\n/**\n * Get just the ddah data as it appears in the store; i.e., it has references to\n * id's of assignments.\n */\nconst _ddahsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\n/**\n * Get the current ddahs. This selector is memoized and will only\n * be recomputed when ddahs or assignments change.\n */\nexport const ddahsSelector = createSelector(\n    [_ddahsSelector, assignmentsSelector],\n    (ddahs, assignments) => {\n        if (ddahs.length === 0) {\n            return [];\n        }\n        assignments = arrayToHash(assignments);\n        return ddahs.map(({ assignment_id, ...rest }) => ({\n            ...rest,\n            status: computeDdahStatus(rest),\n            total_hours: computeDdahHours(rest),\n            assignment: assignments[assignment_id] || {},\n        }));\n    }\n);\n","import {\n    setActiveSession,\n    fetchSessions,\n    sessionsSelector,\n    activeSessionSelector,\n} from \"./sessions\";\nimport {\n    fetchActiveUser,\n    setActiveUserRole,\n    activeRoleSelector,\n} from \"./users\";\nimport { fetchApplicants, fetchApplicantsSuccess } from \"./applicants\";\nimport { fetchApplications, fetchApplicationsSuccess } from \"./applications\";\nimport { fetchAssignments, fetchAssignmentsSuccess } from \"./assignments\";\nimport {\n    fetchContractTemplates,\n    fetchContractTemplatesSuccess,\n} from \"./contract_templates\";\nimport { fetchInstructors, fetchInstructorsSuccess } from \"./instructors\";\nimport { fetchPositions, fetchPositionsSuccess } from \"./positions\";\nimport { setGlobals, globalsSelector } from \"./globals\";\nimport { parseURLSearchString } from \"../../libs/urlUtils\";\nimport { fetchDdahs } from \"./ddahs\";\n\n/**\n * A helper function to replace all API actions to\n * use mock API actions.\n *\n * @param {boolean} enableMockAPI\n */\nfunction toggleMockApi(enableMockAPI) {\n    // in production, ToggleMockApi is a no-op. In development, it actually\n    // does something.\n    /* eslint-disable */\n    if (enableMockAPI != null && process.env.REACT_APP_DEV_FEATURES) {\n        const mock = require(\"../mockAPI\");\n        const mockAPI = mock.mockAPI;\n\n        if (enableMockAPI === true) {\n            mockAPI.replaceGlobalFetch();\n        } else {\n            mockAPI.restoreGlobalFetch();\n        }\n    }\n    /* eslint-enable */\n}\n\n/**\n * Prepare an object to be used to set global variables. The\n * return value is the same as the input except with `null` entries\n * removed.\n *\n * @param {*} globals\n * @returns {object} same as input but with `null` values removed.\n */\nfunction prepareGlobals(globals) {\n    const ret = {};\n    for (const [key, val] of Object.entries(globals)) {\n        if (val != null) {\n            ret[key] = val;\n        }\n    }\n    return ret;\n}\n\n/**\n * Various actions have side effects, requiring additional actions to\n * be dispatched. For example, if a session changes, all data related to\n * that session needs to be re-fetched.\n *\n * This function allows you to specify \"stage\" to start the init procedure at.\n * It will handle re-fetching any dependent data and dispatching any\n * required actions depending on the stage specified.\n *\n * @export\n * @param {string} stage - What stage to start the init procedure at\n * @param {{ startAfterStage: boolean }} options - if true, start from the stage following the specified stage; if false, start from the specified stage\n * @returns {function} an async function that handles all the API calls.\n */\nexport function initFromStage(stage, options = { startAfterStage: false }) {\n    const startAfterStage = !!options.startAfterStage;\n\n    return async (dispatch, getState) => {\n        const parsedGlobals = { mockAPI: null, activeSession: null };\n\n        // These actions don't need to finish in a specific order,\n        // so we can wait for them to finish at the end of this function to speed up startup.\n        const asyncActions = [];\n\n        /**\n         * A helper function to determine if the `currentStage`\n         * should be run\n         *\n         * @param {string} queryStage\n         * @returns {boolean} whether the `currentStage` action\n         * should be performed\n         */\n        function shouldRunStage(queryStage) {\n            const initOrder = [\n                \"pageLoad\",\n                \"toggleMockAPI\",\n                \"setActiveUser\",\n                \"setActiveUserRole\",\n                \"fetchInstructors\",\n                \"fetchSessions\",\n                \"setActiveSession\",\n                \"updateGlobals\",\n                \"fetchSessionDependentData\",\n            ];\n\n            // Is the queried stage dependent on the current stage?\n            // If `startAfterStage` is set, we actually want to know\n            // if we are the *next* stage.\n            const stageDependent =\n                initOrder.indexOf(stage) + startAfterStage <=\n                initOrder.indexOf(queryStage);\n\n            // `\"setActiveSession\" requires that an active session be set before\n            // it gets run.\n            if (stageDependent && queryStage === \"setActiveSession\") {\n                const state = getState();\n                const sessions = sessionsSelector(state);\n                const activeSession = activeSessionSelector(state) || {\n                    id: parsedGlobals.activeSession,\n                };\n                return sessions.find(\n                    (session) => session.id === activeSession.id\n                );\n            }\n\n            // All session dependent data depends on an active session being set\n            if (stageDependent && queryStage === \"fetchSessionDependentData\") {\n                const state = getState();\n                const activeSession = activeSessionSelector(state);\n                return activeSession?.id != null;\n            }\n\n            return stageDependent;\n        }\n\n        if (shouldRunStage(\"pageLoad\")) {\n            // When the page loads we parse the URL and pull out any globals that\n            // need setting\n            if (window.location) {\n                Object.assign(\n                    parsedGlobals,\n                    parseURLSearchString(window.location.search)\n                );\n                // Immediately set any global variables in the Redux store.\n                await dispatch(setGlobals(prepareGlobals(parsedGlobals)));\n            }\n        }\n\n        if (shouldRunStage(\"toggleMockAPI\")) {\n            const globals = globalsSelector(getState());\n            toggleMockApi(globals.mockAPI);\n        }\n\n        if (shouldRunStage(\"setActiveUser\")) {\n            await dispatch(fetchActiveUser());\n        }\n\n        if (shouldRunStage(\"setActiveUserRole\")) {\n            // When the role is changed, data should be cleared immediately.\n            // It will be re-fetched via the appropriate routes.\n            dispatch(fetchApplicantsSuccess([]));\n            dispatch(fetchAssignmentsSuccess([]));\n            dispatch(fetchContractTemplatesSuccess([]));\n            dispatch(fetchApplicationsSuccess([]));\n            dispatch(fetchInstructorsSuccess([]));\n            dispatch(fetchPositionsSuccess([]));\n\n            const activeRole = activeRoleSelector(getState());\n            await dispatch(setActiveUserRole(activeRole, { skipInit: true }));\n        }\n\n        if (shouldRunStage(\"fetchInstructors\")) {\n            asyncActions.push(dispatch(fetchInstructors()));\n        }\n\n        if (shouldRunStage(\"fetchSessions\")) {\n            await dispatch(fetchSessions());\n        }\n\n        if (shouldRunStage(\"setActiveSession\")) {\n            // after sessions are fetched, we compare with the active session.\n            // The active session might need to be \"updated\" if the ID matches but\n            // the data doesn't\n            const state = getState();\n            const sessions = sessionsSelector(state);\n            const activeSession = activeSessionSelector(state);\n            // There are two places where the active session could be store:\n            // in the URL as a global and in the Redux store. Prefer the value\n            // in the URL.\n            const matchingSession =\n                sessions.find(\n                    (session) => session.id === parsedGlobals.activeSession\n                ) || activeSession;\n\n            await dispatch(\n                setActiveSession(matchingSession, { skipInit: true })\n            );\n        }\n\n        if (shouldRunStage(\"updateGlobals\")) {\n            await dispatch(setGlobals(prepareGlobals(parsedGlobals)));\n        }\n\n        if (shouldRunStage(\"fetchSessionDependentData\")) {\n            // Before fetching session-related data, the existing data\n            // should be cleared. It will be re-fetched via the appropriate routes,\n            // but clearing now will prevent excess re-renders as data streams in.\n            dispatch(fetchApplicantsSuccess([]));\n            dispatch(fetchAssignmentsSuccess([]));\n            dispatch(fetchContractTemplatesSuccess([]));\n            dispatch(fetchApplicationsSuccess([]));\n            dispatch(fetchPositionsSuccess([]));\n\n            // `fetchActions` array contains all the fetch API calls that need to be\n            // made in order to obtain all data that the app needs.\n            const fetchActions = [\n                fetchApplicants,\n                fetchApplications,\n                fetchAssignments,\n                fetchContractTemplates,\n                fetchPositions,\n                fetchDdahs,\n            ];\n\n            // The order of fetching here doesn't matter, so dispatch all at once\n            await Promise.all(fetchActions.map((action) => dispatch(action())));\n        }\n\n        // Wait for async actions dispatched earlier to complete.\n        await Promise.all(asyncActions);\n    };\n}\n","import {\n    FETCH_ACTIVE_USER_SUCCESS,\n    FETCH_USERS_SUCCESS,\n    UPSERT_USERS_SUCCESS,\n    SET_ACTIVE_USER_ROLE_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport { actionFactory, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { usersReducer } from \"../reducers/users\";\nimport { initFromStage } from \"./init\";\n\n// actions\nconst fetchActiveUserSuccess = actionFactory(FETCH_ACTIVE_USER_SUCCESS);\nconst fetchUsersSuccess = actionFactory(FETCH_USERS_SUCCESS);\nconst upsertUserSuccess = actionFactory(UPSERT_USERS_SUCCESS);\nconst setActiveUserRoleSuccess = actionFactory(SET_ACTIVE_USER_ROLE_SUCCESS);\n\n// dispatchers\nexport const fetchActiveUser = validatedApiDispatcher({\n    name: \"fetchActiveUser\",\n    description: \"Fetch the active user\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const data = await apiGET(`/active_user`);\n        dispatch(fetchActiveUserSuccess(data));\n        // If our currently-set role is one that we don't have,\n        // set our role to one we do have.\n        const currentRole = activeRoleSelector(getState());\n        if (data.roles && !data.roles.includes(currentRole)) {\n            dispatch(setActiveUserRole(data.roles[0]));\n        }\n        return data;\n    },\n});\n\nexport const upsertUser = validatedApiDispatcher({\n    name: \"upsertUsers\",\n    description: \"Upserts a user (setting their role(s))\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (user) => async (dispatch) => {\n        const data = await apiPOST(`/admin/users`, user);\n        dispatch(upsertUserSuccess(data));\n        await dispatch(fetchUsers(user));\n    },\n});\n\nexport const fetchUsers = validatedApiDispatcher({\n    name: \"fetchUsers\",\n    description: \"Fetch all users\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(`/${role}/users`);\n        dispatch(fetchUsersSuccess(data));\n        return data;\n    },\n});\n\nexport const setActiveUserRole = validatedApiDispatcher({\n    name: \"setActiveUserRole\",\n    description: \"Sets the role of the active user\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload, options = {}) => async (dispatch) => {\n        await dispatch(setActiveUserRoleSuccess(payload));\n        if (!options.skipInit) {\n            await dispatch(\n                initFromStage(\"setActiveUserRole\", { startAfterStage: true })\n            );\n        }\n    },\n});\n\nexport const debugOnlyFetchUsers = validatedApiDispatcher({\n    name: \"debugOnlyFetchUsers\",\n    description:\n        \"Fetch all users; this is available only in debug mode and bypasses any user permissions\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: () => async (dispatch) => {\n        const data = await apiGET(`/debug/users`);\n        dispatch(fetchUsersSuccess(data));\n    },\n});\n\nexport const debugOnlySetActiveUser = validatedApiDispatcher({\n    name: \"debugOnlySetActiveUser\",\n    description:\n        \"Sets the active user (i.e. fakes the 'logged on' user); available only in debug mode\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (user, options = {}) => async (dispatch) => {\n        const data = await apiPOST(`/debug/active_user`, user);\n        await dispatch(fetchActiveUserSuccess(data));\n        // The new user we switch to might not have the same roles as the previous user.\n        // Default to the highest-authority role available, which is the first in the list.\n        await dispatch(setActiveUserRoleSuccess(data.roles[0]));\n\n        // After the active user has been set, we need to re-download (almost) all data\n        // with the permissions of the new active user.\n        if (!options.skipInit) {\n            await dispatch(initFromStage(\"setActiveUser\"));\n        }\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nexport const localStoreSelector = usersReducer._localStoreSelector;\nexport const usersSelector = (state) => localStoreSelector(state).users;\nexport const activeUserSelector = (state) =>\n    localStoreSelector(state).active_user;\nexport const activeRoleSelector = (state) =>\n    localStoreSelector(state).active_role;\n","import PropTypes from \"prop-types\";\nimport { createSelector } from \"reselect\";\nimport {\n    FETCH_SESSIONS_SUCCESS,\n    FETCH_ONE_SESSION_SUCCESS,\n    UPSERT_ONE_SESSION_SUCCESS,\n    DELETE_ONE_SESSION_SUCCESS,\n    SET_ACTIVE_SESSION,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport { actionFactory, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { sessionsReducer } from \"../reducers/sessions\";\nimport { activeRoleSelector } from \"./users\";\nimport { initFromStage } from \"./init\";\n\n// actions\nexport const fetchSessionsSuccess = actionFactory(FETCH_SESSIONS_SUCCESS);\nconst fetchOneSessionSuccess = actionFactory(FETCH_ONE_SESSION_SUCCESS);\nconst upsertOneSessionSuccess = actionFactory(UPSERT_ONE_SESSION_SUCCESS);\nconst deleteOneSessionSuccess = actionFactory(DELETE_ONE_SESSION_SUCCESS);\nconst setActiveSessionAction = actionFactory(SET_ACTIVE_SESSION);\n\n// dispatchers\nexport const fetchSessions = validatedApiDispatcher({\n    name: \"fetchSessions\",\n    description: \"Fetch sessions\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(`/${role}/sessions`);\n        await dispatch(fetchSessionsSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchSession = validatedApiDispatcher({\n    name: \"fetchSession\",\n    description: \"Fetch session\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(`/${role}/sessions/${payload.id}`);\n        dispatch(fetchOneSessionSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertSession = validatedApiDispatcher({\n    name: \"upsertSession\",\n    description: \"Add/insert session\",\n    propTypes: {},\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(`/${role}/sessions`, payload);\n        dispatch(upsertOneSessionSuccess(data));\n        return data;\n    },\n});\n\nexport const deleteSession = validatedApiDispatcher({\n    name: \"deleteSession\",\n    description: \"Delete session\",\n    propTypes: { id: PropTypes.any.isRequired },\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(`/${role}/sessions/delete`, payload);\n        dispatch(deleteOneSessionSuccess(data));\n    },\n});\n\n/**\n * Sets the `activeSession`. `activeSession` is used\n * in other API calls, so changing the active session may\n * trigger changes in other data (for example, `instructors` or `positions`)\n *\n * @param {object} payload - The session to set active\n */\nexport const setActiveSession = validatedApiDispatcher({\n    name: \"setActiveSession\",\n    description: \"Set the active session\",\n    onErrorDispatch: true,\n    dispatcher: (payload, options = {}) => async (dispatch, getState) => {\n        const { skipInit } = options;\n        const state = getState();\n        const currentActiveSession = activeSessionSelector(state);\n        if (currentActiveSession === payload) {\n            return;\n        }\n        // passing in null will unset the active session\n        if (payload == null) {\n            await dispatch(setActiveSessionAction(null));\n            return;\n        }\n        if ((currentActiveSession || { id: null }).id === payload.id) {\n            return;\n        }\n        // If we made it here, the activeSession is changing.\n        await dispatch(setActiveSessionAction(payload));\n        // Make sure all tasks we depend on get run\n        if (!skipInit) {\n            await dispatch(\n                initFromStage(\"setActiveSession\", { startAfterStage: true })\n            );\n        }\n    },\n});\n\n// selectors\nexport const localStoreSelector = sessionsReducer._localStoreSelector;\nexport const sessionsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\nexport const activeSessionSelector = createSelector(\n    localStoreSelector,\n    (state) => state.activeSession\n);\n","import {\n    FETCH_ONE_OFFER_SUCCESS,\n    SET_OFFER_ACCEPTED_SUCCESS,\n    SET_OFFER_REJECTED_SUCCESS,\n    OFFER_CREATE_SUCCESS,\n    OFFER_EMAIL_SUCCESS,\n    OFFER_NAG_SUCCESS,\n    OFFER_WITHDRAW_SUCCESS,\n} from \"../constants\";\nimport { fetchError } from \"./errors\";\nimport { actionFactory, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/apiUtils\";\nimport { fetchAssignment } from \"./assignments\";\nimport { activeRoleSelector } from \"./users\";\n\n// actions\nexport const fetchOfferSuccess = actionFactory(FETCH_ONE_OFFER_SUCCESS);\nexport const setOfferAcceptedSuccess = actionFactory(\n    SET_OFFER_ACCEPTED_SUCCESS\n);\nexport const setOfferRejectedSuccess = actionFactory(\n    SET_OFFER_REJECTED_SUCCESS\n);\nexport const offerCreateSuccess = actionFactory(OFFER_CREATE_SUCCESS);\nexport const offerEmailSuccess = actionFactory(OFFER_EMAIL_SUCCESS);\nexport const offerNagSuccess = actionFactory(OFFER_NAG_SUCCESS);\nexport const offerWithdrawSuccess = actionFactory(OFFER_WITHDRAW_SUCCESS);\n\n// dispatchers\nexport const fetchActiveOfferForAssignment = validatedApiDispatcher({\n    name: \"fetchActiveOfferForAssignment\",\n    description: \"Fetch an offer associated with an assignment\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(\n            `/${role}/assignments/${payload.id}/active_offer`\n        );\n        dispatch(fetchOfferSuccess(data));\n        return data;\n    },\n});\n\nexport const setOfferForAssignmentAccepted = validatedApiDispatcher({\n    name: \"setOfferForAssignmentAccepted\",\n    description: \"Set an offer as accepted\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/accept`\n        );\n        dispatch(setOfferAcceptedSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const setOfferForAssignmentRejected = validatedApiDispatcher({\n    name: \"setOfferForAssignmentRejected\",\n    description: \"Set an offer as rejected\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/reject`\n        );\n        dispatch(setOfferRejectedSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const offerForAssignmentWithdraw = validatedApiDispatcher({\n    name: \"offerForAssignmentWithdraw\",\n    description: \"Withdraw an offer\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/withdraw`\n        );\n        dispatch(offerWithdrawSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const offerForAssignmentCreate = validatedApiDispatcher({\n    name: \"offerForAssignmentCreate\",\n    description: \"Create an offer\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/create`\n        );\n        dispatch(offerCreateSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const offerForAssignmentEmail = validatedApiDispatcher({\n    name: \"offerForAssignmentEmail\",\n    description: \"Email an offer\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/email`\n        );\n        dispatch(offerEmailSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const offerForAssignmentNag = validatedApiDispatcher({\n    name: \"offerForAssignmentNag\",\n    description: \"Send a nag email for an offer\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/nag`\n        );\n        dispatch(offerNagSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n","import React from \"react\";\nimport { Button, ButtonGroup } from \"react-bootstrap\";\nimport { connect } from \"react-redux\";\nimport { setGlobals, globalsSelector } from \"../../api/actions\";\n\n/**\n * A toggle switch for turning on and off the Mock API. An instance\n * of the Mock API is included in this component, and this component\n * takes no arguments.\n *\n * This component only renders when `process.env.REACT_APP_DEV_FEATURES` is truthy.\n *\n * @export\n * @returns {React.ElementType}\n */\nlet ToggleMockApi = function ToggleMockApi(props) {\n    const { globals, setMockAPIState } = props;\n    const active = globals.mockAPI;\n\n    return (\n        <span\n            title={\n                \"The Mock API simulates the TAPP API but uses browser-based storage. This allows you to test TAPP functionality without a working server.\"\n            }\n        >\n            Mock API{\" \"}\n            <ButtonGroup>\n                <Button\n                    variant={active ? \"primary\" : \"secondary\"}\n                    onClick={() => setMockAPIState(true)}\n                >\n                    On\n                </Button>\n                <Button\n                    variant={active ? \"secondary\" : \"primary\"}\n                    onClick={() => setMockAPIState(false)}\n                >\n                    Off\n                </Button>\n            </ButtonGroup>\n        </span>\n    );\n};\n\nToggleMockApi = connect((state) => ({ globals: globalsSelector(state) }), {\n    setGlobals,\n})(ToggleMockApi);\n\nexport { ToggleMockApi };\n","import React from \"react\";\nimport { Dropdown } from \"react-bootstrap\";\n\nconst ident = () => {};\n\n/**\n * A toggle switch for turning on and off the Mock API. An instance\n * of the Mock API is included in this component, and this component\n * takes no arguments.\n *\n * This component only renders when `process.env.REACT_APP_DEV_FEATURES` is truthy.\n *\n * @export\n * @returns {React.ElementType}\n */\nfunction ActiveUserButton({\n    users = [],\n    activeUser = {},\n    setActiveUser = ident,\n    fetchUsers = ident,\n}) {\n    const [dropdownVisible, setDropdownVisible] = React.useState(false);\n\n    React.useEffect(() => {\n        // Whenever the dropdown is open, fetch a list of all available users.\n        // This would normally not be a good idea, but since this button is only\n        // used in debug mode, it's okay.\n        if (dropdownVisible) {\n            fetchUsers();\n        }\n    }, [dropdownVisible, fetchUsers]);\n\n    return (\n        <span\n            title={\n                \"Set which user you are currently logged in as. This is only available when the server is running in debug mode.\"\n            }\n            className=\"logged-in-as-container\"\n        >\n            <label>Logged in as</label>\n            <Dropdown\n                onSelect={(i) => {\n                    setActiveUser(users[i]);\n                }}\n                onToggle={(desiredVisibility) =>\n                    setDropdownVisible(desiredVisibility)\n                }\n                show={dropdownVisible}\n                alignRight\n            >\n                <Dropdown.Toggle split variant=\"dark\">\n                    {activeUser.utorid}{\" \"}\n                </Dropdown.Toggle>\n                <Dropdown.Menu flip={true}>\n                    {(users || []).map((user, i) => (\n                        <Dropdown.Item\n                            key={i}\n                            eventKey={\"\" + i}\n                            active={activeUser.utorid === user.utorid}\n                        >\n                            {user.utorid} ({(user.roles || []).join(\", \")})\n                        </Dropdown.Item>\n                    ))}\n                </Dropdown.Menu>\n            </Dropdown>\n        </span>\n    );\n}\n\nexport { ActiveUserButton };\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport { NavLink, Switch, Route } from \"react-router-dom\";\n\nimport \"./main.css\";\nimport { Navbar, Nav } from \"react-bootstrap\";\nimport { ToggleMockApi } from \"./mockAPI\";\n\nimport SwaggerUI from \"swagger-ui-react\";\nimport \"swagger-ui-react/swagger-ui.css\";\nimport { mockApiRoutesAsSwaggerPaths } from \"../../api/defs/doc-generation\";\nimport { mockAPI } from \"../../api/mockAPI\";\nimport {\n    setMockAPIState,\n    usersSelector,\n    activeUserSelector,\n    debugOnlySetActiveUser,\n    debugOnlyFetchUsers,\n} from \"../../api/actions\";\nimport { ActiveUserButton } from \"./active-user-switch\";\n\n/**\n * Wrap `\"react-router-dom\"`'s `NavLink` in Bootstrap\n * styling.\n *\n * @param {*} props\n * @returns\n */\nfunction BootstrapNavLink(props) {\n    return (\n        <Nav.Link\n            as={NavLink}\n            activeClassName=\"bg-warning text-dark\"\n            to={props.to}\n        >\n            {props.children}\n        </Nav.Link>\n    );\n}\nBootstrapNavLink.propTypes = {\n    to: PropTypes.string,\n};\n\nconst swaggerData = {\n    openapi: \"3.0.0\",\n    info: {\n        description:\n            \"TAPP is a program for TA management--for making TA assignments and distributing TA contracts.\",\n        title: \"TAPP\",\n    },\n    servers: [\n        { url: \"/api/v1/admin\" },\n        { url: \"/api/v1/instructor\" },\n        { url: \"/api/v1/ta\" },\n        { url: \"/api/v1\" },\n    ],\n    paths: {\n        /* XXX this is hear temporarily to serve as an example for generating Swagger (openapi) documenation\n        \"/bob\": {\n            get: {\n                summary: \"Bob's summary\",\n                tags: [\"helful\"],\n                produces: \"application/json\",\n                responses: {\n                    default: {\n                        description: \"OK\",\n                        content: {\n                            \"application/json\": {\n                                schema: {\n                                    type: \"object\",\n                                    properties: {\n                                        status: {\n                                            type: \"string\",\n                                            enum: [\"success\", \"error\"]\n                                        },\n                                        message: { type: \"string\" },\n                                        payload: {\n                                            type: \"array\",\n                                            items: {\n                                                type: \"object\",\n                                                properties: {\n                                                    name: { type: \"string\" }\n                                                },\n                                                required: [\"name\"]\n                                            }\n                                        }\n                                    },\n                                    required: [\"status\"]\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        },\n*/\n        ...mockApiRoutesAsSwaggerPaths(mockAPI),\n    },\n};\n\nconst ConnectedActiveUserButton = connect(\n    (state) => ({\n        activeUser: activeUserSelector(state),\n        users: usersSelector(state),\n    }),\n    { fetchUsers: debugOnlyFetchUsers, setActiveUser: debugOnlySetActiveUser }\n)(ActiveUserButton);\n\n// When toggled, `ToggleMockApi` will try\n// to refetch all the sessions, so pass it an\n// appropriate dispatcher.\nconst ConnectedToggleMockApi = connect(null, { setMockAPIState })(\n    ToggleMockApi\n);\n\nfunction DevFrame(props) {\n    return (\n        <div id=\"dev-frame\" className=\"bg-info\">\n            <div id=\"dev-frame-header\">\n                <Navbar expand variant=\"dark\">\n                    <Navbar.Brand\n                        href=\"#/\"\n                        title=\"View TAPP in development mode in a framed window.\"\n                    >\n                        Dev Mode\n                    </Navbar.Brand>\n                    <Nav className=\"mr-auto\">\n                        <BootstrapNavLink to=\"/api-docs\">\n                            API Docs\n                        </BootstrapNavLink>\n                    </Nav>\n                    <Navbar.Collapse className=\"justify-content-end\">\n                        <ConnectedActiveUserButton />\n                        <ConnectedToggleMockApi />\n                    </Navbar.Collapse>\n                </Navbar>\n            </div>\n            <div id=\"dev-frame-body\">\n                <div id=\"dev-frame-body-inner\">\n                    <Switch>\n                        <Route path=\"/api-docs\">\n                            <SwaggerUI spec={swaggerData} docExpansion=\"list\" />\n                        </Route>\n                        <Route>{props.children}</Route>\n                    </Switch>\n                </div>\n            </div>\n            <div id=\"dev-frame-footer\"></div>\n        </div>\n    );\n}\n\nexport { DevFrame };\n","/**\n * Notifications popup whenever they show up in state.ui.notifications\n */\nimport { connect } from \"react-redux\";\nimport Notifications from \"react-notification-system-redux\";\n\nexport const ConnectedNotifications = connect((state) => ({\n    notifications: state.ui.notifications,\n}))(Notifications);\n","import React from \"react\";\nimport { Form, Col } from \"react-bootstrap\";\n\n/**\n * A higher-order-function which returns a function that creates editable fields.\n * For example, `fieldEditorFactory(x, setX)(\"I set foo\", \"foo\", \"number\")` returns\n * a react `<input />` element that will call `setX({...x, foo: <new foo val>})` whenever\n * the input changes.\n *\n * A `type=` parameter can be passed in; when used, some types are coerced. For example,\n * `type=number` will automatically coerce strings to numbers so `setBoundData` would be\n * passed an object with the specified attribute cast as a number.\n *\n * @export\n * @param {object} boundData - object whose attributes will be (non-destructively) set\n * @param {function(object): void} setBoundData - setter function\n * @returnType {function(title: string, attr: string, type: string, inputAttrs: object): React.Node}\n */\nexport function fieldEditorFactory(boundData, setBoundData) {\n    /**\n     * Create a callback function which updates the specified attribute.\n     *\n     * @param {string} attr\n     * @returns\n     */\n    function setAttrFactory(attr, coerceFunc = (x) => x) {\n        return (e) => {\n            const newVal = e.target.value || \"\";\n            const newData = { ...boundData, [attr]: coerceFunc(newVal) };\n            setBoundData(newData);\n        };\n    }\n\n    /**\n     * Create a bootstrap form component that updates the specified attr\n     * of `boundData`\n     *\n     * @param {string} title - Label text of the form control\n     * @param {string} attr - attribute of `boundData` to be updated when this form control changes\n     * @param {string?} type - the type of the `<input />` element\n     * @param {object?} inputAttrs - additional attributes to be passed to the `<input />` element\n     * @returnType {React.Node}\n     */\n    function createFieldEditor(title, attr, type = \"text\", inputAttrs = {}) {\n        // Function called on the value before it is passed to setBoundData\n        let coerceFunc = (x) => x;\n        // Function that is called on the value before it is passed to the `<input />`\n        // element\n        let valueFunc = (x) => x || \"\";\n\n        // depending on the type we want to coerce values appropriately\n        switch (type) {\n            case \"number\":\n                coerceFunc = Number;\n                break;\n            case \"date\":\n                coerceFunc = (x) => new Date(x).toISOString();\n                valueFunc = (x) => {\n                    try {\n                        return new Date(x).toISOString().slice(0, 10);\n                    } catch (e) {\n                        return \"\";\n                    }\n                };\n                break;\n            default:\n                break;\n        }\n\n        return (\n            <React.Fragment>\n                <Form.Label>{title}</Form.Label>\n                <Form.Control\n                    type={type}\n                    value={valueFunc(boundData[attr])}\n                    onChange={setAttrFactory(attr, coerceFunc)}\n                    {...inputAttrs}\n                />\n            </React.Fragment>\n        );\n    }\n\n    return createFieldEditor;\n}\n\n/**\n * Place all children side-by-side in a react-boostrap `Form.Row`\n *\n * @export\n * @param {*} props\n * @returnType {React.Node}\n */\nexport function DialogRow(props) {\n    const { children, icon = null } = props;\n    let iconNode = null;\n    if (icon) {\n        iconNode = <div className=\"input-row-icon\">{icon}</div>;\n    }\n    return (\n        <Form.Row style={{ alignItems: \"baseline\" }}>\n            {iconNode}\n            {React.Children.map(children, (child, index) => {\n                return (\n                    <Form.Group as={Col} key={index}>\n                        {child}\n                    </Form.Group>\n                );\n            })}\n        </Form.Row>\n    );\n}\n","import React from \"react\";\n\n/**\n * Create a `DiffCell` that will render a field's modification if\n * one is present. Otherwise, render the original value.\n *\n * @param {*} accessor\n * @returns\n */\nexport function createDiffCell({ accessor, Cell }) {\n    accessor = (accessor || \"\").split(\".\");\n    function get(obj) {\n        let ret = obj;\n        for (const key of accessor) {\n            if (ret == null) {\n                return undefined;\n            }\n            ret = ret[key];\n        }\n        return ret;\n    }\n\n    /**\n     * If a particular cell has been modified, render the \"modification description\".\n     * Otherwise, render the actual value.\n     *\n     * @param {*} {original}\n     * @returns\n     */\n    function DiffCell({ row }) {\n        const original = row.original || row._original;\n        const value = get(original.obj);\n        const changed = get(original.changes);\n        if (changed != null) {\n            return (\n                <div\n                    className=\"diff-changed-cell bg-primary text-white\"\n                    title={changed}\n                >\n                    {changed}\n                </div>\n            );\n        }\n        // If there is a custom cell renderer, use that. Otherwise, pass the value directly.\n        // However, we return `null` instead instead of an undefined value\n        // (if there happens to be one) to prevent the ReactTable from crashing.\n        return Cell\n            ? Cell({ value, original: original.obj })\n            : value == null\n            ? null\n            : value;\n    }\n    return DiffCell;\n}\n\n/**\n * Take a react table column specification and convert it to a specification for a diff table.\n *\n * @param {*} columns\n * @returns\n */\nexport function createDiffColumnsFromColumns(columns) {\n    return columns.map((column) => {\n        const ret = {\n            // ReactTable really wants columns to have ids. If a column\n            // doesn't have an id, it uses the accessor as an id. However, we\n            // delete the accessor, so put an id in manually.\n            id: column.accessor,\n            ...column,\n            Cell: createDiffCell(column),\n        };\n        delete ret.accessor;\n        return ret;\n    });\n}\n","import React from \"react\";\nimport { shallowEqual } from \"react-redux\";\n\n/**\n * Capitalizes the input string. The function only capitalizes the first word if there are multiple words in the input string.\n * If `word` isn't a string, it is coerced.\n * @param word a single word.\n * @returns\n */\nexport function capitalize(word: string | null | undefined): string {\n    if (!word) {\n        return \"\";\n    }\n    return word.charAt(0).toUpperCase() + word.slice(1);\n}\n\n/**\n * Trims the input string. If the `x` is not a string, it is\n * coerced\n *\n * @param {string} x\n * @returns\n */\nexport function strip(x: string | null | undefined): string {\n    if (x == null) {\n        return \"\";\n    }\n    return (\"\" + x).trim();\n}\n\n/**\n * Formats the input date string to be human readable\n * Input string is of the form 2019-01-01T00:00:00.000Z\n * Output string is of the form January 1, 2019\n * @param {string} dateString\n */\nexport function formatDate(dateString: string): string {\n    if (!dateString) {\n        return dateString;\n    }\n    // Normalize the date string so we can compensate for timezone issues.\n    // This string is now formatted YYYY-MM-DD\n    const normalizedDateString = new Date(dateString).toJSON().slice(0, 10);\n    // Add timezone offset information so that Javascript will\n    // interpret the date in the current timezone\n    const date = new Date(`${normalizedDateString}T00:00:00.000`);\n    return `${date.toLocaleDateString(\"en-CA\", {\n        month: \"short\",\n        year: \"numeric\",\n        day: \"numeric\",\n    })}`;\n}\n\n/**\n * Format a url for downloading. In production, this is the\n * identity function. In development mode, this function replaces\n * port `8000` with `3000` so that non-json data can be downloaded from the\n * backend.\n *\n * @param {string} url\n */\nlet formatDownloadUrl = (url: string) => url;\nif (process.env.REACT_APP_DEV_FEATURES) {\n    formatDownloadUrl = (url: string) => {\n        url = new URL(url, window.location.href).href;\n        return url.replace(\"localhost:8000\", \"localhost:3000\");\n    };\n}\n\nexport { formatDownloadUrl };\n\n// Debounce hook from https://dev.to/gabe_ragland/debouncing-with-react-hooks-jci\n/**\n * Debounce a value. This hook will continue returning the initially passed in `value`\n * until `delay` milliseconds have passed. After the delay, the most recently-passed-in\n * value is returned.\n *\n * @export\n * @param {*} value\n * @param {number} delay\n * @returns\n */\nexport function useDebounce(value: any, delay: number) {\n    // State and setters for debounced value\n    const [debouncedValue, setDebouncedValue] = React.useState<any>(value);\n\n    React.useEffect(\n        () => {\n            if (shallowEqual(value, debouncedValue)) {\n                return;\n            }\n            // Set debouncedValue to value (passed in) after the specified delay\n            const handler = setTimeout(() => {\n                setDebouncedValue(value);\n            }, delay);\n\n            // Return a cleanup function that will be called every time ...\n            // ... useEffect is re-called. useEffect will only be re-called ...\n            // ... if value changes (see the inputs array below).\n            // This is how we prevent debouncedValue from changing if value is ...\n            // ... changed within the delay period. Timeout gets cleared and restarted.\n            // To put it in context, if the user is typing within our app's ...\n            // ... search box, we don't want the debouncedValue to update until ...\n            // ... they've stopped typing for more than 500ms.\n            return () => {\n                clearTimeout(handler);\n            };\n        },\n        // Only re-call effect if value changes\n        // We purposely don't pass in `debounceValue` so that we don't get\n        // stuck in a loop. However, eslint complains about not passing in\n        // `debounceValue`.\n        // eslint-disable-next-line\n        [value, delay]\n    );\n\n    return debouncedValue;\n}\n","import React from \"react\";\nimport classNames from \"classnames\";\nimport {\n    useTable,\n    useSortBy,\n    HeaderGroup,\n    useGlobalFilter,\n    useBlockLayout,\n    useResizeColumns,\n    useRowSelect,\n} from \"react-table\";\nimport {\n    FaSortAlphaDown,\n    FaSortAlphaUp,\n    FaSearch,\n    FaTimes,\n} from \"react-icons/fa\";\nimport { strip } from \"../libs/utils\";\nimport { Badge } from \"react-bootstrap\";\nimport { shallowEqual } from \"react-redux\";\nimport { FixedSizeList } from \"react-window\";\nimport Scrollbars from \"react-custom-scrollbars\";\nimport AutoSizer from \"react-virtualized-auto-sizer\";\n\nexport const COLUMNS = [\n    {\n        Header: \"Last Name\",\n        accessor: \"last_name\",\n    },\n    {\n        Header: \"First Name\",\n        accessor: \"first_name\",\n    },\n];\n\nexport const DATA = Array.from({ length: 10 }).map((r, i) => ({\n    last_name: (\"\" + Math.random()).slice(0, 4),\n    first_name: \"\" + Math.round(Math.random() * 10),\n}));\n\nconst IndeterminateCheckbox = React.forwardRef(function IndeterminateCheckbox(\n    { indeterminate, ...rest }: { indeterminate: boolean; [key: string]: any },\n    ref?: any\n) {\n    React.useEffect(() => {\n        if (ref && ref.current) {\n            ref.current.indeterminate = indeterminate;\n        }\n    }, [ref, indeterminate]);\n\n    return (\n        <>\n            <input type=\"checkbox\" ref={ref ? ref : null} {...rest} />\n        </>\n    );\n});\n\nfunction SortableHeader<T extends object>({\n    column,\n}: {\n    column: HeaderGroup<T>;\n}) {\n    let sortIcon = null;\n    if (column.isSorted) {\n        if (column.isSortedDesc) {\n            sortIcon = (\n                <div className=\"column-sort-icon\">\n                    <FaSortAlphaUp className=\"ml-2 text-secondary\" />\n                </div>\n            );\n        } else {\n            sortIcon = (\n                <div className=\"column-sort-icon\">\n                    <FaSortAlphaDown className=\"ml-2 text-secondary\" />\n                </div>\n            );\n        }\n    }\n    return (\n        <div\n            className=\"th\"\n            {...column.getHeaderProps(column.getSortByToggleProps())}\n        >\n            <div className=\"table-header\">{column.render(\"Header\")}</div>\n            {sortIcon}\n            <div\n                {...column.getResizerProps()}\n                className={`resizer ${column.isResizing ? \"isResizing\" : \"\"}`}\n            />\n        </div>\n    );\n}\n\nfunction FilterBar({\n    onChange,\n    count = null,\n}: {\n    onChange?: Function;\n    count?: number | null;\n}) {\n    // `filterStrings` is the list of strings that we are filtering by. We\n    // filter for rows that contain every string.\n    const [filterStrings, setFilterStrings] = React.useState<string[]>([]);\n\n    React.useEffect(() => {\n        if (typeof onChange === \"function\") {\n            onChange(filterStrings.map((s) => strip(s.toLowerCase())));\n        }\n    }, [filterStrings, onChange]);\n\n    const displayFilterStrings = filterStrings.filter((s) => strip(s));\n    const normalizedFilterStrings = filterStrings.map((s) =>\n        strip(s.toLowerCase())\n    );\n\n    /**\n     * Insert a blank string to the front of the filterString list\n     * if the first string is indeed unique compared to the others.\n     */\n    function saveFirstFilterString() {\n        const firstString = strip((filterStrings[0] || \"\").toLowerCase());\n        if (firstString === \"\") {\n            return;\n        }\n        // If the string is not in the list of current strings,\n        // insert a blank before it.\n        if (!normalizedFilterStrings.slice(1).some((s) => s === firstString)) {\n            // We are \"pushing\" a new filter string on the list. Make sure to strip\n            // away any whitespace it may have.\n            setFilterStrings([\"\", ...filterStrings.map((s) => strip(s))]);\n        } else {\n            // If the string is already on the list, we \"blank\"\n            // it out.\n            setFilterStrings([\"\", ...filterStrings.slice(1)]);\n        }\n    }\n\n    function removeFilterString(filterString: string) {\n        // The first string in the list is the one in the search box.\n        // We don't actually want to delete that string. Instead we want to make it an\n        // empty string so that the search box doesn't suddenly become filled\n        // with the previous search string.\n        if (filterString === filterStrings[0]) {\n            setFilterStrings([\"\", ...filterStrings.slice(1)]);\n            return;\n        }\n        const updatedFilterStrings = filterStrings.filter(\n            (oldString) => oldString !== filterString\n        );\n        setFilterStrings(updatedFilterStrings);\n    }\n\n    return (\n        <div className=\"filterable-table-filter\">\n            <FaSearch className=\"mr-3\" />\n            <input\n                type=\"text\"\n                placeholder=\"Filter by...\"\n                onChange={(e) => {\n                    setFilterStrings([\n                        e.target.value,\n                        ...filterStrings.slice(1),\n                    ]);\n                }}\n                value={filterStrings[0] || \"\"}\n                onKeyDown={(e) => {\n                    // press enter to add the typed query to the filter list\n                    // 13 == Enter\n                    if (e.keyCode === 13) {\n                        saveFirstFilterString();\n                    }\n                }}\n            />\n            {displayFilterStrings.length > 0 && (\n                <span className=\"filter-table-filtering-by\">Filtering by:</span>\n            )}\n            {displayFilterStrings.map((filterString, i) => (\n                <Badge\n                    className=\"filter-chip\"\n                    pill\n                    variant=\"light\"\n                    key={`${filterString}-${i}`}\n                >\n                    {filterString}\n                    <FaTimes\n                        className=\"filter-chip-icon\"\n                        title=\"Remove filter\"\n                        onClick={() => removeFilterString(filterString)}\n                    />\n                </Badge>\n            ))}\n            {count != null && <div className=\"filter-item-count\">{count}</div>}\n        </div>\n    );\n}\n\nconst EMPTY_OBJECT = {};\n\nfunction idsToIndicesObject(\n    ids: any[] | null | undefined,\n    data: { id: any }[]\n): { [key: string]: boolean } {\n    if (!ids) {\n        return EMPTY_OBJECT;\n    }\n\n    const ret: { [key: string]: boolean } = {};\n    for (let i = 0; i < data.length; i++) {\n        const item = data[i];\n        if (ids.includes(item.id)) {\n            ret[i] = true;\n        }\n    }\n    return ret;\n}\n\nfunction generateSelectionHook(enabled: boolean) {\n    if (!enabled) {\n        return () => {};\n    }\n    // Code taken from useRowSelect example https://react-table.tanstack.com/docs/api/useRowSelect\n    return (hooks: any) => {\n        hooks.visibleColumns.push((columns: any[]) => [\n            // Let's make a column for selection\n            {\n                id: \"selection\",\n                // The header can use the table's getToggleAllRowsSelectedProps method\n                // to render a checkbox\n                Header: ({ getToggleAllRowsSelectedProps }: any) => (\n                    <IndeterminateCheckbox\n                        {...getToggleAllRowsSelectedProps()}\n                    />\n                ),\n                // The cell can use the individual row's getToggleRowSelectedProps method\n                // to the render a checkbox\n                Cell: ({ row }: any) =>\n                    // We are only allowed to \"check\" rows that have a valid id (that is,\n                    // a valid id from the actual data-structure. This is different from the\n                    // internal react-table id).\n                    row.original?.id != null ? (\n                        <IndeterminateCheckbox\n                            {...row.getToggleRowSelectedProps()}\n                        />\n                    ) : null,\n                maxWidth: 45,\n            },\n            ...columns,\n        ]);\n    };\n}\n\n/**\n * A ReactTable that can be filtered and sorted. If a `setSelected`\n * function is passed in, checkboxes will be shown next to each row\n * with a non-null id and the user can select specific rows. If `filterable`\n * is true, a filter bar will appear.\n *\n * Note: `selected` is a list of ids (the `id` property on members of the `data` array).\n * Rows matching something in `selected` will be highlighted. This property can be used\n * without passing the `setSelected` function.\n *\n * @export\n * @param {({\n *     columns: any[];\n *     data: any[];\n *     filterable?: boolean | null;\n *     selected?: any[];\n *     setSelected?: Function;\n * })} {\n *     columns,\n *     data,\n *     filterable = null,\n *     selected,\n *     setSelected,\n * }\n * @returns\n */\nexport function AdvancedFilterTable({\n    columns,\n    data,\n    filterable = null,\n    selected,\n    setSelected,\n}: {\n    columns: any[];\n    data: any[];\n    filterable?: boolean | null;\n    selected?: any[];\n    setSelected?: Function;\n}) {\n    // `filterString` contains a list of strings. We will show the rows that contain _all_\n    // strings from the list.\n    const [filterStrings, setFilterStrings] = React.useState<string[]>([]);\n    const filterMethod = React.useCallback(\n        function doFilter(rows: any[], columns: any[], filterName: string) {\n            if (filterStrings.length === 0) {\n                return rows;\n            }\n            // Return the rows where every filter string is included in some cell of that\n            // row.\n            return rows.filter((row) => {\n                return filterStrings.every((str) =>\n                    columns.some((colName) => {\n                        const cellVal = row.values[colName];\n                        return (\"\" + (cellVal || \"\")).toLowerCase().match(str);\n                    })\n                );\n            });\n        },\n        [filterStrings]\n    );\n\n    const table = useTable(\n        {\n            columns,\n            data,\n            //initialState: { globalFilter: \"\" },\n            filterTypes: { custom: filterMethod },\n            globalFilter: \"custom\",\n            autoResetGlobalFilter: false,\n            autoResetSortBy: false,\n            autoResetSelectedRows: false,\n            initialState: {\n                hiddenColumns: columns\n                    .filter((col) => col.show === false)\n                    .map((col) => col.id),\n                selectedRowIds: idsToIndicesObject(selected, data),\n            },\n        },\n        useBlockLayout,\n        useResizeColumns,\n        useGlobalFilter,\n        useSortBy,\n        useRowSelect,\n        generateSelectionHook(!!setSelected)\n    );\n\n    const { selectedRowIds } = table.state;\n\n    const scrollRef = React.useRef<FixedSizeList>(null);\n\n    // If we do not set the `\"custom\"` filter method, it won't be called.\n    React.useEffect(() => {\n        table.setGlobalFilter(\"custom\");\n    }, [table, filterMethod]);\n\n    function onFilterChange(newFilter: string[]) {\n        if (!shallowEqual(newFilter, filterStrings)) {\n            setFilterStrings(newFilter);\n        }\n    }\n\n    React.useEffect(() => {\n        if (typeof setSelected === \"function\") {\n            let ret: number[] = [];\n            for (const [index, isSelected] of Object.entries(selectedRowIds)) {\n                if (!isSelected) {\n                    continue;\n                }\n                const id = data[+index]?.id;\n                if (!ret.includes(id)) {\n                    ret.push(id);\n                }\n            }\n            ret.sort();\n            // An id is never null, however if there is a row in our table that lacks an id\n            // a null value may end up in the list. (This is the id of the original data,\n            // not the internal ReactTable id).\n            ret = ret.filter((id) => id != null);\n            if (!shallowEqual(ret, [...(selected || [])].sort())) {\n                setSelected(ret);\n            }\n        }\n    }, [selectedRowIds, selected, setSelected, data]);\n\n    const renderRow = React.useCallback(\n        ({ index, style }) => {\n            const row = table.rows[index];\n            table.prepareRow(row);\n            return (\n                <div\n                    {...row.getRowProps({ style })}\n                    className={classNames(\"tr\", {\n                        \"table-primary\":\n                            row.isSelected && (row.original as any)?.id != null,\n                    })}\n                >\n                    {row.cells.map((cell) => (\n                        <div\n                            {...cell.getCellProps()}\n                            className={classNames(\n                                \"td\",\n                                (cell.column as any).className,\n                                {\n                                    \"selection-checkbox\":\n                                        cell.column.id === \"selection\",\n                                }\n                            )}\n                        >\n                            {cell.render(\"Cell\")}\n                        </div>\n                    ))}\n                </div>\n            );\n        },\n        [table]\n    );\n\n    const handleScroll = React.useCallback(\n        ({ target }) => {\n            const { scrollTop } = target;\n\n            if (scrollRef.current) {\n                scrollRef.current.scrollTo(scrollTop);\n            }\n        },\n        [scrollRef]\n    );\n\n    return (\n        <div className=\"filter-table-container\">\n            {filterable && (\n                <FilterBar\n                    onChange={onFilterChange}\n                    count={table.rows.length}\n                />\n            )}\n            <div\n                {...table.getTableProps()}\n                className=\"table table-bordered table-sm\"\n            >\n                <div className=\"thead\">\n                    {table.headerGroups.map((headerGroup) => (\n                        <div\n                            {...headerGroup.getHeaderGroupProps()}\n                            className=\"thr\"\n                        >\n                            {headerGroup.headers.map((column, i) => (\n                                <SortableHeader key={i} column={column} />\n                            ))}\n                        </div>\n                    ))}\n                </div>\n                <div {...table.getTableBodyProps()} className=\"tbody\">\n                    <AutoSizer>\n                        {({ width, height }) => {\n                            // Don't let the table get too short no matter what\n                            height = Math.max(height, 300);\n                            return (\n                                <Scrollbars\n                                    style={{ width, height }}\n                                    onScroll={handleScroll}\n                                >\n                                    <FixedSizeList\n                                        height={height}\n                                        itemCount={table.rows.length}\n                                        itemSize={30}\n                                        width={table.totalColumnsWidth}\n                                        ref={scrollRef}\n                                        style={{\n                                            overflow: \"visible\",\n                                        }}\n                                    >\n                                        {renderRow}\n                                    </FixedSizeList>\n                                </Scrollbars>\n                            );\n                        }}\n                    </AutoSizer>\n                </div>\n            </div>\n        </div>\n    );\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { docApiPropTypes } from \"../api/defs/doc-generation\";\nimport { Form } from \"react-bootstrap\";\nimport { DialogRow } from \"./forms/common-controls\";\nimport { createDiffColumnsFromColumns } from \"./diff-table\";\nimport { AdvancedFilterTable } from \"./advanced-filter-table\";\n\nconst DEFAULT_COLUMNS = [\n    { Header: \"Last Name\", accessor: \"last_name\" },\n    { Header: \"First Name\", accessor: \"first_name\" },\n    { Header: \"Email\", accessor: \"email\", minWidth: 120 },\n    { Header: \"UTORid\", accessor: \"utorid\" },\n];\n\n/**\n * List the instructors using a ReactTable. `columns` can be passed\n * in to customize columns/cell renderers.\n *\n * @export\n * @param {{instructors: object[], columns: object[]}} props\n * @returns\n */\nexport function InstructorsList(props) {\n    const { instructors, columns = DEFAULT_COLUMNS } = props;\n    return (\n        <AdvancedFilterTable\n            data={instructors}\n            columns={columns}\n            filterable={true}\n        />\n    );\n}\nInstructorsList.propTypes = {\n    instructors: PropTypes.oneOfType([\n        PropTypes.arrayOf(docApiPropTypes.instructor),\n        PropTypes.any,\n    ]).isRequired,\n    columns: PropTypes.arrayOf(\n        PropTypes.shape({ Header: PropTypes.any.isRequired })\n    ),\n};\n\nexport function InstructorsDiffList({ modifiedInstructors }) {\n    return (\n        <InstructorsList\n            instructors={modifiedInstructors}\n            columns={createDiffColumnsFromColumns(DEFAULT_COLUMNS)}\n        />\n    );\n}\n\nconst DEFAULT_INSTRUCTOR = {\n    utorid: \"\",\n    last_name: \"\",\n    first_name: \"\",\n};\n\n/**\n * Edit information about an instructor.\n *\n * @export\n * @param {{instructor: object, setInstructor: function}} props\n * @returns\n */\nexport function InstructorEditor(props) {\n    const { instructor: instructorProps, setInstructor } = props;\n    const instructor = { ...DEFAULT_INSTRUCTOR, ...instructorProps };\n\n    /**\n     * Create a callback function which updates the specified attribute\n     * of a position.\n     *\n     * @param {string} attr\n     * @returns\n     */\n    function setAttrFactory(attr) {\n        return (e) => {\n            const newVal = e.target.value || \"\";\n            const newInstructor = { ...instructor, [attr]: newVal };\n            setInstructor(newInstructor);\n        };\n    }\n\n    /**\n     * Create a bootstrap form component that updates the specified attr\n     * of `position`\n     *\n     * @param {string} title - Label text of the form control\n     * @param {string} attr - attribute of `position` to be updated when this form control changes\n     * @returns {node}\n     */\n    function createFieldEditor(title, attr, type = \"text\") {\n        return (\n            <React.Fragment>\n                <Form.Label>{title}</Form.Label>\n                <Form.Control\n                    type={type}\n                    value={instructor[attr] || \"\"}\n                    onChange={setAttrFactory(attr)}\n                />\n            </React.Fragment>\n        );\n    }\n\n    return (\n        <Form>\n            <Form.Row>\n                <DialogRow>\n                    {createFieldEditor(\"First Name\", \"first_name\")}\n                    {createFieldEditor(\"Last Name\", \"last_name\")}\n                </DialogRow>\n                <DialogRow>\n                    {createFieldEditor(\"Email\", \"email\")}\n                    {createFieldEditor(\"UTORid\", \"utorid\")}\n                </DialogRow>\n            </Form.Row>\n        </Form>\n    );\n}\nInstructorEditor.propTypes = {\n    instructor: docApiPropTypes.instructor,\n    setInstructor: PropTypes.func,\n};\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { FaEdit } from \"react-icons/fa\";\nimport { Modal, Button, Spinner } from \"react-bootstrap\";\nimport { formatDate } from \"../libs/utils\";\nimport \"./edit-field-widgets.css\";\n\n/**\n * A dialog allowing one to edit `props.value`. `onChange` is called\n * when \"save\" is clicked while editing this value.\n *\n * @param {*} props\n * @returns\n */\nfunction EditFieldDialog(props) {\n    const { title, value, show, onHide, onChange, type } = props;\n    const [fieldVal, setFieldVal] = React.useState(value);\n    const [inProgress, setInProgress] = React.useState(false);\n    const isDate = type === \"date\";\n\n    function cancelClick() {\n        setFieldVal(value);\n        onHide();\n    }\n\n    function saveClick() {\n        async function doSave() {\n            // eslint-disable-next-line\n            if (fieldVal != value) {\n                setInProgress(true);\n                // Only call `onChange` if the value has changed\n                await onChange(fieldVal, value);\n            }\n        }\n        doSave().finally(() => {\n            //onHide();\n            setInProgress(false);\n        });\n    }\n    // When a confirm operation is in progress, a spinner is displayed; otherwise\n    // it's hidden\n    const spinner = inProgress ? (\n        <Spinner animation=\"border\" size=\"sm\" className=\"mr-1\" />\n    ) : null;\n\n    const changeIndicator =\n        // eslint-disable-next-line\n        fieldVal == value ? null : (\n            <span>\n                Change from{\" \"}\n                <span className=\"field-dialog-formatted-name\">\n                    {isDate ? formatDate(value) : value}\n                </span>{\" \"}\n                to{\" \"}\n                <span className=\"field-dialog-formatted-name\">\n                    {isDate ? formatDate(fieldVal) : fieldVal}\n                </span>\n            </span>\n        );\n\n    return (\n        <Modal show={show} onHide={cancelClick}>\n            <Modal.Header closeButton>\n                <Modal.Title>{title}</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <input\n                    type={type}\n                    value={fieldVal}\n                    onChange={(e) => setFieldVal(e.currentTarget.value)}\n                />{\" \"}\n                {changeIndicator}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={cancelClick} variant=\"outline-secondary\">\n                    Cancel\n                </Button>\n                <Button onClick={saveClick}>{spinner}Save</Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\n/**\n * An edit icon that appears on hover.\n *\n * @param {*} props\n * @returns\n */\nexport const EditFieldIcon = React.memo(function EditFieldIcon(props) {\n    const { title, hidden, onClick } = props;\n    if (hidden) {\n        return null;\n    }\n    return (\n        <div\n            className=\"show-on-hover edit-glyph\"\n            onClick={onClick}\n            title={title}\n        >\n            <FaEdit />\n        </div>\n    );\n});\n\n/**\n * Adds an \"edit\" icon which shows up when hovering on the wrapped widget.\n * Clicking the \"edit\" icon opens a dialog that allows one to edit the value.\n * `onChange` is called if \"save\" is pressed in the edit dialog.\n *\n * @export\n * @param {{children, title, value, onChange: function, editable: boolean}} props\n * @returns\n */\nexport function EditableField(props) {\n    const {\n        children,\n        title,\n        value,\n        onChange,\n        editable = true,\n        type = \"text\",\n    } = props;\n    const [dialogShow, setDialogShow] = React.useState(false);\n\n    // This is rendered in every cell of a react table, so performance is important.\n    // It takes a long time to render the `EditFieldIcon`, but we only need this icon\n    // when we hover on a field. Therefore, we start by now showing the icon. When\n    // we move our mouse over the icon for the first time, we render the icon (no need to\n    // hide it again, since it's the initial render multiplied across all the cells that causes\n    // the slowdown). This causes a slight rendering glitch, but the performance is worth it.\n    const [renderEditIcon, setRenderEditIcon] = React.useState(false);\n    return (\n        <div\n            className=\"show-on-hover-wrapper\"\n            onMouseEnter={() => setRenderEditIcon(true)}\n        >\n            {children}\n            {renderEditIcon && (\n                <EditFieldIcon\n                    title={title}\n                    hidden={!editable}\n                    onClick={() => setDialogShow(true)}\n                />\n            )}\n            {editable && dialogShow && (\n                <EditFieldDialog\n                    title={title}\n                    value={value}\n                    onChange={onChange}\n                    show={dialogShow}\n                    onHide={() => setDialogShow(false)}\n                    type={type}\n                />\n            )}\n        </div>\n    );\n}\nEditFieldDialog.propTypes = {\n    title: PropTypes.node,\n    value: PropTypes.any.isRequired,\n    onChange: PropTypes.func,\n    editable: PropTypes.bool,\n};\n","import React from \"react\";\nimport { Modal, Button } from \"react-bootstrap\";\n\nexport function DeleteInstructorDialog(props) {\n    const { show, onHide, onDelete, instructor } = props;\n    if (!instructor) {\n        // This check ensures that the instructor object exists before trying to access instructor.last_name\n        // and instructor.first_name, which will cause a runtime error if instructor is null.\n        return null;\n    } else {\n        return (\n            <Modal show={show} onHide={onHide}>\n                <Modal.Header closeButton>\n                    <Modal.Title>Delete Instructor</Modal.Title>\n                </Modal.Header>\n                <Modal.Body>\n                    Are you sure you want to delete instructor{\" \"}\n                    {instructor.last_name}, {instructor.first_name}? This action\n                    cannot be undone.\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button onClick={onHide} variant=\"light\">\n                        Cancel\n                    </Button>\n                    <Button onClick={onDelete} title=\"Delete Instructor\">\n                        Delete\n                    </Button>\n                </Modal.Footer>\n            </Modal>\n        );\n    }\n}\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport {\n    instructorsSelector,\n    upsertInstructor,\n    deleteInstructor,\n    positionsSelector,\n} from \"../../api/actions\";\nimport { InstructorsList } from \"../../components/instructors\";\nimport { EditableField } from \"../../components/edit-field-widgets\";\nimport { DeleteInstructorDialog } from \"./delete-instructor-dialog\";\nimport { FaTrash, FaLock, FaTimes } from \"react-icons/fa\";\n\n/**\n * A cell that renders editable applicant information\n *\n * @param {*} props\n * @returns\n */\nfunction EditableCell(props) {\n    const title = `Edit ${\"\" + props.column.Header}`;\n    const { upsertInstructor, field } = props;\n    function onChange(newVal) {\n        const applicantId = (props.row.original || props.row._original).id;\n        upsertInstructor({ id: applicantId, [field]: newVal });\n    }\n    return (\n        <EditableField\n            title={title}\n            value={props.value || \"\"}\n            onChange={onChange}\n        >\n            {props.value}\n        </EditableField>\n    );\n}\n\nfunction EditableInstructorsList(props) {\n    const {\n        upsertInstructor,\n        deleteInstructor,\n        inDeleteMode,\n        positions,\n        ...rest\n    } = props;\n\n    const [deleteDialogVisible, setDeleteDialogVisible] = React.useState(false);\n    const [instructorToDelete, setInstructorToDelete] = React.useState(null);\n\n    // Bind an `ApplicantCell` to a particular field\n    function generateCell(field) {\n        return (props) => (\n            <EditableCell\n                field={field}\n                upsertInstructor={upsertInstructor}\n                {...props}\n            />\n        );\n    }\n\n    const instructorCurrentlyAssignedHash = {};\n    for (const position of positions || []) {\n        for (const instructor of position.instructors || []) {\n            instructorCurrentlyAssignedHash[instructor.id] = true;\n        }\n    }\n\n    // props.original contains the row data for this particular instructor\n    function CellDeleteButton({ row }) {\n        const instructor = row.original;\n        const disabled = instructorCurrentlyAssignedHash[instructor.id];\n        if (disabled) {\n            return (\n                <div className=\"delete-button-container\">\n                    <FaLock\n                        className=\"delete-row-button disabled\"\n                        title=\"This instructor is assigned to a position and so cannot be deleted. Unassign the instructor from all positions to delete.\"\n                    />\n                </div>\n            );\n        }\n        return (\n            <div className=\"delete-button-container\">\n                <FaTimes\n                    className=\"delete-row-button\"\n                    title={`Delete ${instructor.last_name}, ${instructor.first_name}`}\n                    onClick={() => {\n                        setInstructorToDelete(instructor);\n                        setDeleteDialogVisible(true);\n                    }}\n                />\n            </div>\n        );\n    }\n\n    const columns = [\n        {\n            Header: <FaTrash className=\"delete-row-column-header-icon\" />,\n            id: \"delete_col\",\n            className: \"delete-col\",\n            Cell: CellDeleteButton,\n            show: inDeleteMode,\n            maxWidth: 32,\n            resizable: false,\n        },\n        {\n            Header: \"Last Name\",\n            accessor: \"last_name\",\n            Cell: generateCell(\"last_name\"),\n        },\n        {\n            Header: \"First Name\",\n            accessor: \"first_name\",\n            Cell: generateCell(\"first_name\"),\n        },\n        {\n            Header: \"Email\",\n            accessor: \"email\",\n            Cell: generateCell(\"email\"),\n            minWidth: 150,\n        },\n        {\n            Header: \"UTORid\",\n            accessor: \"utorid\",\n            Cell: generateCell(\"utorid\"),\n        },\n    ];\n\n    return (\n        <React.Fragment>\n            <InstructorsList columns={columns} {...rest} />\n            <DeleteInstructorDialog\n                show={deleteDialogVisible}\n                onHide={() => {\n                    setDeleteDialogVisible(false);\n                    setInstructorToDelete(null);\n                }}\n                onDelete={() => {\n                    deleteInstructor(instructorToDelete);\n                    setDeleteDialogVisible(false);\n                }}\n                instructor={instructorToDelete}\n            />\n        </React.Fragment>\n    );\n}\n\n/**\n * EditableInstructorsList that has been connected to the redux store\n * for live updates and editability.\n */\nexport const ConnectedInstructorsList = connect(\n    (state) => ({\n        instructors: instructorsSelector(state),\n        positions: positionsSelector(state),\n    }),\n    { upsertInstructor, deleteInstructor }\n)(EditableInstructorsList);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { InstructorEditor } from \"../../components/instructors\";\nimport { Modal, Button, Alert } from \"react-bootstrap\";\nimport { upsertInstructor, instructorsSelector } from \"../../api/actions\";\nimport { strip } from \"../../libs/utils\";\n\nconst BLANK_INSTRUCTOR = {\n    first_name: \"\",\n    last_name: \"\",\n    email: \"\",\n    utorid: \"\",\n};\n\n/**\n * Find if there is a conflicting instructor in the passed in list\n * of instructors, or if any required fields are incorrect.\n *\n * @param {object} instructor\n * @param {object[]} instructors\n */\nfunction getConficts(instructor, instructors) {\n    const ret = { delayShow: \"\", immediateShow: \"\" };\n    if (\n        !strip(instructor.utorid) ||\n        !strip(instructor.first_name) ||\n        !strip(instructor.last_name)\n    ) {\n        ret.delayShow = \"A first name, last name, and utorid is required\";\n    }\n    const matchingInstructor = instructors.find(\n        (x) => strip(x.utorid) === strip(instructor.utorid)\n    );\n    if (matchingInstructor) {\n        ret.immediateShow = (\n            <p>\n                Another instructor exists with utorid={instructor.utorid}:{\" \"}\n                <b>\n                    {matchingInstructor.first_name}{\" \"}\n                    {matchingInstructor.last_name}\n                </b>\n            </p>\n        );\n    }\n    return ret;\n}\n\nfunction AddInstructorDialog(props) {\n    const { show, onHide = () => {}, instructors, upsertInstructor } = props;\n    const [newInstructor, setNewInstructor] = React.useState(BLANK_INSTRUCTOR);\n\n    React.useEffect(() => {\n        if (!show) {\n            // If the dialog is hidden, reset the state\n            setNewInstructor(BLANK_INSTRUCTOR);\n        }\n    }, [show]);\n\n    function createInstructor() {\n        upsertInstructor(newInstructor);\n        onHide();\n    }\n\n    const conflicts = getConficts(newInstructor, instructors);\n\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Add Instructor</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <InstructorEditor\n                    instructor={newInstructor}\n                    setInstructor={setNewInstructor}\n                />\n                {conflicts.immediateShow ? (\n                    <Alert variant=\"danger\">{conflicts.immediateShow}</Alert>\n                ) : null}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button\n                    onClick={createInstructor}\n                    title={conflicts.delayShow || \"Create Instructor\"}\n                    disabled={\n                        !!conflicts.delayShow || !!conflicts.immediateShow\n                    }\n                >\n                    Create Instructor\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n/**\n * AddInstructorDialog that has been connected to the redux store\n */\nexport const ConnectedAddInstructorDialog = connect(\n    (state) => ({ instructors: instructorsSelector(state) }),\n    { upsertInstructor }\n)(AddInstructorDialog);\n","import React from \"react\";\nimport classNames from \"classnames\";\nimport { Dropdown } from \"react-bootstrap\";\n\nimport \"./action-buttons.css\";\n\ninterface PropsWithChildren {\n    [attr: string]: any;\n    children: React.ReactNode;\n}\ninterface ActionButtonProps extends PropsWithChildren {\n    icon?: React.ReactNode | Function;\n    onClick?: () => any;\n    active?: boolean;\n    disabled?: any;\n}\n\ninterface ActionMenuButtonProps extends ActionButtonProps {\n    menu: React.ReactNode;\n}\n\n/**\n * Wrap `icon` in a span (if it is non-null). `icon` may be a function,\n * in which case it is rendered as a react element.\n *\n * @param {(React.ReactNode | Function)} icon\n * @returns {React.ReactNode}\n */\nfunction wrapIcon(icon: React.ReactNode | Function): React.ReactNode {\n    if (!icon) {\n        return icon;\n    }\n    if (typeof icon === \"function\") {\n        const Icon = icon;\n        icon = <Icon />;\n    }\n    return <span className=\"mr-2\">{icon}</span>;\n}\n\n/**\n * Container to house `ActionButton`s.\n *\n * @export\n * @param {PropsWithChildren} { children }\n * @returns\n */\nexport function ActionsList({ children }: PropsWithChildren) {\n    return (\n        <div className=\"page-actions\">\n            <Dropdown>{children}</Dropdown>\n        </div>\n    );\n}\n\n/**\n * Label a group of `ActionButton`s\n *\n * @export\n * @param {PropsWithChildren} { children }\n * @returns\n */\nexport function ActionHeader({ children }: PropsWithChildren) {\n    return <Dropdown.Header>{children}</Dropdown.Header>;\n}\n\n/**\n * An action button. Behaves like a button but is styled to fit in the `ActionsList`\n * area. Accepts an optional `icon` and an `active` boolean which determines whether\n * the button is permanently highlighted.\n *\n * @export\n * @param {ActionButtonProps} {\n *     icon = null,\n *     children,\n *     active,\n *     ...rest\n * }\n * @returns\n */\nexport function ActionButton({\n    icon = null,\n    children,\n    active,\n    disabled,\n    ...rest\n}: ActionButtonProps) {\n    const iconNode = wrapIcon(icon);\n    if (disabled) {\n        rest = { ...rest, onClick: () => {} };\n    }\n    return (\n        <Dropdown.Item\n            as=\"button\"\n            className={classNames({ active, disabled })}\n            {...rest}\n        >\n            {iconNode}\n            {children}\n        </Dropdown.Item>\n    );\n}\n\n/**\n * Display an action button with a `menu` that can be toggled. `menu` is expected\n * to be a React component. If you want a list of items in the menu, you may wrap\n * them in a `<React.Fragment />` tag. You can (and should) use `ActionButton`s in\n * the menu.\n *\n * @export\n * @param {ActionMenuButtonProps} {\n *     icon = null,\n *     children,\n *     menu = null,\n *     active,\n *     ...rest\n * }\n * @returns\n */\nexport function ActionMenuButton({\n    icon = null,\n    children,\n    menu = null,\n    active,\n    disabled = false,\n    ...rest\n}: ActionMenuButtonProps) {\n    const [menuOpen, setMenuOpen] = React.useState(false);\n    const [menuHeight, setMenuHeight] = React.useState(0);\n    const menuSizerRef = React.useRef<HTMLDivElement>(null);\n\n    React.useEffect(() => {\n        if (menuSizerRef == null || menuSizerRef.current == null) {\n            return;\n        }\n        setMenuHeight(menuSizerRef.current.clientHeight);\n    }, [children]);\n\n    const iconNode = wrapIcon(icon);\n\n    return (\n        <>\n            <div\n                className={classNames(\"action-accordion\", {\n                    dropright: !menuOpen,\n                })}\n            >\n                <button\n                    className={classNames(\"dropdown-item\", {\n                        active,\n                        disabled,\n                    })}\n                    {...rest}\n                >\n                    {iconNode}\n                    {children}\n                </button>\n                {!disabled && (\n                    <button\n                        className=\"dropdown-item dropdown-toggle\"\n                        onClick={() => setMenuOpen(!menuOpen)}\n                    ></button>\n                )}\n            </div>\n            <div\n                className={classNames(\"action-accordion-item-container\", {\n                    closed: !menuOpen,\n                })}\n                style={{ height: menuHeight }}\n            >\n                <div ref={menuSizerRef}>{menu}</div>\n            </div>\n        </>\n    );\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Button, Dropdown, ButtonGroup } from \"react-bootstrap\";\nimport { ActionMenuButton, ActionButton } from \"./action-buttons\";\nimport { FaDownload } from \"react-icons/fa\";\n\n/**\n * Export button that offers the ability to export as Spreadsheet/CSV/JSON.\n * `onClick` is called when the button is clicked and supplied with\n * one of \"spreadsheet\", \"csv\", or \"json\".\n *\n * @param {*} props\n * @returns\n */\nexport function ExportButton(props) {\n    const { onClick: clickCallback } = props;\n\n    function onClick(option) {\n        if (clickCallback) {\n            clickCallback(option);\n        }\n    }\n\n    return (\n        <Dropdown as={ButtonGroup} onSelect={onClick}>\n            <Button onClick={() => onClick(\"spreadsheet\")}>Export</Button>\n            <Dropdown.Toggle split id=\"dropdown-split-basic\" />\n            <Dropdown.Menu>\n                <Dropdown.Item eventKey=\"spreadsheet\">\n                    As Spreadsheet\n                </Dropdown.Item>\n                <Dropdown.Item eventKey=\"csv\">As CSV</Dropdown.Item>\n                <Dropdown.Item eventKey=\"json\">As JSON</Dropdown.Item>\n            </Dropdown.Menu>\n        </Dropdown>\n    );\n}\nExportButton.propTypes = {\n    onClick: PropTypes.func.isRequired,\n};\n\n/**\n * Export button that offers the ability to export as Spreadsheet/CSV/JSON.\n * `onClick` is called when the button is clicked and supplied with\n * one of \"spreadsheet\", \"csv\", or \"json\".\n *\n * @param {*} props\n * @returns\n */\nexport function ExportActionButton(props) {\n    const { onClick: clickCallback, disabled = false } = props;\n\n    function onClick(option) {\n        if (clickCallback) {\n            clickCallback(option);\n        }\n    }\n\n    return (\n        <ActionMenuButton\n            onClick={() => onClick(\"spreadsheet\")}\n            icon={FaDownload}\n            menu={\n                <>\n                    <ActionButton onClick={() => onClick(\"spreadsheet\")}>\n                        As Spreadsheet\n                    </ActionButton>\n                    <ActionButton onClick={() => onClick(\"csv\")}>\n                        As CSV\n                    </ActionButton>\n                    <ActionButton onClick={() => onClick(\"json\")}>\n                        As JSON\n                    </ActionButton>\n                </>\n            }\n            disabled={disabled}\n        >\n            Export\n        </ActionMenuButton>\n    );\n}\nExportButton.propTypes = {\n    onClick: PropTypes.func.isRequired,\n};\n","import React, { useState } from \"react\";\nimport PropTypes from \"prop-types\";\nimport XLSX from \"xlsx\";\nimport {\n    Button,\n    Modal,\n    Form,\n    Spinner,\n    Container,\n    Row,\n    Col,\n} from \"react-bootstrap\";\nimport { ActionButton } from \"./action-buttons\";\nimport { FaUpload } from \"react-icons/fa\";\n\nconst DEFAULT_LABEL = \"Select a spreadsheet, CSV, or JSON file.\";\n\n/**\n * A dialog for handling file input. The work of showing validation/content is handled by `dialogContent`.\n * This component handles displaying and parting a file specified by an <input type=\"file\" /> node.\n *\n * @param {*} {\n *     dialogOpen,\n *     onCancel,\n *     onClose,\n *     onConfirm,\n *     dialogContent,\n *     onFileChange,\n * } - `onCancel` means the cancel button was clicked. `onClose` means the `x` was clicked or there was a click outside of the dialog window.\n * @returns\n */\nexport function ImportDialog({\n    dialogOpen,\n    onCancel,\n    onClose,\n    onConfirm,\n    dialogContent,\n    onFileChange,\n    setInProgress: parentSetInProgress,\n    label = DEFAULT_LABEL,\n}) {\n    const [fileInputLabel, setFileInputLabel] = React.useState(label);\n    const [fileArrayBuffer, setFileArrayBuffer] = React.useState(null);\n    const [fileContents, setFileContents] = React.useState(null);\n    const [inProgress, _setInProgress] = React.useState(false);\n\n    // When we are processing we want to set a spinner button\n    // in the dialog as well as communicate to our parent\n    // that we are in the midst of processing. Therefore, we\n    // call both the internal `setInProgress` function as well\n    // as the one from our parent.\n    function setInProgress(val) {\n        _setInProgress(val);\n        if (typeof parentSetInProgress === \"function\") {\n            parentSetInProgress(val);\n        }\n    }\n\n    if (!(onCancel instanceof Function)) {\n        onCancel = () => console.warn(\"No onCancel function set for dialog\");\n    }\n\n    // When file contents changes\n    React.useEffect(() => {\n        if (!fileContents) {\n            return;\n        }\n        if (onFileChange instanceof Function) {\n            onFileChange(fileContents);\n        }\n    }, [fileContents, onFileChange]);\n\n    // Wrap the <input type=\"file\" /> in an effect that parses the file\n    React.useEffect(() => {\n        if (!fileArrayBuffer) {\n            return;\n        }\n\n        // Attempt to decode the file as JSON. If that doesn't work,\n        // we process it as a spreadsheet.\n\n        const rawData = new Uint8Array(fileArrayBuffer);\n        try {\n            const str = new TextDecoder().decode(rawData);\n            setFileContents({ data: JSON.parse(str), fileType: \"json\" });\n            return;\n            // eslint-disable-next-line\n        } catch (e) {}\n        try {\n            const workbook = XLSX.read(rawData, { type: \"array\" });\n            const firstSheet = workbook.SheetNames[0];\n            setFileContents({\n                data: XLSX.utils.sheet_to_json(workbook.Sheets[firstSheet]),\n                fileType: \"spreadsheet\",\n            });\n            return;\n            // eslint-disable-next-line\n        } catch (e) {}\n\n        console.warn(\n            \"Could not determine file type for\",\n            fileInputLabel,\n            fileArrayBuffer\n        );\n    }, [fileArrayBuffer, fileInputLabel]);\n\n    function _onFileChange(event) {\n        const file = event.target.files[0];\n        setFileInputLabel(file.name);\n\n        const reader = new FileReader();\n        reader.onload = (e) => setFileArrayBuffer(e.target.result);\n        reader.readAsArrayBuffer(file);\n    }\n\n    function _onConfirm() {\n        if (!(onConfirm instanceof Function)) {\n            return;\n        }\n        setInProgress(true);\n        // We wrap `onConfirm` in an async function which will automatically\n        // convert it to a promise if needed.\n        (async () => onConfirm(fileContents))()\n            .then(() => {\n                setInProgress(false);\n            })\n            .catch(console.error)\n            .finally(() => {\n                setInProgress(false);\n                setFileArrayBuffer(null);\n                setFileContents(null);\n                setFileInputLabel(label);\n            });\n    }\n\n    // When a confirm operation is in progress, a spinner is displayed; otherwise\n    // it's hidden\n    const spinner = inProgress ? (\n        <Spinner animation=\"border\" size=\"sm\" className=\"mr-1\" />\n    ) : null;\n\n    return (\n        <Modal\n            show={dialogOpen}\n            onHide={onClose}\n            size=\"lg\"\n            dialogClassName=\"wide-modal\"\n        >\n            <Modal.Header closeButton>\n                <Modal.Title>Import From File</Modal.Title>\n            </Modal.Header>\n\n            <Modal.Body>\n                <Container>\n                    <Row className=\"mb-3\">\n                        <Col>\n                            <Form>\n                                <Form.File\n                                    label={fileInputLabel}\n                                    onChange={_onFileChange}\n                                    custom\n                                ></Form.File>\n                            </Form>\n                        </Col>\n                    </Row>\n                    <Row>\n                        <Col>{dialogContent}</Col>\n                    </Row>\n                </Container>\n            </Modal.Body>\n\n            <Modal.Footer>\n                <Button variant=\"secondary\" onClick={onCancel}>\n                    Cancel\n                </Button>\n                <Button variant=\"primary\" onClick={_onConfirm}>\n                    {spinner}\n                    Confirm\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\n/**\n * Renders an dropdown import button component that imports data from file.\n * When clicked, a dialog is opened where a user can select a file to import.\n *\n * @param onFileChange - function called when a file is selected. Do any processing or validation in response to this callback.\n * @param dialgoContent - Content of the dialog to be show. Can be a preview of the data or a validation message.\n * @param onConfirm - Called when the \"Confirm\" button is pressed. Can be an async function. If so, a spinner will be displayed between the time \"Confirm\" is pressed and the time `onConfirm` finishes executing.\n */\nexport function ImportButton({\n    onFileChange,\n    dialogContent,\n    onConfirm,\n    setInProgress,\n}) {\n    const [dialogOpen, setDialogOpen] = useState(false);\n\n    /**\n     * closes the dialog by setting dialogOpen to false\n     */\n    function handleClose() {\n        setDialogOpen(false);\n    }\n\n    function onCancel() {\n        onFileChange(null);\n        handleClose();\n    }\n\n    async function _onConfirm(...args) {\n        await onConfirm(...args);\n        setDialogOpen(false);\n    }\n\n    return (\n        <>\n            <Button onClick={() => setDialogOpen(true)}>Import</Button>\n            <ImportDialog\n                dialogOpen={dialogOpen}\n                onCancel={onCancel}\n                onClose={handleClose}\n                onFileChange={onFileChange}\n                dialogContent={dialogContent}\n                onConfirm={_onConfirm}\n                setInProgress={setInProgress}\n            />\n        </>\n    );\n}\n\nImportButton.propTypes = {\n    uploadFunc: PropTypes.func,\n};\n\n/**\n * Renders an dropdown import button component that imports data from file.\n * When clicked, a dialog is opened where a user can select a file to import.\n *\n * @param onFileChange - function called when a file is selected. Do any processing or validation in response to this callback.\n * @param dialogContent - Content of the dialog to be show. Can be a preview of the data or a validation message.\n * @param onConfirm - Called when the \"Confirm\" button is pressed. Can be an async function. If so, a spinner will be displayed between the time \"Confirm\" is pressed and the time `onConfirm` finishes executing.\n */\nexport function ImportActionButton({\n    onFileChange,\n    dialogContent,\n    onConfirm,\n    setInProgress,\n    disabled = false,\n}) {\n    const [dialogOpen, setDialogOpen] = useState(false);\n\n    /**\n     * closes the dialog by setting dialogOpen to false\n     */\n    function handleClose() {\n        setDialogOpen(false);\n    }\n\n    function onCancel() {\n        onFileChange(null);\n        handleClose();\n    }\n\n    async function _onConfirm(...args) {\n        await onConfirm(...args);\n        setDialogOpen(false);\n    }\n\n    return (\n        <>\n            <ActionButton\n                icon={FaUpload}\n                onClick={() => setDialogOpen(true)}\n                disabled={disabled}\n            >\n                Import\n            </ActionButton>\n            <ImportDialog\n                dialogOpen={dialogOpen}\n                onCancel={onCancel}\n                onClose={handleClose}\n                onFileChange={onFileChange}\n                dialogContent={dialogContent}\n                onConfirm={_onConfirm}\n                setInProgress={setInProgress}\n            />\n        </>\n    );\n}\n\nImportButton.propTypes = {\n    uploadFunc: PropTypes.func,\n};\n","/*\n * A collection of utility functions for dealing with imported data (e.g., spreadsheets\n * and JSON files).\n */\nimport FuzzySet from \"fuzzyset\";\nimport XLSX from \"xlsx\";\nimport * as chrono from \"chrono-node\";\n\n/**\n * Validates `data` based on the specified `schema`. At the moment this\n * function only checks that every key specified by `schema.requiredKeys` is\n * non-null.\n *\n * @export\n * @param {*} data\n * @param {*} schema\n */\nexport function validate(data, schema) {\n    const { requiredKeys } = schema;\n    for (const item of data) {\n        for (const key of requiredKeys) {\n            if (item[key] == null) {\n                throw new Error(\n                    `Item \"${JSON.stringify(\n                        item\n                    )}\" missing required property \"${key}\"`\n                );\n            }\n        }\n    }\n}\n\n/**\n * Delete all properties from `keyMap` that have `value` as\n * their value. This function mutates `keyMap`.\n *\n * @param {*} value\n * @param {*} keyMap\n * @returns\n */\nfunction deleteReferences(value, keyMap) {\n    for (const key in keyMap) {\n        if (keyMap[key] === value) {\n            delete keyMap[key];\n        }\n    }\n    return keyMap;\n}\n\n/**\n * Do fuzzy matching looking for the best approximation of\n * `keyMap[targetKey]`. E.g., if `keyMap = { foo: \"bar\" }`,\n * then `findMatchingKey(\"Foo\", keyMap)` would return `\"bar\"`.\n *\n * If no fuzzy match is found, `null` is returned.\n *\n * @param {*} targetKey\n * @param {*} [keyMap={}]\n * @returns {string | null}\n */\nfunction findMatchingKey(targetKey, keyMap = {}) {\n    if (targetKey in keyMap) {\n        return keyMap[targetKey];\n    }\n    const fuzzySet = FuzzySet(Object.keys(keyMap));\n    // We set a 70% match threshold to prevent mismatches.\n    const matches = fuzzySet.get(targetKey, null, 0.7);\n    if (matches) {\n        // Since we already checked for 100% matches, `matches` will\n        // always be an array of results of the form [[<%match>, <value matched>]]\n        const matchedKey = matches[0][1];\n        return keyMap[matchedKey];\n    }\n\n    return null;\n}\n\n/**\n * Given a `schema`, use fuzzy matching to match column names to\n * schema values.\n *\n * @class SpreadsheetRowMapper\n */\nexport class SpreadsheetRowMapper {\n    constructor(schema) {\n        this.keys = schema.keys;\n        this.keyMap = { ...schema.keyMap };\n        // `keys` are always valid, so make sure they are in the keymap.\n        for (const key of this.keys) {\n            this.keyMap[key] = key;\n        }\n        // Maintain a copy of `this.keyMap`. Items are deleted\n        // from this copy when they are matched (and cached). That\n        // way we don't accidentally double-match an item.\n        this.unmatchedKeys = { ...this.keyMap };\n\n        // This stores associations that we've found in\n        // the spreadsheet already.\n        this.empiricalKeyMap = {};\n        this.unknownKeys = {};\n    }\n    /**\n     * Inputs an object, e.g. `{\"First Name\": \"Joe\", \"Last Name\": \"Smith\"}`\n     * and returns a formatted object where the keys have been replaced by\n     * keys from the schema. E.g., this function might return `{first_name: \"Joe\", last_name: \"Smith\"}`.\n     *\n     * The search for appropriate keys is done with a fuzzy matching algorithm, so\n     * the processed spreadsheet headers don't need to exactly match what's given.\n     *\n     * @param {*} row\n     * @param {boolean} log - whether or not to show lookups using `console.log`\n     * @memberof SpreadsheetRowMapper\n     */\n    formatRow(row, log = true) {\n        const ret = {};\n        for (const [key, value] of Object.entries(row)) {\n            // If we've found this key before, use the cached version.\n            if (key in this.empiricalKeyMap) {\n                ret[this.empiricalKeyMap[key]] = value;\n                continue;\n            }\n            // If we have cached that we don't know a key, continue\n            if (key in this.unknownKeys) {\n                continue;\n            }\n            const matchedKey = findMatchingKey(key, this.unmatchedKeys);\n            if (matchedKey == null) {\n                if (log) {\n                    console.log(\n                        \"Could not find a key corresponding to spreadsheet column\",\n                        `\"${key}\"`\n                    );\n                }\n                this.unknownKeys[key] = true;\n                continue;\n            }\n            if (log) {\n                console.log(\n                    \"Assuming association between spreadsheet column\",\n                    `\"${key}\"`,\n                    \"and the key\",\n                    `\"${matchedKey}\"`\n                );\n            }\n            this.empiricalKeyMap[key] = matchedKey;\n            deleteReferences(matchedKey, this.unmatchedKeys);\n            ret[matchedKey] = value;\n        }\n\n        return ret;\n    }\n}\n\n/**\n * Find a suitable match in the `people` array for `name`. `name` can\n * be a utorid or a string `\"Last, First\"` or a string `\"First Last\"`.\n * If no suitable match is found, an error is thrown.\n *\n * @export\n * @param {string} name\n * @param {{utorid: string, first_name: string, last_name: string}[]} people\n * @returns\n */\nexport function matchByUtoridOrName(name, people) {\n    let match = people.find((x) => x.utorid === name);\n    if (match) {\n        // We found an exact match by UTORid\n        return match;\n    }\n\n    const nameHash = {};\n    for (const person of people) {\n        // We want to be able to match no matter the order in which the names are specified.\n        nameHash[`${person.last_name}, ${person.first_name}`] = person;\n        nameHash[`${person.first_name} ${person.last_name}`] = person;\n    }\n\n    const fuzzySet = FuzzySet(Object.keys(nameHash));\n    match = fuzzySet.get(name, null, 0.7);\n    if (match) {\n        let matchedKey = match;\n        if (Array.isArray(match)) {\n            // If we get an array as a result, it will be of the form [[<%match>, <value matched>]]\n            matchedKey = match[0][1];\n        }\n        return nameHash[matchedKey];\n    }\n\n    throw new Error(`Could not find a match for \"${name}\"`);\n}\n\n/**\n * Parse a date string or integer and return a normalized date string.\n *\n * @param {string | number} str - input date; either a string or an excel date integer\n * @returns {string} - date in YYYY-MM-DD:T00:00:00.000 format\n */\nfunction parseDate(str) {\n    // Dates parsed from excel will come in as a number. Convert those to an appropriate string first.\n    if (typeof str === \"number\") {\n        // Convert to seconds since epoch\n        const sec = Math.round((str - 25569) * 86400 * 1000);\n        // Excel ignores timezone information, so we need to parse this and\n        // remove the timezone tag.\n        str = new Date(sec).toJSON().replace(\"Z\", \"\");\n    }\n    // Parse the date accepting many different formats\n    let date = chrono.parseDate(str);\n    // We need to jump through some hoops to remove all the timezone information.\n    try {\n        return date.toJSON().replace(/T.*/, \"T00:00:00.000Z\");\n    } catch (e) {\n        throw new Error(`Cannot parse \"${str}\" as date`);\n    }\n}\n\n/**\n * Use `schema` to normalize `data` to be an array of objects specified\n * by `schema`. `data` is expected to be an object with `fileType`\n * and `data` attributes. `data.fileType` may be `\"json\"` or `\"spreadsheet\"`.\n * `\"json\"` data is expected to already match the schema. `\"spreadsheet\"` data\n * is converted to match the schema using fuzzy matching on column names (if needed).\n *\n * @export\n * @param {{fileType: \"json\" | \"spreadsheet\", data: any}} data\n * @param {*} [schema={ keys: [], requiredKeys: [] }]\n * @returns\n */\nexport function normalizeImport(\n    data,\n    schema = { keys: [], requiredKeys: [], dateColumns: [] }\n) {\n    const { keys, baseName } = schema;\n    let ret = [];\n    if (data.fileType === \"json\") {\n        // Unwrap data so that it's just an array\n        data = data.data;\n        if (data[baseName]) {\n            data = data[baseName];\n        }\n        for (const item of data) {\n            const newItem = {};\n            for (const key of keys) {\n                newItem[key] = item[key];\n            }\n            ret.push(newItem);\n        }\n    }\n\n    if (data.fileType === \"spreadsheet\") {\n        // `data` should be an array of objects indexed by column name.\n        // E.g., [{\"First Name\": \"Joe\", \"Last Name\": \"Smith\"}, ...]\n        data = data.data;\n\n        const rowMapper = new SpreadsheetRowMapper(schema);\n\n        for (const row of data) {\n            ret.push(rowMapper.formatRow(row));\n        }\n    }\n\n    if (schema.dateColumns && schema.dateColumns.length > 0) {\n        ret = ret.map((row) => {\n            const newRow = { ...row };\n            for (const col of schema.dateColumns) {\n                if (newRow[col] != null) {\n                    newRow[col] = parseDate(newRow[col]);\n                }\n            }\n            return newRow;\n        });\n    }\n\n    validate(ret, schema);\n\n    return ret;\n}\n\n/**\n *  Create a `File` object containing of the specified format.\n *\n * @param {{toSpreadsheet: func, toJson: func}} formatters - Formatters return an array of objects (usable as spreadsheet rows) or a javascript object to be passed to JSON.stringify\n * @param {\"xlsx\" | \"csv\" | \"json\"} dataFormat\n * @param {string} filePrefix\n * @returns {File}\n */\nexport function dataToFile(formatters, dataFormat, filePrefix = \"\") {\n    const fileName = `${filePrefix}${\n        filePrefix ? \"_\" : \"\"\n    }export_${new Date().toLocaleDateString(\"en-CA\", {\n        year: \"numeric\",\n        month: \"numeric\",\n        day: \"numeric\",\n    })}`;\n\n    if (dataFormat === \"spreadsheet\" || dataFormat === \"csv\") {\n        const workbook = XLSX.utils.book_new();\n        const sheet = XLSX.utils.aoa_to_sheet(formatters.toSpreadsheet());\n        XLSX.utils.book_append_sheet(workbook, sheet, \"Instructors\");\n\n        const bookType = dataFormat === \"csv\" ? \"csv\" : \"xlsx\";\n\n        // We convert the data into a blob and return it so that it can be downloaded\n        // by the user's browser\n        const file = new File(\n            [XLSX.write(workbook, { type: \"array\", bookType })],\n            `${fileName}.${bookType}`,\n            {\n                type:\n                    \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n            }\n        );\n        return file;\n    }\n\n    if (dataFormat === \"json\") {\n        const file = new File(\n            [JSON.stringify(formatters.toJson(), null, 4)],\n            `${fileName}.json`,\n            {\n                type: \"application/json\",\n            }\n        );\n        return file;\n    }\n\n    throw new Error(\n        `Cannot process data to format \"${dataFormat}\"; try \"spreadsheet\" or \"json\".`\n    );\n}\n","/*\n * A collection of utility functions for use when exporting data.\n */\n\nimport {\n    WageChunk,\n    Session,\n    Position,\n    Instructor,\n    Assignment,\n    ContractTemplate,\n    Applicant,\n    MinimalWageChunk,\n    MinimalSession,\n    MinimalPosition,\n    MinimalInstructor,\n    MinimalAssignment,\n    MinimalContractTemplate,\n    MinimalApplicant,\n    MinimalDdah,\n    Ddah,\n} from \"../api/defs/types\";\n\n/**\n * Determine whether `wageChunks` can be derived from `session`. E.g.,\n * the rates match the session rates.\n *\n * @param {*} wageChunks\n * @param {*} session\n * @returns {boolean}\n */\nfunction wageChunksMatchPositionAndSession(\n    wageChunks: WageChunk[],\n    position: Position,\n    session: Session\n): boolean {\n    if (!session || !Array.isArray(wageChunks)) {\n        return true;\n    }\n    // A single wage chunk matching the session rate is derivable\n    if (wageChunks.length === 1) {\n        const chunk: WageChunk = wageChunks[0];\n        if (\n            chunk.start_date === position.start_date &&\n            chunk.end_date === position.end_date &&\n            (chunk.rate === session.rate1 || chunk.rate === session.rate2)\n        ) {\n            return true;\n        }\n    }\n    // Two wage chunks split at January matching the session rates are derivable\n    if (wageChunks.length === 2) {\n        let [chunk1, chunk2] = wageChunks;\n        // If for some reason the wage chunks don't have dates, they aren't derivable.\n        if (\n            !chunk1.end_date ||\n            !chunk1.end_date ||\n            !chunk2.start_date ||\n            !chunk2.end_date\n        ) {\n            return false;\n        }\n        // Make sure the wage chunks are ordered by date\n        if (chunk1.end_date > chunk2.start_date) {\n            const tmp = chunk1;\n            chunk1 = chunk2;\n            chunk2 = tmp;\n        }\n\n        // If the wage chunk dates don't match the position's dates,\n        // we're not derivable.\n        if (\n            chunk1.start_date !== position.start_date ||\n            chunk2.end_date !== position.end_date\n        ) {\n            return false;\n        }\n\n        // If the wage chunks are split exactly at a year boundary and the rates\n        // match the session rates, then we *are* derivable.\n        if (\n            (chunk1.end_date || \"\").slice(5, 10) === \"12-31\" &&\n            (chunk2.start_date || \"\").slice(5, 10) === \"01-01\" &&\n            chunk1.rate === session.rate1 &&\n            chunk2.rate === session.rate2\n        ) {\n            return true;\n        }\n    }\n    return false;\n}\n\n/**\n * Prepare a minimal representation of the specified object suitable for\n * export. The returned object will contain exactly the fields needed to\n * perfectly reconstruct the object on import an no others. E.g., instructors\n * referenced by a position will only be referenced by UTORid (and won't have information\n * about their names, etc.).\n *\n * These function also strips all `id` fields, since these are database specific and\n * not used when importing.\n */\nexport const prepareMinimal = {\n    session: function (session: Session): MinimalSession {\n        return {\n            name: session.name,\n            start_date: session.start_date,\n            end_date: session.end_date,\n            rate1: session.rate1,\n            rate2: session.rate2,\n        };\n    },\n    contractTemplate: function (\n        contractTemplate: ContractTemplate\n    ): MinimalContractTemplate {\n        return {\n            template_name: contractTemplate.template_name,\n            template_file: contractTemplate.template_file,\n        };\n    },\n    instructor: function (instructor: Instructor): MinimalInstructor {\n        return {\n            first_name: instructor.first_name,\n            last_name: instructor.last_name,\n            utorid: instructor.utorid,\n            email: instructor.email,\n        };\n    },\n    position: function (position: Position): MinimalPosition {\n        return {\n            position_code: position.position_code,\n            position_title: position.position_title,\n            hours_per_assignment: position.hours_per_assignment,\n            start_date: position.start_date,\n            end_date: position.end_date,\n            duties: position.duties,\n            qualifications: position.qualifications,\n            ad_hours_per_assignment: position.ad_hours_per_assignment,\n            ad_num_assignments: position.ad_num_assignments,\n            ad_open_date: position.ad_open_date,\n            ad_close_date: position.ad_close_date,\n            desired_num_assignments: position.desired_num_assignments,\n            current_enrollment: position.current_enrollment,\n            current_waitlisted: position.current_waitlisted,\n            instructors: position.instructors.map(\n                (instructor) => instructor.utorid\n            ),\n            contract_template: position.contract_template.template_name,\n        };\n    },\n    wageChunk: function (wageChunk: WageChunk): MinimalWageChunk {\n        return {\n            start_date: wageChunk.start_date,\n            end_date: wageChunk.end_date,\n            rate: wageChunk.rate,\n            hours: wageChunk.hours,\n        };\n    },\n    assignment: function (\n        assignment: Assignment,\n        session: Session\n    ): MinimalAssignment {\n        const ret: MinimalAssignment = {\n            utorid: assignment.applicant.utorid,\n            position_code: assignment.position.position_code,\n        };\n        // If there is an contract_override_pdf, we store it, otherwise\n        // the contract comes from the `position` so we don't need to store it.\n        if (assignment.contract_override_pdf) {\n            ret.contract_override_pdf = assignment.contract_override_pdf;\n        }\n\n        // If the start and end dates match the position, there is no need to\n        // store them.\n        const position = assignment.position;\n        if (\n            (assignment.start_date &&\n                assignment.start_date !== position.start_date) ||\n            (assignment.end_date && assignment.end_date !== position.end_date)\n        ) {\n            ret.start_date = assignment.start_date || position.start_date;\n            ret.end_date = assignment.end_date || position.end_date;\n        }\n        // If there is a single wage chunk and the rate matches the session rate,\n        // then just store the number of hours. Otherwise, store the wage chunk(s)\n        if (\n            !Array.isArray(assignment.wage_chunks) ||\n            assignment.wage_chunks.length === 0\n        ) {\n            ret.hours = assignment.hours;\n        } else if (\n            session &&\n            wageChunksMatchPositionAndSession(\n                assignment.wage_chunks,\n                position,\n                session\n            )\n        ) {\n            // The rate is the same as the session rate, so we don't need to store the\n            // wage chunk details\n            ret.hours = assignment.hours;\n        } else {\n            ret.wage_chunks = assignment.wage_chunks.map((chunk) =>\n                prepareMinimal.wageChunk(chunk)\n            );\n        }\n\n        return ret;\n    },\n    applicant: function (applicant: Applicant): MinimalApplicant {\n        return {\n            first_name: applicant.first_name,\n            last_name: applicant.last_name,\n            utorid: applicant.utorid,\n            email: applicant.email,\n            student_number: applicant.student_number,\n            phone: applicant.phone,\n        };\n    },\n    ddah: function (ddah: Ddah): MinimalDdah {\n        const duties = [...ddah.duties];\n        duties.sort((a, b) => a.order - b.order);\n\n        return {\n            position_code: ddah.assignment.position.position_code,\n            applicant: ddah.assignment.applicant.utorid,\n            duties: duties.map((duty) => ({\n                hours: duty.hours,\n                description: duty.description,\n            })),\n        };\n    },\n};\n\n/**\n * The function type of a function that creates an upsertable\n * object. I.e., it may or may not have an ID field.\n *\n * @interface PrepareUpsertable\n * @template T - Minimal representation\n * @template U - Full representation\n * @template V - Context attributes that are required to create a full representation\n */\n\ninterface PrepareUpsertable<T, U, Context> {\n    (minimal: T, context: Omit<Context, \"id\">): Omit<U, \"id\">;\n    (minimal: T, context: Context): U;\n}\n\ninterface Context {\n    session: Session;\n    instructors: Instructor[];\n    contractTemplates: ContractTemplate[];\n    positions: Position[];\n    applicants: Applicant[];\n}\n\ninterface IdContext extends Context {\n    id: number;\n}\n\ninterface prepareFull {\n    session: PrepareUpsertable<MinimalSession, Session, { id: number }>;\n    contractTemplate: PrepareUpsertable<\n        MinimalContractTemplate,\n        ContractTemplate,\n        { id: number }\n    >;\n    instructor: PrepareUpsertable<\n        MinimalInstructor,\n        Instructor,\n        { id: number }\n    >;\n    applicant: PrepareUpsertable<MinimalApplicant, Applicant, { id: number }>;\n    position: PrepareUpsertable<\n        MinimalPosition,\n        Position,\n        {\n            id: number;\n            contractTemplates: ContractTemplate[];\n            instructors: Instructor[];\n        }\n    >;\n    wageChunk: PrepareUpsertable<MinimalWageChunk, WageChunk, { id: number }>;\n    assignment: PrepareUpsertable<\n        MinimalAssignment,\n        Assignment,\n        {\n            id: number;\n            session: Session;\n            applicants: Applicant[];\n            positions: Position[];\n        }\n    >;\n    ddah: PrepareUpsertable<\n        MinimalDdah,\n        Ddah,\n        {\n            id: number;\n            assignments: Assignment[];\n        }\n    >;\n}\n\nexport const prepareFull: prepareFull = {\n    session: function (minSession: MinimalSession, context?: any): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minSession };\n        }\n        return minSession;\n    },\n    contractTemplate: function (\n        minContractTemplate: MinimalContractTemplate,\n        context?: any\n    ): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minContractTemplate };\n        }\n        return minContractTemplate;\n    },\n    instructor: function (\n        minInstructor: MinimalInstructor,\n        context?: any\n    ): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minInstructor };\n        }\n        return minInstructor;\n    },\n    applicant: function (minApplicant: MinimalApplicant, context?: any): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minApplicant };\n        }\n        return minApplicant;\n    },\n    position: function (minPosition: MinimalPosition, context?: any): any {\n        const { id, instructors, contractTemplates }: Partial<IdContext> =\n            context || {};\n        if (!Array.isArray(instructors)) {\n            throw new Error(\n                \"You must pass an array of instructors to reconstruct a position\"\n            );\n        }\n        if (!Array.isArray(contractTemplates)) {\n            throw new Error(\n                \"You must pass an array of contract templates to reconstruct a position\"\n            );\n        }\n\n        const ret: Partial<Position> = {\n            position_code: minPosition.position_code,\n            position_title: minPosition.position_title,\n            hours_per_assignment: minPosition.hours_per_assignment,\n            start_date: minPosition.start_date,\n            end_date: minPosition.end_date,\n            duties: minPosition.duties,\n            qualifications: minPosition.qualifications,\n            ad_hours_per_assignment: minPosition.ad_hours_per_assignment,\n            ad_num_assignments: minPosition.ad_num_assignments,\n            ad_open_date: minPosition.ad_open_date,\n            ad_close_date: minPosition.ad_close_date,\n            desired_num_assignments: minPosition.desired_num_assignments,\n            current_enrollment: minPosition.current_enrollment,\n            current_waitlisted: minPosition.current_waitlisted,\n        };\n\n        // Add in the id if we have it\n        if (id != null) {\n            ret.id = id;\n        }\n\n        // Search for and add the contract template\n        const contract_template = contractTemplates.find(\n            (template) =>\n                template.template_name === minPosition.contract_template\n        );\n        if (contract_template == null) {\n            throw new Error(\n                `Couldn't find contract template with name \"${minPosition.contract_template}\"`\n            );\n        }\n        ret.contract_template = contract_template;\n\n        // Search for an add the list of instructors\n        const instructorList = minPosition.instructors.map((utorid) => {\n            const match = instructors.find((x) => x.utorid === utorid);\n            if (match == null) {\n                throw new Error(\n                    `Could not find instructor with utorid \"${utorid}\"`\n                );\n            }\n            return match;\n        });\n        ret.instructors = instructorList;\n\n        return ret;\n    },\n    wageChunk: function (minWageChunk: MinimalWageChunk, context?: any): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minWageChunk };\n        }\n        return minWageChunk;\n    },\n    assignment: function (\n        minAssignment: MinimalAssignment,\n        context?: any\n    ): any {\n        const { id, positions, applicants, session }: Partial<IdContext> =\n            context || {};\n        if (!Array.isArray(positions)) {\n            throw new Error(\n                \"You must pass an array of positions to reconstruct an assignment\"\n            );\n        }\n        if (!Array.isArray(applicants)) {\n            throw new Error(\n                \"You must pass an array of applicants to reconstruct an assignment\"\n            );\n        }\n        if (!session) {\n            throw new Error(\n                \"You must pass a session to reconstruct an assignment\"\n            );\n        }\n\n        const ret: Partial<Assignment> = {\n            contract_override_pdf: minAssignment.contract_override_pdf,\n        };\n\n        // Add in the id if we have it\n        if (id != null) {\n            ret.id = id;\n        }\n\n        if (minAssignment.hours != null) {\n            ret.hours = minAssignment.hours;\n        }\n\n        // Attach the position\n        const position = positions.find(\n            (x) => x.position_code === minAssignment.position_code\n        );\n        if (position == null) {\n            throw new Error(\n                `Cannot find position with position code \"${minAssignment.position_code}\"`\n            );\n        }\n        ret.position = position;\n\n        // Attach the applicant\n        const applicant = applicants.find(\n            (x) => x.utorid === minAssignment.utorid\n        );\n        if (applicant == null) {\n            throw new Error(\n                `Couldn't find applicant with UTORid \"${minAssignment.utorid}\"`\n            );\n        }\n        ret.applicant = applicant;\n\n        // Attach the wage chunks\n        if (Array.isArray(minAssignment.wage_chunks)) {\n            let hours = 0;\n            for (const chunk of minAssignment.wage_chunks) {\n                hours += chunk.hours;\n            }\n            ret.hours = hours;\n            ret.wage_chunks = minAssignment.wage_chunks as WageChunk[];\n        }\n\n        // Compute the start and end dates\n        ret.start_date = minAssignment.start_date || position.start_date;\n        ret.end_date = minAssignment.end_date || position.end_date;\n\n        return ret;\n    },\n    ddah: function (minDdah: MinimalDdah, context?: any): any {\n        const { id, assignments }: { id?: number; assignments?: Assignment[] } =\n            context || {};\n        if (!Array.isArray(assignments)) {\n            throw new Error(\n                \"You must pass an array of assignments to reconstruct a ddah\"\n            );\n        }\n        const matchingAssignment = assignments.find(\n            (assignment) =>\n                assignment.applicant.utorid === minDdah.applicant &&\n                assignment.position.position_code === minDdah.position_code\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Cannot find assignment corresponding to '${minDdah.position_code}' and UTORid '${minDdah.applicant}'`\n            );\n        }\n        const duties = minDdah.duties.map((duty, i) => ({\n            ...duty,\n            order: i + 1,\n        }));\n\n        let total_hours = 0;\n        for (const duty of duties) {\n            total_hours += duty.hours;\n        }\n\n        if (id == null) {\n            return {\n                assignment: matchingAssignment,\n                duties,\n                total_hours,\n                status: null,\n            };\n        }\n        return {\n            id,\n            assignment: matchingAssignment,\n            duties,\n            total_hours,\n            // We cannot import \"signed\" DDAHs, so the `status` is always null\n            status: null,\n        };\n    },\n};\n","/*\n * A collection of utility functions for comparing imported data and producing diffs.\n */\n\nimport {\n    Session,\n    Position,\n    Instructor,\n    Assignment,\n    ContractTemplate,\n    MinimalPosition,\n    MinimalInstructor,\n    MinimalAssignment,\n    Utorid,\n    Applicant,\n    MinimalApplicant,\n    MinimalDdah,\n    Ddah,\n    Duty,\n} from \"../api/defs/types\";\nimport { prepareMinimal, prepareFull } from \"./exportUtils\";\nimport { matchByUtoridOrName } from \"./importExportUtils\";\n\n/**\n * Type of a diff between an object and existing objects\n * obtained by finding the differences between minimal representations.\n *\n * @interface DiffSpec\n * @template T - type of minimal representation (e.g., MinimalInstructor)\n * @template U - type of full representation (e.g. Instructor)\n */\nexport interface DiffSpec<T, U> {\n    status: \"new\" | \"duplicate\" | \"modified\";\n    changes: Partial<Record<keyof T, string>>;\n    obj: U | Omit<U, \"id\">;\n}\n\n/**\n * Compute the difference between a supplied array of objects and the existing objects\n * of that type. Results are supplied as an array of DiffSpec objects.\n */\nexport const diffImport = {\n    instructorsListFromField: function (\n        list: Utorid[] | string,\n        context: { instructors: Instructor[] }\n    ): Instructor[] {\n        const instructors = context.instructors;\n        if (Array.isArray(list)) {\n            return list.map((utorid) => {\n                const match = instructors.find((x) => x.utorid === utorid);\n                if (!match) {\n                    throw new Error(\n                        `Cannot find instructor with UTORid ${utorid}`\n                    );\n                }\n                return match;\n            });\n        }\n        list = list.split(\";\").map((x) => x.trim());\n\n        return list.map((name) => matchByUtoridOrName(name, instructors));\n    },\n    instructor: function (\n        instructor: MinimalInstructor,\n        context: { instructors: Instructor[] }\n    ): DiffSpec<MinimalInstructor, Instructor> {\n        const existingInstructors = context.instructors;\n        const ret: DiffSpec<MinimalInstructor, Instructor> = {\n            status: \"new\",\n            changes: {},\n            obj: null as any, // Set to any temporarily to keep typescript from complaining\n        };\n        // Check to see if there is a matching instructor in the existing list\n        const matchingInstructor = existingInstructors.find(\n            (x) => x.utorid === instructor.utorid\n        );\n\n        if (matchingInstructor) {\n            ret.status = \"duplicate\";\n            const minimal = prepareMinimal.instructor(matchingInstructor);\n            for (const _prop in minimal) {\n                const prop = _prop as keyof MinimalInstructor;\n                const oldVal = minimal[prop];\n                const newVal = instructor[prop];\n                if (!isSame(oldVal, newVal)) {\n                    ret.status = \"modified\";\n                    ret.changes[prop] = `\"${oldVal}\" → \"${newVal}\"`;\n                }\n            }\n            ret.obj = prepareFull.instructor(instructor, {\n                id: matchingInstructor.id,\n            });\n        } else {\n            ret.obj = prepareFull.instructor(instructor, {});\n        }\n\n        return ret;\n    },\n    instructors: function (\n        importedInstructors: MinimalInstructor[],\n        context: { instructors: Instructor[] }\n    ): DiffSpec<MinimalInstructor, Instructor>[] {\n        return importedInstructors.map((instructor) =>\n            diffImport.instructor(instructor, context)\n        );\n    },\n    position: function (\n        position: MinimalPosition,\n        context: {\n            positions: Position[];\n            instructors: Instructor[];\n            contractTemplates: ContractTemplate[];\n        }\n    ): DiffSpec<MinimalPosition, Position> {\n        const instructors = context.instructors;\n        const contractTemplates = context.contractTemplates;\n        const existingPositions = context.positions;\n        const ret: DiffSpec<MinimalPosition, Position> = {\n            status: \"new\",\n            changes: {},\n            obj: null as any, // Set to any temporarily to keep typescript from complaining\n        };\n        // Check to see if there is a matching instructor in the existing list\n        const matchingPosition = existingPositions.find(\n            (x) => x.position_code === position.position_code\n        );\n\n        if (matchingPosition) {\n            ret.status = \"duplicate\";\n            const minimal = prepareMinimal.position(matchingPosition);\n            for (const _prop in minimal) {\n                const prop = _prop as keyof MinimalPosition;\n                const oldVal = minimal[prop];\n                const newVal = position[prop];\n                if (!isSame(oldVal, newVal)) {\n                    ret.status = \"modified\";\n                    ret.changes[prop] = `\"${oldVal}\" → \"${newVal}\"`;\n                    // Format dates and instructor lists differently\n                    if (prop === \"start_date\" || prop === \"end_date\") {\n                        ret.changes[prop] = `\"${(\"\" + oldVal).slice(\n                            0,\n                            10\n                        )}\" → \"${(\"\" + newVal).slice(0, 10)}\"`;\n                    }\n                    if (prop === \"instructors\") {\n                        const oldInstructors = diffImport.instructorsListFromField(\n                            oldVal as any[],\n                            { instructors }\n                        );\n                        const newInstructors = diffImport.instructorsListFromField(\n                            newVal as any[],\n                            { instructors }\n                        );\n                        ret.changes[prop] = `${oldInstructors\n                            .map((x) => `${x.last_name}, ${x.first_name}`)\n                            .join(\"; \")} → ${newInstructors\n                            .map((x) => `${x.last_name}, ${x.first_name}`)\n                            .join(\"; \")}`;\n                    }\n                }\n            }\n            ret.obj = prepareFull.position(position, {\n                id: matchingPosition.id,\n                instructors,\n                contractTemplates,\n            });\n        } else {\n            ret.obj = prepareFull.position(position, {\n                instructors,\n                contractTemplates,\n            });\n        }\n\n        return ret;\n    },\n    positions: function (\n        importedPositions: MinimalPosition[],\n        context: {\n            positions: Position[];\n            instructors: Instructor[];\n            contractTemplates: ContractTemplate[];\n        }\n    ): DiffSpec<MinimalPosition, Position>[] {\n        return importedPositions.map((position) =>\n            diffImport.position(position, context)\n        );\n    },\n    assignments: function (\n        importedAssignments: MinimalAssignment[],\n        context: {\n            assignments: Assignment[];\n            positions: Position[];\n            applicants: Applicant[];\n            session: Session;\n        }\n    ): DiffSpec<MinimalAssignment, Assignment>[] {\n        return importedAssignments.map((assignment) =>\n            diffImport.assignment(assignment, context)\n        );\n    },\n    assignment: function (\n        assignment: MinimalAssignment,\n        context: {\n            assignments: Assignment[];\n            positions: Position[];\n            applicants: Applicant[];\n            session: Session;\n        }\n    ): DiffSpec<MinimalAssignment, Assignment> {\n        const existingAssignments = context.assignments;\n        const positions = context.positions;\n        const applicants = context.applicants;\n        const session = context.session;\n        const ret: DiffSpec<MinimalAssignment, Assignment> = {\n            status: \"new\",\n            changes: {},\n            obj: null as any, // Set to any temporarily to keep typescript from complaining\n        };\n        // Check to see if there is a matching instructor in the existing list\n        const assignmentHash = hashAssignment(assignment);\n        const matchingAssignment = existingAssignments.find(\n            (x) => hashAssignment(x) === assignmentHash\n        );\n\n        if (matchingAssignment) {\n            ret.status = \"duplicate\";\n            const minimal = prepareMinimal.assignment(\n                matchingAssignment,\n                session\n            );\n            // A MinimalAssignment has fields `position_code` and `utorid` which an\n            // Assignment does not. However, since a match must have the same position\n            // code and UTORid, we will never detect a change in these fields. Thus,\n            // they can be safely ignored.\n            for (const _prop in minimal) {\n                const prop = _prop as keyof MinimalAssignment;\n                const oldVal = minimal[prop];\n                const newVal = assignment[prop];\n                if (!isSame(oldVal, newVal)) {\n                    ret.status = \"modified\";\n                    ret.changes[prop] = `\"${oldVal}\" → \"${newVal}\"`;\n                    // Format dates and instructor lists differently\n                    if (prop === \"start_date\" || prop === \"end_date\") {\n                        ret.changes[prop] = `\"${(\"\" + oldVal).slice(\n                            0,\n                            10\n                        )}\" → \"${(\"\" + newVal).slice(0, 10)}\"`;\n                    }\n                    // If the `.hours` are null, it means that they are derived\n                    // from the wage chunks. However, it would be confusing to see\n                    // a message like \"55 -> undefined\" in the modification list,\n                    // so we recompute the hours from the wage chunks to display a better\n                    // message.\n                    if (\n                        prop === \"hours\" &&\n                        newVal == null &&\n                        Array.isArray(assignment.wage_chunks)\n                    ) {\n                        let hours = 0;\n                        for (const chunk of assignment.wage_chunks) {\n                            hours += chunk.hours;\n                        }\n                        if (oldVal === hours) {\n                            ret.changes[prop] = `${hours} (wage chunk change)`;\n                        } else {\n                            ret.changes[\n                                prop\n                            ] = `${oldVal} → ${hours} (wage chunk change)`;\n                        }\n                    }\n                    if (prop === \"wage_chunks\") {\n                        ret.changes[prop] = `\"${JSON.stringify(\n                            oldVal\n                        )}\" → \"${JSON.stringify(newVal)}\"`;\n                    }\n                }\n            }\n            ret.obj = prepareFull.assignment(assignment, {\n                id: matchingAssignment.id,\n                session,\n                positions,\n                applicants,\n            });\n        } else {\n            ret.obj = prepareFull.assignment(assignment, {\n                session,\n                positions,\n                applicants,\n            });\n        }\n\n        return ret;\n    },\n    applicants: function (\n        importedApplicants: MinimalApplicant[],\n        context: { applicants: Applicant[] }\n    ): DiffSpec<MinimalApplicant, Applicant>[] {\n        return importedApplicants.map((applicant) =>\n            diffImport.applicant(applicant, context)\n        );\n    },\n    applicant: function (\n        applicant: MinimalApplicant,\n        context: { applicants: Applicant[] }\n    ): DiffSpec<MinimalApplicant, Applicant> {\n        const existingApplicants = context.applicants;\n        const ret: DiffSpec<MinimalApplicant, Applicant> = {\n            status: \"new\",\n            changes: {},\n            obj: null as any, // Set to any temporarily to keep typescript from complaining\n        };\n        // Check to see if there is a matching instructor in the existing list\n        const matchingApplicant = existingApplicants.find(\n            (x) => x.utorid === applicant.utorid\n        );\n\n        if (matchingApplicant) {\n            ret.status = \"duplicate\";\n            const minimal = prepareMinimal.applicant(matchingApplicant);\n            for (const _prop in minimal) {\n                const prop = _prop as keyof MinimalApplicant;\n                const oldVal = minimal[prop];\n                const newVal = applicant[prop];\n                if (!isSame(oldVal, newVal)) {\n                    ret.status = \"modified\";\n                    ret.changes[prop] = `\"${oldVal}\" → \"${newVal}\"`;\n                }\n            }\n            ret.obj = prepareFull.applicant(applicant, {\n                id: matchingApplicant.id,\n            });\n        } else {\n            ret.obj = prepareFull.applicant(applicant, {});\n        }\n\n        return ret;\n    },\n    ddahs: function (\n        importedDdahs: MinimalDdah[],\n        context: { ddahs: Ddah[]; assignments: Assignment[] }\n    ): DiffSpec<MinimalDdah, Ddah>[] {\n        return importedDdahs.map((ddah) => diffImport.ddah(ddah, context));\n    },\n    ddah: function (\n        ddah: MinimalDdah,\n        context: { ddahs: Ddah[]; assignments: Assignment[] }\n    ): DiffSpec<MinimalDdah, Ddah> {\n        const existingDdahs = context.ddahs;\n        const ret: DiffSpec<MinimalDdah, Ddah> = {\n            status: \"new\",\n            changes: {},\n            obj: null as any, // Set to any temporarily to keep typescript from complaining\n        };\n        const assignments = context.assignments;\n\n        // Check to see if there is a matching instructor in the existing list\n        const matchingDdah = existingDdahs.find(\n            (x) =>\n                x.assignment.position.position_code === ddah.position_code &&\n                x.assignment.applicant.utorid === ddah.applicant\n        );\n\n        if (matchingDdah) {\n            ret.status = \"duplicate\";\n            const minimal = prepareMinimal.ddah(matchingDdah);\n            for (const _prop in minimal) {\n                const prop = _prop as keyof MinimalDdah;\n                const oldVal = minimal[prop];\n                const newVal = ddah[prop];\n                if (!isSame(oldVal, newVal)) {\n                    ret.status = \"modified\";\n                    if (prop === \"duties\") {\n                        // Duty diffs need to be handled specially since it's an array of objects\n                        ret.changes[prop] = `\"${ddahDutiesToString(\n                            oldVal as any\n                        )}\" → \"${ddahDutiesToString(newVal as any)}\"`;\n                    } else {\n                        ret.changes[prop] = `\"${oldVal}\" → \"${newVal}\"`;\n                    }\n                }\n            }\n            ret.obj = prepareFull.ddah(ddah, {\n                id: matchingDdah.id,\n                assignments,\n            });\n        } else {\n            ret.obj = prepareFull.ddah(ddah, { assignments });\n        }\n\n        return ret;\n    },\n};\n\n/**\n * Format a list of duties as a single string (for print a diff)\n *\n * @param {{hours: number, description: string}[]} duties\n * @returns {string}\n */\nexport function ddahDutiesToString(duties: Duty[]): string {\n    if (duties.length > 0 && duties[0].order != null) {\n        // If we a duties list with an order specified, sort the duties first.\n        // Otherwise, we assume they're in the right order.\n        duties = [...duties].sort((a, b) => a.order - b.order);\n    }\n    return duties\n        .map(({ hours, description }) => `${hours}h - ${description}`)\n        .join(\"; \");\n}\n\n/**\n * Distinguish between a MinimalAssignment and an Assignment\n *\n * @param {(MinimalAssignment | Assignment)} assignment\n * @returns {assignment is  MinimalAssignment}\n */\nfunction isMinimalAssignment(\n    assignment: MinimalAssignment | Assignment\n): assignment is MinimalAssignment {\n    // `Assignment` has a `.position` attribute, but not a `.position_code`\n    if ((assignment as MinimalAssignment).position_code) {\n        return true;\n    }\n    return false;\n}\n\n/**\n * Create a hash of an assignment/minimal assignment based on the position_code\n * and the applicant's UTORid.\n *\n * @param {(MinimalAssignment | Assignment)} assignment\n * @returns {string}\n */\nfunction hashAssignment(assignment: MinimalAssignment | Assignment): string {\n    let position_code, applicant_utorid;\n    if (isMinimalAssignment(assignment)) {\n        position_code = assignment.position_code;\n        applicant_utorid = assignment.utorid;\n    } else {\n        position_code = assignment.position.position_code;\n        applicant_utorid = assignment.applicant.utorid;\n    }\n    return `${position_code}/${applicant_utorid}`;\n}\n\n/**\n * Compare two objects and determine if they are the same. In this check,\n * `null`, `undefined`, and `\"\"` are counted as the same as each other (but\n * they are distinct from `0`). This is used for detecting diffs from spreadsheets\n * where `null` and `\"\"` can't be distinguished.\n *\n * @param {*} obj1\n * @param {*} obj2\n * @returns {boolean}\n */\nfunction isSame(obj1: any, obj2: any): boolean {\n    if (obj1 === obj2) {\n        return true;\n    }\n\n    if (typeof obj1 !== typeof obj2) {\n        return false;\n    }\n\n    if (typeof obj1 === \"number\") {\n        return (isNaN(obj1) && isNaN(obj2)) || obj1 === obj2;\n    }\n\n    // At this point, the only falsy values are `null`, `undefined`, and `\"\"`\n    // (because we've ruled out `0`). We want to treat all these values as the same.\n    if (!obj1 && !obj2) {\n        return true;\n    }\n\n    // If one of the objects is falsy and the other one isn't,\n    // they can't be equal. After this check, neither object is falsy.\n    if ((!obj1 && obj2) || (obj1 && !obj2)) {\n        return false;\n    }\n\n    if (Array.isArray(obj1) && Array.isArray(obj2)) {\n        if (obj1.length !== obj2.length) {\n            return false;\n        }\n        // We will compare sorted versions of the arrays. We make a copy\n        // so we don't mutate with the `.sort()` method.\n        obj1 = [...obj1].sort();\n        obj2 = [...obj2].sort();\n        for (let i = 0; i < obj1.length; i++) {\n            if (!isSame(obj1[i], obj2[i])) {\n                return false;\n            }\n        }\n        // If we made it here, all entries of `obj1` and `obj2` are the same.\n        return true;\n    }\n\n    // By this point, both `obj1` and `obj2` must be objects with properties (we ruled out `null`)\n    if (typeof obj1 === \"object\") {\n        const keys1 = Object.keys(obj1).sort();\n        const keys2 = Object.keys(obj2).sort();\n        if (!isSame(keys1, keys2)) {\n            return false;\n        }\n        return keys1.every((key) => isSame(obj1[key], obj2[key]));\n    }\n\n    return false;\n}\n\n/**\n * Extract a list of all objects that have changed from a diff.\n * These will be suitable for upserting.\n *\n * @export\n * @template T\n * @template U\n * @param {DiffSpec<T, U>[]} diffed\n * @returns {(U[] | Omit<U, \"id\">[])}\n */\nexport function getChanged<T, U>(\n    diffed: DiffSpec<T, U>[]\n): U[] | Omit<U, \"id\">[] {\n    return diffed\n        .filter((item) => item.status === \"new\" || item.status === \"modified\")\n        .map((item) => item.obj);\n}\n","import React from \"react\";\nimport FileSaver from \"file-saver\";\nimport {\n    instructorsSelector,\n    exportInstructors,\n    upsertInstructors,\n} from \"../../api/actions\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ExportActionButton } from \"../../components/export-button\";\nimport { ImportActionButton } from \"../../components/import-button\";\nimport {\n    InstructorsList,\n    InstructorsDiffList,\n} from \"../../components/instructors\";\nimport { Alert } from \"react-bootstrap\";\nimport { normalizeImport, dataToFile } from \"../../libs/importExportUtils\";\nimport { prepareMinimal } from \"../../libs/exportUtils\";\nimport { diffImport, getChanged } from \"../../libs/diffUtils\";\n\n/**\n * Allows for the download of a file blob containing the exported instructors.\n * Instructors are synchronized from the server before being downloaded.\n *\n * @export\n * @returns\n */\nexport function ConnectedExportInstructorsAction() {\n    const dispatch = useDispatch();\n    const [exportType, setExportType] = React.useState(null);\n\n    React.useEffect(() => {\n        if (!exportType) {\n            return;\n        }\n\n        async function doExport() {\n            // Having an export type of `null` means we're ready to export again,\n            // We set the export type to null at the start so in case an error occurs,\n            // we can still try again. This *will not* affect the current value of `exportType`\n            setExportType(null);\n\n            // Make a function that converts a list of instructors into a `File` object.\n            function prepareData(instructors, dataFormat) {\n                return dataToFile(\n                    {\n                        toSpreadsheet: () =>\n                            [\n                                [\"Last Name\", \"First Name\", \"UTORid\", \"email\"],\n                            ].concat(\n                                instructors.map((instructor) => [\n                                    instructor.last_name,\n                                    instructor.first_name,\n                                    instructor.utorid,\n                                    instructor.email,\n                                ])\n                            ),\n                        toJson: () => ({\n                            instructors: instructors.map((instructor) =>\n                                prepareMinimal.instructor(instructor)\n                            ),\n                        }),\n                    },\n                    dataFormat,\n                    \"instructors\"\n                );\n            }\n\n            const file = await dispatch(\n                exportInstructors(prepareData, exportType)\n            );\n\n            FileSaver.saveAs(file);\n        }\n        doExport().catch(console.error);\n    }, [exportType, dispatch]);\n\n    function onClick(option) {\n        setExportType(option);\n    }\n\n    return <ExportActionButton onClick={onClick} />;\n}\n\nconst instructorSchema = {\n    keys: [\"first_name\", \"last_name\", \"utorid\", \"email\"],\n    keyMap: {\n        \"First Name\": \"first_name\",\n        \"Given Name\": \"first_name\",\n        First: \"first_name\",\n        \"Last Name\": \"last_name\",\n        Surname: \"last_name\",\n        \"Family Name\": \"last_name\",\n        Last: \"last_name\",\n    },\n    requiredKeys: [\"utorid\"],\n    primaryKey: \"utorid\",\n    dateColumns: [],\n    baseName: \"instructors\",\n};\n\nexport function ConnectedImportInstructorAction({\n    setImportInProgress = null,\n}) {\n    const dispatch = useDispatch();\n    const instructors = useSelector(instructorsSelector);\n    const [fileContent, setFileContent] = React.useState(null);\n    const [diffed, setDiffed] = React.useState(null);\n    const [processingError, setProcessingError] = React.useState(null);\n    const [inProgress, _setInProgress] = React.useState(false);\n\n    function setInProgress(state) {\n        _setInProgress(state);\n        if (typeof setImportInProgress === \"function\") {\n            setImportInProgress(state);\n        }\n    }\n\n    // Make sure we aren't showing any diff if there's no file loaded.\n    React.useEffect(() => {\n        if (!fileContent) {\n            if (diffed) {\n                setDiffed(null);\n            }\n        }\n    }, [diffed, setDiffed, fileContent]);\n\n    // Recompute the diff every time the file changes\n    React.useEffect(() => {\n        // If we have no file or we are currently in the middle of processing another file,\n        // do nothing.\n        if (!fileContent || inProgress) {\n            return;\n        }\n        try {\n            setProcessingError(null);\n            // normalize the data coming from the file\n            const data = normalizeImport(fileContent, instructorSchema);\n            // Compute which instructors have been added/modified\n            const newDiff = diffImport.instructors(data, { instructors });\n            setDiffed(newDiff);\n        } catch (e) {\n            console.warn(e);\n            setProcessingError(e);\n        }\n    }, [fileContent, instructors, inProgress]);\n\n    async function onConfirm() {\n        const changedInstructors = getChanged(diffed);\n\n        await dispatch(upsertInstructors(changedInstructors));\n\n        setFileContent(null);\n    }\n\n    return (\n        <ImportActionButton\n            onConfirm={onConfirm}\n            onFileChange={setFileContent}\n            dialogContent={\n                <DialogContent\n                    diffed={diffed}\n                    processingError={processingError}\n                />\n            }\n            setInProgress={setInProgress}\n        />\n    );\n}\n\nconst DialogContent = React.memo(function DialogContent({\n    diffed,\n    processingError,\n}) {\n    let dialogContent = <p>No data loaded...</p>;\n    if (processingError) {\n        dialogContent = <Alert variant=\"danger\">{\"\" + processingError}</Alert>;\n    } else if (diffed) {\n        // Separate out the modified and new instructors\n        const newItems = diffed\n            .filter((item) => item.status === \"new\")\n            .map((item) => item.obj);\n        const modifiedDiffSpec = diffed.filter(\n            (item) => item.status === \"modified\"\n        );\n\n        if (newItems.length === 0 && modifiedDiffSpec.length === 0) {\n            dialogContent = (\n                <Alert variant=\"warning\">\n                    No difference between imported instructors and those already\n                    on the system.\n                </Alert>\n            );\n        } else {\n            dialogContent = (\n                <>\n                    {newItems.length > 0 && (\n                        <Alert variant=\"primary\">\n                            <span className=\"mb-1\">\n                                The following instructors will be{\" \"}\n                                <strong>added</strong>\n                            </span>\n                            <InstructorsList instructors={newItems} />\n                        </Alert>\n                    )}\n                    {modifiedDiffSpec.length > 0 && (\n                        <Alert variant=\"info\">\n                            <span className=\"mb-1\">\n                                The following instructors will be{\" \"}\n                                <strong>modified</strong>\n                            </span>\n                            <InstructorsDiffList\n                                modifiedInstructors={modifiedDiffSpec}\n                            />\n                        </Alert>\n                    )}\n                </>\n            );\n        }\n    }\n    return dialogContent;\n});\n","import React from \"react\";\nimport classNames from \"classnames\";\n\ninterface ContentAreaProps {\n    children: React.ReactNode;\n    className?: string;\n}\n\n/**\n * Wrap the content area of a page with the appropriate classes.\n *\n * @export\n * @param {ContentAreaProps} {\n *     children,\n *     className,\n *     ...rest\n * }\n * @returns\n */\nexport function ContentArea({\n    children,\n    className,\n    ...rest\n}: ContentAreaProps) {\n    return (\n        <div className={classNames(\"page-content\", className)} {...rest}>\n            {children}\n        </div>\n    );\n}\n","import React from \"react\";\nimport { ConnectedInstructorsList } from \"./editable-instructors-list\";\nimport { ConnectedAddInstructorDialog } from \"./add-instructor-dialog\";\nimport { FaTrash, FaPlus } from \"react-icons/fa\";\nimport {\n    ConnectedImportInstructorAction,\n    ConnectedExportInstructorsAction,\n} from \"./import-export\";\nimport {\n    ActionsList,\n    ActionButton,\n    ActionHeader,\n} from \"../../components/action-buttons\";\nimport { ContentArea } from \"../../components/layout\";\n\nexport function AdminInstructorsView() {\n    const [addDialogVisible, setAddDialogVisible] = React.useState(false);\n    const [inDeleteMode, setInDeleteMode] = React.useState(false);\n    // While data is being imported, updating the react table takes a long time,\n    // so we use this variable to hide the react table during import.\n    const [importInProgress, setImportInProgress] = React.useState(false);\n\n    return (\n        <div className=\"page-body\">\n            <ActionsList>\n                <ActionHeader>Available Actions</ActionHeader>\n                <ActionButton\n                    icon={<FaPlus />}\n                    onClick={() => {\n                        setAddDialogVisible(true);\n                    }}\n                >\n                    Add Instructor\n                </ActionButton>\n                <ActionButton\n                    icon={<FaTrash />}\n                    onClick={() => setInDeleteMode(!inDeleteMode)}\n                    active={inDeleteMode}\n                >\n                    Delete Instructor\n                </ActionButton>\n\n                <ActionHeader>Import/Export</ActionHeader>\n                <ConnectedImportInstructorAction\n                    setImportInProgress={setImportInProgress}\n                />\n                <ConnectedExportInstructorsAction />\n            </ActionsList>\n            <ContentArea>\n                <ConnectedAddInstructorDialog\n                    show={addDialogVisible}\n                    onHide={() => {\n                        setAddDialogVisible(false);\n                    }}\n                />\n                {!importInProgress && (\n                    <ConnectedInstructorsList inDeleteMode={inDeleteMode} />\n                )}\n            </ContentArea>\n        </div>\n    );\n}\n\nexport { ConnectedInstructorsList, ConnectedAddInstructorDialog };\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Form } from \"react-bootstrap\";\nimport { docApiPropTypes } from \"../../api/defs/doc-generation\";\nimport { fieldEditorFactory, DialogRow } from \"./common-controls\";\n/**\n * Edit a session\n *\n * @export\n * @param {{session: object, setSession: function}} props\n * @returns\n */\nexport function SessionEditor(props) {\n    const { session, setSession } = props;\n\n    const createFieldEditor = fieldEditorFactory(session, setSession);\n\n    return (\n        <Form>\n            <DialogRow>\n                {createFieldEditor(\"Session Name (e.g. 2019 Fall)\", \"name\")}\n            </DialogRow>\n            <DialogRow>\n                {createFieldEditor(\"Start Date\", \"start_date\", \"date\")}\n                {createFieldEditor(\"End Date\", \"end_date\", \"date\")}\n            </DialogRow>\n            <DialogRow>\n                {createFieldEditor(\n                    \"Rate 1 (pre-January rate)\",\n                    \"rate1\",\n                    \"number\",\n                    {\n                        step: \"0.01\",\n                        min: 0,\n                    }\n                )}\n                {createFieldEditor(\n                    \"Rate 2 (post-January rate)\",\n                    \"rate2\",\n                    \"number\",\n                    {\n                        step: \"0.01\",\n                        min: 0,\n                    }\n                )}\n            </DialogRow>\n        </Form>\n    );\n}\nSessionEditor.propTypes = {\n    session: docApiPropTypes.session.isRequired,\n    setSession: PropTypes.func.isRequired,\n};\n","import React from \"react\";\nimport { strip } from \"../../libs/utils\";\nimport { connect } from \"react-redux\";\nimport { SessionEditor } from \"../../components/forms/session-editor\";\nimport { upsertSession, sessionsSelector } from \"../../api/actions\";\nimport { Modal, Button, Alert } from \"react-bootstrap\";\n\nfunction getConflicts(session, sessions = []) {\n    const ret = { delayShow: \"\", immediateShow: \"\" };\n    if (\n        !strip(session.name) ||\n        !strip(session.start_date) ||\n        !strip(session.end_date)\n    ) {\n        ret.delayShow = \"A first name, start date, and end date is required\";\n    }\n    const matchingSession = sessions.find(\n        (x) => strip(x.name) === strip(session.name)\n    );\n    if (matchingSession) {\n        ret.immediateShow = (\n            <p>Another session exists with name={session.name}</p>\n        );\n    }\n    return ret;\n}\n\nconst BLANK_SESSION = {\n    name: \"\",\n    start_date: \"\",\n    end_date: \"\",\n    rate1: \"\",\n    rate2: \"\",\n};\n\nexport function AddSessionDialog(props) {\n    const { show, onHide = () => {}, sessions, upsertSession } = props;\n    const [newSession, setNewSession] = React.useState(BLANK_SESSION);\n\n    React.useEffect(() => {\n        if (!show) {\n            // If the dialog is hidden, reset the state\n            setNewSession(BLANK_SESSION);\n        }\n    }, [show]);\n\n    function createInstructor() {\n        upsertSession(newSession);\n        onHide();\n    }\n\n    const conflicts = getConflicts(newSession, sessions);\n\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Add Session</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <SessionEditor\n                    session={newSession}\n                    setSession={setNewSession}\n                />\n                {conflicts.immediateShow ? (\n                    <Alert variant=\"danger\">{conflicts.immediateShow}</Alert>\n                ) : null}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button\n                    onClick={createInstructor}\n                    title={conflicts.delayShow || \"Create Session\"}\n                    disabled={\n                        !!conflicts.delayShow || !!conflicts.immediateShow\n                    }\n                >\n                    Create Session\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\nexport const ConnectedAddSessionDialog = connect(\n    (state) => ({ sessions: sessionsSelector(state) }),\n    { upsertSession }\n)(AddSessionDialog);\n","import React from \"react\";\n\n/**\n * Wraps `name` in a div with a `title` attribute, so you can\n * see the full `name` on hover.\n *\n * @export\n * @param {string} name\n * @returns\n */\nexport function generateHeaderCell(name: string) {\n    function header() {\n        return (\n            <div title={name} className=\"table-header\">\n                {name}\n            </div>\n        );\n    }\n    header.toString = () => name;\n\n    return header as () => JSX.Element;\n}\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { sessionsSelector, upsertSession, deleteSession } from \"../api/actions\";\nimport { EditableField } from \"./edit-field-widgets\";\nimport { formatDate } from \"../libs/utils\";\nimport { Alert, Modal, Button } from \"react-bootstrap\";\nimport { FaTimes, FaTrash } from \"react-icons/fa\";\nimport { generateHeaderCell } from \"./table-utils\";\nimport { AdvancedFilterTable } from \"./advanced-filter-table\";\n\nfunction EditableCell(props) {\n    const title = `Edit ${\"\" + props.column.Header}`;\n    const { upsertSession, field, type, value } = props;\n    const isDate = type === \"date\";\n\n    function onChange(newVal) {\n        const sessionId = (props.row.original || props.row._original).id;\n        upsertSession({ id: sessionId, [field]: newVal });\n    }\n\n    return (\n        <EditableField\n            title={title}\n            value={type === \"date\" ? (value || \"\").slice(0, 10) : value || \"\"}\n            onChange={onChange}\n            type={type}\n        >\n            {isDate ? formatDate(value) : value}\n        </EditableField>\n    );\n}\n\nfunction ConfirmDeleteDialog(props) {\n    const { show, onHide, onDelete, session } = props;\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Delete Session</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                Are you sure you want to delete the session{\" \"}\n                {(session || {}).name}? This action cannot be undone.\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button onClick={onDelete} title=\"Delete Session\">\n                    Delete\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\n/**\n * List the sessions using a ReactTable. `columns` can be passed\n * in to customize columns/cell renderers.\n *\n * @export\n * @param {{columns?: object[], inDeleteMode?: Boolean}} props\n * @returns\n */\nexport function ConnectedSessionsList(props) {\n    const { inDeleteMode = false } = props;\n    const [sessionToDelete, setSessionToDelete] = React.useState(null);\n    const sessions = useSelector(sessionsSelector);\n    const dispatch = useDispatch();\n\n    function _upsertSession(session) {\n        return dispatch(upsertSession(session));\n    }\n\n    function generateCell(field, type) {\n        return (props) => (\n            <EditableCell\n                field={field}\n                upsertSession={_upsertSession}\n                type={type}\n                {...props}\n            />\n        );\n    }\n\n    // props.original contains the row data for this particular session\n    function CellDeleteButton({ row }) {\n        const session = row?.original || {};\n        return (\n            <div className=\"delete-button-container\">\n                <FaTimes\n                    className=\"delete-row-button\"\n                    title={`Delete ${session.name}`}\n                    onClick={() => {\n                        setSessionToDelete(session);\n                    }}\n                />\n            </div>\n        );\n    }\n\n    const DEFAULT_COLUMNS = [\n        {\n            Header: <FaTrash className=\"delete-row-column-header-icon\" />,\n            Cell: CellDeleteButton,\n            id: \"delete_col\",\n            className: \"delete-col\",\n            show: inDeleteMode,\n            maxWidth: 32,\n            resizable: false,\n        },\n        {\n            Header: generateHeaderCell(\"Name\"),\n            accessor: \"name\",\n            Cell: generateCell(\"name\"),\n        },\n        {\n            Header: generateHeaderCell(\"Start Date\"),\n            accessor: \"start_date\",\n            Cell: generateCell(\"start_date\", \"date\"),\n        },\n        {\n            Header: generateHeaderCell(\"End Date\"),\n            accessor: \"end_date\",\n            Cell: generateCell(\"end_date\", \"date\"),\n        },\n        {\n            Header: generateHeaderCell(\"Rate (Pre-January)\"),\n            accessor: \"rate1\",\n            className: \"number-cell\",\n            Cell: generateCell(\"rate1\"),\n        },\n        {\n            Header: generateHeaderCell(\"Rate (Post-January)\"),\n            accessor: \"rate2\",\n            className: \"number-cell\",\n            Cell: generateCell(\"rate2\"),\n        },\n    ];\n\n    const { columns = DEFAULT_COLUMNS } = props;\n    return (\n        <React.Fragment>\n            <AdvancedFilterTable\n                columns={columns}\n                filterable={true}\n                data={sessions}\n            />\n            <ConfirmDeleteDialog\n                session={sessionToDelete}\n                show={!!sessionToDelete}\n                onHide={() => setSessionToDelete(null)}\n                onDelete={async () => {\n                    await dispatch(deleteSession(sessionToDelete));\n                    setSessionToDelete(null);\n                }}\n            />\n        </React.Fragment>\n    );\n}\n\nexport function MissingActiveSessionWarning({ extraText = \"\" }) {\n    return (\n        <Alert variant=\"info\">\n            There is no active session selected. {extraText}\n        </Alert>\n    );\n}\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { ConnectedAddSessionDialog } from \"./add-session-dialog\";\nimport { activeSessionSelector } from \"../../api/actions\";\nimport { ConnectedSessionsList } from \"../../components/sessions\";\nimport {\n    ActionsList,\n    ActionButton,\n    ActionHeader,\n} from \"../../components/action-buttons\";\nimport { ContentArea } from \"../../components/layout\";\nimport { FaPlus, FaTrash } from \"react-icons/fa\";\nimport { Session } from \"../../api/defs/types\";\n\nexport function AdminSessionsView() {\n    const [addDialogVisible, setAddDialogVisible] = React.useState(false);\n    const [inDeleteMode, setInDeleteMode] = React.useState(false);\n\n    const activeSession = useSelector(activeSessionSelector) as Session | null;\n\n    let activeSessionInfo = (\n        <>\n            There is currently <b className=\"text-primary\">no active session</b>{\" \"}\n            selected. In order to setup contract templates or create positions\n            and offers, you must select an active session.\n        </>\n    );\n    if (activeSession) {\n        activeSessionInfo = (\n            <>\n                The current active session is{\" \"}\n                <b className=\"text-primary\">{activeSession.name}</b>. When\n                setting up contract templates or creating positions and offers,\n                they will be attached to the <i>{activeSession.name}</i>{\" \"}\n                session.\n            </>\n        );\n    }\n\n    return (\n        <div className=\"page-body\">\n            <ActionsList>\n                <ActionHeader>Available Actions</ActionHeader>\n                <ActionButton\n                    icon={<FaPlus />}\n                    onClick={() => {\n                        setAddDialogVisible(true);\n                    }}\n                >\n                    Add Session\n                </ActionButton>\n                <ActionButton\n                    icon={<FaTrash />}\n                    onClick={() => setInDeleteMode(!inDeleteMode)}\n                    active={inDeleteMode}\n                >\n                    Delete Session\n                </ActionButton>\n            </ActionsList>\n            <ContentArea>\n                {/*<TestTable columns={COLUMNS} data={DATA} />*/}\n                <h3>Session Management and Creation</h3>\n                <p>\n                    From this page, you can manage an existing session or create\n                    a new session.\n                </p>\n                <p>{activeSessionInfo}</p>\n\n                <h5>Existing Sessions</h5>\n                <ConnectedAddSessionDialog\n                    show={addDialogVisible}\n                    onHide={() => {\n                        setAddDialogVisible(false);\n                    }}\n                />\n                <ConnectedSessionsList inDeleteMode={inDeleteMode} />\n            </ContentArea>\n        </div>\n    );\n}\n\nexport { ConnectedAddSessionDialog };\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Form } from \"react-bootstrap\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\n\nimport \"react-bootstrap-typeahead/css/Typeahead.css\";\nimport { docApiPropTypes } from \"../../api/defs/doc-generation\";\nimport { fieldEditorFactory, DialogRow } from \"./common-controls\";\n\nconst DEFAULT_POSITION = {\n    position_code: \"\",\n    position_title: \"\",\n    hours_per_assignment: 0,\n    contract_template: {},\n    duties:\n        \"Some combination of marking, invigilating, tutorials, office hours, and the help centre.\",\n    instructors: [],\n};\n\n/**\n * Edit information about a position\n *\n * @export\n * @param {{position: object, instructors: object[]}} props\n * @returns\n */\nexport function PositionEditor(props) {\n    const {\n        position: positionProp,\n        setPosition,\n        instructors = [],\n        contractTemplates = [],\n        defaultContractTemplate = {},\n    } = props;\n    const position = { ...DEFAULT_POSITION, ...positionProp };\n\n    /**\n     * Set `position.instructors` to the specified list.\n     *\n     * @param {*} instructors\n     */\n    function setInstructors(instructors) {\n        setPosition({ ...position, instructors });\n    }\n\n    /**\n     * Set `position.contract_template` to the most recently selected item\n     *\n     * @param {*} selectedContractTypes\n     */\n    function setContractType(selectedContractTypes) {\n        const contract_template =\n            selectedContractTypes[selectedContractTypes.length - 1] ||\n            defaultContractTemplate;\n        setPosition({ ...position, contract_template });\n    }\n\n    const createFieldEditor = fieldEditorFactory(position, setPosition);\n\n    return (\n        <Form>\n            <DialogRow>\n                {createFieldEditor(\n                    \"Position Code (e.g. MAT135H1F)\",\n                    \"position_code\"\n                )}\n                {createFieldEditor(\"Course Title\", \"position_title\")}\n            </DialogRow>\n            <DialogRow>\n                {createFieldEditor(\"Start Date*\", \"start_date\", \"date\")}\n                {createFieldEditor(\"End Date*\", \"end_date\", \"date\")}\n                <p>\n                    If blank, the session start date and end date will be used.\n                </p>\n            </DialogRow>\n            <DialogRow>\n                {createFieldEditor(\n                    \"Hours per Assignment\",\n                    \"hours_per_assignment\",\n                    \"number\"\n                )}\n            </DialogRow>\n            <Form.Group>\n                <Form.Label>Instructors</Form.Label>\n                <Typeahead\n                    id=\"instructors-input\"\n                    ignoreDiacritics={true}\n                    multiple\n                    placeholder=\"Instructors...\"\n                    labelKey={(option) =>\n                        `${option.first_name} ${option.last_name}`\n                    }\n                    selected={position.instructors}\n                    options={instructors}\n                    onChange={setInstructors}\n                />\n            </Form.Group>\n            <Form.Group>\n                <Form.Label>\n                    Contract Template (which offer template will be used)\n                </Form.Label>\n                <Typeahead\n                    id=\"instructors-input\"\n                    ignoreDiacritics={true}\n                    multiple\n                    placeholder=\"Contract template...\"\n                    labelKey={(option) => `${option.template_name}`}\n                    selected={[position.contract_template]}\n                    options={contractTemplates}\n                    onChange={setContractType}\n                />\n            </Form.Group>\n            <h3>Ad-related Info</h3>\n            <DialogRow>{createFieldEditor(\"Duties\", \"duties\")}</DialogRow>\n            <DialogRow>\n                {createFieldEditor(\"Qualifications\", \"qualifications\")}\n            </DialogRow>\n            <h3>Admin Info</h3>\n            <DialogRow>\n                {createFieldEditor(\n                    \"Current Enrollment\",\n                    \"current_enrollment\",\n                    \"number\"\n                )}\n                {createFieldEditor(\"Waitlist\", \"current_waitlisted\", \"number\")}\n                {createFieldEditor(\n                    \"Desired Number of Assignments\",\n                    \"desired_num_assignments\",\n                    \"number\"\n                )}\n            </DialogRow>\n        </Form>\n    );\n}\nPositionEditor.propTypes = {\n    position: docApiPropTypes.position.isRequired,\n    setPosition: PropTypes.func.isRequired,\n    instructors: PropTypes.arrayOf(docApiPropTypes.instructor),\n    defaultContractTemplate: docApiPropTypes.contractTemplate,\n    contractTemplates: PropTypes.arrayOf(docApiPropTypes.contractTemplate),\n};\n","import React from \"react\";\nimport { strip } from \"../../libs/utils\";\nimport { connect } from \"react-redux\";\nimport {\n    upsertPosition,\n    positionsSelector,\n    instructorsSelector,\n    contractTemplatesSelector,\n} from \"../../api/actions\";\nimport { Modal, Button, Alert } from \"react-bootstrap\";\nimport { PositionEditor } from \"../../components/forms/position-editor\";\n\nfunction getConflicts(position, positions = []) {\n    const ret = { delayShow: \"\", immediateShow: \"\" };\n    if (!strip(position.position_code)) {\n        ret.delayShow = \"A position code is required\";\n    }\n    const matchingSession = positions.find(\n        (x) => strip(x.position_code) === strip(position.position_code)\n    );\n    if (matchingSession) {\n        ret.immediateShow = (\n            <p>Another position exists with name={position.position_code}</p>\n        );\n    }\n    return ret;\n}\n\nconst BLANK_POSITION = {\n    position_code: \"\",\n    position_title: \"\",\n    hours_per_assignment: 0,\n    contract_template_id: null,\n    duties:\n        \"Some combination of marking, invigilating, tutorials, office hours, and the help centre.\",\n    instructors: [],\n};\n\nexport function AddPositionDialog(props) {\n    const {\n        show,\n        onHide = () => {},\n        positions,\n        upsertPosition,\n        instructors,\n        contractTemplates,\n    } = props;\n    const [newPosition, setNewPosition] = React.useState(BLANK_POSITION);\n\n    React.useEffect(() => {\n        if (!show) {\n            // If the dialog is hidden, reset the state\n            setNewPosition(BLANK_POSITION);\n        }\n    }, [show]);\n\n    // select a suitable default for the contract template\n    React.useEffect(() => {\n        // Look for a contract template whose name is \"standard\" or \"default\";\n        // If that fails, find one whose name contains \"standard\" or \"default\";\n        // If all else fails, pick the first template in the list\n        const defaultTemplate =\n            contractTemplates.find(\n                (x) => x.template_name.toLowerCase() === \"standard\"\n            ) ||\n            contractTemplates.find(\n                (x) => x.template_name.toLowerCase() === \"default\"\n            ) ||\n            contractTemplates.find((x) =>\n                x.template_name.toLowerCase().includes(\"standard\")\n            ) ||\n            contractTemplates.find((x) =>\n                x.template_name.toLowerCase().includes(\"default\")\n            ) ||\n            contractTemplates[0];\n        if (defaultTemplate) {\n            BLANK_POSITION.contract_template = defaultTemplate;\n            BLANK_POSITION.contract_template_id = defaultTemplate.id;\n        }\n    }, [contractTemplates]);\n\n    function createPosition() {\n        upsertPosition(newPosition);\n        onHide();\n    }\n\n    const conflicts = getConflicts(newPosition, positions);\n\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Add Position</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <PositionEditor\n                    position={newPosition}\n                    setPosition={setNewPosition}\n                    instructors={instructors}\n                    contractTemplates={contractTemplates}\n                    defaultContractTemplate={BLANK_POSITION.contract_template}\n                />\n                {conflicts.immediateShow ? (\n                    <Alert variant=\"danger\">{conflicts.immediateShow}</Alert>\n                ) : null}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button\n                    onClick={createPosition}\n                    title={conflicts.delayShow || \"Create Position\"}\n                    disabled={\n                        !!conflicts.delayShow || !!conflicts.immediateShow\n                    }\n                >\n                    Create Position\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\nexport const ConnectedAddPositionDialog = connect(\n    (state) => ({\n        positions: positionsSelector(state),\n        instructors: instructorsSelector(state),\n        contractTemplates: contractTemplatesSelector(state),\n    }),\n    { upsertPosition }\n)(AddPositionDialog);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Badge } from \"react-bootstrap\";\nimport { formatDate } from \"../libs/utils\";\nimport { createDiffColumnsFromColumns } from \"./diff-table\";\nimport { generateHeaderCell } from \"./table-utils\";\nimport { AdvancedFilterTable } from \"./advanced-filter-table\";\n\nconst DEFAULT_COLUMNS = [\n    { Header: generateHeaderCell(\"Position Code\"), accessor: \"position_code\" },\n    {\n        Header: generateHeaderCell(\"Position Title\"),\n        accessor: \"position_title\",\n    },\n    {\n        Header: generateHeaderCell(\"Hours\"),\n        accessor: \"hours_per_assignment\",\n        maxWidth: 64,\n        className: \"number-cell\",\n    },\n    {\n        Header: generateHeaderCell(\"Start\"),\n        accessor: \"start_date\",\n        Cell: (row) => formatDate(row.value),\n    },\n    {\n        Header: generateHeaderCell(\"End\"),\n        accessor: \"end_date\",\n        Cell: (row) => formatDate(row.value),\n    },\n    {\n        Header: generateHeaderCell(\"Instructors\"),\n        accessor: \"instructors\",\n        Cell: (props) => (\n            <React.Fragment>\n                {props.value.map((instructor = {}) => {\n                    const name = `${instructor.first_name} ${instructor.last_name}`;\n                    return (\n                        <Badge variant=\"secondary\" className=\"mr-1\" key={name}>\n                            {name}\n                        </Badge>\n                    );\n                })}\n            </React.Fragment>\n        ),\n    },\n    {\n        Header: generateHeaderCell(\"Enrolled\"),\n        accessor: \"current_enrollment\",\n        maxWidth: 80,\n    },\n    {\n        Header: generateHeaderCell(\"Waitlist\"),\n        accessor: \"current_waitlisted\",\n        maxWidth: 90,\n    },\n\n    {\n        Header: generateHeaderCell(\"Contract Template\"),\n        accessor: \"contract_template.template_name\",\n    },\n];\n\n/**\n * Display a DiffSpec array of positions and highlight the changes.\n *\n * @export\n * @param {*} { modifiedInstructors }\n * @returns\n */\nexport function PositionsDiffList({ modifiedPositions }) {\n    return (\n        <PositionsList\n            positions={modifiedPositions}\n            columns={createDiffColumnsFromColumns(DEFAULT_COLUMNS)}\n        />\n    );\n}\n\n/**\n * List the instructors using a ReactTable. `columns` can be passed\n * in to customize columns/cell renderers.\n *\n * @export\n * @param {{instructors: object[], columns: object[]}} props\n * @returns\n */\nexport function PositionsList(props) {\n    const { positions, columns = DEFAULT_COLUMNS } = props;\n    return (\n        <AdvancedFilterTable\n            columns={columns}\n            data={positions}\n            filterable={true}\n        />\n    );\n}\nPositionsList.propTypes = {\n    positions: PropTypes.array.isRequired,\n    columns: PropTypes.arrayOf(\n        PropTypes.shape({ Header: PropTypes.any.isRequired })\n    ),\n};\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n    positionsSelector,\n    deletePosition,\n    assignmentsSelector,\n    upsertPosition,\n    instructorsSelector,\n} from \"../../api/actions\";\nimport { PositionsList } from \"../../components/positions-list\";\nimport { formatDate } from \"../../libs/utils\";\nimport { FaTimes, FaLock, FaTrash } from \"react-icons/fa\";\nimport { Badge, Modal, Button, Spinner } from \"react-bootstrap\";\nimport {\n    EditableField,\n    EditFieldIcon,\n} from \"../../components/edit-field-widgets\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport { generateHeaderCell } from \"../../components/table-utils\";\n\n/**\n * Turn a list of instructor objects into a hash string for comparison as to whether\n * an instructor list has changed.\n *\n * @param {*} instructors\n * @returns\n */\nfunction hashInstructorList(instructors) {\n    return instructors\n        .map((i) => `${i.last_name}, ${i.first_name}`)\n        .sort()\n        .join(\";\");\n}\n\n/**\n * A dialog allowing one to edit instructors. `onChange` is called\n * when \"save\" is clicked while editing this value.\n *\n * @param {*} props\n * @returns\n */\nfunction EditInstructorsDialog({ position, show, onHide, onChange }) {\n    const value = position.instructors;\n    const allInstructors = useSelector(instructorsSelector);\n    const [fieldVal, setFieldVal] = React.useState(value);\n    const [inProgress, setInProgress] = React.useState(false);\n\n    function cancelClick() {\n        setFieldVal(value);\n        onHide();\n    }\n\n    function saveClick() {\n        async function doSave() {\n            if (hashInstructorList(fieldVal) !== hashInstructorList(value)) {\n                setInProgress(true);\n                // Only call `onChange` if the value has changed\n                await onChange(fieldVal, value);\n            }\n        }\n        doSave().finally(() => {\n            //onHide();\n            setInProgress(false);\n        });\n    }\n    // When a confirm operation is in progress, a spinner is displayed; otherwise\n    // it's hidden\n    const spinner = inProgress ? (\n        <Spinner animation=\"border\" size=\"sm\" className=\"mr-1\" />\n    ) : null;\n\n    const changeIndicator =\n        // eslint-disable-next-line\n        hashInstructorList(fieldVal) == hashInstructorList(value) ? null : (\n            <span>\n                Change from{\" \"}\n                <span className=\"field-dialog-formatted-name\">\n                    {value\n                        .map(\n                            (instructor) =>\n                                `${instructor.first_name} ${instructor.last_name}`\n                        )\n                        .join(\", \")}\n                </span>{\" \"}\n                to{\" \"}\n                <span className=\"field-dialog-formatted-name\">\n                    {fieldVal\n                        .map(\n                            (instructor) =>\n                                `${instructor.first_name} ${instructor.last_name}`\n                        )\n                        .join(\", \")}\n                </span>\n            </span>\n        );\n\n    return (\n        <Modal show={show} onHide={cancelClick}>\n            <Modal.Header closeButton>\n                <Modal.Title>\n                    Edit Instructors for {position.position_code}\n                </Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <Typeahead\n                    id=\"instructors-input\"\n                    ignoreDiacritics={true}\n                    multiple\n                    placeholder=\"Instructors...\"\n                    labelKey={(option) =>\n                        `${option.first_name} ${option.last_name}`\n                    }\n                    selected={fieldVal}\n                    options={allInstructors}\n                    onChange={setFieldVal}\n                />{\" \"}\n                {changeIndicator}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={cancelClick} variant=\"outline-secondary\">\n                    Cancel\n                </Button>\n                <Button onClick={saveClick}>{spinner}Save</Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\nfunction EditableCell(props) {\n    const title = `Edit ${props.column.Header}`;\n    const { upsertPosition, field, type, value } = props;\n    const isDate = type === \"date\";\n\n    function onChange(newVal) {\n        const positionId = (props.row.original || props.row._original).id;\n        upsertPosition({ id: positionId, [field]: newVal });\n    }\n\n    return (\n        <EditableField\n            title={title}\n            value={type === \"date\" ? (value || \"\").slice(0, 10) : value || \"\"}\n            onChange={onChange}\n            type={type}\n        >\n            {isDate ? formatDate(value) : value}\n        </EditableField>\n    );\n}\n\nfunction EditInstructorsCell({ row }) {\n    // row._original is from ReactTable v6; We can get rid of it when we drop the dependency\n    const position = row.original || row._original;\n    const [dialogShow, setDialogShow] = React.useState(false);\n    const dispatch = useDispatch();\n\n    return (\n        <div className=\"show-on-hover-wrapper\">\n            {position.instructors.map((instructor = {}) => {\n                const name = `${instructor.first_name} ${instructor.last_name}`;\n                return (\n                    <Badge variant=\"secondary\" className=\"mr-1\" key={name}>\n                        {name}\n                    </Badge>\n                );\n            })}\n            <EditFieldIcon\n                title=\"Edit the instructors for this position\"\n                hidden={false}\n                onClick={() => setDialogShow(true)}\n            />\n            <EditInstructorsDialog\n                position={position}\n                show={dialogShow}\n                onHide={() => setDialogShow(false)}\n                onChange={async (newInstructors) => {\n                    await dispatch(\n                        upsertPosition({\n                            id: position.id,\n                            instructors: newInstructors,\n                        })\n                    );\n                    setDialogShow(false);\n                }}\n            />\n        </div>\n    );\n}\n\nfunction ConfirmDeleteDialog(props) {\n    const { show, onHide, onDelete, position } = props;\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Delete Session</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                Are you sure you want to delete the position{\" \"}\n                {position ? position.position_code : null}? This action cannot\n                be undone.\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button onClick={onDelete} title=\"Delete Position\">\n                    Delete\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\nexport function ConnectedPositionsList({ inDeleteMode = false }) {\n    const positions = useSelector(positionsSelector);\n    const assignments = useSelector(assignmentsSelector);\n    const [positionToDelete, setPositionToDelete] = React.useState(null);\n    const dispatch = useDispatch();\n\n    function _upsertPosition(position) {\n        return dispatch(upsertPosition(position));\n    }\n\n    const numAssignmentsByPositionCode = assignments.reduce(\n        (acc, assignment) => {\n            const position_code = assignment.position.position_code;\n            acc[position_code] = acc[position_code] || 0;\n            acc[position_code] += 1;\n            return acc;\n        },\n        {}\n    );\n\n    // props.original contains the row data for this particular instructor\n    function CellDeleteButton({ row }) {\n        const position = row.original || row._original;\n        // If there are any assignments for this position, we should be disabled\n        const disabled = numAssignmentsByPositionCode[position.position_code];\n        if (disabled) {\n            return (\n                <div className=\"delete-button-container\">\n                    <FaLock\n                        className=\"delete-row-button disabled\"\n                        title=\"This position has an associated assignment and so cannot be deleted.\"\n                    />\n                </div>\n            );\n        }\n        return (\n            <div className=\"delete-button-container\">\n                <FaTimes\n                    className=\"delete-row-button\"\n                    title={`Delete ${position.last_name}, ${position.first_name}`}\n                    onClick={() => {\n                        setPositionToDelete(position);\n                    }}\n                />\n            </div>\n        );\n    }\n\n    function generateCell(field, type) {\n        return (props) => (\n            <EditableCell\n                field={field}\n                upsertPosition={_upsertPosition}\n                type={type}\n                {...props}\n            />\n        );\n    }\n\n    const DEFAULT_COLUMNS = [\n        {\n            Header: <FaTrash className=\"delete-row-column-header-icon\" />,\n            Cell: CellDeleteButton,\n            id: \"delete_col\",\n            className: \"delete-col\",\n            show: inDeleteMode,\n            maxWidth: 32,\n            resizable: false,\n        },\n        {\n            Header: generateHeaderCell(\"Position Code\"),\n            accessor: \"position_code\",\n            Cell: generateCell(\"position_code\"),\n        },\n        {\n            Header: generateHeaderCell(\"Position Title\"),\n            accessor: \"position_title\",\n            Cell: generateCell(\"position_title\"),\n        },\n        {\n            Header: generateHeaderCell(\"Start\"),\n            accessor: \"start_date\",\n            Cell: generateCell(\"start_date\", \"date\"),\n        },\n        {\n            Header: generateHeaderCell(\"End\"),\n            accessor: \"end_date\",\n            Cell: generateCell(\"end_date\", \"date\"),\n        },\n        {\n            Header: generateHeaderCell(\"Instructor(s)\"),\n            id: \"instructors\",\n            accessor: (row) => hashInstructorList(row.instructors),\n            Cell: EditInstructorsCell,\n        },\n        {\n            Header: generateHeaderCell(\"Hours/Assignment\"),\n            accessor: \"hours_per_assignment\",\n            maxWidth: 64,\n            className: \"number-cell\",\n            Cell: generateCell(\"hours_per_assignment\"),\n        },\n        {\n            Header: generateHeaderCell(\"Enrolled\"),\n            accessor: \"current_enrollment\",\n            className: \"number-cell\",\n            maxWidth: 80,\n            Cell: generateCell(\"current_enrollment\"),\n        },\n        {\n            Header: generateHeaderCell(\"Waitlist\"),\n            accessor: \"current_waitlisted\",\n            className: \"number-cell\",\n            maxWidth: 50,\n            Cell: generateCell(\"current_waitlisted\", \"number\"),\n        },\n        {\n            Header: generateHeaderCell(\"Desired Num Assignments\"),\n            accessor: \"desired_num_assignments\",\n            className: \"number-cell\",\n            maxWidth: 50,\n            Cell: generateCell(\"desired_num_assignments\"),\n        },\n        {\n            Header: generateHeaderCell(\"Current Num Assignments\"),\n            id: \"current_num_assignments\",\n            className: \"number-cell\",\n            accessor: (position) =>\n                numAssignmentsByPositionCode[position.position_code] || \"\",\n            maxWidth: 50,\n        },\n        {\n            Header: generateHeaderCell(\"Contract Template\"),\n            accessor: \"contract_template.template_name\",\n        },\n    ];\n\n    return (\n        <React.Fragment>\n            <PositionsList positions={positions} columns={DEFAULT_COLUMNS} />\n            <ConfirmDeleteDialog\n                position={positionToDelete}\n                show={!!positionToDelete}\n                onHide={() => setPositionToDelete(null)}\n                onDelete={async () => {\n                    await dispatch(deletePosition(positionToDelete));\n                    setPositionToDelete(null);\n                }}\n            />\n        </React.Fragment>\n    );\n}\n","import React from \"react\";\nimport FileSaver from \"file-saver\";\nimport {\n    instructorsSelector,\n    positionsSelector,\n    exportPositions,\n    contractTemplatesSelector,\n    upsertPositions,\n} from \"../../api/actions\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ExportActionButton } from \"../../components/export-button\";\nimport { ImportActionButton } from \"../../components/import-button\";\nimport { Alert } from \"react-bootstrap\";\nimport { normalizeImport, dataToFile } from \"../../libs/importExportUtils\";\nimport {\n    PositionsList,\n    PositionsDiffList,\n} from \"../../components/positions-list\";\nimport { prepareMinimal } from \"../../libs/exportUtils\";\nimport { diffImport, getChanged } from \"../../libs/diffUtils\";\n\n/**\n * Allows for the download of a file blob containing the exported instructors.\n * Instructors are synchronized from the server before being downloaded.\n *\n * @export\n * @returns\n */\nexport function ConnectedExportPositionsAction({ disabled }) {\n    const dispatch = useDispatch();\n    const [exportType, setExportType] = React.useState(null);\n\n    React.useEffect(() => {\n        if (!exportType) {\n            return;\n        }\n\n        async function doExport() {\n            // Having an export type of `null` means we're ready to export again,\n            // We set the export type to null at the start so in case an error occurs,\n            // we can still try again. This *will not* affect the current value of `exportType`\n            setExportType(null);\n\n            // Make a function that converts a list of instructors into a `File` object.\n            function prepareData(positions, dataFormat) {\n                return dataToFile(\n                    {\n                        toSpreadsheet: () =>\n                            [\n                                [\n                                    \"Position Code\",\n                                    \"Position Title\",\n                                    \"Start Date\",\n                                    \"End Date\",\n                                    \"Hours Per Assignment\",\n                                    \"Number of Assignments\",\n                                    \"Contract Template\",\n                                    \"Instructors\",\n                                    \"Duties\",\n                                    \"Qualifications\",\n                                    \"Current Enrollment\",\n                                    \"Current Waitlist\",\n                                ],\n                            ].concat(\n                                positions.map((position) => [\n                                    position.position_code,\n                                    position.position_title,\n                                    position.start_date &&\n                                        new Date(position.start_date)\n                                            .toJSON()\n                                            .slice(0, 10),\n                                    position.end_date &&\n                                        new Date(position.end_date)\n                                            .toJSON()\n                                            .slice(0, 10),\n                                    position.hours_per_assignment,\n                                    position.desired_num_assignments,\n                                    position.contract_template.template_name,\n                                    position.instructors\n                                        .map(\n                                            (instructor) =>\n                                                `${instructor.last_name}, ${instructor.first_name}`\n                                        )\n                                        .join(\"; \"),\n                                    position.duties || \"\",\n                                    position.qualifications || \"\",\n                                    position.current_enrollment,\n                                    position.current_waitlisted,\n                                ])\n                            ),\n                        toJson: () => ({\n                            positions: positions.map((position) =>\n                                prepareMinimal.position(position)\n                            ),\n                        }),\n                    },\n                    dataFormat,\n                    \"positions\"\n                );\n            }\n\n            const file = await dispatch(\n                exportPositions(prepareData, exportType)\n            );\n\n            FileSaver.saveAs(file);\n        }\n        doExport().catch(console.error);\n    }, [exportType, dispatch]);\n\n    function onClick(option) {\n        setExportType(option);\n    }\n\n    return <ExportActionButton onClick={onClick} disabled={disabled} />;\n}\n\nconst positionSchema = {\n    keys: [\n        \"position_code\",\n        \"position_title\",\n        \"start_date\",\n        \"end_date\",\n        \"hours_per_assignment\",\n        \"desired_num_assignments\",\n        \"contract_template\",\n        \"instructors\",\n        \"duties\",\n        \"qualifications\",\n        \"current_enrollment\",\n        \"current_waitlisted\",\n        \"ad_open_date\",\n        \"ad_close_date\",\n        \"ad_hours_per_assignment\",\n        \"ad_num_assignments\",\n    ],\n    keyMap: {\n        \"Position Code\": \"position_code\",\n        \"Course Code\": \"position_code\",\n        \"Course Name\": \"position_code\",\n        \"Position Title\": \"position_title\",\n        \"Start Date\": \"start_date\",\n        Start: \"start_date\",\n        \"End Date\": \"end_date\",\n        End: \"end_date\",\n        \"Hours Per Assignment\": \"hours_per_assignment\",\n        \"Number of Assignments\": \"desired_num_assignments\",\n        \"Contract Template\": \"contract_template\",\n        \"Current Enrollment\": \"current_enrollment\",\n        \"Current Waitlist\": \"current_waitlisted\",\n    },\n    dateColumns: [\"start_date\", \"end_date\"],\n    requiredKeys: [\"position_code\", \"contract_template\"],\n    primaryKey: \"position_code\",\n    baseName: \"positions\",\n};\n\nexport function ConnectedImportPositionsAction({\n    disabled,\n    setImportInProgress = null,\n}) {\n    const dispatch = useDispatch();\n    const positions = useSelector(positionsSelector);\n    const instructors = useSelector(instructorsSelector);\n    const contractTemplates = useSelector(contractTemplatesSelector);\n    const [fileContent, setFileContent] = React.useState(null);\n    const [diffed, setDiffed] = React.useState(null);\n    const [processingError, setProcessingError] = React.useState(null);\n    const [inProgress, _setInProgress] = React.useState(false);\n\n    function setInProgress(state) {\n        _setInProgress(state);\n        if (typeof setImportInProgress === \"function\") {\n            setImportInProgress(state);\n        }\n    }\n\n    // Make sure we aren't showing any diff if there's no file loaded.\n    React.useEffect(() => {\n        if (!fileContent) {\n            if (diffed) {\n                setDiffed(null);\n            }\n        }\n    }, [diffed, setDiffed, fileContent]);\n\n    // Recompute the diff every time the file changes\n    React.useEffect(() => {\n        // If we have no file or we are currently in the middle of processing another file,\n        // do nothing.\n        if (!fileContent || inProgress) {\n            return;\n        }\n        try {\n            setProcessingError(null);\n\n            // normalize the data coming from the file\n            let data = normalizeImport(fileContent, positionSchema);\n            // `normalizeImport` only normalizes the column names and dates. We need to make sure the\n            // instructors are correct as well.\n            for (const item of data) {\n                item.instructors = diffImport\n                    .instructorsListFromField(item.instructors || [], {\n                        instructors,\n                    })\n                    .map((x) => x.utorid);\n            }\n\n            // Compute which positions have been added/modified\n            const newDiff = diffImport.positions(data, {\n                positions,\n                instructors,\n                contractTemplates,\n            });\n\n            setDiffed(newDiff);\n        } catch (e) {\n            console.warn(e);\n            setProcessingError(e);\n        }\n    }, [fileContent, positions, contractTemplates, instructors, inProgress]);\n\n    async function onConfirm() {\n        const changedPositions = getChanged(diffed);\n        await dispatch(upsertPositions(changedPositions));\n        setFileContent(null);\n    }\n\n    return (\n        <ImportActionButton\n            onConfirm={onConfirm}\n            onFileChange={setFileContent}\n            dialogContent={\n                <DialogContent\n                    diffed={diffed}\n                    processingError={processingError}\n                />\n            }\n            setInProgress={setInProgress}\n            disabled={disabled}\n        />\n    );\n}\n\nconst DialogContent = React.memo(function DialogContent({\n    diffed,\n    processingError,\n}) {\n    let dialogContent = <p>No data loaded...</p>;\n    if (processingError) {\n        dialogContent = <Alert variant=\"danger\">{\"\" + processingError}</Alert>;\n    } else if (diffed) {\n        const newItems = diffed\n            .filter((item) => item.status === \"new\")\n            .map((item) => item.obj);\n        const modifiedDiffSpec = diffed.filter(\n            (item) => item.status === \"modified\"\n        );\n\n        if (newItems.length === 0 && modifiedDiffSpec.length === 0) {\n            dialogContent = (\n                <Alert variant=\"warning\">\n                    No difference between imported positions and those already\n                    on the system.\n                </Alert>\n            );\n        } else {\n            dialogContent = (\n                <>\n                    {newItems.length > 0 && (\n                        <Alert variant=\"primary\">\n                            <span className=\"mb-1\">\n                                The following positions will be{\" \"}\n                                <strong>added</strong>\n                            </span>\n                            <PositionsList positions={newItems} />\n                        </Alert>\n                    )}\n                    {modifiedDiffSpec.length > 0 && (\n                        <Alert variant=\"info\">\n                            <span className=\"mb-1\">\n                                The following positions will be{\" \"}\n                                <strong>modified</strong>\n                            </span>\n                            <PositionsDiffList\n                                modifiedPositions={modifiedDiffSpec}\n                            />\n                        </Alert>\n                    )}\n                </>\n            );\n        }\n    }\n\n    return dialogContent;\n});\n","import React from \"react\";\nimport { ConnectedAddPositionDialog } from \"./add-position-dialog\";\nimport { ConnectedPositionsList } from \"./position-list\";\nimport {\n    ConnectedExportPositionsAction,\n    ConnectedImportPositionsAction,\n} from \"./import-export\";\nimport {\n    ActionsList,\n    ActionButton,\n    ActionHeader,\n} from \"../../components/action-buttons\";\nimport { ContentArea } from \"../../components/layout\";\nimport { FaPlus, FaTrash } from \"react-icons/fa\";\nimport { formatDate } from \"../../libs/utils\";\nimport { Badge } from \"react-bootstrap\";\nimport { activeSessionSelector } from \"../../api/actions\";\nimport { useSelector } from \"react-redux\";\nimport { MissingActiveSessionWarning } from \"../../components/sessions\";\n\nexport function AdminPositionsView() {\n    const [addDialogVisible, setAddDialogVisible] = React.useState(false);\n    const [inDeleteMode, setInDeleteMode] = React.useState(false);\n    const activeSession = useSelector(activeSessionSelector);\n    // While data is being imported, updating the react table takes a long time,\n    // so we use this variable to hide the react table during import.\n    const [importInProgress, setImportInProgress] = React.useState(false);\n\n    return (\n        <div className=\"page-body\">\n            <ActionsList>\n                <ActionHeader>Available Actions</ActionHeader>\n                <ActionButton\n                    icon={<FaPlus />}\n                    onClick={() => {\n                        setAddDialogVisible(true);\n                    }}\n                    disabled={!activeSession}\n                >\n                    Add Position\n                </ActionButton>\n                <ActionButton\n                    icon={<FaTrash />}\n                    onClick={() => setInDeleteMode(!inDeleteMode)}\n                    active={inDeleteMode}\n                    disabled={!activeSession}\n                >\n                    Delete Position\n                </ActionButton>\n                <ActionHeader>Import/Export</ActionHeader>\n                <ConnectedImportPositionsAction\n                    disabled={!activeSession}\n                    setImportInProgress={setImportInProgress}\n                />\n                <ConnectedExportPositionsAction disabled={!activeSession} />\n            </ActionsList>\n            <ContentArea>\n                {activeSession ? null : (\n                    <MissingActiveSessionWarning extraText=\"To view or modify positions, you must select a session.\" />\n                )}\n                <ConnectedAddPositionDialog\n                    show={addDialogVisible}\n                    onHide={() => {\n                        setAddDialogVisible(false);\n                    }}\n                />\n                {!importInProgress && (\n                    <ConnectedPositionsList inDeleteMode={inDeleteMode} />\n                )}\n            </ContentArea>\n        </div>\n    );\n}\n\nconst POSITION_COLUMNS_FOR_INSTRUCTOR_VIEW = [\n    { Header: \"Position\", accessor: \"position_code\" },\n    { Header: \"Title\", accessor: \"position_title\" },\n    {\n        Header: \"Start\",\n        accessor: \"start_date\",\n        Cell: (row) => formatDate(row.value),\n    },\n    {\n        Header: \"End\",\n        accessor: \"end_date\",\n        Cell: (row) => formatDate(row.value),\n    },\n    {\n        Header: \"Coordinator(s)\",\n        accessor: \"instructors\",\n        Cell: (props) => (\n            <React.Fragment>\n                {props.value.map((instructor = {}) => {\n                    const name = `${instructor.first_name} ${instructor.last_name}`;\n                    return (\n                        <Badge variant=\"secondary\" className=\"mr-1\" key={name}>\n                            {name}\n                        </Badge>\n                    );\n                })}\n            </React.Fragment>\n        ),\n    },\n    {\n        Header: \"Enrolled\",\n        accessor: \"current_enrollment\",\n        maxWidth: 80,\n    },\n    {\n        Header: \"Waitlist\",\n        accessor: \"current_waitlisted\",\n        maxWidth: 90,\n    },\n\n    {\n        Header: \"Contract Type\",\n        accessor: \"contract_template.template_name\",\n        maxWidth: 120,\n    },\n];\n\nexport function InstructorPositionsView() {\n    const activeSession = useSelector(activeSessionSelector);\n\n    let heading = (\n        <div>\n            <h4 className=\"text-black\">You have not selected a session</h4>\n            <h5 className=\"text-warning\">Select a session to view Positions</h5>\n        </div>\n    );\n    if (activeSession) {\n        heading = (\n            <h4>\n                Positions for Session{\" \"}\n                <span className=\"text-primary\">{activeSession.name}</span>\n            </h4>\n        );\n    }\n\n    return (\n        <div className=\"page-body\">\n            <ContentArea>\n                {heading}\n                <p>\n                    Every <i>position</i> corresponds to a particular\n                    job/contract type. If a course has multiple types of TA\n                    jobs, that course might be associated with multiple\n                    positions.\n                </p>\n                <ConnectedPositionsList\n                    columns={POSITION_COLUMNS_FOR_INSTRUCTOR_VIEW}\n                />\n            </ContentArea>\n        </div>\n    );\n}\n\nexport { ConnectedAddPositionDialog, ConnectedPositionsList };\n","export const SET_SELECTED_ROWS = \"SET_SELECTED_ROWS\";\n","import { SET_SELECTED_ROWS } from \"./constants\";\n\n// actions\nexport const setSelectedRows = (data) => ({\n    type: SET_SELECTED_ROWS,\n    payload: data,\n});\n\n// selectors\nexport const offerTableSelector = (state) => state.ui.offerTable;\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport {\n    assignmentsSelector,\n    upsertApplicant,\n    upsertAssignment,\n} from \"../../api/actions\";\nimport { EditableField } from \"../../components/edit-field-widgets\";\nimport { offerTableSelector, setSelectedRows } from \"./actions\";\nimport { Button } from \"react-bootstrap\";\nimport { FaSearch } from \"react-icons/fa\";\nimport { formatDownloadUrl, capitalize, formatDate } from \"../../libs/utils\";\nimport { AdvancedFilterTable } from \"../../components/advanced-filter-table\";\n\n/**\n * A cell that renders editable applicant information\n *\n * @param {*} props\n * @returns\n */\nfunction ApplicantCell(props) {\n    const title = `Edit ${\"\" + props.column.Header}`;\n    const { upsertApplicant, field } = props;\n    const applicant = props.row.original || props.row._original;\n    function onChange(newVal) {\n        const applicantId = applicant.applicant.id;\n        upsertApplicant({ id: applicantId, [field]: newVal });\n    }\n    return (\n        <EditableField\n            title={title}\n            value={props.value || \"\"}\n            onChange={onChange}\n        >\n            {props.value}\n        </EditableField>\n    );\n}\n\n/**\n * Cell to show the status of a contract and offer a download button if a contract has been created.\n * I.e., a\n *\n * @param {*} { original }\n * @returns\n */\nfunction StatusCell({ row }) {\n    const original = row.original || row._original;\n    const formattedStatus = capitalize(original.active_offer_status || \"\");\n    const activeOfferUrlToken = original.active_offer_url_token;\n\n    let download = null;\n    if (activeOfferUrlToken) {\n        const url = `/public/contracts/${activeOfferUrlToken}.pdf`;\n        download = (\n            <Button\n                href={formatDownloadUrl(url)}\n                variant=\"light\"\n                size=\"sm\"\n                className=\"mr-2 py-0\"\n                title=\"Download offer PDF\"\n            >\n                <FaSearch />\n            </Button>\n        );\n    }\n\n    return (\n        <>\n            {download}\n            {formattedStatus}\n        </>\n    );\n}\n\n/**\n * A cell that renders editable assignment information\n *\n * @param {*} props\n * @returns\n */\nfunction AssignmentCell(props) {\n    const title = `Edit ${\"\" + props.column.Header}`;\n    const { upsertAssignment, field } = props;\n    const assignment = props.row.original || props.row._original;\n    const active_offer_status = assignment.active_offer_status;\n    function onChange(newVal) {\n        const assignmentId = assignment.id;\n        upsertAssignment({ id: assignmentId, [field]: newVal });\n    }\n    return (\n        <EditableField\n            title={title}\n            value={props.value || \"\"}\n            onChange={onChange}\n            editable={\n                !active_offer_status ||\n                [\"provisional\", \"withdrawn\", \"No Contract\"].includes(\n                    active_offer_status\n                )\n            }\n        >\n            {props.value}\n        </EditableField>\n    );\n}\n\nfunction EditableOfferTable(props) {\n    const {\n        upsertApplicant,\n        upsertAssignment,\n        data,\n        selected,\n        setSelected,\n        ...rest\n    } = props;\n\n    const _setSelected = React.useCallback(setSelected, []);\n\n    // Bind an `ApplicantCell` to a particular field\n    function generateApplicantCell(field) {\n        return (props) => (\n            <ApplicantCell\n                field={field}\n                upsertApplicant={upsertApplicant}\n                {...props}\n            />\n        );\n    }\n\n    // Bind an `AssignmentCell` to a particular field\n    function generateAssignmentCell(field) {\n        return (props) => (\n            <AssignmentCell\n                field={field}\n                upsertAssignment={upsertAssignment}\n                {...props}\n            />\n        );\n    }\n\n    const columns = [\n        {\n            Header: \"Last Name\",\n            accessor: \"applicant.last_name\",\n            Cell: generateApplicantCell(\"last_name\"),\n        },\n        {\n            Header: \"First Name\",\n            accessor: \"applicant.first_name\",\n            Cell: generateApplicantCell(\"first_name\"),\n        },\n        {\n            Header: \"Email\",\n            accessor: \"applicant.email\",\n            Cell: generateApplicantCell(\"email\"),\n        },\n        {\n            Header: \"Position\",\n            accessor: \"position.position_code\",\n        },\n        {\n            Header: \"Hours\",\n            accessor: \"hours\",\n            className: \"number-cell\",\n            maxWidth: 70,\n            Cell: generateAssignmentCell(\"hours\"),\n        },\n        {\n            Header: \"Status\",\n            id: \"status\",\n            // We want items with no active offer to appear at the end of the list\n            // when sorted, so we set their accessor to null (the accessor is used by react table\n            // when sorting items).\n            accessor: (data) =>\n                data.active_offer_status === \"No Contract\"\n                    ? null\n                    : data.active_offer_status,\n            Cell: StatusCell,\n        },\n        {\n            Header: \"Date\",\n            accessor: \"active_offer_recent_activity_date\",\n            Cell: ({ value }) => (value ? formatDate(value) : null),\n            maxWidth: 120,\n        },\n        {\n            Header: \"Nag Count\",\n            accessor: \"active_offer_nag_count\",\n            // If the nag-count is 0, we don't want to show it,\n            // so we return null in that case, which displays nothing.\n            Cell: ({ value }) => (value ? value : null),\n            maxWidth: 30,\n        },\n    ];\n\n    return (\n        <AdvancedFilterTable\n            filterable={true}\n            columns={columns}\n            data={data}\n            selected={selected}\n            setSelected={_setSelected}\n            {...rest}\n        />\n    );\n}\n\n/**\n * OfferTable that has been connected to the redux store\n * for live updates and editability.\n */\nexport const ConnectedOfferTable = connect(\n    (state) => ({\n        data: assignmentsSelector(state).map((offer) => {\n            const { active_offer_status, ...rest } = offer;\n            return !active_offer_status\n                ? { active_offer_status: \"No Contract\", ...rest }\n                : offer;\n        }),\n        selected: offerTableSelector(state).selectedAssignmentIds,\n    }),\n    { upsertApplicant, upsertAssignment, setSelected: setSelectedRows }\n)(EditableOfferTable);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Form } from \"react-bootstrap\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\n\nimport \"react-bootstrap-typeahead/css/Typeahead.css\";\nimport { docApiPropTypes } from \"../../api/defs/doc-generation\";\nimport { fieldEditorFactory, DialogRow } from \"./common-controls\";\nimport { splitDateRangeAtNewYear } from \"../../api/mockAPI/utils\";\n\n/**\n * Adds up all the hours for the wage chunks belonging to an assignment and\n * returns true or false based on whether they match the number of hours for the\n * assignment.\n *\n * @param {*} assignment\n * @returns\n */\nfunction assignmentAndWageChunksMatch(assignment) {\n    if (!Array.isArray(assignment.wage_chunks)) {\n        return true;\n    }\n    let totalHours = 0;\n    for (const chunk of assignment.wage_chunks) {\n        totalHours += chunk.hours;\n    }\n    return totalHours === assignment.hours;\n}\n\nconst DEFAULT_ASSIGNMENT = {\n    note: \"\",\n    position: { id: null },\n    position_id: null,\n    applicant: { id: null },\n    applicant_id: null,\n};\n\n/**\n * Edit information about a position\n *\n * @export\n * @param {{position: object, instructors: object[]}} props\n * @returns\n */\nexport function AssignmentEditor(props) {\n    const {\n        assignment: assignmentProp,\n        setAssignment,\n        applicants,\n        positions,\n    } = props;\n    const assignment = { ...DEFAULT_ASSIGNMENT, ...assignmentProp };\n\n    React.useEffect(() => {\n        // Create or destroy wage chunks based on whether an assignment's dates\n        // cross the January 1 boundary.\n        if (!assignment.start_date || !assignment.end_date) {\n            // If there are no dates, unset any existing wage chunks and\n            // return.\n            if (assignment.wage_chunks) {\n                setAssignment({ ...assignment, wage_chunks: null });\n            }\n            return;\n        }\n        const splitDateRanges = splitDateRangeAtNewYear(\n            assignment.start_date,\n            assignment.end_date\n        );\n        // splitDateRanges will have two ranges if we cross Jan 1 and one range otherwise.\n        if (splitDateRanges.length === 1) {\n            // With only one date range, we have no need for wage chunks.\n            if (assignment.wage_chunks) {\n                setAssignment({ ...assignment, wage_chunks: null });\n            }\n            return;\n        }\n\n        // If we made it here, we cross the January first boundary and have exactly two date ranges\n        if (\n            assignment.wage_chunks == null ||\n            !assignmentAndWageChunksMatch(assignment)\n        ) {\n            const wage_chunks = splitDateRanges.map((range) => ({\n                ...range,\n                hours: assignment.hours / 2,\n            }));\n            setAssignment({ ...assignment, wage_chunks });\n        }\n    }, [assignment, setAssignment]);\n\n    // update the selected position; this comes with side effects\n    function setPosition(positions) {\n        const position = positions[positions.length - 1] || { id: null };\n        setAssignment({\n            ...assignment,\n            position,\n            position_id: position.id,\n            hours: position.hours_per_assignment,\n            start_date: position.start_date,\n            end_date: position.end_date,\n        });\n    }\n\n    // update the selected applicant\n    function setApplicant(applicants) {\n        const applicant = applicants[applicants.length - 1] || { id: null };\n        setAssignment({\n            ...assignment,\n            applicant,\n            applicant_id: applicant.id,\n        });\n    }\n\n    const createFieldEditor = fieldEditorFactory(assignment, setAssignment);\n\n    let wageChunkAdjuster1 = null;\n    let wageChunkAdjuster2 = null;\n    if (assignment.wage_chunks != null) {\n        // If there are any wage chunks, there are exactly two of them,\n        // one for pre-January and one for post.\n        const wageChunks = assignment.wage_chunks;\n        wageChunkAdjuster1 = (\n            <>\n                <Form.Label>F Hours</Form.Label>\n                <Form.Control\n                    type=\"number\"\n                    title=\"The number of pre-January hours\"\n                    value={wageChunks[0].hours}\n                    onChange={(e) => {\n                        const newHours = Math.min(\n                            Math.max(Number(e.target.value), 0),\n                            assignment.hours\n                        );\n                        setAssignment({\n                            ...assignment,\n                            wage_chunks: [\n                                { ...wageChunks[0], hours: newHours },\n                                {\n                                    ...wageChunks[1],\n                                    hours: assignment.hours - newHours,\n                                },\n                            ],\n                        });\n                    }}\n                />\n            </>\n        );\n        wageChunkAdjuster2 = (\n            <>\n                <Form.Label>S Hours</Form.Label>\n                <Form.Control\n                    type=\"number\"\n                    title=\"The number of post-January hours. This value cannot be set directly. You must set the number of pre-January hours.\"\n                    disabled\n                    value={wageChunks[1].hours}\n                />\n            </>\n        );\n    }\n\n    return (\n        <Form>\n            <DialogRow>\n                <React.Fragment>\n                    <Form.Label>Position</Form.Label>\n                    <Typeahead\n                        id=\"position-input\"\n                        ignoreDiacritics={true}\n                        placeholder=\"Position...\"\n                        multiple\n                        labelKey={(option) =>\n                            `${option.position_code} (${option.position_title})`\n                        }\n                        selected={\n                            assignment.position.id == null\n                                ? []\n                                : [assignment.position]\n                        }\n                        options={positions}\n                        onChange={setPosition}\n                    />\n                </React.Fragment>\n                <React.Fragment>\n                    <Form.Label>Applicant</Form.Label>\n                    <Typeahead\n                        id=\"applicant-input\"\n                        ignoreDiacritics={true}\n                        placeholder=\"Applicant...\"\n                        multiple\n                        labelKey={(option) =>\n                            `${option.first_name} ${option.last_name}`\n                        }\n                        selected={\n                            assignment.applicant.id == null\n                                ? []\n                                : [assignment.applicant]\n                        }\n                        options={applicants}\n                        onChange={setApplicant}\n                    />\n                </React.Fragment>\n            </DialogRow>\n            <DialogRow>\n                {createFieldEditor(\"Hours\", \"hours\", \"number\")}\n            </DialogRow>\n\n            <h4>Optional Settings</h4>\n            <DialogRow>\n                {createFieldEditor(\"Start Date\", \"start_date\", \"date\")}\n                {createFieldEditor(\"End Date\", \"end_date\", \"date\")}\n            </DialogRow>\n            <DialogRow>\n                {wageChunkAdjuster1}\n                {wageChunkAdjuster2}\n            </DialogRow>\n        </Form>\n    );\n}\nAssignmentEditor.propTypes = {\n    assignment: docApiPropTypes.assignment.isRequired,\n    setAssignment: PropTypes.func.isRequired,\n    positions: PropTypes.arrayOf(docApiPropTypes.position),\n    applicants: PropTypes.arrayOf(docApiPropTypes.applicant),\n};\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { Modal, Alert, Button, Spinner } from \"react-bootstrap\";\nimport { strip } from \"../../libs/utils\";\nimport {\n    positionsSelector,\n    applicantsSelector,\n    assignmentsSelector,\n    upsertAssignment,\n} from \"../../api/actions\";\nimport { AssignmentEditor } from \"../../components/forms/assignment-editor\";\n\nfunction getConflicts(assignment, assignments = []) {\n    const ret = { delayShow: \"\", immediateShow: \"\" };\n    if (!strip(assignment.position_id) || !strip(assignment.applicant_id)) {\n        ret.delayShow = \"A position and applicant is required\";\n    }\n    const matchingAssignment = assignments.find(\n        (x) =>\n            strip((x.position || {}).id) ===\n                strip((assignment.position || {}).id) &&\n            strip((x.applicant || {}).id) ===\n                strip((assignment.applicant || {}).id)\n    );\n    if (matchingAssignment) {\n        ret.immediateShow = (\n            <p>\n                Another assignment exists with{\" \"}\n                <b>\n                    applicant={assignment.applicant.first_name}{\" \"}\n                    {assignment.applicant.last_name}\n                </b>{\" \"}\n                and <b>position={assignment.position.position_code}</b>\n            </p>\n        );\n    }\n    return ret;\n}\n\nconst BLANK_ASSIGNMENT = {\n    position: { id: null },\n    applicant: { id: null },\n    position_id: -1,\n    applicant_id: -1,\n};\n\nexport function AddAssignmentDialog(props) {\n    const {\n        show,\n        onHide,\n        positions,\n        applicants,\n        assignments,\n        upsertAssignment,\n    } = props;\n    const [newAssignment, setNewAssignment] = React.useState(BLANK_ASSIGNMENT);\n    const [inProgress, setInProgress] = React.useState(false);\n\n    React.useEffect(() => {\n        if (!show) {\n            // If the dialog is hidden, reset the state\n            setNewAssignment(BLANK_ASSIGNMENT);\n        }\n    }, [show]);\n\n    async function createAssignment() {\n        setInProgress(true);\n        try {\n            await upsertAssignment(newAssignment);\n        } finally {\n            setInProgress(false);\n        }\n        onHide();\n    }\n\n    const conflicts = getConflicts(newAssignment, assignments);\n\n    // When a confirm operation is in progress, a spinner is displayed; otherwise\n    // it's hidden\n    const spinner = inProgress ? (\n        <Spinner animation=\"border\" size=\"sm\" className=\"mr-1\" />\n    ) : null;\n\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Add Assignment</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <AssignmentEditor\n                    positions={positions}\n                    applicants={applicants}\n                    assignment={newAssignment}\n                    setAssignment={setNewAssignment}\n                />\n                {!inProgress && conflicts.immediateShow ? (\n                    <Alert variant=\"danger\">{conflicts.immediateShow}</Alert>\n                ) : null}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button\n                    onClick={createAssignment}\n                    title={conflicts.delayShow || \"Create Position\"}\n                    disabled={\n                        !!conflicts.delayShow || !!conflicts.immediateShow\n                    }\n                >\n                    {spinner}\n                    Create Assignment\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\nexport const ConnectedAddAssignmentDialog = connect(\n    (state) => ({\n        positions: positionsSelector(state),\n        applicants: applicantsSelector(state),\n        assignments: assignmentsSelector(state),\n    }),\n    { upsertAssignment }\n)(AddAssignmentDialog);\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { offerTableSelector } from \"../offertable/actions\";\nimport {\n    assignmentsSelector,\n    fetchWageChunksForAssignment,\n} from \"../../api/actions\";\nimport { Button, Modal, Alert, Spinner } from \"react-bootstrap\";\nimport { Assignment, WageChunk } from \"../../api/defs/types\";\nimport { formatDate } from \"../../libs/utils\";\nimport { ActionButton } from \"../../components/action-buttons\";\nimport { FaSearchDollar } from \"react-icons/fa\";\n\nfunction WagechunkDetails({ wageChunks }: { wageChunks: WageChunk[] }) {\n    return (\n        <table className=\"wagechunk-details-table\">\n            <thead>\n                <tr>\n                    <th>Hours</th>\n                    <th>Rate</th>\n                    <th>Start Date</th>\n                    <th>End Date</th>\n                </tr>\n            </thead>\n            <tbody>\n                {(wageChunks || []).map((chunk, i) => (\n                    <tr key={i}>\n                        <td>{chunk.hours}</td>\n                        <td>{chunk.rate}</td>\n                        <td>{formatDate(chunk.start_date || \"\")}</td>\n                        <td>{formatDate(chunk.end_date || \"\")}</td>\n                    </tr>\n                ))}\n            </tbody>\n        </table>\n    );\n}\n\nexport function ConnectedAssignmentDetails({\n    assignmentId,\n}: {\n    assignmentId: Number;\n}) {\n    const assignments = useSelector<any, Assignment[]>(assignmentsSelector);\n    const assignment = assignments.find((a) => a.id === assignmentId);\n    const dispatch = useDispatch();\n\n    React.useEffect(() => {\n        if (assignment?.wage_chunks) {\n            // If the assignment already has wage chunks, we don't need to refetch them.\n            return;\n        }\n\n        dispatch(fetchWageChunksForAssignment(assignment));\n    }, [assignment, dispatch]);\n\n    if (!assignment) {\n        return <div>No Assignment found with ID \"{assignmentId}\"</div>;\n    }\n\n    return (\n        <table className=\"assignment-details-table\">\n            <tbody>\n                <tr>\n                    <th>Position</th>\n                    <td>\n                        {assignment.position.position_code}{\" \"}\n                        {assignment.position.position_title}\n                    </td>\n                </tr>\n                <tr>\n                    <th>Applicant Name</th>\n                    <td>\n                        {assignment.applicant.last_name},{\" \"}\n                        {assignment.applicant.first_name}\n                    </td>\n                </tr>\n                <tr>\n                    <th>Total Hours</th>\n                    <td>{assignment.hours}</td>\n                </tr>\n                <tr>\n                    <th>Offer Status</th>\n                    <td>{assignment.active_offer_status || \"No Offer\"}</td>\n                </tr>\n                <tr>\n                    <th>Pay Description</th>\n                    <td>\n                        {assignment.wage_chunks ? (\n                            <WagechunkDetails\n                                wageChunks={assignment.wage_chunks}\n                            />\n                        ) : (\n                            <Spinner\n                                animation=\"border\"\n                                size=\"sm\"\n                                className=\"mr-1\"\n                            />\n                        )}\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n    );\n}\n\nexport function ConnectedViewAssignmentDetailsAction() {\n    const assignments = useSelector<any, Assignment[]>(assignmentsSelector);\n    const { selectedAssignmentIds } = useSelector<\n        any,\n        { selectedAssignmentIds: Number[] }\n    >(offerTableSelector);\n    const selectedAssignments = assignments.filter((assignment) =>\n        selectedAssignmentIds.includes(assignment.id)\n    );\n    const [dialogVisible, setDialogVisible] = React.useState<Boolean>(false);\n\n    // We want to show the assignment details in a predictable order, so sort\n    // by position code and then last, first\n    selectedAssignments.sort((a, b) => {\n        const aHash = `${a.position.position_code} ${a.applicant.last_name} ${a.applicant.first_name}`;\n        const bHash = `${b.position.position_code} ${b.applicant.last_name} ${b.applicant.first_name}`;\n        return aHash === bHash ? 0 : aHash > bHash ? 1 : -1;\n    });\n\n    let assignmentDetails: JSX.Element | JSX.Element[] = (\n        <Alert variant=\"info\">\n            There are no selected assignments. You must select assignments to\n            see their details.\n        </Alert>\n    );\n    if (selectedAssignments.length > 0) {\n        assignmentDetails = selectedAssignments.map((assignment, i) => {\n            let split = i === 0 ? null : <hr />;\n            return (\n                <React.Fragment key={i}>\n                    {split}\n                    <ConnectedAssignmentDetails\n                        assignmentId={assignment.id}\n                        key={i}\n                    />\n                </React.Fragment>\n            );\n        });\n    }\n\n    const disabled = selectedAssignmentIds.length === 0;\n\n    return (\n        <React.Fragment>\n            <ActionButton\n                icon={FaSearchDollar}\n                onClick={() => setDialogVisible(true)}\n                title={\n                    disabled\n                        ? \"You must select an assignment to view its details\"\n                        : \"View details of selected assignment(s)\"\n                }\n                disabled={disabled}\n            >\n                Assignment Details\n            </ActionButton>\n            <Modal\n                show={dialogVisible}\n                onHide={() => setDialogVisible(false)}\n                size=\"lg\"\n            >\n                <Modal.Header closeButton>\n                    <Modal.Title>Assignment Details</Modal.Title>\n                </Modal.Header>\n                <Modal.Body>{assignmentDetails}</Modal.Body>\n                <Modal.Footer>\n                    <Button\n                        variant=\"light\"\n                        onClick={() => setDialogVisible(false)}\n                    >\n                        Close\n                    </Button>\n                </Modal.Footer>\n            </Modal>\n        </React.Fragment>\n    );\n}\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { offerTableSelector } from \"../offertable/actions\";\nimport { assignmentsSelector } from \"../../api/actions\";\nimport {\n    offerForAssignmentCreate,\n    offerForAssignmentEmail,\n    offerForAssignmentNag,\n    offerForAssignmentWithdraw,\n    setOfferForAssignmentAccepted,\n    setOfferForAssignmentRejected,\n} from \"../../api/actions/offers\";\nimport {\n    FaEnvelope,\n    FaBan,\n    FaCheck,\n    FaUserTimes,\n    FaUserClock,\n    FaUserPlus,\n} from \"react-icons/fa\";\nimport { ActionButton } from \"../../components/action-buttons\";\n\n/**\n * Functions to test what actions you can do with a particular assignment\n */\nconst OfferTest = {\n    canCreate(assignment) {\n        return (\n            assignment.active_offer_status == null ||\n            assignment.active_offer_status === \"withdrawn\"\n        );\n    },\n    canEmail(assignment) {\n        return assignment.active_offer_status != null;\n    },\n    canNag(assignment) {\n        return assignment.active_offer_status === \"pending\";\n    },\n    canWithdraw(assignment) {\n        return assignment.active_offer_status != null;\n    },\n    canAccept(assignment) {\n        return assignment.active_offer_status != null;\n    },\n    canReject(assignment) {\n        return assignment.active_offer_status != null;\n    },\n};\n\nfunction OfferActionButtons(props) {\n    const selectedAssignments = props.assignments;\n    const {\n        offerForAssignmentCreate,\n        offerForAssignmentEmail,\n        offerForAssignmentNag,\n        offerForAssignmentWithdraw,\n        setOfferForAssignmentAccepted,\n        setOfferForAssignmentRejected,\n    } = props;\n\n    function createOffers() {\n        for (const assignment of selectedAssignments) {\n            offerForAssignmentCreate(assignment);\n        }\n    }\n    function withdrawOffers() {\n        for (const assignment of selectedAssignments) {\n            offerForAssignmentWithdraw(assignment);\n        }\n    }\n    function emailOffers() {\n        for (const assignment of selectedAssignments) {\n            offerForAssignmentEmail(assignment);\n        }\n    }\n    function nagOffers() {\n        for (const assignment of selectedAssignments) {\n            offerForAssignmentNag(assignment);\n        }\n    }\n    function acceptOffers() {\n        for (const assignment of selectedAssignments) {\n            setOfferForAssignmentAccepted(assignment);\n        }\n    }\n    function rejectOffers() {\n        for (const assignment of selectedAssignments) {\n            setOfferForAssignmentRejected(assignment);\n        }\n    }\n\n    const actionPermitted = {};\n    for (const key of [\n        \"canCreate\",\n        \"canEmail\",\n        \"canNag\",\n        \"canWithdraw\",\n        \"canAccept\",\n        \"canReject\",\n    ]) {\n        actionPermitted[key] =\n            selectedAssignments.length !== 0 &&\n            selectedAssignments.every(OfferTest[key]);\n    }\n\n    return (\n        <React.Fragment>\n            <ActionButton\n                icon={<FaUserPlus />}\n                onClick={createOffers}\n                disabled={!actionPermitted.canCreate}\n            >\n                Create Offer\n            </ActionButton>\n            <ActionButton\n                icon={<FaUserTimes />}\n                onClick={withdrawOffers}\n                disabled={!actionPermitted.canWithdraw}\n            >\n                Withdraw Offer\n            </ActionButton>\n            <ActionButton\n                icon={<FaEnvelope />}\n                onClick={emailOffers}\n                disabled={!actionPermitted.canEmail}\n            >\n                Email Offer\n            </ActionButton>\n            <ActionButton\n                icon={<FaUserClock />}\n                onClick={nagOffers}\n                disabled={!actionPermitted.canNag}\n            >\n                Nag Offer\n            </ActionButton>\n            <ActionButton\n                icon={<FaCheck />}\n                onClick={acceptOffers}\n                disabled={!actionPermitted.canAccept}\n            >\n                Set as Accepted\n            </ActionButton>\n            <ActionButton\n                icon={<FaBan />}\n                onClick={rejectOffers}\n                disabled={!actionPermitted.canReject}\n            >\n                Set as Rejected\n            </ActionButton>\n        </React.Fragment>\n    );\n}\nexport const ConnectedOfferActionButtons = connect(\n    (state) => {\n        // pass in the currently selected assignments.\n        const { selectedAssignmentIds } = offerTableSelector(state);\n        const assignments = assignmentsSelector(state);\n        return {\n            assignments: assignments.filter((x) =>\n                selectedAssignmentIds.includes(x.id)\n            ),\n        };\n    },\n    {\n        offerForAssignmentCreate,\n        offerForAssignmentEmail,\n        offerForAssignmentNag,\n        offerForAssignmentWithdraw,\n        setOfferForAssignmentAccepted,\n        setOfferForAssignmentRejected,\n    }\n)(OfferActionButtons);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { formatDate } from \"../libs/utils\";\nimport { createDiffColumnsFromColumns } from \"./diff-table\";\nimport { AdvancedFilterTable } from \"./advanced-filter-table\";\n\nconst DEFAULT_COLUMNS = [\n    { Header: \"Last Name\", accessor: \"applicant.last_name\" },\n    { Header: \"First Name\", accessor: \"applicant.first_name\" },\n    { Header: \"Position Code\", accessor: \"position.position_code\" },\n    { Header: \"Hours\", accessor: \"hours\", className: \"number-cell\" },\n    {\n        Header: \"Start\",\n        accessor: \"start_date\",\n        Cell: (row) => formatDate(row.value) || \"\",\n    },\n    {\n        Header: \"End\",\n        accessor: \"end_date\",\n        Cell: (row) => formatDate(row.value) || \"\",\n    },\n];\n\n/**\n * Display a DiffSpec array of assignments and highlight the changes.\n *\n * @export\n * @param {*} { modifiedInstructors }\n * @returns\n */\nexport function AssignmentsDiffList({ modifiedAssignments }) {\n    return (\n        <AssignmentsList\n            assignments={modifiedAssignments}\n            columns={createDiffColumnsFromColumns(DEFAULT_COLUMNS)}\n        />\n    );\n}\n\nfunction AssignmentsList(props) {\n    const { assignments, columns = DEFAULT_COLUMNS } = props;\n    return <AdvancedFilterTable data={assignments} columns={columns} />;\n}\nAssignmentsList.propTypes = {\n    assignments: PropTypes.arrayOf(\n        PropTypes.shape({\n            id: PropTypes.number,\n            position: PropTypes.object,\n            applicant: PropTypes.object,\n        })\n    ).isRequired,\n};\n\nexport { AssignmentsList };\n","import React from \"react\";\nimport FileSaver from \"file-saver\";\nimport {\n    assignmentsSelector,\n    exportAssignments,\n    activeSessionSelector,\n    applicantsSelector,\n    positionsSelector,\n    upsertAssignments,\n} from \"../../api/actions\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ExportActionButton } from \"../../components/export-button\";\nimport { ImportActionButton } from \"../../components/import-button\";\nimport { Alert } from \"react-bootstrap\";\nimport { normalizeImport, dataToFile } from \"../../libs/importExportUtils\";\nimport {\n    AssignmentsList,\n    AssignmentsDiffList,\n} from \"../../components/assignments-list\";\nimport { prepareMinimal } from \"../../libs/exportUtils\";\nimport { diffImport, getChanged } from \"../../libs/diffUtils\";\nimport { offerTableSelector } from \"../offertable/actions\";\n\n/**\n * Format a date as YYYY-MM-DD for inserting into a spreadsheet\n *\n * @param {*} date\n * @returns\n */\nfunction formatDateForSpreadsheet(date) {\n    try {\n        return date && new Date(date).toJSON().slice(0, 10);\n    } catch (e) {\n        return \"\";\n    }\n}\n\n/**\n * Create header columns for a spreadsheet containing information about every pay period.\n *\n * @param {*} assignments\n * @returns\n */\nfunction createPayPeriodHeaders(assignments) {\n    const ret = [];\n    if (!assignments) {\n        return ret;\n    }\n    const maxNumPeriods = Math.max(\n        ...assignments.map((assignment) => assignment.wage_chunks?.length || 0),\n        0\n    );\n\n    for (let i = 0; i < maxNumPeriods; i++) {\n        ret.push(\n            `Period ${i + 1} Rate`,\n            `Period ${i + 1} Hours`,\n            `Period ${i + 1} Start Date`,\n            `Period ${i + 1} End Date`\n        );\n    }\n    return ret;\n}\n\n/**\n * Create formatted rows providing information about each wage chunk.\n *\n * @param {*} wageChunks\n * @returns\n */\nfunction formatWageChunksToList(wageChunks) {\n    const ret = [];\n    if (!wageChunks) {\n        return ret;\n    }\n\n    ret.push(wageChunks.length);\n    for (const chunk of wageChunks) {\n        ret.push(\n            chunk.rate,\n            chunk.hours,\n            formatDateForSpreadsheet(chunk.start_date),\n            formatDateForSpreadsheet(chunk.end_date)\n        );\n    }\n    return ret;\n}\n\n/**\n * Allows for the download of a file blob containing the exported instructors.\n * Instructors are synchronized from the server before being downloaded.\n *\n * @export\n * @returns\n */\nexport function ConnectedExportAssignmentsAction({\n    disabled = false,\n    setExportInProgress = null,\n}) {\n    const dispatch = useDispatch();\n    const session = useSelector(activeSessionSelector);\n    const [exportType, setExportType] = React.useState(null);\n    const { selectedAssignmentIds } = useSelector(offerTableSelector);\n\n    const setInProgress = React.useCallback(\n        function setInProgress(val) {\n            if (typeof setExportInProgress === \"function\") {\n                setExportInProgress(val);\n            }\n        },\n        [setExportInProgress]\n    );\n\n    React.useEffect(() => {\n        if (!exportType) {\n            return;\n        }\n\n        async function doExport() {\n            // Having an export type of `null` means we're ready to export again,\n            // We set the export type to null at the start so in case an error occurs,\n            // we can still try again. This *will not* affect the current value of `exportType`\n            setExportType(null);\n\n            // Make a function that converts a list of instructors into a `File` object.\n            function prepareData(assignments, dataFormat) {\n                // If we have selected specific assignments, we only want to export those.\n                if (selectedAssignmentIds && selectedAssignmentIds.length > 0) {\n                    assignments = assignments.filter((a) =>\n                        selectedAssignmentIds.includes(a.id)\n                    );\n                }\n\n                // We want to flatten a lot of the data in `assignments` and only include the information\n                // we need.\n                const assignmentsForSpreadsheet = assignments.map(\n                    (assignment) => ({\n                        first_name: assignment.applicant.first_name,\n                        last_name: assignment.applicant.last_name,\n                        utorid: assignment.applicant.utorid,\n                        email: assignment.applicant.email,\n                        position_code: assignment.position.position_code,\n                        start_date: assignment.start_date,\n                        end_date: assignment.end_date,\n                        contract_template: assignment.contract_override_pdf\n                            ? null\n                            : assignment.position.contract_template\n                                  .template_name,\n                        contract_override_pdf: assignment.contract_override_pdf,\n                        hours: assignment.hours,\n                        active_offer_status: assignment.active_offer_status,\n                        active_offer_recent_activity_date:\n                            assignment.active_offer_recent_activity_date,\n                        wage_chunks: assignment.wage_chunks.map((chunk) => ({\n                            hours: chunk.hours,\n                            rate: chunk.rate,\n                            start_date: chunk.start_date,\n                            end_date: chunk.end_date,\n                        })),\n                    })\n                );\n                return dataToFile(\n                    {\n                        toSpreadsheet: () =>\n                            [\n                                [\n                                    \"Last Name\",\n                                    \"First Name\",\n                                    \"UTORid\",\n                                    \"Email\",\n                                    \"Position Code\",\n                                    \"Start Date\",\n                                    \"End Date\",\n                                    \"Hours\",\n                                    \"Contract Template\",\n                                    \"Contract Override PDF\",\n                                    \"Offer Status\",\n                                    \"Recent Activity Date\",\n                                    \"\",\n                                    \"Number of Pay Periods\",\n                                    ...createPayPeriodHeaders(\n                                        assignmentsForSpreadsheet\n                                    ),\n                                ],\n                            ].concat(\n                                assignmentsForSpreadsheet.map((assignment) => [\n                                    assignment.last_name,\n                                    assignment.first_name,\n                                    assignment.utorid,\n                                    assignment.email,\n                                    assignment.position_code,\n                                    formatDateForSpreadsheet(\n                                        assignment.start_date\n                                    ),\n                                    formatDateForSpreadsheet(\n                                        assignment.end_date\n                                    ),\n                                    assignment.hours,\n                                    assignment.contract_template,\n                                    assignment.contract_override_pdf,\n                                    assignment.active_offer_status,\n                                    undefined,\n                                    assignment.active_offer_recent_activity_date,\n                                    ...formatWageChunksToList(\n                                        assignment.wage_chunks\n                                    ),\n                                ])\n                            ),\n                        toJson: () => ({\n                            assignments: assignments.map((assignment) =>\n                                prepareMinimal.assignment(assignment, session)\n                            ),\n                        }),\n                    },\n                    dataFormat,\n                    \"assignments\"\n                );\n            }\n\n            setInProgress(true);\n            const file = await dispatch(\n                exportAssignments(prepareData, exportType)\n            );\n            setInProgress(false);\n\n            FileSaver.saveAs(file);\n        }\n        doExport().catch(console.error);\n    }, [exportType, dispatch, session, selectedAssignmentIds, setInProgress]);\n\n    function onClick(option) {\n        setExportType(option);\n    }\n\n    return <ExportActionButton onClick={onClick} disabled={disabled} />;\n}\n\nconst assignmentSchema = {\n    // We don't list \"active_offer_status\" because that cannot be imported. It has to be set\n    // via the TA or manually by the admin.\n    keys: [\n        \"utorid\",\n        \"position_code\",\n        \"start_date\",\n        \"end_date\",\n        \"contract_template\",\n        \"contract_override_pdf\",\n        \"hours\",\n        \"wage_chunks\",\n    ],\n    keyMap: {\n        \"Position Code\": \"position_code\",\n        \"Course Name\": \"position_code\",\n        \"Start Date\": \"start_date\",\n        Start: \"start_date\",\n        \"End Date\": \"end_date\",\n        End: \"end_date\",\n        Hours: \"hours\",\n        \"Contract Override PDF\": \"contract_override_pdf\",\n    },\n    dateColumns: [\"start_date\", \"end_date\"],\n    requiredKeys: [\"position_code\", \"utorid\"],\n    primaryKey: [\"utorid\", \"position_code\"],\n    baseName: \"assignments\",\n};\n\nexport function ConnectedImportAssignmentsAction({\n    disabled = false,\n    setImportInProgress = null,\n}) {\n    const dispatch = useDispatch();\n    const assignments = useSelector(assignmentsSelector);\n    const applicants = useSelector(applicantsSelector);\n    const positions = useSelector(positionsSelector);\n    const session = useSelector(activeSessionSelector);\n    const [fileContent, setFileContent] = React.useState(null);\n    const [diffed, setDiffed] = React.useState(null);\n    const [processingError, setProcessingError] = React.useState(null);\n    const [inProgress, _setInProgress] = React.useState(false);\n\n    function setInProgress(state) {\n        _setInProgress(state);\n        if (typeof setImportInProgress === \"function\") {\n            setImportInProgress(state);\n        }\n    }\n\n    // Make sure we aren't showing any diff if there's no file loaded.\n    React.useEffect(() => {\n        if (!fileContent) {\n            if (diffed) {\n                setDiffed(null);\n            }\n        }\n    }, [diffed, setDiffed, fileContent]);\n\n    // Recompute the diff every time the file changes\n    React.useEffect(() => {\n        // If we have no file or we are currently in the middle of processing another file,\n        // do nothing.\n        if (!fileContent || inProgress) {\n            return;\n        }\n        try {\n            setProcessingError(null);\n\n            // normalize the data coming from the file\n            let data = normalizeImport(fileContent, assignmentSchema);\n            // If data is coming from a spreadsheet, we need to make sure the\n            // `hours` field is coerced to a number\n            for (const item of data) {\n                if (item.hours) {\n                    item.hours = +item.hours;\n                }\n            }\n\n            // Compute which positions have been added/modified\n            const newDiff = diffImport.assignments(data, {\n                assignments,\n                positions,\n                applicants,\n                session,\n            });\n\n            setDiffed(newDiff);\n        } catch (e) {\n            console.warn(e);\n            setProcessingError(e);\n        }\n    }, [fileContent, assignments, positions, applicants, session, inProgress]);\n\n    async function onConfirm() {\n        const changedPositions = getChanged(diffed);\n        await dispatch(upsertAssignments(changedPositions));\n        setFileContent(null);\n    }\n\n    return (\n        <ImportActionButton\n            onConfirm={onConfirm}\n            onFileChange={setFileContent}\n            dialogContent={\n                <DialogContent\n                    diffed={diffed}\n                    processingError={processingError}\n                />\n            }\n            setInProgress={setInProgress}\n            disabled={disabled}\n        />\n    );\n}\n\nconst DialogContent = React.memo(function DialogContent({\n    diffed,\n    processingError,\n}) {\n    let dialogContent = <p>No data loaded...</p>;\n    if (processingError) {\n        dialogContent = <Alert variant=\"danger\">{\"\" + processingError}</Alert>;\n    } else if (diffed) {\n        const newItems = diffed\n            .filter((item) => item.status === \"new\")\n            .map((item) => item.obj);\n        const modifiedDiffSpec = diffed.filter(\n            (item) => item.status === \"modified\"\n        );\n\n        if (newItems.length === 0 && modifiedDiffSpec.length === 0) {\n            dialogContent = (\n                <Alert variant=\"warning\">\n                    No difference between imported assignments and those already\n                    on the system.\n                </Alert>\n            );\n        } else {\n            dialogContent = (\n                <>\n                    {newItems.length > 0 && (\n                        <Alert variant=\"primary\">\n                            <span className=\"mb-1\">\n                                The following assignments will be{\" \"}\n                                <strong>added</strong>\n                            </span>\n                            <AssignmentsList assignments={newItems} />\n                        </Alert>\n                    )}\n                    {modifiedDiffSpec.length > 0 && (\n                        <Alert variant=\"info\">\n                            <span className=\"mb-1\">\n                                The following assignments will be{\" \"}\n                                <strong>modified</strong>\n                            </span>\n                            <AssignmentsDiffList\n                                modifiedAssignments={modifiedDiffSpec}\n                            />\n                        </Alert>\n                    )}\n                </>\n            );\n        }\n    }\n\n    return dialogContent;\n});\n","import React from \"react\";\nimport { ConnectedOfferTable } from \"../offertable\";\nimport { ConnectedAddAssignmentDialog } from \"./add-assignment-dialog\";\nimport { ConnectedViewAssignmentDetailsAction } from \"./assignment-details\";\nimport { ConnectedOfferActionButtons } from \"./offer-actions\";\nimport {\n    ConnectedExportAssignmentsAction,\n    ConnectedImportAssignmentsAction,\n} from \"./import-export\";\nimport {\n    ActionsList,\n    ActionButton,\n    ActionHeader,\n} from \"../../components/action-buttons\";\nimport { ContentArea } from \"../../components/layout\";\nimport { FaPlus } from \"react-icons/fa\";\nimport { MissingActiveSessionWarning } from \"../../components/sessions\";\nimport { useSelector } from \"react-redux\";\nimport { activeSessionSelector } from \"../../api/actions\";\nimport { Spinner } from \"react-bootstrap\";\n\nexport function AdminAssignmentsView() {\n    const [addDialogVisible, setAddDialogVisible] = React.useState(false);\n    const activeSession = useSelector(activeSessionSelector);\n    // While data is being imported, updating the react table takes a long time,\n    // so we use this variable to hide the react table during import.\n    const [inProgress, setInProgress] = React.useState(false);\n\n    return (\n        <div className=\"page-body\">\n            <ActionsList>\n                <ActionHeader>Available Actions</ActionHeader>\n                <ActionButton\n                    icon={<FaPlus />}\n                    onClick={() => {\n                        setAddDialogVisible(true);\n                    }}\n                    disabled={!activeSession}\n                >\n                    Add Assignment\n                </ActionButton>\n                <ActionHeader>Import/Export</ActionHeader>\n                <ConnectedImportAssignmentsAction\n                    disabled={!activeSession}\n                    setImportInProgress={setInProgress}\n                />\n                <ConnectedExportAssignmentsAction\n                    disabled={!activeSession}\n                    setExportInProgress={setInProgress}\n                />\n                <ActionHeader>Selected Assignment Actions</ActionHeader>\n                <ConnectedViewAssignmentDetailsAction />\n                <ConnectedOfferActionButtons />\n            </ActionsList>\n            <ContentArea>\n                {activeSession ? null : (\n                    <MissingActiveSessionWarning extraText=\"To view or modify assignments, you must select a session.\" />\n                )}\n\n                {inProgress ? (\n                    <React.Fragment>\n                        <Spinner animation=\"border\" className=\"mr-2\" />\n                        In Progress\n                    </React.Fragment>\n                ) : (\n                    <ConnectedOfferTable />\n                )}\n                <ConnectedAddAssignmentDialog\n                    show={addDialogVisible}\n                    onHide={() => {\n                        setAddDialogVisible(false);\n                    }}\n                />\n            </ContentArea>\n        </div>\n    );\n}\n\nexport function InstructorAssignmentsView() {\n    return (\n        <div className=\"page-body\">\n            <ActionsList>\n                <ActionHeader>Import/Export</ActionHeader>\n                <ConnectedExportAssignmentsAction />\n            </ActionsList>\n            <ContentArea>\n                <ConnectedOfferTable />\n            </ContentArea>\n        </div>\n    );\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Form } from \"react-bootstrap\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\n\nimport \"react-bootstrap-typeahead/css/Typeahead.css\";\nimport { docApiPropTypes } from \"../../api/defs/doc-generation\";\nimport { fieldEditorFactory, DialogRow } from \"./common-controls\";\n\nconst DEFAULT_CONTRACT_TEMPLATE = {\n    template_name: \"\",\n    template_file: \"\",\n};\n\n/**\n * Edit information about a contract_template\n *\n * @export\n * @param {{contractTemplate: object, availableTemplates: object[], setContractTemplate: function}} props\n * @returns\n */\nexport function ContractTemplateEditor(props) {\n    const {\n        contractTemplate: contractTemplateProp,\n        setContractTemplate,\n        availableTemplates = [],\n    } = props;\n    const contractTemplate = {\n        ...DEFAULT_CONTRACT_TEMPLATE,\n        ...contractTemplateProp,\n    };\n\n    // update the selected template_file; this comes with side effects\n    function setTemplateFile(templates) {\n        const templateFile = templates[templates.length - 1] || \"\";\n        setContractTemplate({\n            ...contractTemplate,\n            template_file: templateFile,\n        });\n    }\n\n    const createFieldEditor = fieldEditorFactory(\n        contractTemplate,\n        setContractTemplate\n    );\n\n    return (\n        <Form>\n            <DialogRow>\n                {createFieldEditor(\n                    'Template Name (e.g. \"OTO\" \"Invigilate\")',\n                    \"template_name\"\n                )}\n            </DialogRow>\n            <DialogRow>\n                <React.Fragment>\n                    <Form.Label title=\"This file is stored on the server; you can edit it there.\">\n                        Template File\n                    </Form.Label>\n                    <Typeahead\n                        id=\"file-name-input\"\n                        ignoreDiacritics={true}\n                        placeholder=\"File name...\"\n                        multiple\n                        labelKey={(option) => `${option}`}\n                        selected={\n                            !contractTemplate.template_file\n                                ? []\n                                : [contractTemplate.template_file]\n                        }\n                        options={availableTemplates.map((x) => x.template_file)}\n                        onChange={setTemplateFile}\n                    />\n                </React.Fragment>\n            </DialogRow>\n        </Form>\n    );\n}\nContractTemplateEditor.propTypes = {\n    contractTemplate: docApiPropTypes.contractTemplate.isRequired,\n    setContractTemplate: PropTypes.func.isRequired,\n    availableTemplates: PropTypes.arrayOf(\n        docApiPropTypes.contractTemplateMinimal\n    ),\n};\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { Modal, Button, Alert } from \"react-bootstrap\";\nimport {\n    contractTemplatesSelector,\n    allContractTemplatesSelector,\n    upsertContractTemplate,\n    fetchAllContractTemplates,\n} from \"../../api/actions\";\nimport { strip } from \"../../libs/utils\";\nimport { ContractTemplateEditor } from \"../../components/forms/contract-template-editor\";\n\nconst BLANK_CONTRACT_TEMPLATE = {\n    template_name: \"\",\n    template_file: \"\",\n};\n\n/**\n * Find if there is a conflicting instructor in the passed in list\n * of instructors, or if any required fields are incorrect.\n *\n * @param {object} contractTemplate\n * @param {object[]} contractTemplates\n */\nfunction getConflicts(contractTemplate, contractTemplates) {\n    const ret = { delayShow: \"\", immediateShow: \"\" };\n    if (\n        !strip(contractTemplate.template_name) ||\n        !strip(contractTemplate.template_file)\n    ) {\n        ret.delayShow = \"A template name and template file is required\";\n    }\n    const matchingTemplate = contractTemplates.find(\n        (x) => strip(x.template_name) === strip(contractTemplate.template_name)\n    );\n    if (matchingTemplate) {\n        ret.immediateShow = (\n            <p>\n                Another contract template exists with name=\n                {contractTemplate.template_name}:{\" \"}\n                <b>\n                    {matchingTemplate.template_name}{\" \"}\n                    {matchingTemplate.template_file}\n                </b>\n            </p>\n        );\n    }\n    return ret;\n}\n\nfunction AddContractTemplateDialog(props) {\n    const {\n        show,\n        onHide = () => {},\n        contractTemplates,\n        availableTemplates,\n        upsertContractTemplate,\n        fetchAllContractTemplates,\n    } = props;\n    const [newContractTemplate, setNewContractTemplate] = React.useState(\n        BLANK_CONTRACT_TEMPLATE\n    );\n\n    React.useEffect(() => {\n        if (!show) {\n            // If the dialog is hidden, reset the state\n            setNewContractTemplate(BLANK_CONTRACT_TEMPLATE);\n        } else {\n            // If we've just become visible, fetch all available contract templates\n            fetchAllContractTemplates();\n        }\n    }, [show, fetchAllContractTemplates]);\n\n    function createContractTemplate() {\n        upsertContractTemplate(newContractTemplate);\n        onHide();\n    }\n\n    const conflicts = getConflicts(newContractTemplate, contractTemplates);\n\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Add Contract Template</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <ContractTemplateEditor\n                    contractTemplate={newContractTemplate}\n                    setContractTemplate={setNewContractTemplate}\n                    availableTemplates={availableTemplates}\n                />\n\n                {conflicts.immediateShow ? (\n                    <Alert variant=\"danger\">{conflicts.immediateShow}</Alert>\n                ) : null}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button\n                    onClick={createContractTemplate}\n                    title={conflicts.delayShow || \"Create Contract Template\"}\n                    disabled={\n                        !!conflicts.delayShow || !!conflicts.immediateShow\n                    }\n                >\n                    Create Contract Template\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n/**\n * AddContractTemplateDialog that has been connected to the redux store\n */\nexport const ConnectedAddContractTemplateDialog = connect(\n    (state) => ({\n        contractTemplates: contractTemplatesSelector(state),\n        availableTemplates: allContractTemplatesSelector(state),\n    }),\n    { upsertContractTemplate, fetchAllContractTemplates }\n)(AddContractTemplateDialog);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { docApiPropTypes } from \"../api/defs/doc-generation\";\n\nimport { AdvancedFilterTable } from \"./advanced-filter-table\";\n\nconst DEFAULT_COLUMNS = [\n    { Header: \"Template Name\", accessor: \"template_name\" },\n    {\n        Header: \"Template File\",\n        accessor: \"template_file\",\n    },\n];\n\n/**\n * List the contract templates using a ReactTable. `columns` can be passed\n * in to customize columns/cell renderers.\n *\n * @export\n * @param {{contractTemplates: object[], columns: object[]}} props\n * @returns\n */\nexport function ContractTemplatesList(props) {\n    const { contractTemplates, columns = DEFAULT_COLUMNS } = props;\n    return (\n        <AdvancedFilterTable\n            data={contractTemplates}\n            columns={columns}\n            filterable={true}\n        />\n    );\n}\nContractTemplatesList.propTypes = {\n    contractTemplates: PropTypes.arrayOf(docApiPropTypes.contractTemplate)\n        .isRequired,\n    columns: PropTypes.arrayOf(\n        PropTypes.shape({ Header: PropTypes.any.isRequired })\n    ),\n};\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport FileSaver from \"file-saver\";\nimport { FaDownload } from \"react-icons/fa\";\nimport {\n    contractTemplatesSelector,\n    previewContractTemplate,\n    downloadContractTemplate,\n} from \"../../api/actions\";\nimport { ContractTemplatesList } from \"../../components/contract-templates-list\";\nimport { FaSearch } from \"react-icons/fa\";\nimport { Button, Modal, Alert, Spinner } from \"react-bootstrap\";\nimport ModalHeader from \"react-bootstrap/ModalHeader\";\n\nfunction TemplatePreviewDialog({ show, onClose, template_id }) {\n    const [isLoading, setIsLoading] = React.useState(false);\n    const [cachedPreview, setCachedPreview] = React.useState({\n        id: null,\n        content: null,\n    });\n    const dispatch = useDispatch();\n\n    React.useEffect(() => {\n        if (\n            // Don't try to load an invalid template\n            template_id == null ||\n            // Don't reload a template that we've already loaded\n            template_id === cachedPreview.template_id\n        ) {\n            setIsLoading(false);\n            return;\n        }\n\n        // We're loading a template that we haven't loaded yet.\n        setIsLoading(true);\n        dispatch(previewContractTemplate(template_id))\n            .then((content) => {\n                setCachedPreview({ id: template_id, content });\n            })\n            .finally(() => setIsLoading(false));\n    }, [template_id, setIsLoading, cachedPreview.template_id, dispatch]);\n\n    async function downloadClicked() {\n        const file = await dispatch(downloadContractTemplate(template_id));\n        FileSaver.saveAs(file);\n    }\n\n    return (\n        <Modal\n            size=\"xl\"\n            show={show}\n            onHide={onClose}\n            dialogClassName=\"fullscreen-modal\"\n        >\n            <ModalHeader closeButton>\n                <Modal.Title>Previewing Template</Modal.Title>\n            </ModalHeader>\n            <Modal.Body className=\"d-flex\">\n                <p>\n                    The template you are previewing has its fields filled in\n                    with dummy values. These values will be replaced with\n                    correct values when the template is used to create a\n                    contract.\n                </p>\n                {isLoading && (\n                    <Alert variant=\"info\">\n                        <Spinner animation=\"border\" className=\"mr-3\" />\n                        Loading Template...\n                    </Alert>\n                )}\n                {template_id != null && !isLoading && (\n                    <iframe\n                        style={{\n                            boder: \"1px solid black\",\n                            width: \"100%\",\n                            flexGrow: 1,\n                        }}\n                        srcDoc={isLoading ? null : cachedPreview.content}\n                        title=\"Contract template preview\"\n                    />\n                )}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button\n                    title=\"Download a copy of this template. The downloaded copy will have no substitutions made and will be suitable for editing.\"\n                    onClick={downloadClicked}\n                    variant=\"link\"\n                >\n                    <FaDownload className=\"mr-2\" />\n                    Download Template\n                </Button>\n                <Button variant=\"secondary\" onClick={onClose}>\n                    Close\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\nexport function ConnectedContractTemplateList() {\n    const [previewVisible, setPreviewVisible] = React.useState(false);\n    const [previewingTemplate, setPreviewingTemplate] = React.useState(null);\n    const contractTemplates = useSelector(contractTemplatesSelector);\n    const columns = [\n        { Header: \"Template Name\", accessor: \"template_name\", width: 200 },\n        {\n            Header: \"Template File\",\n            accessor: \"template_file\",\n            Cell: TemplateFileCell,\n            width: 400,\n        },\n    ];\n\n    function TemplateFileCell({ row }) {\n        const rowData = row.original || row._original;\n        const template_id = rowData.id;\n        const template_file = rowData.template_file;\n\n        return (\n            <div>\n                <Button\n                    variant=\"light\"\n                    size=\"sm\"\n                    className=\"mr-2 py-0\"\n                    title=\"Preview Template\"\n                    onClick={() => previewClicked(template_id)}\n                >\n                    <FaSearch />\n                </Button>\n                {template_file}\n            </div>\n        );\n    }\n\n    function previewClicked(template_id) {\n        setPreviewingTemplate(template_id);\n        setPreviewVisible(true);\n    }\n\n    return (\n        <>\n            <ContractTemplatesList\n                contractTemplates={contractTemplates}\n                columns={columns}\n            />\n            <TemplatePreviewDialog\n                show={previewVisible}\n                onClose={() => setPreviewVisible(false)}\n                template_id={previewingTemplate}\n            />\n        </>\n    );\n}\n","import React from \"react\";\nimport { ActionButton } from \"../../components/action-buttons\";\nimport { FaUpload } from \"react-icons/fa\";\nimport { useDispatch } from \"react-redux\";\nimport { uploadContractTemplate } from \"../../api/actions\";\nimport {\n    Modal,\n    Row,\n    Col,\n    Container,\n    Form,\n    Button,\n    Spinner,\n} from \"react-bootstrap\";\n\nexport function ConnectedUploadContractTemplateAction({ disabled = false }) {\n    const dispatch = useDispatch();\n    const [file, setFile] = React.useState<File | null>(null);\n    const [fileInputLabel, setFileInputLabel] = React.useState(\n        \"Select an HTML template file.\"\n    );\n    const [dialogOpen, setDialogOpen] = React.useState<Boolean>(false);\n    const [inProgress, setInProgress] = React.useState(false);\n\n    async function _onFileChange(event: React.ChangeEvent<HTMLInputElement>) {\n        if (event?.target?.files) {\n            const file = event.target.files[0];\n            setFile(file);\n            setFileInputLabel(file.name);\n        } else {\n            setFile(null);\n        }\n    }\n\n    async function onConfirm() {\n        if (file) {\n            setInProgress(true);\n            try {\n                await dispatch(uploadContractTemplate(file));\n            } finally {\n                setInProgress(false);\n            }\n        }\n\n        onCancel();\n    }\n    function onCancel() {\n        setDialogOpen(false);\n        setFileInputLabel(\"Select an HTML template file.\");\n        setFile(null);\n    }\n\n    // When a confirm operation is in progress, a spinner is displayed; otherwise\n    // it's hidden\n    const spinner = inProgress ? (\n        <Spinner animation=\"border\" size=\"sm\" className=\"mr-1\" />\n    ) : null;\n\n    return (\n        <>\n            <ActionButton\n                icon={FaUpload}\n                onClick={() => setDialogOpen(true)}\n                disabled={disabled}\n            >\n                Upload Contract Template\n            </ActionButton>\n            <Modal\n                show={dialogOpen}\n                onHide={onCancel}\n                size=\"lg\"\n                dialogClassName=\"wide-modal\"\n            >\n                <Modal.Header closeButton>\n                    <Modal.Title>Import From File</Modal.Title>\n                </Modal.Header>\n\n                <Modal.Body>\n                    <Container>\n                        <Row className=\"mb-3\">\n                            <Col>\n                                <Form>\n                                    <Form.File\n                                        label={fileInputLabel}\n                                        onChange={_onFileChange}\n                                        custom\n                                    ></Form.File>\n                                </Form>\n                            </Col>\n                        </Row>\n                        <Row>\n                            <Col>\n                                <p>\n                                    A template is an HTML file with special\n                                    substitution strings (words surrounded by{\" \"}\n                                    {\"{{\"} and {\"}}\"}) that will be replaced\n                                    with assignment-specific values when\n                                    rendered as a contract.\n                                </p>\n                            </Col>\n                        </Row>\n                    </Container>\n                </Modal.Body>\n\n                <Modal.Footer>\n                    <Button variant=\"secondary\" onClick={onCancel}>\n                        Cancel\n                    </Button>\n                    <Button\n                        variant=\"primary\"\n                        disabled={!file}\n                        title={\n                            file\n                                ? `Upload '${fileInputLabel}' to TAPP`\n                                : \"You must select a file to upload.\"\n                        }\n                        onClick={onConfirm}\n                    >\n                        {spinner}\n                        <FaUpload className=\"mr-2\" />\n                        Upload\n                    </Button>\n                </Modal.Footer>\n            </Modal>\n        </>\n    );\n}\n","import React from \"react\";\nimport { ConnectedAddContractTemplateDialog } from \"./contract-template-dialog\";\nimport { ConnectedContractTemplateList } from \"./contract-template-list\";\nimport {\n    ActionsList,\n    ActionButton,\n    ActionHeader,\n} from \"../../components/action-buttons\";\nimport { ContentArea } from \"../../components/layout\";\nimport { FaPlus } from \"react-icons/fa\";\nimport { ConnectedUploadContractTemplateAction } from \"./upload-contract-template-button\";\nimport { useSelector } from \"react-redux\";\nimport { activeSessionSelector } from \"../../api/actions\";\nimport { MissingActiveSessionWarning } from \"../../components/sessions\";\n\nexport function AdminContractTemplatesView() {\n    const [addDialogVisible, setAddDialogVisible] = React.useState(false);\n    const activeSession = useSelector(activeSessionSelector);\n    return (\n        <div className=\"page-body\">\n            <ActionsList>\n                <ActionHeader>Available Actions</ActionHeader>\n                <ActionButton\n                    icon={<FaPlus />}\n                    onClick={() => {\n                        setAddDialogVisible(true);\n                    }}\n                    disabled={!activeSession}\n                >\n                    Add Contract Template\n                </ActionButton>\n                <ConnectedUploadContractTemplateAction\n                    disabled={!activeSession}\n                />\n            </ActionsList>\n            <ContentArea>\n                {activeSession ? null : (\n                    <MissingActiveSessionWarning extraText=\"To view or modify contract templates, you must select a session.\" />\n                )}\n                <ConnectedContractTemplateList />\n                <ConnectedAddContractTemplateDialog\n                    show={addDialogVisible}\n                    onHide={() => {\n                        setAddDialogVisible(false);\n                    }}\n                />\n            </ContentArea>\n        </div>\n    );\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Badge, Dropdown } from \"react-bootstrap\";\nimport { apiPropTypes } from \"../api/defs/prop-types\";\n\nexport function ActiveUserDisplay(props) {\n    const [dropdownVisible, setDropdownVisible] = React.useState(false);\n    const {\n        activeUser = { utorid: \"<noid>\", roles: [] },\n        activeRole,\n        setActiveUserRole,\n    } = props;\n\n    const roles = activeUser.roles;\n    const label = !activeRole ? (\n        <span className=\"text-secondary mr-2\">Select a role</span>\n    ) : (\n        <span className=\"text-primary mr-2\">{activeRole}</span>\n    );\n\n    const isActiveRole = (role) => {\n        return activeRole === role;\n    };\n    return (\n        <Badge>\n            Login: {activeUser.utorid}\n            {\" as\"}\n            <Dropdown\n                onSelect={(i) => {\n                    setActiveUserRole(roles[i]);\n                }}\n                onToggle={(desiredVisibility) =>\n                    setDropdownVisible(desiredVisibility)\n                }\n                show={dropdownVisible}\n                alignRight\n            >\n                <Dropdown.Toggle split variant=\"light\">\n                    {label}\n                </Dropdown.Toggle>\n                <Dropdown.Menu flip={true}>\n                    {(roles || []).map((role, index) => (\n                        <Dropdown.Item\n                            key={index}\n                            eventKey={\"\" + index}\n                            active={isActiveRole(role)}\n                        >\n                            {role}\n                        </Dropdown.Item>\n                    ))}\n                </Dropdown.Menu>\n            </Dropdown>\n        </Badge>\n    );\n}\nActiveUserDisplay.propTypes = {\n    activeUser: apiPropTypes.user,\n    activeRole: PropTypes.string,\n    setActiveUserRole: PropTypes.func.isRequired,\n};\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Dropdown, FormControl } from \"react-bootstrap\";\n/**\n * react-bootstrap dropdown menu that is filterable. Expects\n * children which are `Dropdown.Item` and contain just text\n * as content. To use, set as the `as=` attribute on a `Dropdown.Menu`.\n *\n * Notes: Because of the way react-bootstrap works, this\n * component must be wrapped in a `React.formwardRef`.\n */\nconst FilterableMenuContents = React.forwardRef((props, ref) => {\n    const { children, style, className, clearFilter } = props;\n    const [filter, setFilter] = React.useState(\"\");\n    // If the `clearFilter` flag is set, make sure we start\n    // with an empty filter. This is used to clear the filter when the\n    // widget is hidden.\n    React.useEffect(() => {\n        if (clearFilter) {\n            setFilter(\"\");\n        }\n    }, [clearFilter]);\n    function onChange(e) {\n        setFilter(e.currentTarget.value);\n    }\n    // Filter the child `Dropdown.Item` items\n    const sessionList = React.Children.toArray(children).filter(\n        (child) =>\n            !filter.trim() ||\n            child.props.children.toLowerCase().includes(filter.trim())\n    );\n    // The sessions list could be empty for two reasons: there are\n    // no sessions, or we've filtered them all away. Display an\n    // appropriate message in either case\n    const emptyListMessage =\n        children.length === 0\n            ? \"No Available Sessions\"\n            : \"No Matching Sessions\";\n    return (\n        <div style={style} className={className} ref={ref}>\n            <FormControl\n                autoFocus\n                className=\"mx-3 my-2 w-auto\"\n                placeholder=\"Type to filter...\"\n                title=\"Filter sessions\"\n                onChange={onChange}\n                value={filter}\n                tabIndex={0}\n            />\n            <ul className=\"list-unstyled my-0\">\n                {sessionList.length > 0 ? (\n                    sessionList\n                ) : (\n                    <li className=\"dropdown-item text-muted\">\n                        {emptyListMessage}\n                    </li>\n                )}\n            </ul>\n        </div>\n    );\n});\n/**\n * A menu that nests inside a `Dropdown`. Pass in a list\n * `items` which are objects of the form `{id: ..., name: ...}`.\n * When `onSelect` is triggered, it will be passed the index of the clicked-upon\n * item in the `items` array.\n *\n * @param {*} props\n * @returns\n */\nexport function FilterableMenu(props) {\n    const { items, activeItemId, clearFilter } = props;\n    return (\n        <Dropdown.Menu as={FilterableMenuContents} clearFilter={clearFilter}>\n            {items.map((s, index) => (\n                <Dropdown.Item\n                    key={s.id}\n                    // `eventKey` must be a string. If it is a number, 0 is coerced to null\n                    eventKey={\"\" + index}\n                    active={activeItemId === s.id}\n                >\n                    {s.name}\n                </Dropdown.Item>\n            ))}\n        </Dropdown.Menu>\n    );\n}\nFilterableMenu.propTypes = {\n    items: PropTypes.arrayOf(\n        PropTypes.shape({\n            id: PropTypes.any.isRequired,\n            name: PropTypes.string.isRequired,\n        })\n    ),\n    activeItemId: PropTypes.any,\n    clearFilter: PropTypes.bool,\n};\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { FilterableMenu } from \"./filterable-menu\";\nimport { Badge, Dropdown } from \"react-bootstrap\";\nimport { apiPropTypes } from \"../api/defs/prop-types\";\n\nexport function ActiveSessionDisplay(props) {\n    const { sessions = [], activeSession, setActiveSession } = props;\n    // keep track of the dropdown visibility so that the filter can be cleared\n    // whenever the dropdown is invisible.\n    const [dropdownVisible, setDropdownVisible] = React.useState(false);\n    const activeSessionId = activeSession ? activeSession.id : null;\n\n    let label = <span className=\"text-secondary mr-2\">Select a Session</span>;\n    if (activeSessionId != null) {\n        label = <span className=\"text-primary mr-2\">{activeSession.name}</span>;\n    }\n\n    return (\n        <Badge>\n            Selected session:\n            <Dropdown\n                onSelect={(i) => {\n                    setActiveSession(sessions[i]);\n                }}\n                onToggle={(desiredVisibility) =>\n                    setDropdownVisible(desiredVisibility)\n                }\n                show={dropdownVisible}\n            >\n                <Dropdown.Toggle split variant=\"light\">\n                    {label}\n                </Dropdown.Toggle>\n                <FilterableMenu\n                    items={sessions}\n                    activeItemId={activeSessionId}\n                    clearFilter={!dropdownVisible}\n                />\n            </Dropdown>\n        </Badge>\n    );\n}\nActiveSessionDisplay.propTypes = {\n    setActiveSession: PropTypes.func.isRequired,\n    sessions: PropTypes.arrayOf(apiPropTypes.session).isRequired,\n    activeSession: apiPropTypes.session,\n};\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n    sessionsSelector,\n    activeSessionSelector,\n    setActiveUserRole,\n    setActiveSession,\n    activeUserSelector,\n    activeRoleSelector,\n} from \"../../api/actions\";\nimport { ActiveUserDisplay } from \"../../components/active-user\";\nimport { ActiveSessionDisplay } from \"../../components/active-session\";\nimport { Session, Role } from \"../../api/defs/types\";\n\nexport function ConnectedActiveSessionDisplay() {\n    const sessions = useSelector(sessionsSelector);\n    const activeSession = useSelector(activeSessionSelector);\n    const dispatch = useDispatch();\n\n    function _setActiveSession(session: Session) {\n        return dispatch(setActiveSession(session));\n    }\n\n    return (\n        <ActiveSessionDisplay\n            sessions={sessions}\n            activeSession={activeSession}\n            setActiveSession={_setActiveSession}\n        />\n    );\n}\n\nexport function ConnectedActiveUserDisplay() {\n    const activeUser = useSelector(activeUserSelector);\n    const activeRole = useSelector(activeRoleSelector);\n    const dispatch = useDispatch();\n\n    function _setActiveUserRole(role: Role) {\n        return dispatch(setActiveUserRole(role));\n    }\n\n    return (\n        <ActiveUserDisplay\n            activeUser={activeUser}\n            activeRole={activeRole}\n            setActiveUserRole={_setActiveUserRole}\n        />\n    );\n}\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { activeSessionSelector } from \"../../api/actions\";\nimport { ConnectedActiveSessionDisplay } from \"../header\";\nimport { ContentArea } from \"../../components/layout\";\nimport { Session } from \"../../api/defs/types\";\n\nfunction ConnectedLandingView() {\n    const activeSession = useSelector(activeSessionSelector) as Session | null;\n\n    let activeSessionInfo = (\n        <>\n            There is currently <b className=\"text-primary\">no active session</b>{\" \"}\n            selected. Please select one below.\n        </>\n    );\n    if (activeSession) {\n        activeSessionInfo = (\n            <>\n                The current active session is{\" \"}\n                <b className=\"text-primary\">{activeSession.name}</b>. You may\n                select a different session below.\n            </>\n        );\n    }\n\n    return (\n        <div className=\"page-body\">\n            <ContentArea>\n                <h2>Welcome to TAPP!</h2>\n                <p>\n                    TAPP is a TA administration program designed for creating\n                    and distributing TA contracts.\n                </p>\n                <p>\n                    In order to use most features of TAPP, you need to select a{\" \"}\n                    <i>session</i>. {activeSessionInfo}\n                </p>\n                <ConnectedActiveSessionDisplay />\n            </ContentArea>\n        </div>\n    );\n}\n\nexport { ConnectedLandingView as Landing };\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { activeSessionSelector } from \"../../api/actions\";\nimport { ConnectedActiveSessionDisplay } from \"../header\";\nimport { ContentArea } from \"../../components/layout\";\nimport { Session } from \"../../api/defs/types\";\n\nfunction ConnectedLandingView() {\n    const activeSession = useSelector(activeSessionSelector) as Session | null;\n\n    let activeSessionInfo = (\n        <>\n            There is currently <b className=\"text-primary\">no active session</b>{\" \"}\n            selected. Please select one below.\n        </>\n    );\n    if (activeSession) {\n        activeSessionInfo = (\n            <>\n                The current active session is{\" \"}\n                <b className=\"text-primary\">{activeSession.name}</b>. You may\n                select a different session below.\n            </>\n        );\n    }\n\n    return (\n        <div className=\"page-body\">\n            <ContentArea>\n                <h2>Welcome to TAPP!</h2>\n                <p>\n                    TAPP is a TA administration program designed for creating\n                    and distributing TA contracts.\n                </p>\n                <p>\n                    In order to use most features of TAPP, you need to select a{\" \"}\n                    <i>session</i>. {activeSessionInfo}\n                </p>\n                <ConnectedActiveSessionDisplay />\n            </ContentArea>\n        </div>\n    );\n}\n\nexport { ConnectedLandingView as Landing };\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { createDiffColumnsFromColumns } from \"./diff-table\";\nimport { Applicant, MinimalApplicant } from \"../api/defs/types\";\nimport { DiffSpec } from \"../libs/diffUtils\";\nimport { Form } from \"react-bootstrap\";\nimport { DialogRow } from \"./forms/common-controls\";\nimport { AdvancedFilterTable } from \"./advanced-filter-table\";\n\nconst DEFAULT_COLUMNS = [\n    { Header: \"Last Name\", accessor: \"last_name\" },\n    { Header: \"First Name\", accessor: \"first_name\" },\n    { Header: \"UTORid\", accessor: \"utorid\" },\n    { Header: \"Student Number\", accessor: \"student_number\" },\n    { Header: \"Email\", accessor: \"email\" },\n    { Header: \"Phone\", accessor: \"phone\" },\n];\n\n/**\n * Display a DiffSpec array of positions and highlight the changes.\n *\n * @export\n * @param {*} { modifiedApplicants }\n * @returns\n */\nexport function ApplicantsDiffList({\n    modifiedApplicants,\n}: {\n    modifiedApplicants: DiffSpec<MinimalApplicant, Applicant>[];\n}) {\n    return (\n        <ApplicantsList\n            applicants={modifiedApplicants as any[]}\n            columns={createDiffColumnsFromColumns(DEFAULT_COLUMNS)}\n        />\n    );\n}\n\n/**\n * List the applicants using a ReactTable. `columns` can be passed\n * in to customize columns/cell renderers.\n *\n * @export\n * @param {{applicants: object[], columns: object[]}} props\n * @returns\n */\nexport function ApplicantsList(props: {\n    applicants: (Omit<Applicant, \"id\"> | Applicant)[];\n    columns?: any[];\n}) {\n    const { applicants, columns = DEFAULT_COLUMNS } = props;\n    return (\n        <AdvancedFilterTable\n            columns={columns}\n            data={applicants}\n            filterable={true}\n        />\n    );\n}\nApplicantsList.propTypes = {\n    applicants: PropTypes.array.isRequired,\n    columns: PropTypes.arrayOf(\n        PropTypes.shape({ Header: PropTypes.any.isRequired })\n    ),\n};\n\nconst DEFAULT_APPLICANT = {\n    first_name: \"\",\n    last_name: \"\",\n    email: \"\",\n    utorid: \"\",\n    phone: \"\",\n    student_number: \"\",\n};\n\n/**\n * Edit information about an applicant.\n *\n * @export\n * @param {{instructor: object, setInstructor: function}} props\n * @returns\n */\nexport function ApplicantEditor(props: {\n    applicant: Partial<Applicant>;\n    setApplicant: Function;\n}) {\n    const { applicant: applicantProps, setApplicant } = props;\n    const applicant = { ...DEFAULT_APPLICANT, ...applicantProps };\n\n    /**\n     * Create a callback function which updates the specified attribute\n     * of a position.\n     *\n     * @param {string} attr\n     * @returns\n     */\n    function setAttrFactory(attr: keyof Applicant) {\n        return (e: React.ChangeEvent<HTMLInputElement>) => {\n            const newVal = e.target.value || \"\";\n            const newApplicant = { ...applicant, [attr]: newVal };\n            setApplicant(newApplicant);\n        };\n    }\n\n    /**\n     * Create a bootstrap form component that updates the specified attr\n     * of `position`\n     *\n     * @param {string} title - Label text of the form control\n     * @param {string} attr - attribute of `position` to be updated when this form control changes\n     * @returns {node}\n     */\n    function createFieldEditor(\n        title: string,\n        attr: keyof Applicant,\n        type = \"text\"\n    ) {\n        return (\n            <React.Fragment>\n                <Form.Label>{title}</Form.Label>\n                <Form.Control\n                    type={type}\n                    value={applicant[attr] || \"\"}\n                    onChange={setAttrFactory(attr)}\n                />\n            </React.Fragment>\n        );\n    }\n\n    return (\n        <Form>\n            <Form.Row>\n                <DialogRow>\n                    {createFieldEditor(\"First Name\", \"first_name\")}\n                    {createFieldEditor(\"Last Name\", \"last_name\")}\n                </DialogRow>\n                <DialogRow>\n                    {createFieldEditor(\"Email\", \"email\")}\n                    {createFieldEditor(\"UTORid\", \"utorid\")}\n                </DialogRow>\n                <DialogRow>\n                    {createFieldEditor(\"Student Number\", \"student_number\")}\n                    {createFieldEditor(\"Phone\", \"phone\")}\n                </DialogRow>\n            </Form.Row>\n        </Form>\n    );\n}\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n    applicantsSelector,\n    assignmentsSelector,\n    deleteApplicant,\n    upsertApplicant,\n} from \"../../api/actions\";\nimport { EditableField } from \"../../components/edit-field-widgets\";\nimport type { Applicant, Assignment } from \"../../api/defs/types\";\nimport { ApplicantsList } from \"../../components/applicants\";\nimport { FaLock, FaTimes, FaTrash } from \"react-icons/fa\";\nimport { generateHeaderCell } from \"../../components/table-utils\";\nimport { Button, Modal } from \"react-bootstrap\";\n\n/**\n * A cell that renders editable applicant information\n *\n * @param {*} props\n * @returns\n */\nfunction EditableCell(props: {\n    column: any;\n    upsertApplicant: Function;\n    field: string;\n    value: string;\n    row: { original: Applicant };\n}): React.ReactElement {\n    const title = `Edit ${\"\" + props.column.Header}`;\n    const { upsertApplicant, field } = props;\n\n    async function onChange(newVal: string | number | null) {\n        const applicantId = (props.row.original || (props.row as any)._original)\n            .id;\n        return await upsertApplicant({ id: applicantId, [field]: newVal });\n    }\n    return (\n        <EditableField\n            title={title}\n            value={props.value || \"\"}\n            onChange={onChange}\n            editable={true}\n        >\n            {props.value}\n        </EditableField>\n    );\n}\n\nfunction ConfirmDeleteDialog(props: {\n    show: boolean;\n    onHide: () => void;\n    onDelete: () => void;\n    applicant: Applicant | null;\n}) {\n    const { show, onHide, onDelete, applicant } = props;\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Delete Applicant</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                Are you sure you want to delete the applicant{\" \"}\n                <span className=\"text-info font-weight-bold\">\n                    {applicant\n                        ? `${applicant.first_name} ${applicant.last_name}`\n                        : null}\n                </span>\n                ? This action cannot be undone.\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button onClick={onDelete} title=\"Delete Applicant\">\n                    Delete\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\nexport function ConnectedApplicantsList({ inDeleteMode = false }) {\n    const applicants = useSelector(applicantsSelector) as Applicant[];\n    const assignments = useSelector(assignmentsSelector) as Assignment[];\n    const [applicantToDelete, setApplicantToDelete] = React.useState(null);\n    const dispatch = useDispatch();\n\n    const assignmentsHash: { [key: string]: boolean } = {};\n    for (const assignment of assignments) {\n        assignmentsHash[assignment.applicant.id] = true;\n    }\n\n    function _upsertApplicant(applicant: Partial<Applicant>) {\n        return dispatch(upsertApplicant(applicant));\n    }\n\n    // props.original contains the row data for this particular applicant\n    function CellDeleteButton({ row }: any) {\n        const applicant = row.original || row._original;\n        const disabled = assignmentsHash[applicant.id];\n        if (disabled) {\n            return (\n                <div className=\"delete-button-container\">\n                    <FaLock\n                        className=\"delete-row-button disabled\"\n                        title=\"This applicant has an associated assignment and so cannot be deleted.\"\n                    />\n                </div>\n            );\n        }\n        return (\n            <div className=\"delete-button-container\">\n                <FaTimes\n                    className=\"delete-row-button\"\n                    title={`Delete ${applicant.last_name}, ${applicant.first_name}`}\n                    onClick={() => {\n                        setApplicantToDelete(applicant);\n                    }}\n                />\n            </div>\n        );\n    }\n\n    function generateCell(field: string) {\n        return (props: any) => (\n            <EditableCell\n                field={field}\n                upsertApplicant={_upsertApplicant}\n                {...props}\n            />\n        );\n    }\n\n    const DEFAULT_COLUMNS = [\n        {\n            Header: <FaTrash className=\"delete-row-column-header-icon\" />,\n            Cell: CellDeleteButton,\n            id: \"delete_col\",\n            className: \"delete-col\",\n            show: inDeleteMode,\n            maxWidth: 32,\n            resizable: false,\n        },\n        {\n            Header: generateHeaderCell(\"Last Name\"),\n            accessor: \"last_name\",\n            Cell: generateCell(\"last_name\"),\n        },\n        {\n            Header: generateHeaderCell(\"First Name\"),\n            accessor: \"first_name\",\n            Cell: generateCell(\"first_name\"),\n        },\n        {\n            Header: generateHeaderCell(\"Email\"),\n            accessor: \"email\",\n            Cell: generateCell(\"email\"),\n        },\n        {\n            Header: generateHeaderCell(\"UTORid\"),\n            accessor: \"utorid\",\n            Cell: generateCell(\"utorid\"),\n        },\n        {\n            Header: generateHeaderCell(\"Student Number\"),\n            accessor: \"student_number\",\n            Cell: generateCell(\"student_number\"),\n        },\n        {\n            Header: generateHeaderCell(\"Phone\"),\n            accessor: \"phone\",\n            Cell: generateCell(\"phone\"),\n        },\n    ];\n\n    return (\n        <React.Fragment>\n            <ApplicantsList applicants={applicants} columns={DEFAULT_COLUMNS} />\n            <ConfirmDeleteDialog\n                applicant={applicantToDelete}\n                show={!!applicantToDelete}\n                onHide={() => setApplicantToDelete(null)}\n                onDelete={async () => {\n                    await dispatch(deleteApplicant(applicantToDelete));\n                    setApplicantToDelete(null);\n                }}\n            />\n        </React.Fragment>\n    );\n}\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Modal, Button, Alert, Spinner } from \"react-bootstrap\";\nimport { applicantsSelector, upsertApplicant } from \"../../api/actions\";\nimport { strip } from \"../../libs/utils\";\nimport { Applicant } from \"../../api/defs/types\";\nimport { ApplicantEditor } from \"../../components/applicants\";\n\nconst BLANK_APPLICANT = {\n    first_name: \"\",\n    last_name: \"\",\n    email: \"\",\n    utorid: \"\",\n    phone: \"\",\n    student_number: \"\",\n};\n\n/**\n * Find if there is a conflicting instructor in the passed in list\n * of instructors, or if any required fields are incorrect.\n *\n * @param {object} applicant\n * @param {object[]} applicants\n */\nfunction getConflicts(applicant: Partial<Applicant>, applicants: Applicant[]) {\n    const ret: {\n        delayShow: string;\n        immediateShow: React.ReactNode;\n    } = { delayShow: \"\", immediateShow: \"\" };\n    if (\n        !strip(applicant.utorid || \"\") ||\n        !strip(applicant.first_name || \"\") ||\n        !strip(applicant.last_name || \"\")\n    ) {\n        ret.delayShow = \"A first name, last name, and utorid is required\";\n    }\n    const matchingApplicant = applicants.find(\n        (x) => strip(x.utorid) === strip(applicant.utorid || \"\")\n    );\n    if (matchingApplicant) {\n        ret.immediateShow = (\n            <p>\n                Another applicant exists with utorid={applicant.utorid}:{\" \"}\n                <b>\n                    {matchingApplicant.first_name} {matchingApplicant.last_name}\n                </b>\n            </p>\n        );\n    }\n    return ret;\n}\n\nexport function ConnectedAddApplicantDialog(props: {\n    show: boolean;\n    onHide?: (...args: any) => any;\n}) {\n    const { show, onHide = () => {} } = props;\n    const [newApplicant, setNewApplicant] = React.useState<Partial<Applicant>>(\n        BLANK_APPLICANT\n    );\n    const [inProgress, setInProgress] = React.useState(false);\n\n    const applicants = useSelector(applicantsSelector) as Applicant[];\n    const dispatch = useDispatch();\n\n    function _upsertApplicant(applicant: Partial<Applicant>) {\n        return dispatch(upsertApplicant(applicant));\n    }\n\n    React.useEffect(() => {\n        if (!show) {\n            // If the dialog is hidden, reset the state\n            setNewApplicant(BLANK_APPLICANT);\n        }\n    }, [show]);\n\n    async function createInstructor() {\n        setInProgress(true);\n        await _upsertApplicant(newApplicant);\n        setInProgress(false);\n        onHide();\n    }\n\n    // When a confirm operation is in progress, a spinner is displayed; otherwise\n    // it's hidden\n    const spinner = inProgress ? (\n        <Spinner animation=\"border\" size=\"sm\" className=\"mr-1\" />\n    ) : null;\n\n    const conflicts = getConflicts(newApplicant, applicants);\n\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Add Applicant</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <ApplicantEditor\n                    applicant={newApplicant}\n                    setApplicant={setNewApplicant}\n                />\n                {conflicts.immediateShow ? (\n                    <Alert variant=\"danger\">{conflicts.immediateShow}</Alert>\n                ) : null}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button\n                    onClick={createInstructor}\n                    title={conflicts.delayShow || \"Create Instructor\"}\n                    disabled={\n                        !!conflicts.delayShow || !!conflicts.immediateShow\n                    }\n                >\n                    {spinner}Create Applicant\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n","import React from \"react\";\nimport FileSaver from \"file-saver\";\nimport {\n    exportApplicants,\n    applicantsSelector,\n    upsertApplicants,\n} from \"../../api/actions\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ExportActionButton } from \"../../components/export-button\";\nimport { ImportActionButton } from \"../../components/import-button\";\nimport { Alert } from \"react-bootstrap\";\nimport { normalizeImport, dataToFile } from \"../../libs/importExportUtils\";\nimport { prepareMinimal } from \"../../libs/exportUtils\";\nimport { diffImport, getChanged, DiffSpec } from \"../../libs/diffUtils\";\nimport { Applicant, MinimalApplicant } from \"../../api/defs/types\";\nimport {\n    ApplicantsList,\n    ApplicantsDiffList,\n} from \"../../components/applicants\";\n\n/**\n * Allows for the download of a file blob containing the exported instructors.\n * Instructors are synchronized from the server before being downloaded.\n *\n * @export\n * @returns\n */\nexport function ConnectedExportApplicantsAction() {\n    const dispatch = useDispatch();\n    const [exportType, setExportType] = React.useState<\n        \"spreadsheet\" | \"json\" | null\n    >(null);\n\n    React.useEffect(() => {\n        if (!exportType) {\n            return;\n        }\n\n        async function doExport() {\n            // Having an export type of `null` means we're ready to export again,\n            // We set the export type to null at the start so in case an error occurs,\n            // we can still try again. This *will not* affect the current value of `exportType`\n            setExportType(null);\n\n            // Make a function that converts a list of instructors into a `File` object.\n            function prepareData(\n                applicants: Applicant[],\n                dataFormat: \"csv\" | \"json\" | \"xlsx\"\n            ) {\n                return dataToFile(\n                    {\n                        toSpreadsheet: () =>\n                            [\n                                [\n                                    \"Last Name\",\n                                    \"First Name\",\n                                    \"UTORid\",\n                                    \"Student Number\",\n                                    \"email\",\n                                    \"Phone\",\n                                ],\n                            ].concat(\n                                applicants.map((applicant) => [\n                                    applicant.last_name,\n                                    applicant.first_name,\n                                    applicant.utorid,\n                                    applicant.student_number,\n                                    applicant.email,\n                                    applicant.phone,\n                                ])\n                            ),\n                        toJson: () => ({\n                            applicants: applicants.map((applicant) =>\n                                prepareMinimal.applicant(applicant)\n                            ),\n                        }),\n                    },\n                    dataFormat,\n                    \"applicants\"\n                );\n            }\n\n            const file = await dispatch(\n                exportApplicants(prepareData, exportType)\n            );\n\n            FileSaver.saveAs(file);\n        }\n        doExport().catch(console.error);\n    }, [exportType, dispatch]);\n\n    function onClick(option: \"spreadsheet\" | \"json\") {\n        setExportType(option);\n    }\n\n    return <ExportActionButton onClick={onClick} />;\n}\n\nconst applicantSchema = {\n    keys: [\n        \"first_name\",\n        \"last_name\",\n        \"utorid\",\n        \"email\",\n        \"student_number\",\n        \"phone\",\n    ],\n    keyMap: {\n        \"First Name\": \"first_name\",\n        \"Given Name\": \"first_name\",\n        First: \"first_name\",\n        \"Last Name\": \"last_name\",\n        Surname: \"last_name\",\n        \"Family Name\": \"last_name\",\n        Last: \"last_name\",\n        \"Student Number\": \"student_number\",\n    },\n    requiredKeys: [\"utorid\"],\n    primaryKey: \"utorid\",\n    dateColumns: [],\n    baseName: \"applicants\",\n};\n\nexport function ConnectedImportInstructorAction() {\n    const dispatch = useDispatch();\n    const applicants = useSelector(applicantsSelector);\n    const [fileContent, setFileContent] = React.useState<{\n        fileType: \"json\" | \"spreadsheet\";\n        data: any;\n    } | null>(null);\n    const [diffed, setDiffed] = React.useState<\n        DiffSpec<MinimalApplicant, Applicant>[] | null\n    >(null);\n    const [processingError, setProcessingError] = React.useState(null);\n    const [inProgress, setInProgress] = React.useState(false);\n\n    // Make sure we aren't showing any diff if there's no file loaded.\n    React.useEffect(() => {\n        if (!fileContent) {\n            if (diffed) {\n                setDiffed(null);\n            }\n        }\n    }, [diffed, setDiffed, fileContent]);\n\n    // Recompute the diff every time the file changes\n    React.useEffect(() => {\n        // If we have no file or we are currently in the middle of processing another file,\n        // do nothing.\n        if (!fileContent || inProgress) {\n            return;\n        }\n        try {\n            setProcessingError(null);\n            // normalize the data coming from the file\n            const data = normalizeImport(\n                fileContent,\n                applicantSchema\n            ) as MinimalApplicant[];\n            // Compute which applicants have been added/modified\n            const newDiff = diffImport.applicants(data, { applicants });\n\n            setDiffed(newDiff);\n        } catch (e) {\n            console.warn(e);\n            setProcessingError(e);\n        }\n    }, [fileContent, applicants, inProgress]);\n\n    async function onConfirm() {\n        if (!diffed) {\n            throw new Error(\"Unable to compute an appropriate diff\");\n        }\n        const changedApplicants = getChanged(diffed);\n\n        await dispatch(upsertApplicants(changedApplicants));\n\n        setFileContent(null);\n    }\n\n    let dialogContent = <p>No data loaded...</p>;\n    if (processingError) {\n        dialogContent = <Alert variant=\"danger\">{\"\" + processingError}</Alert>;\n    } else if (diffed) {\n        const newItems = diffed\n            .filter((item) => item.status === \"new\")\n            .map((item) => item.obj);\n        const modifiedDiffSpec = diffed.filter(\n            (item) => item.status === \"modified\"\n        );\n\n        if (newItems.length === 0 && modifiedDiffSpec.length === 0) {\n            dialogContent = (\n                <Alert variant=\"warning\">\n                    No difference between imported applicants and those already\n                    on the system.\n                </Alert>\n            );\n        } else {\n            dialogContent = (\n                <>\n                    {newItems.length > 0 && (\n                        <Alert variant=\"primary\">\n                            <span className=\"mb-1\">\n                                The following <strong>{newItems.length}</strong>{\" \"}\n                                applicant{newItems.length > 1 ? \"s\" : \"\"} will\n                                be <strong>added</strong>\n                            </span>\n                            <ApplicantsList applicants={newItems} />\n                        </Alert>\n                    )}\n                    {modifiedDiffSpec.length > 0 && (\n                        <Alert variant=\"info\">\n                            <span className=\"mb-1\">\n                                The following instructors will be{\" \"}\n                                <strong>modified</strong>\n                            </span>\n                            <ApplicantsDiffList\n                                modifiedApplicants={modifiedDiffSpec}\n                            />\n                        </Alert>\n                    )}\n                </>\n            );\n        }\n    }\n\n    return (\n        <ImportActionButton\n            onConfirm={onConfirm}\n            onFileChange={setFileContent}\n            dialogContent={dialogContent}\n            setInProgress={setInProgress}\n        />\n    );\n}\n","import React from \"react\";\nimport { ConnectedApplicantsList } from \"./editable-applicants-list\";\nimport { ConnectedAddApplicantDialog } from \"./add-applicant-dialog\";\nimport { FaTrash, FaPlus } from \"react-icons/fa\";\nimport {\n    ConnectedImportInstructorAction,\n    ConnectedExportApplicantsAction,\n} from \"./import-export\";\nimport {\n    ActionsList,\n    ActionButton,\n    ActionHeader,\n} from \"../../components/action-buttons\";\nimport { ContentArea } from \"../../components/layout\";\n\nexport function AdminApplicantsView(): React.ReactNode {\n    const [addDialogVisible, setAddDialogVisible] = React.useState(false);\n    const [inDeleteMode, setInDeleteMode] = React.useState(false);\n    return (\n        <div className=\"page-body\">\n            <ActionsList>\n                <ActionHeader>Available Actions</ActionHeader>\n                <ActionButton\n                    icon={<FaPlus />}\n                    onClick={() => {\n                        setAddDialogVisible(true);\n                    }}\n                >\n                    Add Applicant\n                </ActionButton>\n                <ActionButton\n                    icon={<FaTrash />}\n                    onClick={() => setInDeleteMode(!inDeleteMode)}\n                    active={inDeleteMode}\n                >\n                    Delete Applicant\n                </ActionButton>\n\n                <ActionHeader>Import/Export</ActionHeader>\n                <ConnectedImportInstructorAction />\n                <ConnectedExportApplicantsAction />\n            </ActionsList>\n            <ContentArea>\n                <ConnectedAddApplicantDialog\n                    show={addDialogVisible}\n                    onHide={() => {\n                        setAddDialogVisible(false);\n                    }}\n                />\n                <ConnectedApplicantsList inDeleteMode={inDeleteMode} />\n            </ContentArea>\n        </div>\n    );\n}\n","import React from \"react\";\nimport { createDiffColumnsFromColumns } from \"./diff-table\";\nimport { MinimalDdah, Ddah, Assignment, Duty } from \"../api/defs/types\";\nimport { DiffSpec, ddahDutiesToString } from \"../libs/diffUtils\";\nimport { Form, Button } from \"react-bootstrap\";\nimport { DialogRow } from \"./forms/common-controls\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport { FaPlus, FaTrash } from \"react-icons/fa\";\nimport { stringToNativeType } from \"../libs/urlUtils\";\nimport { AdvancedFilterTable } from \"./advanced-filter-table\";\n\nconst DEFAULT_COLUMNS = [\n    {\n        Header: \"Position\",\n        accessor: \"assignment.position.position_code\",\n        maxWidth: 120,\n    },\n    {\n        Header: \"Last Name\",\n        accessor: \"assignment.applicant.last_name\",\n        maxWidth: 120,\n    },\n    {\n        Header: \"First Name\",\n        accessor: \"assignment.applicant.first_name\",\n        maxWidth: 120,\n    },\n    {\n        Header: \"Total Hours\",\n        accessor: \"total_hours\",\n        maxWidth: 100,\n        className: \"number-cell\",\n    },\n    { Header: \"Duties\", accessor: \"duties\" },\n];\n\n/**\n * Display a DiffSpec array of positions and highlight the changes.\n *\n * @export\n * @param {*} { modifiedApplicants }\n * @returns\n */\nexport function DdahsDiffList({\n    modifiedDdahs,\n}: {\n    modifiedDdahs: DiffSpec<MinimalDdah, Ddah>[];\n}) {\n    // We want to flatten the `Duties` list in case it is displayed,\n    // it needs to be a string.\n    modifiedDdahs = modifiedDdahs.map((modifiedDdah) => {\n        if (\n            modifiedDdah.obj.duties == null ||\n            typeof modifiedDdah.obj.duties === \"string\"\n        ) {\n            return modifiedDdah;\n        }\n        return {\n            ...modifiedDdah,\n            obj: {\n                ...modifiedDdah.obj,\n                // Lie to typescript. This is a string, but we don't really want to mess with the types\n                duties: ddahDutiesToString(modifiedDdah.obj.duties) as any,\n            },\n        };\n    });\n\n    return (\n        <DdahsList\n            ddahs={modifiedDdahs as any[]}\n            columns={createDiffColumnsFromColumns(DEFAULT_COLUMNS)}\n        />\n    );\n}\n\nexport function DdahsList(props: {\n    ddahs: (Omit<Ddah, \"id\"> | Ddah)[];\n    columns?: any[];\n}) {\n    const { ddahs, columns = DEFAULT_COLUMNS } = props;\n\n    // we want to display the duties as a single string,\n    // so flatten any duties that are not already a string before rendering\n    const flattenedDdahs = ddahs.map((ddah) => {\n        // If `ddah.duties` is null, it means that we're not actually passing\n        // in a Ddah type. In this case, leave it alone. If `ddah.duties` is already\n        // a string, it has been converted by something else to a string already.\n        if (ddah.duties == null || typeof ddah.duties === \"string\") {\n            return ddah;\n        }\n        return { ...ddah, duties: ddahDutiesToString(ddah.duties) };\n    });\n\n    return <AdvancedFilterTable data={flattenedDdahs} columns={columns} />;\n}\n\nconst DEFAULT_DDAH = {\n    assignment: null,\n    duties: [] as Duty[],\n};\n\ninterface PartialDdah {\n    assignment: Assignment | null;\n    duties: Duty[];\n}\n\n/**\n * Edit information about an applicant.\n *\n * @export\n * @param {{instructor: object, setInstructor: function}} props\n * @returns\n */\nexport function DdahEditor(props: {\n    ddah: PartialDdah;\n    setDdah: Function;\n    assignments?: Assignment[];\n    editableAssignment?: Boolean;\n}) {\n    const {\n        ddah: ddahProps,\n        setDdah,\n        assignments = [],\n        editableAssignment = true,\n    } = props;\n    const ddah = { ...DEFAULT_DDAH, ...ddahProps };\n\n    // If the assignment is editable, we have a selector for the assignments,\n    // otherwise it is rendered as fixed text.\n    let assignmentNode: React.ReactNode = ddah.assignment\n        ? ` ${ddah.assignment.position.position_code} for ${ddah.assignment.applicant.last_name}, ${ddah.assignment.applicant.first_name}`\n        : \"No Assignment\";\n    if (editableAssignment) {\n        assignmentNode = (\n            <Typeahead\n                id=\"position-input\"\n                ignoreDiacritics={true}\n                placeholder=\"Assignment...\"\n                multiple\n                labelKey={(option: Assignment) =>\n                    `${option.position.position_code} for ${option.applicant.last_name}, ${option.applicant.first_name}`\n                }\n                selected={ddah.assignment == null ? [] : [ddah.assignment]}\n                options={assignments}\n                onChange={setAssignment}\n            />\n        );\n    }\n\n    // Make a copy of the duties so that we can sort it without mutating the prop\n    const duties = [...ddah.duties];\n    duties.sort((a, b) => a.order - b.order);\n    const nextOrder = Math.max(...duties.map((x) => x.order), 0) + 1;\n    let totalHours = 0;\n    for (const duty of duties) {\n        totalHours += duty.hours;\n    }\n    const hoursMismatch = ddah.assignment\n        ? ddah.assignment.hours !== totalHours\n        : false;\n\n    function setAssignment(assignments: Assignment[]) {\n        const assignment = assignments[assignments.length - 1] || null;\n        setDdah({ ...ddah, assignment });\n    }\n\n    function upsertDuty(duty: Duty) {\n        let newDuties = duties.filter((x) => x.order !== duty.order);\n        newDuties.push(duty);\n        setDdah({ ...ddah, duties: newDuties });\n    }\n\n    function removeDuty(duty: Duty) {\n        let newDuties = duties.filter((x) => x.order !== duty.order);\n        setDdah({ ...ddah, duties: newDuties });\n    }\n\n    return (\n        <Form>\n            <DialogRow>\n                <React.Fragment>\n                    <Form.Label>Assignment</Form.Label>\n                    {assignmentNode}\n                </React.Fragment>\n            </DialogRow>\n            <h4>Duties</h4>\n            {duties.map((duty) => (\n                <DialogRow\n                    key={duty.order}\n                    icon={\n                        <Button\n                            title=\"Remove duty\"\n                            onClick={() => removeDuty(duty)}\n                            variant=\"outline-info\"\n                        >\n                            <FaTrash />\n                        </Button>\n                    }\n                >\n                    <>\n                        <Form.Label>Hours</Form.Label>\n                        <Form.Control\n                            type=\"number\"\n                            value={duty.hours}\n                            onChange={(\n                                e: React.ChangeEvent<HTMLInputElement>\n                            ) =>\n                                upsertDuty({\n                                    ...duty,\n                                    hours: stringToNativeType(\n                                        e.target.value\n                                    ) as any,\n                                })\n                            }\n                        />\n                    </>\n                    <>\n                        <Form.Label>Description</Form.Label>\n                        <Form.Control\n                            title=\"Enter a description of what these hours are allocated for\"\n                            type=\"input\"\n                            value={duty.description}\n                            onChange={(\n                                e: React.ChangeEvent<HTMLInputElement>\n                            ) =>\n                                upsertDuty({\n                                    ...duty,\n                                    description: e.target.value,\n                                })\n                            }\n                        />\n                    </>\n                </DialogRow>\n            ))}\n            <DialogRow>\n                <Button\n                    variant=\"outline-info\"\n                    onClick={() =>\n                        upsertDuty({\n                            description: \"\",\n                            hours: 0,\n                            order: nextOrder,\n                        })\n                    }\n                >\n                    <FaPlus className=\"add-duty-btn-icon\" />\n                    Add Duty\n                </Button>\n            </DialogRow>\n            <DialogRow>\n                <>\n                    <span\n                        className={\n                            hoursMismatch ? \"add-ddah-hours-mismatch\" : \"\"\n                        }\n                    >\n                        {totalHours}\n                    </span>{\" \"}\n                    of {ddah.assignment ? ddah.assignment.hours : \"?\"} hours\n                    allocated{\" \"}\n                    {hoursMismatch\n                        ? `(${\n                              (ddah.assignment?.hours || 0) - totalHours\n                          } unassigned)`\n                        : \"\"}\n                </>\n            </DialogRow>\n        </Form>\n    );\n}\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Modal, Button, Alert, Spinner } from \"react-bootstrap\";\nimport { Duty, Assignment, Ddah } from \"../../api/defs/types\";\nimport { upsertDdah, ddahsSelector } from \"../../api/actions/ddahs\";\nimport { DdahEditor } from \"../../components/ddahs\";\nimport { assignmentsSelector } from \"../../api/actions\";\n\ninterface PartialDdah {\n    assignment: Assignment | null;\n    duties: Duty[];\n}\n\nconst BLANK_DDAH: PartialDdah = {\n    assignment: null,\n    duties: [],\n};\n\n/**\n * Find if there is a conflicting instructor in the passed in list\n * of instructors, or if any required fields are incorrect.\n *\n * @param {object} applicant\n * @param {object[]} ddahs\n */\nfunction getConflicts(ddah: PartialDdah, ddahs: Ddah[]) {\n    const ret: {\n        delayShow: string;\n        immediateShow: React.ReactNode;\n    } = { delayShow: \"\", immediateShow: \"\" };\n    if (ddah.duties.length === 0) {\n        ret.delayShow = \"A DDAH must have at least one duty\";\n    }\n    if (ddah.assignment == null) {\n        ret.delayShow = \"A DDAH can only be created for an existing assignment\";\n        return ret;\n    }\n\n    const matchingDdah = ddahs.find(\n        (x) => x.assignment.id === (ddah.assignment || {}).id\n    );\n    if (matchingDdah) {\n        ret.immediateShow = (\n            <p>\n                Another DDAH exists for assignment=\n                {ddah.assignment.position.position_code}:{\" \"}\n                <b>\n                    {matchingDdah.assignment.applicant.first_name}{\" \"}\n                    {matchingDdah.assignment.applicant.last_name}\n                </b>\n            </p>\n        );\n    }\n    return ret;\n}\n\nexport function ConnectedAddDdahDialog(props: {\n    show: boolean;\n    onHide?: (...args: any) => any;\n}) {\n    const { show, onHide = () => {} } = props;\n    const [newDdah, setNewDdah] = React.useState<PartialDdah>(BLANK_DDAH);\n    const [inProgress, setInProgress] = React.useState(false);\n\n    const ddahs = useSelector(ddahsSelector) as Ddah[];\n    const dispatch = useDispatch();\n    const assignmentsWithDdahHash = {} as { [key: string]: boolean };\n    for (const ddah of ddahs) {\n        assignmentsWithDdahHash[ddah.assignment.id] = true;\n    }\n    const assignmentsWithoutDdah = useSelector<any, Assignment[]>(\n        assignmentsSelector\n    ).filter((x) => !assignmentsWithDdahHash[x.id]);\n\n    function _upsertDdah(ddah: PartialDdah) {\n        if (ddah.assignment == null) {\n            console.warn(\n                \"Trying to upsert a DDAH with a null assignment reference\"\n            );\n            return;\n        }\n        const newDdah = {\n            assignment_id: ddah.assignment.id,\n            duties: ddah.duties,\n        };\n        return dispatch(upsertDdah(newDdah));\n    }\n\n    React.useEffect(() => {\n        if (!show) {\n            // If the dialog is hidden, reset the state\n            setNewDdah(BLANK_DDAH);\n        }\n    }, [show]);\n\n    async function createDdah() {\n        setInProgress(true);\n        await _upsertDdah(newDdah);\n        setInProgress(false);\n        onHide();\n    }\n\n    // When a confirm operation is in progress, a spinner is displayed; otherwise\n    // it's hidden\n    const spinner = inProgress ? (\n        <Spinner animation=\"border\" size=\"sm\" className=\"mr-1\" />\n    ) : null;\n\n    const conflicts = getConflicts(newDdah, ddahs);\n\n    return (\n        <Modal show={show} onHide={onHide}>\n            <Modal.Header closeButton>\n                <Modal.Title>Add DDAH</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <DdahEditor\n                    ddah={newDdah}\n                    setDdah={setNewDdah}\n                    assignments={assignmentsWithoutDdah}\n                />\n                {!inProgress && conflicts.immediateShow ? (\n                    <Alert variant=\"danger\">{conflicts.immediateShow}</Alert>\n                ) : null}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={onHide} variant=\"light\">\n                    Cancel\n                </Button>\n                <Button\n                    onClick={createDdah}\n                    title={conflicts.delayShow || \"Create Instructor\"}\n                    disabled={\n                        !!conflicts.delayShow || !!conflicts.immediateShow\n                    }\n                >\n                    {spinner}Create DDAH\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n","import { SET_SELECTED_DDAH_TABLE_ROWS } from \"./constants\";\nimport { DdahsTableType } from \"./reducers\";\n\n// actions\nexport const setSelectedRows = (data: number[]) => ({\n    type: SET_SELECTED_DDAH_TABLE_ROWS,\n    payload: data,\n});\n\n// selectors\nexport const ddahTableSelector = (state: any) =>\n    state.ui.ddahsTable as DdahsTableType;\n","import React from \"react\";\nimport FileSaver from \"file-saver\";\nimport JSZip from \"jszip\";\nimport XLSX from \"xlsx\";\nimport { applicantsSelector, assignmentsSelector } from \"../../api/actions\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ExportActionButton } from \"../../components/export-button\";\nimport { ImportActionButton } from \"../../components/import-button\";\nimport { Alert } from \"react-bootstrap\";\nimport {\n    dataToFile,\n    SpreadsheetRowMapper,\n    matchByUtoridOrName,\n} from \"../../libs/importExportUtils\";\nimport { prepareMinimal } from \"../../libs/exportUtils\";\nimport { diffImport, getChanged, DiffSpec } from \"../../libs/diffUtils\";\nimport { Applicant, Ddah, MinimalDdah, Assignment } from \"../../api/defs/types\";\nimport {\n    exportDdahs,\n    ddahsSelector,\n    upsertDdahs,\n    downloadDdahAcceptedList,\n} from \"../../api/actions/ddahs\";\nimport { DdahsList, DdahsDiffList } from \"../../components/ddahs\";\nimport { ddahTableSelector } from \"../ddah-table/actions\";\nimport { ActionButton } from \"../../components/action-buttons\";\nimport { FaDownload } from \"react-icons/fa\";\n\n/**\n * Return an array of [hours, duty, hours duty, ...] for the specified `ddah`\n *\n * @param {Ddah} ddah\n * @returns {((string | number)[])}\n */\nfunction flattenDuties(ddah: Ddah): (string | number)[] {\n    const ret = [];\n    const duties = [...ddah.duties];\n    duties.sort((a, b) => a.order - b.order);\n\n    for (const duty of duties) {\n        ret.push(duty.hours);\n        ret.push(duty.description);\n    }\n\n    return ret;\n}\n\n/**\n * Turns an array of Ddah objects into an Array of Arrays suitable\n * for converting into a spreadsheet.\n *\n * @export\n * @param {Ddah[]} ddahs\n * @returns {((string | number)[][])}\n */\nexport function prepareDdahsSpreadsheet(ddahs: Ddah[]): (string | number)[][] {\n    // Compute the maximum number of duties, because each duty gets a column.\n    const maxDuties = Math.max(\n        ...ddahs.map((ddah) => ddah.duties.length || 0),\n        0\n    );\n    // Create headers for the duty columns\n    const dutyHeaders = Array.from({ length: maxDuties * 2 }, (_, i) => {\n        if (i % 2 === 0) {\n            return `Hours ${i / 2 + 1}`;\n        }\n        return `Duty ${(i - 1) / 2 + 1}`;\n    });\n\n    return [\n        [\n            \"Position\",\n            \"Last Name\",\n            \"First Name\",\n            \"email\",\n            \"Assignment Hours\",\n            \"Offer Status\",\n            \"\",\n        ].concat(dutyHeaders),\n    ].concat(\n        ddahs.map((ddah) =>\n            [\n                ddah.assignment.position.position_code,\n                ddah.assignment.applicant.last_name,\n                ddah.assignment.applicant.first_name,\n                ddah.assignment.applicant.email,\n                ddah.assignment.hours,\n                ddah.assignment.active_offer_status,\n                \"\",\n            ].concat(flattenDuties(ddah))\n        ) as any[][]\n    );\n}\n\n/**\n * Allows for the download of a file blob containing the exported instructors.\n * Instructors are synchronized from the server before being downloaded.\n *\n * @export\n * @returns\n */\nexport function ConnectedExportDdahsAction({ disabled = false }) {\n    const dispatch = useDispatch();\n    const [exportType, setExportType] = React.useState<\n        \"spreadsheet\" | \"json\" | null\n    >(null);\n\n    const { selectedDdahIds } = useSelector<any, { selectedDdahIds: Number[] }>(\n        ddahTableSelector\n    );\n\n    React.useEffect(() => {\n        if (!exportType) {\n            return;\n        }\n\n        async function doExport() {\n            // Having an export type of `null` means we're ready to export again,\n            // We set the export type to null at the start so in case an error occurs,\n            // we can still try again. This *will not* affect the current value of `exportType`\n            setExportType(null);\n\n            // Make a function that converts a list of instructors into a `File` object.\n            function prepareData(\n                ddahs: Ddah[],\n                dataFormat: \"csv\" | \"json\" | \"xlsx\"\n            ) {\n                // If we have selected specific DDAHs, filter so we only export them.\n                if (selectedDdahIds && selectedDdahIds.length > 0) {\n                    ddahs = ddahs.filter((d) => selectedDdahIds.includes(d.id));\n                }\n\n                return dataToFile(\n                    {\n                        toSpreadsheet: () => prepareDdahsSpreadsheet(ddahs),\n                        toJson: () => ({\n                            ddahs: ddahs.map((ddah) =>\n                                prepareMinimal.ddah(ddah)\n                            ),\n                        }),\n                    },\n                    dataFormat,\n                    \"ddahs\"\n                );\n            }\n\n            const file = await dispatch(exportDdahs(prepareData, exportType));\n            FileSaver.saveAs(file);\n        }\n        doExport().catch(console.error);\n    }, [exportType, dispatch, selectedDdahIds]);\n\n    function onClick(option: \"spreadsheet\" | \"json\") {\n        setExportType(option);\n    }\n\n    return <ExportActionButton onClick={onClick} disabled={disabled} />;\n}\n\n/**\n * Convert imported spreadsheet or JSON data into an\n * array of minimal DDAH objects.\n *\n * @param {({\n *     fileType: \"json\" | \"spreadsheet\";\n *     data: any;\n * })} data\n * @param {Applicant[]} applicants\n * @returns {MinimalDdah[]}\n */\nfunction normalizeDdahImports(\n    data: {\n        fileType: \"json\" | \"spreadsheet\";\n        data: any;\n    },\n    applicants: Applicant[]\n): MinimalDdah[] {\n    let ret: MinimalDdah[] = [];\n\n    if (data.fileType === \"json\") {\n        let unwrapped: MinimalDdah[] = data.data;\n        if ((unwrapped as any).ddahs) {\n            unwrapped = (unwrapped as any).ddahs;\n        }\n        for (const ddah of unwrapped) {\n            ret.push(ddah);\n        }\n    }\n\n    if (data.fileType === \"spreadsheet\") {\n        const unwrapped = data.data;\n        // Get an upper bound for the maximum number of duties that the spreadsheet might have\n        const maxDuties = Math.round(\n            Math.max(\n                ...unwrapped.map((row: object) => Object.keys(row).length),\n                0\n            ) / 2\n        );\n\n        // We need to generate a keymap for all the likely column names\n        const keyMap: { [key: string]: string } = {\n            Position: \"position_code\",\n            \"First Name\": \"first_name\",\n            \"Given Name\": \"first_name\",\n            First: \"first_name\",\n            \"Last Name\": \"last_name\",\n            Surname: \"last_name\",\n            \"Family Name\": \"last_name\",\n            Last: \"last_name\",\n        };\n        // We will also add `Hours #` and `Duty #` to the keymap for the number of duties in our range\n        for (let i = 0; i <= maxDuties; i++) {\n            keyMap[`Duty ${i}`] = `duty_${i}`;\n            keyMap[`Hours ${i}`] = `hours_${i}`;\n            if (i < 10) {\n                keyMap[`Duty 0${i}`] = `duty_${i}`;\n                keyMap[`Hours 0${i}`] = `hours_${i}`;\n            }\n        }\n\n        // SpreadsheetRowMapper will perform fuzzy matching of column names for us.\n        const rowMapper = new SpreadsheetRowMapper({\n            keys: [\"position_code\", \"first_name\", \"last_name\", \"utorid\"],\n            keyMap,\n        });\n\n        for (const row of unwrapped) {\n            const normalized: {\n                [key: string]: any;\n            } = rowMapper.formatRow(row);\n            if (normalized.utorid == null) {\n                // If a UTORid column was not specified, we need to manually search the applicants for\n                // someone matching the first/last name. `matchByUtoridOrName` will succeed or throw an error,\n                // so if we make it past this line of code, we've successfully found a match.\n                const applicant = matchByUtoridOrName(\n                    `${normalized.first_name} ${normalized.last_name}`,\n                    applicants\n                ) as Applicant;\n                normalized.utorid = applicant.utorid;\n                delete normalized.first_name;\n                delete normalized.last_name;\n            }\n            // Now we need to condense duties to a list\n            // The easiest way is to just hunt for them\n            const duties: { description: string; hours: number }[] = [];\n            for (let i = 0; i <= maxDuties; i++) {\n                const duty = normalized[`duty_${i}`];\n                const hours = normalized[`hours_${i}`];\n                if (duty != null || hours != null) {\n                    duties.push({ description: duty || \"\", hours: hours || 0 });\n                    delete normalized[`duty_${i}`];\n                    delete normalized[`hours_${i}`];\n                }\n            }\n            ret.push({\n                position_code: normalized.position_code,\n                applicant: normalized.utorid,\n                duties,\n            });\n        }\n    }\n\n    return ret;\n}\n\nexport function ConnectedImportDdahsAction({\n    disabled = false,\n    setImportInProgress = null,\n}: {\n    disabled: boolean;\n    setImportInProgress?: Function | null;\n}) {\n    const dispatch = useDispatch();\n    const ddahs = useSelector<any, Ddah[]>(ddahsSelector);\n    const assignments = useSelector<any, Assignment[]>(assignmentsSelector);\n    const applicants = useSelector<any, Applicant[]>(applicantsSelector);\n    const [fileContent, setFileContent] = React.useState<{\n        fileType: \"json\" | \"spreadsheet\";\n        data: any;\n    } | null>(null);\n    const [diffed, setDiffed] = React.useState<\n        DiffSpec<MinimalDdah, Ddah>[] | null\n    >(null);\n    const [processingError, setProcessingError] = React.useState(null);\n    const [inProgress, _setInProgress] = React.useState(false);\n\n    function setInProgress(state: boolean) {\n        _setInProgress(state);\n        if (typeof setImportInProgress === \"function\") {\n            setImportInProgress(state);\n        }\n    }\n\n    // Make sure we aren't showing any diff if there's no file loaded.\n    React.useEffect(() => {\n        if (!fileContent) {\n            if (diffed) {\n                setDiffed(null);\n            }\n        }\n    }, [diffed, setDiffed, fileContent]);\n\n    // Recompute the diff every time the file changes\n    React.useEffect(() => {\n        // If we have no file or we are currently in the middle of processing another file,\n        // do nothing.\n        if (!fileContent || inProgress) {\n            return;\n        }\n        try {\n            setProcessingError(null);\n            // normalize the data coming from the file\n            const data = normalizeDdahImports(fileContent, applicants);\n            // Compute which applicants have been added/modified\n            const newDiff = diffImport.ddahs(data, { ddahs, assignments });\n\n            setDiffed(newDiff);\n        } catch (e) {\n            console.warn(e);\n            setProcessingError(e);\n        }\n    }, [fileContent, ddahs, assignments, applicants, inProgress]);\n\n    async function onConfirm() {\n        if (!diffed) {\n            throw new Error(\"Unable to compute an appropriate diff\");\n        }\n        const changedDdahs = getChanged(diffed);\n\n        await dispatch(upsertDdahs(changedDdahs));\n\n        setFileContent(null);\n    }\n\n    return (\n        <ImportActionButton\n            onConfirm={onConfirm}\n            onFileChange={setFileContent}\n            dialogContent={\n                <DialogContent\n                    diffed={diffed}\n                    processingError={processingError}\n                />\n            }\n            setInProgress={setInProgress}\n            disabled={disabled}\n        />\n    );\n}\n\nconst DEFAULT_DDAH = {\n    duties: [\n        {\n            order: 1,\n            hours: 0,\n            description: \"\",\n        },\n        {\n            order: 2,\n            hours: 0,\n            description: \"\",\n        },\n        {\n            order: 3,\n            hours: 0,\n            description: \"\",\n        },\n        {\n            order: 4,\n            hours: 0,\n            description: \"\",\n        },\n    ],\n};\n\n/**\n * Turn a list of ddahs and assignments into an object\n * with Arrays of Arrays (suitable for turning into spreadsheets) of DDAHs\n * split by position codes.\n *\n * @param {Ddah[]} ddahs\n * @param {Assignment[]} assignments\n * @returns\n */\nfunction createDdahSpreadsheets(ddahs: Ddah[], assignments: Assignment[]) {\n    const ddahsByAssignmentId: { [key: string]: Ddah } = {};\n    for (const ddah of ddahs) {\n        ddahsByAssignmentId[ddah.assignment.id] = ddah;\n    }\n\n    // Create DDAHs for all assignments, but use the real DDAH if\n    // it exists.\n    const allDdahs = assignments\n        .map((assignment) => {\n            // Rejected or withdrawn assignments shouldn't show up on the DDAH list\n            if (\n                assignment.active_offer_status === \"rejected\" ||\n                assignment.active_offer_status === \"withdrawn\"\n            ) {\n                // We return null in this case; we will filter out\n                // the null results later.\n                return null;\n            }\n            if (ddahsByAssignmentId[assignment.id]) {\n                return ddahsByAssignmentId[assignment.id];\n            }\n            return { ...DEFAULT_DDAH, assignment: assignment };\n        })\n        .filter((x) => x) as Ddah[];\n    allDdahs.sort(({ assignment: a }, { assignment: b }) => {\n        const aHash = `${a.position.position_code} ${a.applicant.last_name} ${a.applicant.first_name}`;\n        const bHash = `${b.position.position_code} ${b.applicant.last_name} ${b.applicant.first_name}`;\n        return aHash === bHash ? 0 : aHash > bHash ? 1 : -1;\n    });\n\n    // Get a list of all the positions\n    const posSet = new Set<string>();\n    for (const ddah of allDdahs) {\n        posSet.add(ddah.assignment.position.position_code);\n    }\n\n    // Create an object with arrays of DDAHs for every position\n    const ddahsByPosition: { [key: string]: any[][] } = {};\n    for (const position_code of Array.from(posSet)) {\n        ddahsByPosition[position_code] = prepareDdahsSpreadsheet(\n            allDdahs.filter(\n                (ddah) =>\n                    ddah.assignment.position.position_code === position_code\n            )\n        );\n    }\n\n    return ddahsByPosition;\n}\n\nasync function arraysByKeyToZip(arrays: { [key: string]: any[][] }) {\n    const zip = new JSZip();\n\n    for (const [position_code, array] of Object.entries(arrays)) {\n        // workbook sheets and file names can't have `/` or other special characters in them\n        // So we replace them with `_` before we start.\n        const sanitized_position_code = position_code.replace(\n            /[^A-z0-9 ]/g,\n            \"_\"\n        );\n        const workbook = XLSX.utils.book_new();\n        const sheet = XLSX.utils.aoa_to_sheet(array);\n        XLSX.utils.book_append_sheet(\n            workbook,\n            sheet,\n            // Sheet names are limited to 31 characters in length\n            `${sanitized_position_code} DDAHs`.slice(0, 30)\n        );\n        const rawSpreadsheet = XLSX.write(workbook, {\n            type: \"binary\",\n            bookType: \"xlsx\",\n        });\n        zip.file(`${sanitized_position_code}-DDAHs.xlsx`, rawSpreadsheet, {\n            binary: true,\n        });\n    }\n\n    const blob = await zip.generateAsync({ type: \"blob\" });\n    return blob;\n}\n\nexport function ConnectedDownloadPositionDdahTemplatesAction({\n    disabled = false,\n}) {\n    const assignments = useSelector<any, Assignment[]>(assignmentsSelector);\n    const ddahs = useSelector<any, Ddah[]>(ddahsSelector);\n\n    async function download() {\n        const spreadsheets = createDdahSpreadsheets(ddahs, assignments);\n        const blob = await arraysByKeyToZip(spreadsheets);\n        FileSaver.saveAs(blob, \"DDAHs-by-position.zip\");\n    }\n\n    return (\n        <ActionButton\n            icon={FaDownload}\n            title=\"Download by-position spreadsheets appropriate for filling in and uploading to create DDAHs\"\n            onClick={() => download()}\n            disabled={disabled}\n        >\n            By-Position Templates\n        </ActionButton>\n    );\n}\n\nexport function ConnectedDownloadDdahsAcceptedListAction({ disabled = false }) {\n    const dispatch = useDispatch();\n\n    async function downloadClicked() {\n        const file = await dispatch(downloadDdahAcceptedList());\n        FileSaver.saveAs(file);\n    }\n\n    return (\n        <ActionButton\n            icon={FaDownload}\n            title=\"Download a list of DDAHs that have been signed by TAs this session\"\n            onClick={() => downloadClicked()}\n            disabled={disabled}\n        >\n            Signature List\n        </ActionButton>\n    );\n}\n\nconst DialogContent = React.memo(function DialogContent({\n    diffed,\n    processingError,\n}: {\n    diffed: DiffSpec<MinimalDdah, Ddah>[] | null;\n    processingError: string | null;\n}) {\n    let dialogContent = <p>No data loaded...</p>;\n    if (processingError) {\n        dialogContent = <Alert variant=\"danger\">{\"\" + processingError}</Alert>;\n    } else if (diffed) {\n        const newItems = diffed\n            .filter((item) => item.status === \"new\")\n            .map((item) => item.obj);\n        const modifiedDiffSpec = diffed.filter(\n            (item) => item.status === \"modified\"\n        );\n\n        if (newItems.length === 0 && modifiedDiffSpec.length === 0) {\n            dialogContent = (\n                <Alert variant=\"warning\">\n                    No difference between imported applicants and those already\n                    on the system.\n                </Alert>\n            );\n        } else {\n            dialogContent = (\n                <>\n                    {newItems.length > 0 && (\n                        <Alert variant=\"primary\">\n                            <span className=\"mb-1\">\n                                The following applicants will be{\" \"}\n                                <strong>added</strong>\n                            </span>\n                            <DdahsList ddahs={newItems} />\n                        </Alert>\n                    )}\n                    {modifiedDiffSpec.length > 0 && (\n                        <Alert variant=\"info\">\n                            <span className=\"mb-1\">\n                                The following instructors will be{\" \"}\n                                <strong>modified</strong>\n                            </span>\n                            <DdahsDiffList modifiedDdahs={modifiedDiffSpec} />\n                        </Alert>\n                    )}\n                </>\n            );\n        }\n    }\n\n    return dialogContent;\n});\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ddahTableSelector, setSelectedRows } from \"./actions\";\nimport { Ddah, Assignment, Instructor } from \"../../api/defs/types\";\nimport {\n    ddahsSelector,\n    upsertDdah,\n    approveDdah,\n} from \"../../api/actions/ddahs\";\nimport { assignmentsSelector } from \"../../api/actions\";\nimport { FaCheck, FaSearch, FaEdit, FaDownload } from \"react-icons/fa\";\n\nimport \"./styles.css\";\nimport { Button, Modal, Spinner } from \"react-bootstrap\";\nimport { formatDate, formatDownloadUrl } from \"../../libs/utils\";\nimport { DdahEditor } from \"../../components/ddahs\";\nimport { generateHeaderCell } from \"../../components/table-utils\";\nimport { AdvancedFilterTable } from \"../../components/advanced-filter-table\";\n\ninterface RowData {\n    id?: number;\n    position_code: string;\n    last_name: string;\n    first_name: string;\n    total_hours: number | null;\n    status: string | null;\n    issues: string | null;\n    issue_code: \"hours_mismatch\" | \"missing\" | null;\n}\n\n/**\n * Determine if there are issues with `ddah` and\n * return a human-readable string specifying the issues\n *\n * @param {Ddah} ddah\n * @returns\n */\nfunction ddahIssues(ddah: Ddah) {\n    if (ddah.total_hours !== ddah.assignment.hours) {\n        return `Hours Mismatch (${ddah.total_hours} vs. ${ddah.assignment.hours})`;\n    }\n    return null;\n}\n\nfunction getReadableStatus(ddah: Pick<Ddah, \"status\">) {\n    switch (ddah.status) {\n        case \"accepted\":\n            return \"Accepted\";\n        case \"emailed\":\n            return \"Pending\";\n        default:\n            return \"Unsent\";\n    }\n}\n\n/**\n * Cell for rendering the status of a DDAH\n *\n * @param {{ original: RowData }} { original }\n * @returns {React.ReactNode}\n */\nfunction StatusCell({\n    row,\n    children = null,\n}: {\n    row: { original: RowData };\n    children?: React.ReactNode;\n}): JSX.Element {\n    const original = row.original;\n    // If we have a blank ID, we aren't actually a DDAH (we're an assignment\n    // without a DDAH), so don't render anything.\n    if (original.id == null) {\n        return null as any;\n    }\n    const readableStatus = getReadableStatus(original as Pick<Ddah, \"status\">);\n    switch ((original as Pick<Ddah, \"status\">).status) {\n        case \"accepted\":\n            return (\n                <React.Fragment>\n                    {children}\n                    <span className=\"accepted-ddah\">{readableStatus}</span>\n                </React.Fragment>\n            );\n        default:\n            return (\n                <React.Fragment>\n                    {children}\n                    {readableStatus}\n                </React.Fragment>\n            );\n    }\n}\n\n/**\n * Cell for rendering the issues of a DDAH\n *\n * @param {{ original: RowData }} { original }\n * @returns {React.ReactNode}\n */\nfunction IssuesCell({\n    row,\n}: {\n    row: { original: RowData };\n}): JSX.Element | null {\n    const original = row.original;\n    switch (original.issue_code) {\n        case \"hours_mismatch\":\n            return <div className=\"hours-mismatch-ddah\">{original.issues}</div>;\n        case \"missing\":\n            return <div className=\"missing-ddah\">{original.issues}</div>;\n        default:\n            return null;\n    }\n}\n\n/**\n * Cell for previewing a DDAH\n *\n * @param {{ original: RowData }} { original }\n * @returns {React.ReactNode}\n */\nfunction PreviewCell({\n    row,\n    onClick = () => {},\n}: {\n    row: { original: RowData };\n    onClick: Function;\n}): JSX.Element | null {\n    const original = row.original;\n    if (original.id == null) {\n        return null;\n    }\n    return (\n        <Button\n            variant=\"light\"\n            size=\"sm\"\n            className=\"mr-2 py-0\"\n            title=\"Preview DDAH\"\n            onClick={() => onClick(original.id)}\n        >\n            <FaSearch />\n        </Button>\n    );\n}\n\nfunction DdahPreviewModal({\n    ddah,\n    show,\n    onHide = () => {},\n    onApprove = () => {},\n    onEdit = () => {},\n}: {\n    ddah: Ddah | null;\n    show: Boolean;\n    onHide?: Function;\n    onApprove?: Function;\n    onEdit?: Function;\n}): React.ReactElement {\n    let ddahPreview: React.ReactElement | string = \"No DDAH to preview\";\n    let url: string | null = null;\n    if (ddah != null) {\n        ddahPreview = <DdahPreview ddah={ddah} />;\n        url = `/public/ddahs/${ddah.url_token}.pdf`;\n    }\n    return (\n        <Modal show={show} onHide={onHide} dialogClassName=\"wide-modal\">\n            <Modal.Header closeButton>\n                <Modal.Title>Previewing DDAH</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>{ddahPreview}</Modal.Body>\n            <Modal.Footer>\n                <Button variant=\"outline-secondary\" onClick={() => onHide()}>\n                    Close\n                </Button>\n                <Button variant=\"outline-info\" onClick={() => onEdit(ddah)}>\n                    <FaEdit className=\"mr-2\" />\n                    Edit\n                </Button>\n                {url && (\n                    <Button\n                        title=\"Download DDAH.\"\n                        variant=\"link\"\n                        href={formatDownloadUrl(url)}\n                    >\n                        <FaDownload className=\"mr-2\" />\n                        Download DDAH\n                    </Button>\n                )}\n                <Button onClick={() => onApprove(ddah)}>\n                    <FaCheck className=\"mr-2\" />\n                    Approve\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\nfunction DdahPreview({ ddah }: { ddah: Ddah }): React.ReactElement {\n    const duties = [...ddah.duties];\n    duties.sort((a, b) => a.order - b.order);\n\n    const assignment = ddah.assignment;\n    const applicant = assignment.applicant;\n    const position = assignment.position;\n    const instructors = position.instructors;\n\n    return (\n        <div className=\"ddah-preview-container\">\n            <h4>Description of Duties and Allocation of Hours</h4>\n            <h4>\n                Position: {position.position_code} ({position.position_title})\n            </h4>\n            <h4>\n                TA: {applicant.first_name} {applicant.last_name}\n            </h4>\n            <h5>Duties</h5>\n            <ul>\n                {duties.map((duty) => (\n                    <li key={duty.order}>\n                        <span className=\"ddah-duty-hours\">{duty.hours}</span>\n                        <span className=\"ddah-duty-description\">\n                            {duty.description}\n                        </span>\n                    </li>\n                ))}\n                <li>\n                    <span className=\"ddah-duty-hours\">{ddah.total_hours}</span>\n                    <span className=\"ddah-duty-description\">Total</span>\n                </li>\n            </ul>\n            <div className=\"signature-area\">\n                <div>\n                    Prepared by {getFirstInstructorsName(instructors)}{\" \"}\n                    {ddah.emailed_date\n                        ? ` on ${formatDate(ddah.emailed_date)}`\n                        : \"\"}\n                </div>\n                <div>\n                    {ddah.accepted_date\n                        ? `Accepted by ${applicant.first_name} ${\n                              applicant.last_name\n                          } on ${formatDate(ddah.accepted_date)}`\n                        : \"Not yet accepted\"}\n                </div>\n            </div>\n        </div>\n    );\n}\n\nfunction ConnectedDdahEditorModal({\n    ddah,\n    show,\n    onHide = () => {},\n}: {\n    ddah: Ddah | null;\n    show: Boolean;\n    onHide?: Function;\n}): React.ReactElement {\n    const [inProgress, setInProgress] = React.useState(false);\n    const dispatch = useDispatch();\n    const [newDdah, setNewDdah] = React.useState<Ddah | null>(ddah);\n\n    React.useEffect(() => {\n        setNewDdah(ddah);\n    }, [ddah]);\n\n    // When a confirm operation is in progress, a spinner is displayed; otherwise\n    // it's hidden\n    const spinner = inProgress ? (\n        <Spinner animation=\"border\" size=\"sm\" className=\"mr-1\" />\n    ) : null;\n\n    async function onSave(newDdah: Ddah | null) {\n        try {\n            if (newDdah) {\n                setInProgress(true);\n                await dispatch(upsertDdah(newDdah));\n            }\n        } finally {\n            setInProgress(false);\n            onHide();\n        }\n    }\n\n    const editor = ddah ? (\n        <DdahEditor\n            ddah={newDdah as Ddah}\n            editableAssignment={false}\n            setDdah={setNewDdah}\n        />\n    ) : (\n        \"No DDAH Specified\"\n    );\n\n    return (\n        <Modal show={show} onHide={onHide} dialogClassName=\"wide-modal\">\n            <Modal.Header closeButton>\n                <Modal.Title>Editing DDAH</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>{editor}</Modal.Body>\n            <Modal.Footer>\n                <Button variant=\"outline-secondary\" onClick={() => onHide()}>\n                    Cancel\n                </Button>\n                <Button onClick={() => onSave(newDdah)}>\n                    {spinner}\n                    Save\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\nfunction getFirstInstructorsName(instructors: Instructor[]): string {\n    if (instructors.length === 0) {\n        return \"(Unknown)\";\n    }\n    return `${instructors[0].first_name} ${instructors[0].last_name}`;\n}\n\n/**\n * Table to view/preview large collections of DDAHs\n *\n * @export\n * @returns\n */\nexport function ConnectedDdahsTable() {\n    let ddahs = useSelector(ddahsSelector) as Ddah[];\n    const assignments = useSelector(assignmentsSelector) as Assignment[];\n    const selected = useSelector(ddahTableSelector).selectedDdahIds;\n    const dispatch = useDispatch();\n\n    const [previewVisible, setPreviewVisible] = React.useState<Boolean>(false);\n    const [editVisible, setEditVisible] = React.useState<Boolean>(false);\n    const [previewDdah, setPreviewDdah] = React.useState<Ddah | null>(null);\n\n    // It is possible that things needed to construct the DDAH are loaded out of order.\n    // E.g., the position or assignment data hasn't come back from the API\n    // even though the DDAH data has. In this case, we want to fail gracefully until\n    // the data arrives (by showing an empty list of DDAHs).\n    if (\n        ddahs.some(\n            (ddah) =>\n                ddah.assignment == null ||\n                ddah.assignment.applicant == null ||\n                ddah.assignment.position == null\n        )\n    ) {\n        ddahs = [];\n    }\n\n    function setSelected(ids: number[]) {\n        // If a row is missing an id, `null` will be used in place of that id.\n        // We don't want that value of `null` to mess things up when we use\n        // the selected rows in another function.\n        dispatch(setSelectedRows(ids.filter((id) => id != null)));\n    }\n\n    function onPreviewClick(id: number) {\n        setPreviewDdah(ddahs.find((ddah) => ddah.id === id) || null);\n        setPreviewVisible(true);\n    }\n\n    function WrappedStatusCell(props: any): React.ReactNode {\n        const { row, ...rest } = props;\n        return (\n            <StatusCell row={row} {...rest}>\n                <PreviewCell {...props} onClick={onPreviewClick} />\n            </StatusCell>\n        );\n    }\n\n    // The omni-search doesn't work on nested properties, so we need to flatten\n    // the data we display before sending it to the table.\n    const data = ddahs.map(\n        (ddah) =>\n            ({\n                id: ddah.id,\n                position_code: ddah.assignment.position.position_code,\n                last_name: ddah.assignment.applicant.last_name,\n                first_name: ddah.assignment.applicant.first_name,\n                total_hours: ddah.total_hours,\n                status: ddah.status || \"unsent\",\n                approved: ddah.approved_date ? \"Approved\" : \"\",\n                readable_status: getReadableStatus(ddah),\n                issues: ddahIssues(ddah),\n                issue_code: ddahIssues(ddah) ? \"hours_mismatch\" : null,\n            } as RowData)\n    );\n\n    // We want to also list all assignments for which there isn't a DDAH.\n    // We start by hashing all the existing DDAHs\n    const ddahAssignmentIdsHash = {} as { [key: string]: true };\n    for (const ddah of ddahs) {\n        ddahAssignmentIdsHash[ddah.assignment.id] = true;\n    }\n    for (const assignment of assignments) {\n        // If an offer is rejected or withdrawn, we will never make a DDAH for it.\n        // It is important that this is the first check in the loop, since a\n        // DDAH might have been created for an offer that becomes withdrawn.\n        // In that case, we still don't want it showing up.\n        if (\n            assignment.active_offer_status === \"rejected\" ||\n            assignment.active_offer_status === \"withdrawn\"\n        ) {\n            continue;\n        }\n        if (ddahAssignmentIdsHash[assignment.id]) {\n            // We have an associated DDAH\n            continue;\n        }\n        data.push({\n            position_code: assignment.position.position_code,\n            last_name: assignment.applicant.last_name,\n            first_name: assignment.applicant.first_name,\n            total_hours: null,\n            status: null,\n            issues: \"Missing DDAH\",\n            issue_code: \"missing\",\n        });\n    }\n\n    // Sort the table by position_code by default\n    data.sort((a, b) => {\n        if (a.position_code > b.position_code) {\n            return 1;\n        } else if (a.position_code < b.position_code) {\n            return -1;\n        }\n        if (a.last_name > b.last_name) {\n            return 1;\n        } else if (a.last_name < b.last_name) {\n            return -1;\n        }\n        return 0;\n    });\n\n    const columns = [\n        {\n            Header: generateHeaderCell(\"Position\"),\n            accessor: \"position_code\",\n        },\n        { Header: generateHeaderCell(\"Last Name\"), accessor: \"last_name\" },\n        { Header: generateHeaderCell(\"First Name\"), accessor: \"first_name\" },\n        {\n            Header: generateHeaderCell(\"DDAH Hours\"),\n            accessor: \"total_hours\",\n            maxWidth: 120,\n            style: { textAlign: \"right\" },\n        },\n        {\n            Header: generateHeaderCell(\"Status\"),\n            accessor: \"status\",\n            Cell: WrappedStatusCell,\n        },\n        {\n            Header: generateHeaderCell(\"Approved\"),\n            accessor: \"approved\",\n            maxWidth: 50,\n            Cell: ({ value }: any) =>\n                value ? (\n                    <div className=\"accepted-ddah\">\n                        <FaCheck />\n                    </div>\n                ) : null,\n        },\n        {\n            Header: generateHeaderCell(\"Issues\"),\n            accessor: \"issues\",\n            Cell: IssuesCell,\n        },\n    ];\n\n    return (\n        <>\n            <ConnectedDdahEditorModal\n                ddah={previewDdah}\n                show={editVisible}\n                onHide={() => setEditVisible(false)}\n            />\n            <DdahPreviewModal\n                ddah={previewDdah}\n                show={previewVisible}\n                onHide={() => setPreviewVisible(false)}\n                onEdit={() => {\n                    setPreviewVisible(false);\n                    setEditVisible(true);\n                }}\n                onApprove={async () => {\n                    if (previewDdah) {\n                        await dispatch(approveDdah(previewDdah));\n                    }\n                    setPreviewVisible(false);\n                }}\n            />\n            <AdvancedFilterTable\n                // The ReactTable types are not smart enough to know that you can use a function\n                // for Header, so we will opt out of the type system here.\n                columns={columns as any}\n                data={data}\n                selected={selected}\n                setSelected={setSelected}\n                filterable={true}\n            />\n        </>\n    );\n}\n","export const SET_SELECTED_DDAH_TABLE_ROWS = \"SET_SELECTED_DDAH_TABLE_ROWS\";\n","import React from \"react\";\nimport { ConnectedAddDdahDialog } from \"./add-ddah-dialog\";\nimport { FaPlus, FaMailBulk, FaCheck } from \"react-icons/fa\";\nimport {\n    ConnectedImportDdahsAction,\n    ConnectedExportDdahsAction,\n    ConnectedDownloadPositionDdahTemplatesAction,\n    ConnectedDownloadDdahsAcceptedListAction,\n} from \"./import-export\";\nimport {\n    ActionsList,\n    ActionButton,\n    ActionHeader,\n} from \"../../components/action-buttons\";\nimport { ContentArea } from \"../../components/layout\";\nimport { ConnectedDdahsTable } from \"../ddah-table\";\nimport { MissingActiveSessionWarning } from \"../../components/sessions\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { activeSessionSelector } from \"../../api/actions\";\nimport { ddahTableSelector } from \"../ddah-table/actions\";\nimport { ddahsSelector, emailDdah, approveDdah } from \"../../api/actions/ddahs\";\nimport { Ddah } from \"../../api/defs/types\";\n\nexport function AdminDdahsView(): React.ReactNode {\n    const [addDialogVisible, setAddDialogVisible] = React.useState(false);\n    // While data is being imported, updating the react table takes a long time,\n    // so we use this variable to hide the react table during import.\n    const [importInProgress, setImportInProgress] = React.useState(false);\n    const activeSession = useSelector(activeSessionSelector);\n    const { selectedDdahIds } = useSelector(ddahTableSelector);\n    const ddahs = useSelector<any, Ddah[]>(ddahsSelector);\n    const dispatch = useDispatch();\n    const selectedDdahs = ddahs.filter((ddah) =>\n        selectedDdahIds.includes(ddah.id)\n    );\n\n    return (\n        <div className=\"page-body\">\n            <ActionsList>\n                <ActionHeader>Available Actions</ActionHeader>\n                <ActionButton\n                    icon={<FaPlus />}\n                    onClick={() => {\n                        setAddDialogVisible(true);\n                    }}\n                    disabled={!activeSession}\n                >\n                    Add DDAH\n                </ActionButton>\n                <ConnectedDownloadPositionDdahTemplatesAction\n                    disabled={!activeSession}\n                />\n                <ConnectedDownloadDdahsAcceptedListAction\n                    disabled={!activeSession}\n                />\n\n                <ActionHeader>Import/Export</ActionHeader>\n                <ConnectedImportDdahsAction\n                    disabled={!activeSession}\n                    setImportInProgress={setImportInProgress}\n                />\n                <ConnectedExportDdahsAction disabled={!activeSession} />\n                <ActionHeader>Selected DDAH Actions</ActionHeader>\n                <ActionButton\n                    icon={FaMailBulk}\n                    onClick={() => {\n                        for (const ddah of selectedDdahs) {\n                            dispatch(emailDdah(ddah));\n                        }\n                    }}\n                    disabled={selectedDdahIds.length === 0}\n                >\n                    Email DDAH\n                </ActionButton>\n                <ActionButton\n                    icon={FaCheck}\n                    onClick={() => {\n                        for (const ddah of selectedDdahs) {\n                            dispatch(approveDdah(ddah));\n                        }\n                    }}\n                    disabled={selectedDdahIds.length === 0}\n                >\n                    Approve DDAH\n                </ActionButton>\n            </ActionsList>\n            <ContentArea>\n                {activeSession ? null : (\n                    <MissingActiveSessionWarning extraText=\"To view or modify DDAHs, you must select a session.\" />\n                )}\n                <ConnectedAddDdahDialog\n                    show={addDialogVisible}\n                    onHide={() => {\n                        setAddDialogVisible(false);\n                    }}\n                />\n                {!importInProgress && <ConnectedDdahsTable />}\n            </ContentArea>\n        </div>\n    );\n}\n","import React from \"react\";\nimport { Redirect, Route, Switch } from \"react-router-dom\";\nimport { AdminInstructorsView } from \"../instructors\";\nimport { AdminSessionsView } from \"../sessions\";\nimport { AdminPositionsView, InstructorPositionsView } from \"../positions\";\nimport {\n    AdminAssignmentsView,\n    InstructorAssignmentsView,\n} from \"../assignments\";\nimport { AdminContractTemplatesView } from \"../contract_template\";\nimport { Landing } from \"../admin/landing.tsx\";\nimport { Landing as InstructorLanding } from \"../instructor/landing.tsx\";\nimport { AdminApplicantsView } from \"../applicants\";\nimport { AdminDdahsView } from \"../ddahs\";\n\nexport function AdminRoutes() {\n    return (\n        <Switch>\n            <Route exact path=\"/\">\n                <Redirect to=\"/assignments_and_positions/assignments\" />\n            </Route>\n            <Route exact path=\"/tapp\">\n                <Landing />\n            </Route>\n            <Route exact path=\"/session_setup\">\n                <Redirect to=\"/session_setup/sessions\" />\n            </Route>\n            <Route exact path=\"/session_setup/sessions\">\n                <AdminSessionsView />\n            </Route>\n            <Route exact path=\"/session_setup/contract_templates\">\n                <AdminContractTemplatesView />\n            </Route>\n            <Route exact path=\"/session_setup/instructors\">\n                <AdminInstructorsView />\n            </Route>\n            <Route exact path=\"/assignments_and_positions\">\n                <Redirect to=\"/assignments_and_positions/positions\" />\n            </Route>\n            <Route exact path=\"/assignments_and_positions/positions\">\n                <AdminPositionsView />\n            </Route>\n            <Route exact path=\"/assignments_and_positions/assignments\">\n                <AdminAssignmentsView />\n            </Route>\n            <Route exact path=\"/assignments_and_positions/ddahs\">\n                <AdminDdahsView />\n            </Route>\n            <Route exact path=\"/applicants_and_matching\">\n                <Redirect to=\"/applicants_and_matching/applicants\" />\n            </Route>\n            <Route exact path=\"/applicants_and_matching/applicants\">\n                <AdminApplicantsView />\n            </Route>\n        </Switch>\n    );\n}\n\nexport function InstructorRoutes() {\n    return (\n        <Switch>\n            <Route exact path=\"/\">\n                <Redirect to=\"/tapp\" />\n            </Route>\n            <Route exact path=\"/tapp\">\n                <InstructorLanding />\n            </Route>\n            <Route exact path=\"/tapp/positions\">\n                <InstructorPositionsView />\n            </Route>\n            <Route exact path=\"/tapp/assignments\">\n                <InstructorAssignmentsView />\n            </Route>\n            <Route exact path=\"/tapp/ddahs\">\n                <div>Not implemented yet</div>\n            </Route>\n        </Switch>\n    );\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Nav, Navbar } from \"react-bootstrap\";\nimport { NavLink, useRouteMatch } from \"react-router-dom\";\n\nimport \"./components.css\";\n\n/**\n * Wrap `\"react-router-dom\"`'s `NavLink` in Bootstrap\n * styling.\n *\n * @param {*} props\n * @returns\n */\nfunction BootstrapNavItem(props) {\n    return (\n        <Nav.Item>\n            <Nav.Link as={NavLink} {...props}>\n                {props.children}\n            </Nav.Link>\n        </Nav.Item>\n    );\n}\nBootstrapNavItem.propTypes = {\n    to: PropTypes.string,\n};\n\n/**\n * Render a header that dynamically adjusts depending on the route\n * (as determined by `react-router-dom`). Top-level routes appear in\n * a dropdown menu. Subroutes (which only show when the top-level route is active)\n * appear as a horizontal list. A top-level route takes the form\n *\n * ```\n * {\n *    route: \"/some/route\"\n *    name: \"Display Name\"\n *    description: \"Alt Text\"\n *    subroutes: [<same as routes>]\n * }\n * ```\n *\n * `subroutes.route` is automatically prefixed with the parent's `route`.\n *\n * @export\n * @param {object[]} props.routes\n * @returns\n */\n\nexport function Header(props) {\n    const { routes = [], infoComponents = [] } = props;\n    let match = useRouteMatch(\"/:mainRoute/:subRoute?\") || {\n        params: { mainRoute: \"tapp\" },\n    };\n    const { mainRoute } = match.params;\n\n    if (routes.length === 0) {\n        return <div>No Routes in Header</div>;\n    }\n\n    const activeMainRoutes = routes.map((route) => (\n        <BootstrapNavItem\n            title={route.description}\n            eventKey={route.route}\n            to={route.route}\n            key={route.route}\n            className=\"primary\"\n        >\n            {route.name}\n        </BootstrapNavItem>\n    ));\n\n    // filters the routes to include only the current route, then maps all of that route's subroutes to BootstrapNavItems\n    const availableSubroutes = routes\n        .filter((route) => route.route.substring(1) === mainRoute)\n        .map((route) =>\n            (route.subroutes || []).map((subroute) => {\n                const fullroute = `${route.route}${subroute.route}`;\n                return (\n                    <BootstrapNavItem\n                        to={fullroute}\n                        title={subroute.description}\n                        key={fullroute}\n                        className=\"secondary\"\n                    >\n                        {subroute.name}\n                    </BootstrapNavItem>\n                );\n            })\n        );\n\n    return (\n        <div className=\"header-container\">\n            <div className=\"header-nav\">\n                <Navbar>\n                    <Nav\n                        activeKey={mainRoute}\n                        defaultActiveKey={\"tapp\"}\n                        className=\"primary-nav-links\"\n                    >\n                        {activeMainRoutes}\n                    </Nav>\n                </Navbar>\n                <Nav className=\"secondary-nav-links\">{availableSubroutes}</Nav>\n            </div>\n            <div className=\"header-widgets\">{infoComponents}</div>\n        </div>\n    );\n}\n\nHeader.propTypes = {\n    routes: PropTypes.arrayOf(\n        PropTypes.shape({\n            route: PropTypes.string.isRequired,\n            name: PropTypes.string.isRequired,\n            description: PropTypes.string,\n            subroutes: PropTypes.arrayOf(\n                PropTypes.shape({\n                    route: PropTypes.string.isRequired,\n                    name: PropTypes.string.isRequired,\n                    description: PropTypes.string,\n                })\n            ),\n        })\n    ),\n    infoComponents: PropTypes.array,\n};\n","import React from \"react\";\nimport { Header } from \"../../components/header\";\nimport {\n    ConnectedActiveSessionDisplay,\n    ConnectedActiveUserDisplay,\n} from \"../header\";\n\nexport const routes = [\n    {\n        route: \"/session_setup\",\n        name: \"Session Setup\",\n        description: \"Setup a new session or manage an existing session.\",\n        subroutes: [\n            {\n                route: \"/sessions\",\n                name: \"Sessions\",\n                description: \"Manage Sessions\",\n            },\n            {\n                route: \"/contract_templates\",\n                name: \"Contract Templates\",\n                description: \"Manage Contract Templates\",\n            },\n            {\n                route: \"/instructors\",\n                name: \"Instructors\",\n                description: \"Manage Instructors\",\n            },\n        ],\n    },\n    {\n        route: \"/assignments_and_positions\",\n        name: \"Assignments & Positions\",\n        description: \"Manage Assignments & Positions\",\n        subroutes: [\n            {\n                route: \"/positions\",\n                name: \"Positions\",\n                description: \"Manage Positions\",\n            },\n            {\n                route: \"/assignments\",\n                name: \"Assignments\",\n                description: \"Manage Assignments\",\n            },\n            {\n                route: \"/ddahs\",\n                name: \"DDAHs\",\n                description: \"Manage DDAHs\",\n            },\n        ],\n    },\n    {\n        route: \"/applicants_and_matching\",\n        name: \"Applicants & Matching\",\n        description: \"Manage applicants and match applicants to positions\",\n        subroutes: [\n            {\n                route: \"/applicants\",\n                name: \"Applicants\",\n                description: \"Manage Applicants\",\n            },\n        ],\n    },\n];\n\n/**\n * Header showing the routes that a user with `role=admin`\n * can see.\n *\n * @returns\n */\n\nfunction AdminHeader() {\n    return (\n        <Header\n            routes={routes}\n            infoComponents={[\n                <ConnectedActiveSessionDisplay key={0} />,\n                <ConnectedActiveUserDisplay key={1} />,\n            ]}\n        />\n    );\n}\n\nexport { AdminHeader };\n","import React from \"react\";\nimport { Header } from \"../../components/header\";\nimport {\n    ConnectedActiveSessionDisplay,\n    ConnectedActiveUserDisplay,\n} from \"../header\";\n\nexport const routes = [\n    {\n        route: \"/tapp\",\n        name: \"Course Admin\",\n        description: \"Administrate TAs in your courses\",\n        subroutes: [\n            {\n                route: \"/positions\",\n                name: \"Courses & Positions\",\n                description: \"View your courses and positions\",\n            },\n            {\n                route: \"/assignments\",\n                name: \"TA Information\",\n                description: \"View information about your TAs\",\n            },\n            {\n                route: \"/ddahs\",\n                name: \"DDAHs\",\n                description: \"Manage your TAs' DDAH forms\",\n            },\n        ],\n    },\n    {\n        route: \"/applications\",\n        name: \"Applications\",\n        description: \"View information about TAs applying to your course\",\n        subroutes: [\n            {\n                route: \"/statistics\",\n                name: \"Statistics\",\n                description: \"See statistics about accepted/rejected contracts\",\n            },\n        ],\n    },\n];\n\n/**\n * Header showing the routes that a user with `role=admin`\n * can see.\n *\n * @returns\n */\nexport function InstructorHeader() {\n    return (\n        <Header\n            routes={routes}\n            infoComponents={[\n                <ConnectedActiveSessionDisplay key={0} />,\n                <ConnectedActiveUserDisplay key={1} />,\n            ]}\n        />\n    );\n}\n","import { SET_SELECTED_ROWS } from \"./constants\";\nimport { createReducer } from \"redux-create-reducer\";\n\n// initialize the state of offer table\nconst initialState = {\n    selectedAssignmentIds: [],\n};\n\nconst offerTableReducer = createReducer(initialState, {\n    [SET_SELECTED_ROWS]: (state, action) => {\n        return { ...state, selectedAssignmentIds: action.payload };\n    },\n});\n\nexport default offerTableReducer;\n","import { SET_SELECTED_DDAH_TABLE_ROWS } from \"./constants\";\nimport { createReducer } from \"redux-create-reducer\";\n\n// initialize the state of offer table\nconst initialState = {\n    selectedDdahIds: [] as number[],\n};\n\nconst ddahsTableReducer = createReducer(initialState, {\n    [SET_SELECTED_DDAH_TABLE_ROWS]: (state: any, action: any) => {\n        return { ...state, selectedDdahIds: action.payload };\n    },\n});\n\nexport type DdahsTableType = typeof initialState;\n\nexport default ddahsTableReducer;\n","import { reducer as formReducer } from \"redux-form\";\nimport { reducer as notificationReducer } from \"react-notification-system-redux\";\nimport { combineReducers } from \"./api/reducers/utils\";\nimport { globalReducer } from \"./api/reducers/globals\";\nimport offerTableReducer from \"./views/offertable/reducers\";\nimport {\n    statusReducer,\n    sessionsReducer,\n    positionsReducer,\n    applicantsReducer,\n    applicationsReducer,\n    assignmentsReducer,\n    instructorsReducer,\n    contractTemplatesReducer,\n    ddahsReducer,\n} from \"./api/reducers\";\nimport { usersReducer } from \"./api/reducers/users\";\nimport ddahsTableReducer from \"./views/ddah-table/reducers\";\n\n// When `combineReducers` is used,\n// every action gets dispatched to every reducer.\n// Since reducers don't change the state on unrecognized\n// actions, this is okay. Further, each reducer believes\n// it has its own top-level state, but in reality it is\n// just passed a part of the whole state. E.g., if `combineReducers`\n// is passed\n//   {\n//      mypath: myReducer\n//   }\n// When `myReducer(localState)` is called, `localSate == globalState.mypath`.\nconst reducer = combineReducers({\n    model: combineReducers({\n        status: statusReducer,\n        sessions: sessionsReducer,\n        positions: positionsReducer,\n        applicants: applicantsReducer,\n        applications: applicationsReducer,\n        assignments: assignmentsReducer,\n        instructors: instructorsReducer,\n        contractTemplates: contractTemplatesReducer,\n        users: usersReducer,\n        ddahs: ddahsReducer,\n    }),\n    ui: combineReducers({\n        notifications: notificationReducer,\n        form: formReducer,\n        offerTable: offerTableReducer,\n        ddahsTable: ddahsTableReducer,\n        globals: globalReducer,\n    }),\n});\n\nexport default reducer;\n","import { createStore, applyMiddleware } from \"redux\";\nimport { composeWithDevTools } from \"redux-devtools-extension\";\nimport { persistStore, persistReducer } from \"redux-persist\";\nimport storage from \"redux-persist/lib/storage\";\nimport rootReducer from \"./rootReducer\";\nimport thunk from \"redux-thunk\";\n\n/* eslint-disable */\nconst configureStore = () => {\n    const persistConfig = {\n        key: \"root\",\n        storage,\n        whitelist: [\"auth\", \"application\"],\n    };\n    const persistedReducer = persistReducer(persistConfig, rootReducer);\n    const store = createStore(\n        persistedReducer,\n        composeWithDevTools(applyMiddleware(thunk))\n    );\n    const persistor = persistStore(store);\n\n    if (process.env.NODE_ENV !== \"production\") {\n        if (module.hot) {\n            module.hot.accept(\"./rootReducer\", () => {\n                store.replaceReducer(persistedReducer);\n            });\n        }\n    }\n\n    return { store, persistor };\n};\n/* eslint-enable */\n\nexport default configureStore;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { HashRouter } from \"react-router-dom\";\nimport { PersistGate } from \"redux-persist/integration/react\";\nimport { DevFrame as _DevFrame } from \"./views/dev_frame\";\nimport App from \"./App\";\nimport configureStore from \"./store\";\n\nconst { store, persistor } = configureStore();\n\n// In production, we don't want to wrap the app in a dev frame,\n// but we do want to in development\nlet DevFrame = function (props) {\n    return <React.Fragment>{props.children}</React.Fragment>;\n};\n/* eslint-disable */\nif (process.env.REACT_APP_DEV_FEATURES) {\n    DevFrame = _DevFrame;\n}\n/* eslint-enable */\n\nconst render = (Component) => {\n    return ReactDOM.render(\n        <HashRouter>\n            <Provider store={store}>\n                <PersistGate persistor={persistor}>\n                    <DevFrame>\n                        <div id=\"app-body\">\n                            <Component />\n                        </div>\n                    </DevFrame>\n                </PersistGate>\n            </Provider>\n        </HashRouter>,\n        document.getElementById(\"root\")\n    );\n};\n\nrender(App);\n\n// Hot module reloading\n// https://medium.com/@brianhan/hot-reloading-cra-without-eject-b54af352c642\n\n/*eslint-disable */\nif (module.hot) {\n    module.hot.accept(\"./App\", () => {\n        const NextApp = require(\"./App\").default;\n        render(NextApp);\n    });\n}\n/*eslint-enable */\n","import React, { useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { initFromStage, activeRoleSelector } from \"./api/actions\";\nimport { ConnectedNotifications } from \"./views/notifications\";\nimport { AdminRoutes, InstructorRoutes } from \"./views/routes\";\nimport { AdminHeader } from \"./views/admin\";\n\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport \"./App.css\";\nimport { InstructorHeader } from \"./views/instructor\";\n\nexport default function ConnectedApp() {\n    const activeRole = useSelector(activeRoleSelector);\n    const dispatch = useDispatch();\n\n    useEffect(() => {\n        // When the page is first loaded, we need to fetch all the data\n        // associated with the page. This is done via a call to `initFromStage`.\n        dispatch(initFromStage(\"pageLoad\"));\n    }, [dispatch]);\n\n    let body = <div>Loading...</div>;\n\n    if (activeRole === \"admin\") {\n        body = (\n            <>\n                <AdminHeader />\n                <div className=\"view-container\">\n                    <AdminRoutes />\n                </div>\n            </>\n        );\n    }\n\n    if (activeRole === \"instructor\") {\n        body = (\n            <>\n                <InstructorHeader />\n                <div className=\"view-container\">\n                    <InstructorRoutes />\n                </div>\n            </>\n        );\n    }\n    if (activeRole === \"ta\") {\n        body = \"Viewing as TA\";\n    }\n\n    return (\n        <React.Fragment>\n            {body}\n            <ConnectedNotifications />\n        </React.Fragment>\n    );\n}\n","/*\n * A collection of utility functions for interfacing with urls\n */\n\n/**\n * Try to parse `s` as a native javascript type. E.g., \"45.6\" will\n * be parsed as a number, \"true\" will be parsed as `true`, \"[]\"\n * will be parsed as an empty array.\n *\n * @param {string} s\n * @returns\n */\nfunction stringToNativeType(s) {\n    if (typeof s === \"string\" && s !== \"\" && !Number.isNaN(+s)) {\n        return +s;\n    }\n    try {\n        return JSON.parse(s);\n    } catch (e) {\n        return s;\n    }\n}\n\nfunction parseURLSearchString(s) {\n    const searchParams = new URLSearchParams(s);\n    const ret = {};\n    for (const [key, val] of searchParams.entries()) {\n        ret[key] = stringToNativeType(val);\n    }\n    return ret;\n}\n\nexport { stringToNativeType, parseURLSearchString };\n","import PropTypes from \"prop-types\";\n\n/**\n * Generate proptypes for API responses using the passed-in proptypes function.\n * This is encapsulated so that `PropTypes` can be replaced (for example, with a proxy\n * used for documentation generation).\n *\n * @param {*} PropTypes - a PropTypes function (coming from the `\"prop-types\"` module or elsewhere)\n * @returns an object of PropTypes\n */\nfunction generatePropTypes(PropTypes) {\n    const id = PropTypes.oneOfType([PropTypes.number, PropTypes.string]);\n\n    return {\n        apiResponse: PropTypes.shape({\n            status: PropTypes.oneOf([\"success\", \"error\"]).isRequired,\n            message: PropTypes.string,\n            payload: PropTypes.any,\n        }),\n        apiResponseSuccess: PropTypes.shape({\n            status: PropTypes.oneOf([\"success\"]).isRequired,\n            message: PropTypes.string,\n            payload: PropTypes.any,\n        }),\n        apiResponseError: PropTypes.shape({\n            status: PropTypes.oneOf([\"error\"]).isRequired,\n            message: PropTypes.string.isRequired,\n            payload: PropTypes.any,\n        }),\n        idOnly: PropTypes.shape({\n            id,\n        }),\n        session: PropTypes.shape({\n            id,\n            start_date: PropTypes.string,\n            end_date: PropTypes.string,\n            name: PropTypes.string.isRequired,\n        }),\n        contractTemplateMinimal: PropTypes.shape({\n            template_file: PropTypes.string,\n        }),\n        contractTemplate: PropTypes.shape({\n            template_file: PropTypes.string,\n            template_name: PropTypes.string,\n        }),\n        position: PropTypes.shape({\n            position_code: PropTypes.string.isRequired,\n            position_title: PropTypes.string,\n            hours_per_assignment: PropTypes.number,\n            start_date: PropTypes.string,\n            end_date: PropTypes.string,\n            contract_template_id: id,\n            duties: PropTypes.string,\n            qualifications: PropTypes.string,\n            ad_hours_per_assignment: PropTypes.number,\n            ad_num_assignments: PropTypes.number,\n            ad_open_date: PropTypes.string,\n            ad_close_date: PropTypes.string,\n            desired_num_assignments: PropTypes.number,\n            current_enrollment: PropTypes.number,\n            current_waitlisted: PropTypes.number,\n            instructor_ids: PropTypes.arrayOf(id),\n            instructor_preference: PropTypes.arrayOf(\n                PropTypes.shape({\n                    preference_level: PropTypes.number,\n                    applicant_id: id,\n                    instructor_id: id,\n                })\n            ),\n        }),\n        instructor: PropTypes.shape({\n            first_name: PropTypes.string.isRequired,\n            last_name: PropTypes.string.isRequired,\n            email: PropTypes.string,\n            utorid: PropTypes.string.isRequired,\n        }),\n        assignment: PropTypes.shape({\n            start_date: PropTypes.string,\n            end_date: PropTypes.string,\n            note: PropTypes.string,\n            contract_override_pdf: PropTypes.string,\n            applicant_id: id.isRequired,\n            position_id: id.isRequired,\n            active_offer_status: PropTypes.oneOf([\n                \"accepted\",\n                \"rejected\",\n                \"withdrawn\",\n                \"provisional\",\n                \"pending\",\n                \"no_offer\",\n                null,\n            ]),\n            active_offer_url_token: PropTypes.string,\n            active_offer_recent_activity_date: PropTypes.string,\n            active_offer_nag_count: PropTypes.number,\n        }),\n        applicant: PropTypes.shape({\n            utorid: PropTypes.string.isRequired,\n            student_number: PropTypes.string,\n            first_name: PropTypes.string.isRequired,\n            last_name: PropTypes.string.isRequired,\n            email: PropTypes.string,\n            phone: PropTypes.string,\n        }),\n        wageChunk: PropTypes.shape({\n            start_date: PropTypes.string,\n            end_date: PropTypes.string,\n            hours: PropTypes.number,\n            rate: PropTypes.number,\n        }),\n        reportingTag: PropTypes.shape({\n            name: PropTypes.string,\n        }),\n        offer: PropTypes.shape({\n            first_name: PropTypes.string,\n            last_name: PropTypes.string,\n            email: PropTypes.string,\n            position_code: PropTypes.string,\n            position_title: PropTypes.string,\n            position_start_date: PropTypes.string,\n            position_end_date: PropTypes.string,\n            first_time_ta: PropTypes.bool,\n            instructor_contact_desc: PropTypes.string,\n            pay_period_desc: PropTypes.string,\n            installments: PropTypes.number,\n            ta_coordinator_name: PropTypes.string,\n            ta_coordinator_email: PropTypes.string,\n            emailed_date: PropTypes.string,\n            status: PropTypes.string,\n            accepted_date: PropTypes.string,\n            rejected_date: PropTypes.string,\n            withdrawn_date: PropTypes.string,\n            url_token: PropTypes.string,\n            nag_count: PropTypes.number,\n        }),\n        application: PropTypes.shape({\n            session_id: id,\n            comments: PropTypes.string,\n            program: PropTypes.string,\n            department: PropTypes.string,\n            previous_uoft_experience: PropTypes.string,\n            yip: PropTypes.number,\n            annotation: PropTypes.string,\n            applicant_id: id,\n            position_preference: PropTypes.arrayOf(\n                PropTypes.shape({\n                    preference_level: PropTypes.number,\n                    position_id: id,\n                })\n            ),\n        }),\n        user: PropTypes.shape({\n            utorid: PropTypes.string,\n            roles: PropTypes.arrayOf(PropTypes.string),\n        }),\n        ddah: PropTypes.shape({\n            assignment_id: id,\n            signature: PropTypes.string,\n            approved_date: PropTypes.string,\n            accepted_date: PropTypes.string,\n            revised_date: PropTypes.string,\n            emailed_date: PropTypes.string,\n            url_token: PropTypes.string,\n            duties: PropTypes.arrayOf(\n                PropTypes.shape({\n                    description: PropTypes.string,\n                    hours: PropTypes.number,\n                    order: PropTypes.number,\n                })\n            ),\n        }),\n    };\n}\n\nconst apiPropTypes = generatePropTypes(PropTypes);\n\nexport { apiPropTypes, generatePropTypes };\n","const contract_templates_by_filename = {\n    \"/math/default.html\": `<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <title>Offer Letter</title>\n        <style>\n            * {\n                box-sizing: border-box;\n            }\n            html {\n                margin: 0;\n                padding: 0;\n            }\n            body {\n                width: 8.5in;\n                margin: 0;\n                padding-left: 0.75in;\n                padding-right: 0.75in;\n                hyphens: auto;\n                text-align: justify;\n                box-sizing: border-box;\n                font-family: Helvetica, sans-serif;\n                font-size: 12pt;\n            }\n            .i {\n                font-style: italic;\n            }\n            .emphcolor {\n                color: red;\n            }\n            table.appointment-summary {\n                margin-left: 1in;\n                font-size: 0.9em;\n            }\n            .appointment-summary th {\n                padding-right: 0.5em;\n                text-align: right;\n                font-weight: normal;\n            }\n            .letter-head p {\n                margin-bottom: 0.5in;\n            }\n            .letter-foot {\n                margin-top: 1in;\n            }\n            .signature {\n                font-family: alex_brushregular, cursive;\n                font-size: 30pt;\n                margin-left: 0.5in;\n                margin-bottom: 0.1in;\n            }\n            .applicant .signature {\n                border-bottom: 1px solid black;\n                min-width: 2.5in;\n                display: inline-block;\n                margin-left: 0;\n            }\n            .checkbox {\n                font-size: 18pt;\n            }\n\n            @media only screen and (max-width: 9in) {\n                /* when printed, these styles won't show\n\t\t\t\tbecause the \"screen\" is 8.5in */\n                body {\n                    width: unset;\n                    padding-bottom: 0.5in;\n                    padding-left: 2em;\n                    padding-right: 2em;\n                }\n            }\n        </style>\n        <link rel=\"stylesheet\" href=\"font.css\" />\n        <link rel=\"stylesheet\" href=\"header.css\" />\n        <!-- for rendering with wkhtmltopdf styles need to be inlined; when rendered directly in a browser,\n\tthis will just be invalid CSS -->\n        <style>\n            {{ style_font }}\n        </style>\n        <style>\n            {{ style_header }}\n        </style>\n    </head>\n    <body>\n        <div class=\"letter-head\">\n            <div class=\"uoftlogo\"></div>\n            <p>{{ date }}</p>\n            <p>\n                {{ first_name }} {{ last_name }}<br />\n                c/o Some Department<br />\n                University of Toronto\n            </p>\n            <p>Dear {{ first_name }},</p>\n        </div>\n        <div class=\"letter-body\">\n            <p>\n                I am pleased to offer you an appointment as a Teaching Assistant\n                in Some Department. The starting date of your appointment will\n                be {{ start_date | date: \"%b %d, %Y\" }} and this appointment\n                will end on {{ end_date | date: \"%b %d, %Y\" }} with no further\n                notice to you.\n            </p>\n            <h3 class=\"i\">Appointment Summary</h3>\n            <table class=\"appointment-summary\">\n                <tr>\n                    <th>Appointment:</th>\n                    <td class=\"emphcolor\">\n                        {{ position_code }} {{ position_title }}\n                    </td>\n                </tr>\n                <tr>\n                    <th>Hours:</th>\n                    <td class=\"emphcolor\">{{ hours }}</td>\n                </tr>\n                <tr>\n                    <th>Start Date:</th>\n                    <td>{{ start_date | date: \"%b %d, %Y\" }}</td>\n                </tr>\n                <tr>\n                    <th>End Date:</th>\n                    <td>{{ end_date | date: \"%b %d, %Y\" }}</td>\n                </tr>\n                <tr>\n                    <th>Rate:</th>\n                    <td>{{ pay_period_desc }}</td>\n                </tr>\n            </table>\n\n            <p>\n                Your appointment will be for {{ hours }} hours for {{\n                position_code }}. Your Course Coordinator(s) {{\n                instructor_contact_desc }} will be in contact with you. You will\n                be paid {{ pay_period_desc }} for this position. You will be\n                paid in {{ installments }} instalments, once per month for the\n                period of your appointment. Your salary will be paid by direct\n                deposit.\n            </p>\n            Your payroll documentation will be available online through the\n            University’s Employee Self-Service (ESS) at\n            <a href=\"http://ess.hrandequity.utoronto.ca/\"\n                >ess.hrandequity.utoronto.ca/</a\n            >. This includes electronic delivery of your pay statement, tax\n            documentation, and other payroll documentation as made available\n            from time to time. You are able to print copies of these documents\n            directly from ESS.\n            <p>\n                By signing this Employment Agreement, you authorize the\n                University to provide your T4 slips electronically and not in a\n                paper format. If you wish to discuss an alternative format,\n                please contact Central Payroll Services at\n                payroll.hr@utoronto.ca.\n            </p>\n            <p>\n                This appointment is being granted on the basis that you are a\n                student or Post-Doctoral Fellow (PDF) at the University of\n                Toronto on the starting date of the appointment. If you are not\n                a student or PDF on the starting date of this appointment, this\n                offer is revoked and the University will have no obligations\n                under this letter.\n            </p>\n            <p>\n                As a Teaching Assistant, you will be a member of the Canadian\n                Union of Public Employees (CUPE) Local 3902, Unit 1 bargaining\n                unit. Your employment will be governed by the terms and\n                conditions of the collective agreement between the University of\n                Toronto and CUPE Local 3902, which may be found on the web at\n                <br />\n                <a\n                    href=\"http://agreements.hrandequity.utoronto.ca/#CUPE3902_Unit1\"\n                    >agreements.hrandequity.utoronto.ca/#CUPE3902_Unit1</a\n                >\n                <br />\n                Once you accept the offer of employment, a copy of the agreement\n                will be given to you if you do not already have one. A statement\n                about the Union, along with other information about the Union,\n                can be found on the Union's website (<a\n                    href=\"http://www.cupe3902.org/unit-1/\"\n                    >http://www.cupe3902.org/unit-1/</a\n                >). All of this information is that of the Union, represents the\n                views of the Union, and has not been approved or endorsed by the\n                University.\n            </p>\n            <h3>Required Training</h3>\n            <p>\n                You are required to take the following training:\n            </p>\n            <ul>\n                <li>\n                    U of T AODA Online Training, provided by the Accessibility\n                    for Ontarians with Disabilities Act (AODA) Office, available\n                    at\n                    <a href=\"http://aoda.hrandequity.utoronto.ca/\"\n                        >aoda.hrandequity.utoronto.ca/</a\n                    >\n                </li>\n            </ul>\n            <p>\n                If you are new to the University, or have not previously\n                completed the training, you will be notified by email when the\n                training module becomes available for your completion, normally\n                one month after the start date of this appointment. Completion\n                of this training will be automatically captured in the system\n                and you will be paid for this training in accordance with the\n                rates set out in your collective agreement. Please note that you\n                only need to complete the above training program once with the\n                University.\n            </p>\n            <h3>Policies & Procedures</h3>\n            <p>\n                You will also be subject to and bound by University policies of\n                general application and their related guidelines. The policies\n                are listed on the Governing Council website at\n                <a\n                    href=\"http://www.governingcouncil.utoronto.ca/Governing_Council/Policies.htm\"\n                    >www.governingcouncil.utoronto.ca/Governing_Council/Policies.htm</a\n                >\n                For convenience, a partial list of policies, those applicable to\n                all employees, and related guidelines can be found on the Human\n                Resources and Equity website at policies.hrandequity.utoronto.ca\n                Printed versions will be provided, upon request, through Human\n                Resources or your supervisor.\n            </p>\n            <p>\n                You should pay particular attention to those policies which\n                confirm the University’s commitment to, and your obligation to\n                support, a workplace that is free from discrimination and\n                harassment as set out in the Human Rights Code, is safe as set\n                out in the Occupational Health and Safety Act, and that respects\n                the University's commitment to equity and to workplace civility.\n            </p>\n            <p>\n                All of the applicable policies may be amended and/or new\n                policies may be introduced from time to time. When this happens,\n                if notice is required you will be given notice as the University\n                deems necessary and the amendments will become binding terms of\n                your employment contract with the University.\n            </p>\n            <h3>Accessibility</h3>\n            <p>\n                The University has a number of programs and services available\n                to employees who have need of accommodation due to disability\n                through its Health & Well-being Programs and Services (<a\n                    href=\"http://www.hrandequity.utoronto.ca/about-hr-equity/health.htm\"\n                    >www.hrandequity.utoronto.ca/about-hr-equity/health.htm</a\n                >). A description of the accommodation process is available in\n                the Accommodation for Employees with Disabilities: U of T\n                Guidelines, which may be found at:\n                <br />\n                <a\n                    href=\"http://well-being.hrandequity.utoronto.ca/services/#accommodation\"\n                    >well-being.hrandequity.utoronto.ca/services/#accommodation</a\n                >\n                <br />\n                In the event that you have a disability that would impact upon\n                how you would respond to an emergency in the workplace (e.g.,\n                situations requiring evacuation), you should contact Health &\n                Well-being Programs & Services at 416.978.2149 as soon as\n                possible so that you can be provided with information regarding\n                an individualized emergency response plan.\n            </p>\n            <p>\n                The law requires the Employment Standards Act Poster to be\n                provided to all employees; it is available on the HR & Equity\n                website at\n                <a\n                    href=\"http://www.hrandequity.utoronto.ca/news/employment-standards-ontario\"\n                    >www.hrandequity.utoronto.ca/news/employment-standards-ontario</a\n                >\n                This poster describes the minimum rights and obligations\n                contained in the Employment Standards Act. Please note that in\n                many respects this offer of employment exceeds the minimum\n                requirements set out in the Act.\n            </p>\n            <p>\n                Your duties may include all or any combination of the following:\n                grading, scheduled tutorials, office hours, Math Aid Centre\n                hours, and test and exam invigilation. You will be expected to\n                complete all grading for all student work that is completed\n                during the term of the appointment, up to and including final\n                exams.\n            </p>\n            <p>\n                Within 15 working days after the date of this letter, you will\n                be given the opportunity to review the Description of Duties and\n                Allocation of Hours (DDAH) form, which will set out more\n                specifically the duties of your position, and the hours assigned\n                to each.\n            </p>\n            <p>\n                Please sign below to indicate your acceptance of this offer, and\n                return a copy of this letter to me as soon as possible but no\n                later than 2 days after you have been provided with the DDAH\n                form. If we have not heard from you by this deadline, this offer\n                may be withdrawn. If you are unable to accept this offer, please\n                advise me immediately.\n            </p>\n            <p>\n                If you have any questions, please contact me via email at\n                <a href=\"mailto:tacoord@toronto.edu\">tacoord@toronto.edu</a>\n            </p>\n        </div>\n        <div class=\"letter-foot tacoordinator\">\n            <p>Yours sincerely,</p>\n            <div class=\"signature\">Tom Tomson</div>\n            <div class=\"details\">\n                Tom Tomson<br />TA Coordinator<br />Some Department\n            </div>\n        </div>\n        <div>\n            <p>\n                <span class=\"checkbox\"\n                    >{% if signature == blank %}☐{% else %}☑{% endif %}</span\n                >\n                I confirm that I will be registered as a University of Toronto\n                student or PDF on the date that this appointment begins. I\n                understand that if I should cease to be registered as a\n                University of Toronto student or PDF during the period of this\n                appointment, for any reason other than convocation, I must\n                immediately notify my supervisor, and my appointment may be\n                terminated.\n            </p>\n        </div>\n        <div class=\"letter-foot applicant\">\n            <p>Please sign below to accept this offer.</p>\n            <div class=\"signature\">{{ signature }}</div>\n            <div class=\"details\">\n                Applicant Signature\n            </div>\n        </div>\n    </body>\n</html>`,\n    \"/math/oto.html\": `<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <title>Offer Letter</title>\n        <style>\n            * {\n                box-sizing: border-box;\n            }\n            html {\n                margin: 0;\n                padding: 0;\n            }\n            body {\n                width: 8.5in;\n                margin: 0;\n                padding-left: 0.75in;\n                padding-right: 0.75in;\n                hyphens: auto;\n                text-align: justify;\n                box-sizing: border-box;\n                font-family: Helvetica, sans-serif;\n                font-size: 12pt;\n            }\n            .i {\n                font-style: italic;\n            }\n            .emphcolor {\n                color: red;\n            }\n            table.appointment-summary {\n                margin-left: 1in;\n                font-size: 0.9em;\n            }\n            .appointment-summary th {\n                padding-right: 0.5em;\n                text-align: right;\n                font-weight: normal;\n            }\n            .letter-head p {\n                margin-bottom: 0.5in;\n            }\n            .letter-foot {\n                margin-top: 1in;\n            }\n            .signature {\n                font-family: alex_brushregular, cursive;\n                font-size: 30pt;\n                margin-left: 0.5in;\n                margin-bottom: 0.1in;\n            }\n            .applicant .signature {\n                border-bottom: 1px solid black;\n                min-width: 2.5in;\n                display: inline-block;\n                margin-left: 0;\n            }\n            .checkbox {\n                font-size: 18pt;\n            }\n\n            @media only screen and (max-width: 9in) {\n                /* when printed, these styles won't show\n\t\t\t\tbecause the \"screen\" is 8.5in */\n                body {\n                    width: unset;\n                    padding-bottom: 0.5in;\n                    padding-left: 2em;\n                    padding-right: 2em;\n                }\n            }\n        </style>\n        <link rel=\"stylesheet\" href=\"font.css\" />\n        <link rel=\"stylesheet\" href=\"header.css\" />\n        <!-- for rendering with wkhtmltopdf styles need to be inlined; when rendered directly in a browser,\n\tthis will just be invalid CSS -->\n        <style>\n            {{ style_font }}\n        </style>\n        <style>\n            {{ style_header }}\n        </style>\n    </head>\n    <body>\n        <div class=\"letter-head\">\n            <div class=\"uoftlogo\"></div>\n            <p>{{ date }}</p>\n            <p>\n                {{ first_name }} {{ last_name }}<br />\n                c/o Some Department<br />\n                University of Toronto\n            </p>\n            <p>Dear {{ first_name }},</p>\n        </div>\n        <div class=\"letter-body\">\n            <p>\n                I am pleased to offer you an appointment as a Teaching Assistant\n                in Some Department. The starting date of your appointment will\n                be {{ start_date | date: \"%b %d, %Y\" }} and this appointment\n                will end on {{ end_date | date: \"%b %d, %Y\" }} with no further\n                notice to you.\n            </p>\n            <h3 class=\"i\">Appointment Summary</h3>\n            <table class=\"appointment-summary\">\n                <tr>\n                    <th>Appointment:</th>\n                    <td class=\"emphcolor\">\n                        {{ position_code }} {{ position_title }}\n                    </td>\n                </tr>\n                <tr>\n                    <th>Hours:</th>\n                    <td class=\"emphcolor\">{{ hours }}</td>\n                </tr>\n                <tr>\n                    <th>Start Date:</th>\n                    <td>{{ start_date | date: \"%b %d, %Y\" }}</td>\n                </tr>\n                <tr>\n                    <th>End Date:</th>\n                    <td>{{ end_date | date: \"%b %d, %Y\" }}</td>\n                </tr>\n                <tr>\n                    <th>Rate:</th>\n                    <td>{{ pay_period_desc }}</td>\n                </tr>\n            </table>\n\n            <p>\n                Your appointment will be for {{ hours }} hours for {{\n                position_code }}. This is a ONE TIME ONLY appointment. Your Course Coordinator(s) {{\n                instructor_contact_desc }} will be in contact with you. You will\n                be paid {{ pay_period_desc }} for this position. You will be\n                paid in one instalment. Your salary will be paid by direct\n                deposit.\n            </p>\n            Your payroll documentation will be available online through the\n            University’s Employee Self-Service (ESS) at\n            <a href=\"http://ess.hrandequity.utoronto.ca/\"\n                >ess.hrandequity.utoronto.ca/</a\n            >. This includes electronic delivery of your pay statement, tax\n            documentation, and other payroll documentation as made available\n            from time to time. You are able to print copies of these documents\n            directly from ESS.\n            <p>\n                By signing this Employment Agreement, you authorize the\n                University to provide your T4 slips electronically and not in a\n                paper format. If you wish to discuss an alternative format,\n                please contact Central Payroll Services at\n                payroll.hr@utoronto.ca.\n            </p>\n            <p>\n                This appointment is being granted on the basis that you are a\n                student or Post-Doctoral Fellow (PDF) at the University of\n                Toronto on the starting date of the appointment. If you are not\n                a student or PDF on the starting date of this appointment, this\n                offer is revoked and the University will have no obligations\n                under this letter.\n            </p>\n            <p>\n                As a Teaching Assistant, you will be a member of the Canadian\n                Union of Public Employees (CUPE) Local 3902, Unit 1 bargaining\n                unit. Your employment will be governed by the terms and\n                conditions of the collective agreement between the University of\n                Toronto and CUPE Local 3902, which may be found on the web at\n                <br />\n                <a\n                    href=\"http://agreements.hrandequity.utoronto.ca/#CUPE3902_Unit1\"\n                    >agreements.hrandequity.utoronto.ca/#CUPE3902_Unit1</a\n                >\n                <br />\n                Once you accept the offer of employment, a copy of the agreement\n                will be given to you if you do not already have one. A statement\n                about the Union, along with other information about the Union,\n                can be found on the Union's website (<a\n                    href=\"http://www.cupe3902.org/unit-1/\"\n                    >http://www.cupe3902.org/unit-1/</a\n                >). All of this information is that of the Union, represents the\n                views of the Union, and has not been approved or endorsed by the\n                University.\n            </p>\n            <h3>Required Training</h3>\n            <p>\n                You are required to take the following training:\n            </p>\n            <ul>\n                <li>\n                    U of T AODA Online Training, provided by the Accessibility\n                    for Ontarians with Disabilities Act (AODA) Office, available\n                    at\n                    <a href=\"http://aoda.hrandequity.utoronto.ca/\"\n                        >aoda.hrandequity.utoronto.ca/</a\n                    >\n                </li>\n            </ul>\n            <p>\n                If you are new to the University, or have not previously\n                completed the training, you will be notified by email when the\n                training module becomes available for your completion, normally\n                one month after the start date of this appointment. Completion\n                of this training will be automatically captured in the system\n                and you will be paid for this training in accordance with the\n                rates set out in your collective agreement. Please note that you\n                only need to complete the above training program once with the\n                University.\n            </p>\n            <h3>Policies & Procedures</h3>\n            <p>\n                You will also be subject to and bound by University policies of\n                general application and their related guidelines. The policies\n                are listed on the Governing Council website at\n                <a\n                    href=\"http://www.governingcouncil.utoronto.ca/Governing_Council/Policies.htm\"\n                    >www.governingcouncil.utoronto.ca/Governing_Council/Policies.htm</a\n                >\n                For convenience, a partial list of policies, those applicable to\n                all employees, and related guidelines can be found on the Human\n                Resources and Equity website at policies.hrandequity.utoronto.ca\n                Printed versions will be provided, upon request, through Human\n                Resources or your supervisor.\n            </p>\n            <p>\n                You should pay particular attention to those policies which\n                confirm the University’s commitment to, and your obligation to\n                support, a workplace that is free from discrimination and\n                harassment as set out in the Human Rights Code, is safe as set\n                out in the Occupational Health and Safety Act, and that respects\n                the University's commitment to equity and to workplace civility.\n            </p>\n            <p>\n                All of the applicable policies may be amended and/or new\n                policies may be introduced from time to time. When this happens,\n                if notice is required you will be given notice as the University\n                deems necessary and the amendments will become binding terms of\n                your employment contract with the University.\n            </p>\n            <h3>Accessibility</h3>\n            <p>\n                The University has a number of programs and services available\n                to employees who have need of accommodation due to disability\n                through its Health & Well-being Programs and Services (<a\n                    href=\"http://www.hrandequity.utoronto.ca/about-hr-equity/health.htm\"\n                    >www.hrandequity.utoronto.ca/about-hr-equity/health.htm</a\n                >). A description of the accommodation process is available in\n                the Accommodation for Employees with Disabilities: U of T\n                Guidelines, which may be found at:\n                <br />\n                <a\n                    href=\"http://well-being.hrandequity.utoronto.ca/services/#accommodation\"\n                    >well-being.hrandequity.utoronto.ca/services/#accommodation</a\n                >\n                <br />\n                In the event that you have a disability that would impact upon\n                how you would respond to an emergency in the workplace (e.g.,\n                situations requiring evacuation), you should contact Health &\n                Well-being Programs & Services at 416.978.2149 as soon as\n                possible so that you can be provided with information regarding\n                an individualized emergency response plan.\n            </p>\n            <p>\n                The law requires the Employment Standards Act Poster to be\n                provided to all employees; it is available on the HR & Equity\n                website at\n                <a\n                    href=\"http://www.hrandequity.utoronto.ca/news/employment-standards-ontario\"\n                    >www.hrandequity.utoronto.ca/news/employment-standards-ontario</a\n                >\n                This poster describes the minimum rights and obligations\n                contained in the Employment Standards Act. Please note that in\n                many respects this offer of employment exceeds the minimum\n                requirements set out in the Act.\n            </p>\n            <p>\n                Your duties may include all or any combination of the following:\n                grading, scheduled tutorials, office hours, Math Aid Centre\n                hours, and test and exam invigilation. You will be expected to\n                complete all grading for all student work that is completed\n                during the term of the appointment, up to and including final\n                exams.\n            </p>\n            <p>\n                Within 15 working days after the date of this letter, you will\n                be given the opportunity to review the Description of Duties and\n                Allocation of Hours (DDAH) form, which will set out more\n                specifically the duties of your position, and the hours assigned\n                to each.\n            </p>\n            <p>\n                Please sign below to indicate your acceptance of this offer, and\n                return a copy of this letter to me as soon as possible but no\n                later than 2 days after you have been provided with the DDAH\n                form. If we have not heard from you by this deadline, this offer\n                may be withdrawn. If you are unable to accept this offer, please\n                advise me immediately.\n            </p>\n            <p>\n                If you have any questions, please contact me via email at\n                <a href=\"mailto:tacoord@toronto.edu\">tacoord@toronto.edu</a>\n            </p>\n        </div>\n        <div class=\"letter-foot tacoordinator\">\n            <p>Yours sincerely,</p>\n            <div class=\"signature\">Tom Tomson</div>\n            <div class=\"details\">\n                Tom Tomson<br />TA Coordinator<br />Some Department\n            </div>\n        </div>\n        <div>\n            <p>\n                <span class=\"checkbox\"\n                    >{% if signature == blank %}☐{% else %}☑{% endif %}</span\n                >\n                I confirm that I will be registered as a University of Toronto\n                student or PDF on the date that this appointment begins. I\n                understand that if I should cease to be registered as a\n                University of Toronto student or PDF during the period of this\n                appointment, for any reason other than convocation, I must\n                immediately notify my supervisor, and my appointment may be\n                terminated.\n            </p>\n        </div>\n        <div class=\"letter-foot applicant\">\n            <p>Please sign below to accept this offer.</p>\n            <div class=\"signature\">{{ signature }}</div>\n            <div class=\"details\">\n                Applicant Signature\n            </div>\n        </div>\n    </body>\n</html>`,\n};\n// It's not important to store separate HTML templates for each of these\n// so just duplicate an existing template.\ncontract_templates_by_filename[\"/math/default2018.html\"] =\n    contract_templates_by_filename[\"/math/default.html\"];\ncontract_templates_by_filename[\"/math/invigilate.html\"] =\n    contract_templates_by_filename[\"/math/default.html\"];\ncontract_templates_by_filename[\"/math/invigilate2014.html\"] =\n    contract_templates_by_filename[\"/math/default.html\"];\n\nexport const mockData = {\n    sessions: [\n        {\n            id: 1,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            name: \"2019 Fall\",\n            rate1: 45.55,\n            rate2: 47.33,\n        },\n        {\n            id: 2,\n            start_date: \"2020-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-30T00:00:00.000Z\",\n            name: \"2021 Spring\",\n            rate1: 45.55,\n            rate2: null,\n        },\n    ],\n    available_contract_templates: [\n        {\n            template_file: \"/math/default.html\",\n        },\n        {\n            template_file: \"/math/default2018.html\",\n        },\n        {\n            template_file: \"/math/invigilate.html\",\n        },\n        {\n            template_file: \"/math/invigilate2014.html\",\n        },\n        {\n            template_file: \"/math/oto.html\",\n        },\n    ],\n    contract_templates: [\n        {\n            id: 1,\n            template_name: \"standard\",\n            template_file: \"/math/default.html\",\n        },\n        {\n            id: 2,\n            template_name: \"oto\",\n            template_file: \"/math/oto.html\",\n        },\n        {\n            id: 3,\n            template_name: \"standard\",\n            template_file: \"/math/default2018.html\",\n        },\n        {\n            id: 4,\n            template_name: \"invigilate\",\n            template_file: \"/math/invigilate.html\",\n        },\n    ],\n    contract_templates_by_session: {\n        1: [1, 2],\n        2: [3, 4],\n    },\n    contract_templates_by_filename: contract_templates_by_filename,\n    instructors: [\n        {\n            id: 1000,\n            last_name: \"Smith\",\n            first_name: \"Henry\",\n            email: \"hery.smith@utoronto.ca\",\n            utorid: \"smithh\",\n        },\n        {\n            id: 1001,\n            last_name: \"Garcia\",\n            first_name: \"Emily\",\n            email: \"emily.garcia@utoronto.ca\",\n            utorid: \"garciae\",\n        },\n        {\n            id: 1002,\n            last_name: \"Miller\",\n            first_name: \"Megan\",\n            email: \"megan.miller@utoronto.ca\",\n            utorid: \"millerm\",\n        },\n        {\n            id: 1003,\n            last_name: \"Beera\",\n            first_name: \"Lizzy\",\n            email: \"lizzy.beera@utoronto.ca\",\n            utorid: \"beeral\",\n        },\n    ],\n    positions_by_session: {\n        1: [10, 11, 14, 15, 16],\n        2: [12, 13],\n    },\n    positions: [\n        {\n            id: 10,\n            position_code: \"MAT135H1F\",\n            position_title: \"Calculus I\",\n            hours_per_assignment: 70,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            contract_template_id: 1,\n            duties: \"Tutorials\",\n            qualifications: \"Teaching skill\",\n            ad_hours_per_assignment: 70,\n            ad_num_assignments: 15,\n            ad_open_date: \"2019-08-01T00:00:00.000Z\",\n            ad_close_date: \"2019-08-15T00:00:00.000Z\",\n            desired_num_assignments: 15,\n            current_enrollment: 1200,\n            current_waitlisted: 200,\n            instructor_ids: [1000, 1001],\n            instructor_preferences: [\n                {\n                    preference_level: 2,\n                    applicant_id: 2000,\n                    instructor_id: 1000,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2002,\n                    instructor_id: 1000,\n                },\n                {\n                    preference_level: -1,\n                    applicant_id: 2005,\n                    instructor_id: 1001,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2002,\n                    instructor_id: 1001,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2006,\n                    instructor_id: 1001,\n                },\n            ],\n        },\n        {\n            id: 11,\n            position_code: \"MAT136H1F\",\n            position_title: \"Calculus II\",\n            hours_per_assignment: 70,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            contract_template_id: 2,\n            instructor_ids: [],\n        },\n        {\n            id: 12,\n            position_code: \"CSC135H1F\",\n            position_title: \"Computer Fun\",\n            hours_per_assignment: 70,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            duties: \"Tutorials\",\n            contract_template_id: 3,\n            instructor_ids: [1000],\n            instructor_preferences: [\n                {\n                    preference_level: -1,\n                    applicant_id: 2005,\n                    instructor_id: 1000,\n                },\n                {\n                    preference_level: 2,\n                    applicant_id: 2001,\n                    instructor_id: 1000,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2006,\n                    instructor_id: 1000,\n                },\n            ],\n        },\n        {\n            id: 13,\n            position_code: \"MAT235H1F\",\n            position_title: \"Calculus III\",\n            hours_per_assignment: 70,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            contract_template_id: 3,\n            instructor_ids: [1002],\n            instructor_preferences: [\n                {\n                    preference_level: 2,\n                    applicant_id: 2000,\n                    instructor_id: 1002,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2002,\n                    instructor_id: 1002,\n                },\n            ],\n        },\n        {\n            instructor_ids: [1002],\n            position_code: \"CSC100H1S\",\n            position_title: \"Computers for Humans\",\n            hours_per_assignment: 100,\n            duties:\n                \"Some combination of marking, invigilating, tutorials, office hours, and the help centre.\",\n            contract_template_id: 1,\n            start_date: \"2021-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 14,\n        },\n        {\n            instructor_ids: [1000],\n            position_code: \"MAT137Y1Y\",\n            position_title: \"Calculus!\",\n            hours_per_assignment: 250,\n            duties:\n                \"Some combination of marking, invigilating, tutorials, office hours, and the help centre.\",\n            contract_template_id: 1,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            qualifications: \"Skilled Proofs Reader\",\n            current_enrollment: 1500,\n            current_waitlisted: 78,\n            desired_num_assignments: 22,\n            id: 15,\n        },\n        {\n            instructor_ids: [1001],\n            position_code: \"MAT135H1F Head TA\",\n            position_title: \"Calculus I\",\n            hours_per_assignment: 225,\n            duties: \"Top-notch Head TA Stuff\",\n            contract_template_id: 1,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            desired_num_assignments: 3,\n            id: 16,\n        },\n    ],\n    applicants: [\n        {\n            id: 2000,\n            utorid: \"weasleyr\",\n            student_number: \"89013443\",\n            first_name: \"Ron\",\n            last_name: \"Weasley\",\n            email: \"ron@potter.com\",\n            phone: \"543-223-9993\",\n        },\n        {\n            id: 2001,\n            utorid: \"potterh\",\n            student_number: \"999666999\",\n            first_name: \"Harry\",\n            last_name: \"Potter\",\n            email: \"harry@potter.com\",\n        },\n        {\n            id: 2002,\n            utorid: \"smithb\",\n            email: \"smithb@mail.utoronto.ca\",\n            first_name: \"Bethany\",\n            last_name: \"Smith\",\n            student_number: \"131382748\",\n        },\n        {\n            id: 2003,\n            utorid: \"wilsonh\",\n            email: \"wilsonh@mail.utoronto.ca\",\n            first_name: \"Hanna\",\n            last_name: \"Wilson\",\n            student_number: \"600366904\",\n        },\n        {\n            id: 2004,\n            utorid: \"molinat\",\n            email: \"molinat@mail.utoronto.ca\",\n            first_name: \"Troy\",\n            last_name: \"Molina\",\n            student_number: \"328333023\",\n        },\n        {\n            id: 2005,\n            utorid: \"howeyb\",\n            email: \"howeyb@mail.utoronto.ca\",\n            first_name: \"Brett\",\n            last_name: \"Howey\",\n            student_number: \"329613524\",\n        },\n        {\n            id: 2006,\n            utorid: \"brownd\",\n            email: \"brownd@mail.utoronto.ca\",\n            first_name: \"David\",\n            last_name: \"Brown\",\n            student_number: \"29151485\",\n        },\n    ],\n    assignments_by_session: {\n        1: [100, 101, 102, 103, 104, 105, 106, 107, 108, 109],\n        2: [],\n    },\n    assignments: [\n        {\n            id: 100,\n            position_id: 10,\n            applicant_id: 2001,\n            hours: 90,\n        },\n        {\n            id: 101,\n            position_id: 10,\n            applicant_id: 2005,\n            hours: 95,\n        },\n        {\n            note: \"\",\n            position_id: 16,\n            applicant_id: 2000,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            id: 102,\n        },\n        {\n            note: \"\",\n            position_id: 16,\n            applicant_id: 2002,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            id: 103,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2001,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 104,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2002,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 105,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2005,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 106,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2000,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 107,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2006,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 108,\n        },\n        {\n            note: \"\",\n            position_id: 14,\n            applicant_id: 2002,\n            start_date: \"2021-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 109,\n        },\n    ],\n    wage_chunks: [\n        {\n            id: 3000,\n            assignment_id: 100,\n            hours: 20,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            rate: 10.01,\n        },\n        {\n            id: 3001,\n            assignment_id: 100,\n            hours: 35,\n            start_date: \"2020-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-20T00:00:00.000Z\",\n            rate: 12.02,\n        },\n        {\n            id: 3002,\n            assignment_id: 101,\n            hours: 95,\n            start_date: \"2019-09-01T00:00:00.000Z\",\n            end_date: \"2020-04-20T00:00:00.000Z\",\n            rate: null,\n        },\n        {\n            id: 3003,\n            assignment_id: 102,\n            hours: 225,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n        },\n        {\n            id: 3004,\n            assignment_id: 103,\n            hours: 225,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n        },\n        {\n            id: 3005,\n            assignment_id: 104,\n            hours: 125,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3006,\n            assignment_id: 104,\n            hours: 125,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3007,\n            assignment_id: 105,\n            hours: 125,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3008,\n            assignment_id: 105,\n            hours: 125,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3009,\n            assignment_id: 106,\n            hours: 125,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3010,\n            assignment_id: 106,\n            hours: 125,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3011,\n            assignment_id: 107,\n            hours: 100,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3012,\n            assignment_id: 107,\n            hours: 100,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3013,\n            assignment_id: 108,\n            hours: 100,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3014,\n            assignment_id: 108,\n            hours: 100,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3015,\n            assignment_id: 109,\n            hours: 100,\n            start_date: \"2021-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n    ],\n    offers: [\n        {\n            id: 10000,\n            assignment_id: 100,\n            status: \"withdrawn\",\n        },\n        {\n            id: 10001,\n            assignment_id: 100,\n            status: \"pending\",\n        },\n        {\n            id: 10002,\n            assignment_id: 101,\n            status: \"accepted\",\n        },\n        {\n            id: 10003,\n            assignment_id: 102,\n            status: \"withdrawn\",\n        },\n    ],\n    applications: [\n        {\n            id: 15000,\n            comments: \"\",\n            program: \"Phd\",\n            department: \"Computer Science\",\n            previous_uoft_ta_experience: \"Last year I TAed a bunch\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2000,\n            position_preferences: [\n                {\n                    preference_level: 2,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 15,\n                },\n            ],\n        },\n        {\n            id: 15001,\n            comments: \"\",\n            program: \"UG\",\n            department: \"Computer Science\",\n            previous_uoft_ta_experience: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2001,\n            position_preferences: [\n                {\n                    preference_level: 0,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n            ],\n        },\n        {\n            id: 15002,\n            comments: \"\",\n            program: \"Phd\",\n            department: \"Math\",\n            previous_uoft_ta_experience: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2002,\n            position_preferences: [\n                {\n                    preference_level: 3,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 2,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 11,\n                },\n            ],\n        },\n        {\n            id: 15003,\n            comments: \"\",\n            program: \"Phd\",\n            department: \"Computer Science\",\n            previous_uoft_ta_experience: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2005,\n            position_preferences: [\n                {\n                    preference_level: 2,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 1,\n                    position_id: 11,\n                },\n            ],\n        },\n        {\n            id: 15004,\n            comments: \"\",\n            program: \"UG\",\n            department: \"Computer Science\",\n            previous_uoft_ta_experience: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2006,\n            position_preferences: [\n                {\n                    preference_level: 3,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 2,\n                    position_id: 12,\n                },\n            ],\n        },\n        {\n            id: 15005,\n            comments: \"\",\n            program: \"UG\",\n            department: \"Math\",\n            previous_uoft_ta_experience: \"\",\n            yip: 3,\n            annotation: \"\",\n            session_id: 2,\n            applicant_id: 2002,\n            position_preferences: [\n                {\n                    preference_level: 3,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 2,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 11,\n                },\n            ],\n        },\n        {\n            id: 15006,\n            comments: \"\",\n            program: \"MSc\",\n            department: \"Computer Science\",\n            previous_uoft_ta_experience: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 2,\n            applicant_id: 2003,\n            position_preferences: [\n                {\n                    preference_level: 3,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 2,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 11,\n                },\n            ],\n        },\n        {\n            id: 15007,\n            comments: \"\",\n            program: \"UG\",\n            department: \"Computer Science\",\n            previous_uoft_ta_experience: \"\",\n            yip: 4,\n            annotation: \"\",\n            session_id: 2,\n            applicant_id: 2004,\n            position_preferences: [\n                {\n                    preference_level: 1,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n            ],\n        },\n    ],\n    ddahs: [\n        {\n            id: 700,\n            assignment_id: 100,\n            signature: null,\n            approved_date: null,\n            accepted_date: null,\n            revised_date: null,\n            emailed_date: null,\n            url_token: \"DJAKSLJLFD\",\n            duties: [\n                {\n                    order: 2,\n                    hours: 25,\n                    description: \"Marking the midterm\",\n                },\n                {\n                    order: 1,\n                    hours: 4,\n                    description: \"Initial training\",\n                },\n                {\n                    order: 3,\n                    hours: 40,\n                    description: \"Running tutorials\",\n                },\n            ],\n        },\n        {\n            id: 701,\n            assignment_id: 101,\n            signature: \"Brett Howey\",\n            approved_date: null,\n            accepted_date: \"2019-09-02T00:00:00.000Z\",\n            revised_date: null,\n            emailed_date: \"2019-09-02T00:00:00.000Z\",\n            url_token: \"somerandomtoken\",\n            duties: [\n                {\n                    order: 2,\n                    hours: 50,\n                    description: \"Marking the midterm\",\n                },\n                {\n                    order: 1,\n                    hours: 6,\n                    description: \"Initial training\",\n                },\n            ],\n        },\n    ],\n    users: [\n        {\n            email: \"hery.smith@utoronto.ca\",\n            utorid: \"smithh\",\n            roles: [\"admin\", \"instructor\"],\n        },\n        {\n            email: \"emily.garcia@utoronto.ca\",\n            utorid: \"garciae\",\n            roles: [\"instructor\"],\n        },\n        {\n            email: \"megan.miller@utoronto.ca\",\n            utorid: \"millerm\",\n            roles: [\"instructor\"],\n        },\n        {\n            email: \"lizzy.beera@utoronto.ca\",\n            utorid: \"beeral\",\n            roles: [\"instructor\"],\n        },\n    ],\n    active_user: \"smithh\",\n};\n","import {\n    getAttributesCheckMessage,\n    MockAPIController,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session as SessionType } from \"../defs/types\";\n\ninterface RouteParams {\n    role: \"admin\" | \"instructor\" | \"ta\";\n    [key: string]: string;\n}\n\nexport class Session extends MockAPIController {\n    constructor(data: any) {\n        super(data, data.sessions);\n    }\n    create(session: Partial<SessionType>): SessionType {\n        const newSession = super.create(session) as SessionType;\n        // If we insert a new session, we need to make sure we create\n        // a corresponding assignments_by_session array\n        this.data.assignments_by_session[newSession.id] = [];\n        return newSession;\n    }\n    findAll(...args: any[]): SessionType[] {\n        return super.findAll(...args) as SessionType[];\n    }\n    validateNew(session: Partial<SessionType>) {\n        // if we're here, we need to create a new session\n        // but check if the session name is empty or duplicate\n        const message = getAttributesCheckMessage(session, this.ownData, {\n            name: { required: true, unique: true },\n        } as any);\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    validateProp(prop: keyof SessionType, value: any, id: number) {\n        if (prop === \"name\") {\n            // check if `name` is empty\n            if (value === undefined || value.length === 0) {\n                throw new Error(\n                    `Property ${prop} cannot be empty or undefined.`\n                );\n            }\n            // if `name` is not empty, make sure it is unique after the update\n            // by filtering out the request session\n            const filteredData = this.findAll().filter(\n                (item) => item.id !== id\n            );\n            // and make sure `name` is unique to the rest\n            const message = getAttributesCheckMessage(\n                { name: value },\n                filteredData,\n                {\n                    name: { unique: true },\n                } as any\n            );\n            if (message) {\n                throw new Error(message);\n            }\n        }\n\n        return true;\n    }\n}\n\nexport const sessionsRoutes = {\n    get: {\n        \"/sessions\": documentCallback({\n            func: (data: any) => new Session(data).findAll(),\n            summary: \"Get all available sessions\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.session),\n        }),\n    },\n    post: {\n        \"/sessions\": documentCallback({\n            func: (\n                data: any,\n                params: RouteParams,\n                body: Partial<SessionType>\n            ) => {\n                errorUnlessRole(params, \"admin\");\n                // body should be a session object. If it contains an id,\n                // update an existing session. Otherwise, create a new one.\n                return new Session(data).upsert(body);\n            },\n            summary: \"Upsert a session\",\n            returns: docApiPropTypes.session,\n            posts: docApiPropTypes.session,\n        }),\n        \"/sessions/delete\": documentCallback({\n            func: (\n                data: any,\n                params: RouteParams,\n                body: Partial<SessionType>\n            ) => {\n                errorUnlessRole(params, \"admin\");\n                return new Session(data).delete(body as any);\n            },\n            summary: \"Delete a session\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.session,\n        }),\n    },\n};\n","import {\n    getAttributesCheckMessage,\n    findAllById,\n    MockAPIController,\n    bytesToBase64,\n    errorUnlessRole,\n    base64decode,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\n\nexport class ContractTemplate extends MockAPIController {\n    constructor(data) {\n        super(data);\n        this.ownData = this.data.contract_templates;\n    }\n    validateNew(template, session = null) {\n        // The name and file are required\n        const message = getAttributesCheckMessage(template, this.ownData, {\n            template_name: { required: true },\n            template_file: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n        // If we're inserting to a session, the name must be unique\n        if (session) {\n            const message = getAttributesCheckMessage(\n                template,\n                this.findAllBySession(session),\n                {\n                    template_name: { required: true, unique: true },\n                }\n            );\n            if (message) {\n                throw new Error(message);\n            }\n        }\n    }\n    upload({ file_contents, file_name }) {\n        this.data.contract_templates_by_filename[file_name] = file_contents;\n        this.data.available_contract_templates.push({\n            template_file: file_name,\n        });\n    }\n    getTemplateHtml(template) {\n        template = new ContractTemplate(this.data).find(template);\n        if (\n            !(\n                template.template_file in\n                this.data.contract_templates_by_filename\n            )\n        ) {\n            throw new Error(\n                `Could not find Html for template ${template.template_file}`\n            );\n        }\n        return this.data.contract_templates_by_filename[template.template_file];\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        return findAllById(\n            this.data.contract_templates_by_session[matchingSession.id] || [],\n            this.ownData\n        );\n    }\n    upsertBySession(obj, session) {\n        const matchingSession = new Session(this.data).find(session);\n        // If this is not an upsert, validate the paramters. Otherwise, don't validate.\n        if (!this.find(obj)) {\n            this.validateNew(obj, matchingSession);\n        }\n        const newTemplate = this.upsert(obj);\n        // Make sure there is an array for to store the contract_templates by session,\n        // and the push to this array before returning the new object\n        this.data.contract_templates_by_session[matchingSession.id] =\n            this.data.contract_templates_by_session[matchingSession.id] || [];\n        this.data.contract_templates_by_session[matchingSession.id].push(\n            newTemplate.id\n        );\n        return newTemplate;\n    }\n}\n\nexport const templatesRoutes = {\n    get: {\n        \"/available_contract_templates\": documentCallback({\n            func: (data) => [...data.available_contract_templates],\n            summary:\n                \"Get all available contract templates (these are literal files on the server).\",\n            returns: wrappedPropTypes.arrayOf(\n                docApiPropTypes.contractTemplateMinimal\n            ),\n        }),\n        \"/sessions/:session_id/contract_templates\": documentCallback({\n            func: (data, params) =>\n                new ContractTemplate(data).findAllBySession(params.session_id),\n            summary: \"Get contract templates associated with this session.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.contractTemplate),\n        }),\n        \"/contract_templates/:template_id/view\": documentCallback({\n            func: (data, params) =>\n                new ContractTemplate(data).getTemplateHtml(params.template_id),\n            summary:\n                \"Get a preview of the contact template (i.e., the actual HTML).\",\n            returns: wrappedPropTypes.string,\n        }),\n        \"/contract_templates/:template_id/download\": documentCallback({\n            func: (data, params) => {\n                const { template_id } = params;\n                const template = new ContractTemplate(data);\n                const templateContent = template.getTemplateHtml(template_id);\n\n                // We're directly sending binary data, so we need to encode the template\n                // as UTF-8 (rather than native Javascript UTF-16)\n                const encodedContent = new TextEncoder().encode(\n                    templateContent\n                );\n                return {\n                    file_name: template.find(template_id).template_file,\n                    mime_type: \"text/html\",\n                    content: bytesToBase64(encodedContent),\n                };\n            },\n            summary:\n                \"Download the raw HTML template associated with the contract-template. No substitutions are made to this file. The `content` filed is encoded in Base64 and may be a binary file (e.g., a zip file).\",\n            returns: wrappedPropTypes.shape({\n                file_name: wrappedPropTypes.string,\n                mime_type: wrappedPropTypes.string,\n                content: wrappedPropTypes.string,\n            }),\n        }),\n    },\n    post: {\n        \"/sessions/:session_id/contract_templates\": documentCallback({\n            func: (data, params, body) => {\n                return new ContractTemplate(data).upsertBySession(\n                    body,\n                    params.session_id\n                );\n            },\n            summary:\n                \"Associate a position template with a session; this method upserts\",\n            posts: docApiPropTypes.contractTemplate,\n            returns: docApiPropTypes.contractTemplate,\n        }),\n        \"/contract_templates/upload\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const { file_name, content } = body;\n                const file_contents = base64decode(content);\n                new ContractTemplate(data).upload({ file_contents, file_name });\n                return [...data.available_contract_templates];\n            },\n            summary:\n                \"Upload a base64-encoded contract template. (The contract template should be utf-8 encoded HTML).\",\n            posts: wrappedPropTypes.shape({\n                file_name: wrappedPropTypes.string,\n                content: wrappedPropTypes.string,\n            }),\n            returns: wrappedPropTypes.arrayOf(\n                docApiPropTypes.contractTemplateMinimal\n            ),\n        }),\n    },\n};\n","import { MockAPIController, find, getAttributesCheckMessage } from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\n\nexport class User extends MockAPIController {\n    constructor(data) {\n        super(data, data.users);\n    }\n    validateNew(user) {\n        const message = getAttributesCheckMessage(user, this.ownData, {\n            utorid: { required: true, unique: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    rawFind(query) {\n        if (query == null) {\n            return null;\n        }\n        // If we pass an `id`, rely on that, otherwise,\n        // use the `utorid`.\n        if (query.id != null) {\n            return find(query, this.ownData);\n        }\n        if (query.utorid != null) {\n            return find(query, this.ownData, \"utorid\");\n        }\n        return find({ utorid: query }, this.ownData, \"utorid\");\n    }\n    setActiveUser(user) {\n        const matchingUser = this.find(user);\n        if (!matchingUser) {\n            throw new Error(\n                `Cannot find user ${JSON.stringify(user)} to set as active`\n            );\n        }\n        this.data.active_user = matchingUser.utorid;\n    }\n    getActiveUser() {\n        return this.find(this.data.active_user);\n    }\n}\n\nexport const activeUserRoutes = {\n    get: {\n        \"/users\": documentCallback({\n            func: (data) => new User(data).findAll(),\n            summary: \"Get all available users.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n        }),\n        \"/active_user\": documentCallback({\n            func: (data) => new User(data).getActiveUser(),\n            summary: \"Gets the currently active user.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n            roles: [\"instructor\", \"ta\"],\n        }),\n    },\n    post: {\n        \"/users\": documentCallback({\n            func: (data, params, body) => new User(data).upsert(body),\n            summary: \"Upserts user info\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n            posts: docApiPropTypes.user,\n        }),\n    },\n};\n","import {\n    getAttributesCheckMessage,\n    deleteInArray,\n    MockAPIController,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { User } from \"./active_user\";\nimport { Position } from \"./positions\";\n\nexport class Instructor extends MockAPIController {\n    constructor(data) {\n        super(data, data.instructors);\n    }\n    validateNew(instructor) {\n        const message = getAttributesCheckMessage(instructor, this.ownData, {\n            utorid: { required: true, unique: true },\n            first_name: { required: true },\n            last_name: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    delete(instructor) {\n        const matchingInstructor = this.find(instructor);\n        if (!matchingInstructor) {\n            throw new Error(\n                `Cannot find instructor matching ${JSON.stringify(instructor)}`\n            );\n        }\n        super.delete(matchingInstructor);\n        // After an instructor is deleted, they should be removed from all courses\n\n        // remove this instructor from any positions\n        for (const position of this.data.positions) {\n            if (\n                (position.instructor_ids || []).includes(matchingInstructor.id)\n            ) {\n                deleteInArray(matchingInstructor.id, position.instructor_ids);\n            }\n        }\n        return matchingInstructor;\n    }\n    /**\n     * Returns the instructor object corresponding to the active user,\n     * or null if the active user doesn't correspond to an instructor.\n     *\n     * @returns {Instructor | null}\n     * @memberof Instructor\n     */\n    getFromActiveUser() {\n        const activeUser = new User(this.data).getActiveUser();\n        const activeInstructor = new Instructor(this.data)\n            .findAll()\n            .find((instructor) => instructor.utorid === activeUser.utorid);\n        return activeInstructor;\n    }\n}\n\nexport const instructorsRoutes = {\n    get: {\n        \"/instructors\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Instructor(data).findAll();\n                }\n                if (params.role === \"instructor\") {\n                    const activeInstructor = new Instructor(\n                        data\n                    ).getFromActiveUser();\n                    if (!activeInstructor) {\n                        return [];\n                    }\n                    const instructorPositions = new Position(\n                        data\n                    ).getForInstructor(activeInstructor);\n                    const instructorIdsSet = new Set();\n                    for (const position of instructorPositions) {\n                        for (const id of position.instructor_ids) {\n                            instructorIdsSet.add(id);\n                        }\n                    }\n\n                    return new Instructor(data)\n                        .findAll()\n                        .filter((instructor) =>\n                            instructorIdsSet.has(instructor.id)\n                        );\n                }\n                // Always error if we've made it to this point\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Get a list of all instructors\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.instructor),\n        }),\n    },\n    post: {\n        \"/instructors\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Instructor(data).upsert(body);\n            },\n            summary: \"Upsert an instructor\",\n            posts: docApiPropTypes.instructor,\n            returns: docApiPropTypes.instructor,\n        }),\n        \"/instructors/delete\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Instructor(data).delete(body);\n            },\n            summary: \"Delete an instructor (removes from all positions)\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.instructor,\n        }),\n    },\n};\n","import {\n    find,\n    getAttributesCheckMessage,\n    deleteInArray,\n    findAllById,\n    MockAPIController,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\nimport { ContractTemplate } from \"./contract_templates\";\nimport { Instructor } from \"./instructors\";\n\nexport class Position extends MockAPIController {\n    constructor(data) {\n        super(data, data.positions);\n    }\n    validateNew(position, session = null) {\n        // If we're inserting to a session, the position_code must be unique\n        if (session) {\n            const message = getAttributesCheckMessage(\n                position,\n                this.findAllBySession(session),\n                {\n                    position_code: { required: true, unique: true },\n                }\n            );\n            if (message) {\n                throw new Error(message);\n            }\n        }\n    }\n    find(query) {\n        const rawPosition = this.rawFind(query);\n        // Find which session we're part of\n\n        let session_id = null;\n        for (const [_session_id, assignment_ids] of Object.entries(\n            this.data.positions_by_session\n        )) {\n            if (assignment_ids.includes(rawPosition.id)) {\n                session_id = _session_id;\n                break;\n            }\n        }\n        return { ...rawPosition, session_id };\n    }\n    getSession(position) {\n        return new Session(this.data).find({\n            id: position.session_id,\n        });\n    }\n    getContractTemplate(position) {\n        return new ContractTemplate(this.data).find({\n            id: position.contract_template_id,\n        });\n    }\n    getInstructors(position) {\n        if (!position.instructor_ids) {\n            return [];\n        }\n        return position.instructor_ids.map((id) =>\n            new Instructor(this.data).find({ id })\n        );\n    }\n    /**\n     * Returns a list of positions that the specified `instructor` is an instructor for.\n     *\n     * @param {*} instructor\n     * @memberof Position\n     */\n    getForInstructor(instructor) {\n        instructor = new Instructor(this.data).find(instructor);\n        if (!instructor) {\n            throw new Error(`Cannot find a matching instructor`);\n        }\n        const positions = this.findAll();\n        return positions.filter((position) =>\n            (position.instructor_ids || []).includes(instructor.id)\n        );\n    }\n    delete(position) {\n        const matchingPosition = this.rawFind(position);\n        if (!matchingPosition) {\n            throw new Error(\n                `Cannot find position matching ${JSON.stringify(position)}`\n            );\n        }\n        super.delete(matchingPosition);\n        // After an instructor is deleted, they should be removed from all courses\n\n        // remove this instructor from any positions\n        for (const bySessionsList of Object.values(\n            this.data.positions_by_session\n        )) {\n            if (bySessionsList.includes(matchingPosition.id)) {\n                deleteInArray(matchingPosition.id, bySessionsList);\n            }\n        }\n        return matchingPosition;\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        return findAllById(\n            this.data.positions_by_session[matchingSession.id] || [],\n            this.ownData\n        );\n    }\n    upsertBySession(obj, session) {\n        const matchingSession = new Session(this.data).rawFind(session);\n        // If this is not an upsert, validate the parameters. Otherwise, don't validate.\n        if (!this.rawFind(obj)) {\n            this.validateNew(obj, matchingSession);\n\n            // if the start/end date is not set,\n            // use the session dates\n            obj.start_date =\n                obj.start_date === undefined\n                    ? matchingSession.start_date\n                    : obj.start_date;\n            obj.end_date =\n                obj.end_date === undefined\n                    ? matchingSession.end_date\n                    : obj.end_date;\n        }\n        const newPosition = this.upsert(obj);\n        // Make sure there is an array for to store the contract_templates by session,\n        // and the push to this array before returning the new object\n        this.data.positions_by_session[matchingSession.id] =\n            this.data.positions_by_session[matchingSession.id] || [];\n        this.data.positions_by_session[matchingSession.id].push(newPosition.id);\n        return newPosition;\n    }\n    findAssociatedSession(position) {\n        const matchingPosition = this.find(position);\n        if (!matchingPosition) {\n            throw new Error(\n                `Could not associated session because there is no position matching ${JSON.stringify(\n                    position\n                )}`\n            );\n        }\n        const ret = Object.keys(this.data.positions_by_session).find((x) =>\n            this.data.positions_by_session[x].includes(matchingPosition.id)\n        );\n        // Make sure we recast the id as an int\n        return ret != null ? +ret : ret;\n    }\n}\n\nexport const positionsRoutes = {\n    get: {\n        \"/sessions/:session_id/positions\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Position(data).findAllBySession(\n                        params.session_id\n                    );\n                }\n                if (params.role === \"instructor\") {\n                    // Only return the the positions belonging to the current session\n                    // for which the activeUser is an instructor.\n                    const activeInstructor = new Instructor(\n                        data\n                    ).getFromActiveUser();\n                    if (!activeInstructor) {\n                        return [];\n                    }\n                    return new Position(data)\n                        .findAllBySession(params.session_id)\n                        .filter((position) =>\n                            position.instructor_ids.includes(\n                                activeInstructor.id\n                            )\n                        );\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Get positions associated with this session.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.position),\n        }),\n    },\n    post: {\n        \"/sessions/:session_id/positions\": documentCallback({\n            func: (data, params, body) => {\n                return new Position(data).upsertBySession(\n                    body,\n                    params.session_id\n                );\n            },\n            summary:\n                \"Upsert a position associated with a session. If a new position is created, it will be automatically associated with the given session\",\n            posts: docApiPropTypes.position,\n            returns: docApiPropTypes.position,\n        }),\n        \"/positions\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const positions = data.positions;\n                // body should be a session object. If it contains an id,\n                // update an existing session. Otherwise, create a new one.\n                const matchingPosition = find(body, positions);\n                if (matchingPosition) {\n                    return Object.assign(matchingPosition, body);\n                }\n                throw new Error(`Cannot find position with id=${body.id}`);\n            },\n            summary: \"Update a position\",\n            posts: docApiPropTypes.position,\n            returns: docApiPropTypes.position,\n        }),\n        \"/positions/delete\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Position(data).delete(body);\n            },\n            summary: \"Delete a position\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.position,\n        }),\n    },\n};\n","import { documentCallback, docApiPropTypes } from \"../defs/doc-generation\";\nimport { find, MockAPIController, findAllById } from \"./utils\";\nimport { Assignment } from \"./assignments\";\nimport { Position } from \"./positions\";\n\nexport class WageChunk extends MockAPIController {\n    constructor(data) {\n        super(data, data.wage_chunks);\n    }\n    validateNew() {\n        // There is nothing to validate for a wage chunk\n    }\n    findAllByAssignment(assignment) {\n        const matchingAssignment = new Assignment(this.data).rawFind(\n            assignment\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Could not find assignment matching ${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n        // Make sure we apply `this.find` so that the rates are computed.\n        return findAllById(\n            [matchingAssignment.id],\n            this.ownData,\n            \"assignment_id\"\n        ).map((x) => this.find(x));\n    }\n    find(wageChunk) {\n        const rawWageChunk = this.rawFind(wageChunk);\n        const ret = { ...rawWageChunk };\n        if (ret.rate == null) {\n            // If the rate is not set, look it up from the session\n            const session = this.getSession(wageChunk);\n            if (session.rate2 == null) {\n                ret.rate = session.rate1;\n            } else {\n                // Rates switch from session.rate1 to session.rate2 on January 1 of\n                // the year following the session start date.\n                const start_date = new Date(wageChunk.start_date);\n                const end_date = new Date(wageChunk.end_date);\n                const session_start_date = new Date(session.start_date);\n                // For `Date`, 11 is december\n                const december = new Date(\n                    session_start_date.getFullYear(),\n                    11,\n                    31\n                );\n                if (start_date <= december && end_date <= december) {\n                    ret.rate = session.rate1;\n                } else {\n                    ret.rate = session.rate2;\n                }\n            }\n        }\n        return ret;\n    }\n    getSession(wageChunk) {\n        const rawWageChunk = this.rawFind(wageChunk);\n        const assignment = new Assignment(this.data).rawFind({\n            id: rawWageChunk.assignment_id,\n        });\n        const position = new Assignment(this.data).getPosition(assignment);\n        return new Position(this.data).getSession(position);\n    }\n    upsertByAssignment(wageChunk, assignment) {\n        const matchingAssignment = new Assignment(this.data).rawFind(\n            assignment\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Could not find assignment matching ${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n        return this.upsert({\n            ...wageChunk,\n            assignment_id: matchingAssignment.id,\n        });\n    }\n    /**\n     * Sets the list of wage chunks associated with a given assignment to `wageChunks`.\n     * Any wage chunks omitted from the list are deleted.\n     *\n     * @param {*} wageChunks\n     * @param {*} assignment\n     * @returns\n     * @memberof WageChunk\n     */\n    setAllByAssignment(wageChunks, assignment) {\n        const matchingAssignment = new Assignment(this.data).rawFind(\n            assignment\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Could not find assignment matching ${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n        const existingWageChunks = this.findAllByAssignment(assignment);\n        // Now we can upsert all the wageChunks\n        wageChunks.forEach((chunk) =>\n            this.upsertByAssignment(chunk, matchingAssignment)\n        );\n        // every wage chunk that is not in the `wageChunks` list gets deleted\n        for (const wageChunk of existingWageChunks) {\n            if (!find(wageChunk, wageChunks)) {\n                this.delete(wageChunk);\n            }\n        }\n        // Recompute the wage chunks list. This is \"needless\"\n        // logically, but it might catch some bugs at some point.\n        return this.findAllByAssignment(matchingAssignment);\n    }\n}\n\nexport const wageChunkRoutes = {\n    get: {},\n    post: {\n        \"/wage_chunks\": documentCallback({\n            func: (data, params, body) => new WageChunk(data).upsert(body),\n            posts: docApiPropTypes.wageChunk,\n            summary: \"Upsert a wage_chunk\",\n            returns: docApiPropTypes.wageChunk,\n        }),\n        \"/wage_chunks/delete\": documentCallback({\n            func: (data, params, body) => new WageChunk(data).delete(body),\n            posts: docApiPropTypes.wageChunk,\n            summary: \"Delete a wage_chunk. Must have a valid id specified.\",\n            returns: docApiPropTypes.wageChunk,\n        }),\n    },\n};\n","import {\n    getAttributesCheckMessage,\n    MockAPIController,\n    findAllById,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\n\nexport class Application extends MockAPIController {\n    constructor(data) {\n        super(data, data.applications);\n    }\n    validateNew(applicant) {\n        const message = getAttributesCheckMessage(applicant, this.ownData, {\n            session_id: { required: true },\n            applicant_id: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        if (!matchingSession) {\n            throw new Error(\n                `Cannot find applicant by session because session ${JSON.stringify(\n                    session\n                )} cannot be found`\n            );\n        }\n        // The applicants for this session are those who have submitted an application for this session\n        return findAllById([matchingSession.id], this.ownData, \"session_id\");\n    }\n}\n\nexport const applicationsRoutes = {\n    get: {\n        \"/sessions/:session_id/applications\": documentCallback({\n            func: (data, params) =>\n                new Application(data).findAllBySession(params.session_id),\n            summary: \"Get all applications associated with the given session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.application),\n        }),\n    },\n    post: {\n        \"/applications\": documentCallback({\n            func: (data, params, body) => new Application(data).upsert(body),\n            summary: \"Upsert an application\",\n            posts: docApiPropTypes.application,\n            returns: docApiPropTypes.application,\n        }),\n    },\n};\n","import {\n    getAttributesCheckMessage,\n    findAllById,\n    MockAPIController,\n    filterNullProps,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\nimport { Application } from \"./applications\";\nimport { Assignment } from \"./assignments\";\nimport { stringToNativeType } from \"../../libs/urlUtils\";\nimport { Instructor } from \"./instructors\";\n\nexport class Applicant extends MockAPIController {\n    constructor(data) {\n        super(data, data.applicants);\n    }\n    validateNew(applicant) {\n        const message = getAttributesCheckMessage(applicant, this.ownData, {\n            utorid: { required: true, unique: true },\n            first_name: { required: true },\n            last_name: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        if (!matchingSession) {\n            throw new Error(\n                `Cannot find applicant by session because session ${JSON.stringify(\n                    session\n                )} cannot be found`\n            );\n        }\n        // The applicants for this session are those who have submitted an\n        // application for this session or those who have an assignment in this\n        // session.\n        const applications = new Application(this.data).findAllBySession(\n            matchingSession\n        );\n        const assignments = new Assignment(this.data).findAllBySession(\n            matchingSession\n        );\n        // Get a unique list of applicant ids\n        const applicantIds = Array.from(\n            new Set(\n                applications\n                    .map((x) => x.applicant_id)\n                    .concat(assignments.map((x) => x.applicant_id))\n            )\n        );\n        return findAllById(applicantIds, this.ownData);\n    }\n}\n\nexport const applicantsRoutes = {\n    get: {\n        \"/sessions/:session_id/applicants\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Applicant(data).findAllBySession(\n                        params.session_id\n                    );\n                }\n                if (params.role === \"instructor\") {\n                    const activeInstructor = new Instructor(\n                        data\n                    ).getFromActiveUser();\n                    if (!activeInstructor) {\n                        return [];\n                    }\n                    const applicantIds = new Assignment(data)\n                        .findAllBySessionAndInstructor(\n                            params.session_id,\n                            activeInstructor\n                        )\n                        .map((assignment) => assignment.applicant_id);\n                    // Only return applicants for positions that the instructor is instructing\n                    return new Applicant(data)\n                        .findAll()\n                        .filter((applicant) =>\n                            applicantIds.includes(applicant.id)\n                        );\n                }\n\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Get all applicants associated with the given session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.applicant),\n        }),\n        \"/applicants\": documentCallback({\n            func: (data) => new Applicant(data).findAll(),\n            summary: \"Get all applicants\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.applicant),\n        }),\n        \"/applicants/:applicant_id\": documentCallback({\n            func: (data, params) =>\n                new Applicant(data).find(params.applicant_id),\n            summary: \"Get an applicant\",\n            returns: docApiPropTypes.applicant,\n        }),\n    },\n    post: {\n        \"/applicants\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Applicant(data).upsert(body);\n            },\n            summary: \"Upsert an applicant\",\n            posts: docApiPropTypes.applicant,\n            returns: docApiPropTypes.applicant,\n        }),\n        \"/sessions/:session_id/applicants\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const applicants = new Applicant(data).findAll();\n                // If we didn't specify an `id` but we did specify a `utorid`,\n                // try to look up the applicant by `utorid`\n                const existingApplicant =\n                    applicants.find(\n                        (x) => x.id === body.id || x.utorid === body.utorid\n                    ) || {};\n                const applicant = new Applicant(data).upsert({\n                    ...existingApplicant,\n                    ...filterNullProps(body),\n                });\n                const applications = new Application(data).findAllBySession(\n                    params.session_id\n                );\n                // First search for an applicant with a matching `id`\n                let match = applications.find(\n                    (application) => application.applicant_id === applicant.id\n                );\n                if (!match) {\n                    // We need to create an application for this applicant\n                    new Application(data).upsert({\n                        session_id: stringToNativeType(params.session_id),\n                        applicant_id: applicant.id,\n                        comment: \"<Autogenerated>\",\n                    });\n                }\n\n                return applicant;\n            },\n            summary:\n                \"Upsert an applicant. If they have no application associated with the current session, an application is created.\",\n            posts: docApiPropTypes.applicant,\n            returns: docApiPropTypes.applicant,\n        }),\n        \"/applicants/delete\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Applicant(data).delete(body);\n            },\n            summary: \"Delete an applicant\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.applicant,\n        }),\n    },\n};\n","import {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport {\n    getAttributesCheckMessage,\n    findAllById,\n    sum,\n    splitDateRangeAtNewYear,\n    MockAPIController,\n    wageChunkArrayToStartAndEndDates,\n    formatInstructorsContact,\n    wageChunkArrayToPayPeriodDescription,\n    errorUnlessRole,\n} from \"./utils\";\nimport { Session } from \"./sessions\";\nimport { Position } from \"./positions\";\nimport { WageChunk } from \"./wage_chunks\";\nimport { Applicant } from \"./applicants\";\nimport { Instructor } from \"./instructors\";\n\nexport class Assignment extends MockAPIController {\n    constructor(data) {\n        super(data, data.assignments);\n    }\n    validateNew(assignment) {\n        // No uniqueness required, so pass in an empty array ([]) to the verifier\n        const message = getAttributesCheckMessage(assignment, [], {\n            position_id: { required: true },\n            applicant_id: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).rawFind(session);\n        return findAllById(\n            this.data.assignments_by_session[matchingSession.id] || [],\n            this.ownData\n            // Call \"find\" again to make sure every item gets packaged appropriately\n        ).map((x) => new Assignment(this.data).find(x));\n    }\n    getPosition(assignment) {\n        return new Position(this.data).find({\n            id: assignment.position_id,\n        });\n    }\n    getApplicant(assignment) {\n        return new Applicant(this.data).find({\n            id: assignment.applicant_id,\n        });\n    }\n    /**\n     * Grabs a bunch of data from the wage chunks related to an assignment\n     *\n     * @param {string} assignment\n     * @returnType {{hours: number, wage_chunks: object[]}}\n     */\n    getWageChunkInfo(assignment) {\n        const wageChunks = new WageChunk(this.data).findAllByAssignment(\n            assignment\n        );\n        const hours = sum(...wageChunks.map((x) => x.hours));\n        return { hours, wageChunks };\n    }\n    /**\n     * Grab the active offer for an assignment\n     *\n     * @param {number} matchingAssignment.id\n     * @param {object} this.data\n     * @returns {({}|null)} - an offer object or `undefined`\n     */\n    getActiveOffer(assignment) {\n        return new ActiveOffer(this.data).findByAssignment(assignment);\n    }\n    /**\n     * Pieces together all the details of an assignment from the mockAPI data\n     *\n     * @param {object} matchingAssignment - an assignment\n     * @returns\n     */\n    find(assignment) {\n        const matchingAssignment = this.rawFind(assignment);\n        if (!matchingAssignment) {\n            return matchingAssignment;\n        }\n        const ret = { ...matchingAssignment };\n        // compute the hours from wage chunks\n        const { hours } = this.getWageChunkInfo(matchingAssignment);\n        Object.assign(ret, { hours });\n        // compute offer_status\n        const activeOffer = this.getActiveOffer(matchingAssignment);\n        if (activeOffer) {\n            Object.assign(ret, {\n                active_offer_status: activeOffer.status,\n                active_offer_url_token: activeOffer.url_token,\n            });\n        }\n        return ret;\n    }\n    upsert(assignment) {\n        // Call `find` to make sure the `hours` field is computed\n        const upsertedAssignment = this.find(super.upsert(assignment));\n\n        // Make sure the assignment is in the assignments_by_session list\n        const session_id = new Position(this.data).findAssociatedSession(\n            upsertedAssignment.position_id\n        );\n        if (session_id) {\n            this.data.assignments_by_session[session_id].push(\n                upsertedAssignment.id\n            );\n        }\n\n        // If `hours` is passed into the assignment, we need to modify the wage chunks\n        // associated with the assignment (but only if the hours differ).\n        if (\n            assignment.hours == null ||\n            +upsertedAssignment.hours === +assignment.hours\n        ) {\n            return upsertedAssignment;\n        }\n\n        let wageChunks = new WageChunk(this.data).findAllByAssignment(\n            upsertedAssignment\n        );\n        // If there are no wage chunks, we need to create some\n        if (wageChunks.length === 0) {\n            const dateRanges = splitDateRangeAtNewYear(\n                upsertedAssignment.start_date,\n                upsertedAssignment.end_date\n            );\n            // create the wage chunks with zero hours, because it will be updated soon\n            for (const range of dateRanges) {\n                new WageChunk(this.data).upsertByAssignment(\n                    {\n                        hours: 0,\n                        start_date: range.start_date,\n                        end_date: range.end_date,\n                    },\n                    upsertedAssignment\n                );\n            }\n        }\n\n        // Now we are guaranteed to have wage chunks, so set them to the correct number\n        // of hours\n        wageChunks = new WageChunk(this.data).findAllByAssignment(\n            upsertedAssignment\n        );\n        const delta =\n            +assignment.hours - +(this.find(upsertedAssignment).hours || 0);\n        const perChunkDelta = delta / wageChunks.length;\n        for (const chunk of wageChunks) {\n            new WageChunk(this.data).upsert({\n                ...chunk,\n                hours: (chunk.hours || 0) + perChunkDelta,\n            });\n        }\n\n        // Find the assignment again, to make sure all computed fields are properly computed\n        return this.find(upsertedAssignment);\n    }\n    /**\n     * Returns the list of all assignments for positions that are (a) for the\n     * specified session, and (b) taught by the specified instructor.\n     *\n     * @param {*} session\n     * @param {*} instructor\n     * @returns\n     * @memberof Assignment\n     */\n    findAllBySessionAndInstructor(session, instructor) {\n        session = new Session(this.data).find(session);\n        instructor = new Instructor(this.data).find(instructor);\n        const instructorPositions = new Position(this.data).getForInstructor(\n            instructor\n        );\n        const assignments = this.findAllBySession(session);\n        const positionIds = instructorPositions.map((position) => position.id);\n\n        // Only return assignments for positions that the instructor is instructing\n        return assignments.filter((assignment) =>\n            positionIds.includes(assignment.position_id)\n        );\n    }\n}\n\nclass ActiveOffer extends MockAPIController {\n    constructor(data) {\n        super(data, data.offers);\n    }\n    findByAssignment(assignment) {\n        const matchingAssignment = this._ensureAssignment(assignment);\n\n        // As a hack, a `_noActiveOffer` flag is added to an assignment\n        // if the active offer should be ignore.\n        if (matchingAssignment && matchingAssignment._noActiveOffer) {\n            return null;\n        }\n\n        // offers are never deleted, only added to the table, so\n        // picking the last one is the same as picking the \"newest\"\n        const offers = findAllById(\n            [matchingAssignment.id],\n            this.data.offers,\n            \"assignment_id\"\n        );\n        const activeOffer = offers[offers.length - 1];\n        return activeOffer || null;\n    }\n    _ensureAssignment(assignment) {\n        const matchingAssignment = new Assignment(this.data).rawFind(\n            assignment\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Could not find assignment matching ${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n        return matchingAssignment;\n    }\n    getAssignment(offer) {\n        return new Assignment(this.data).find({\n            id: offer.assignment_id,\n        });\n    }\n    find(query) {\n        // This is where the magic happens. We create all the data needed for the offer here.\n        const baseOffer = this.rawFind(query);\n        const assignment = this.getAssignment(baseOffer);\n        const { hours, wageChunks } = new Assignment(\n            this.data\n        ).getWageChunkInfo(assignment);\n        const position = new Assignment(this.data).getPosition(assignment);\n        const applicant = new Assignment(this.data).getApplicant(assignment);\n        const instructors = new Position(this.data).getInstructors(position);\n        const contractTemplate = new Position(this.data).getContractTemplate(\n            position\n        );\n\n        const { start_date, end_date } = wageChunkArrayToStartAndEndDates(\n            wageChunks\n        );\n\n        const offer = {\n            accepted_date: null,\n            rejected_date: null,\n            withdrawn_date: null,\n            signature: \"\",\n            nag_count: 0,\n            // All mutable fields should come before `baseOffer` is destructured.\n            // Fields that come after are computed and cannot be directly set.\n            ...baseOffer,\n            contract_template: contractTemplate.template_file,\n            contract_override_pdf: assignment.contract_override_pdf,\n            first_name: applicant.first_name,\n            last_name: applicant.last_name,\n            email: applicant.email,\n            position_code: position.position_code,\n            position_title: position.position_title,\n            position_start_date: start_date,\n            position_end_date: end_date,\n            first_time_ta: null,\n            instructor_contact_desc: formatInstructorsContact(instructors),\n            pay_period_desc: wageChunkArrayToPayPeriodDescription(wageChunks),\n            hours,\n            ta_coordinator_name: \"Dr. Coordinator\",\n            ta_coordinator_email: \"coordinator@utoronto.ca\",\n            url_token: \"mock_api_offer_url_token\",\n        };\n\n        return offer;\n    }\n    withdrawByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        return this.find(\n            this.upsert({\n                ...offer,\n                status: \"withdrawn\",\n                withdrawn_date: new Date().toISOString(),\n            })\n        );\n    }\n    rejectByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        return this.find(\n            this.upsert({\n                ...offer,\n                status: \"rejected\",\n                rejected_date: new Date().toISOString(),\n            })\n        );\n    }\n    acceptByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        return this.find(\n            this.upsert({\n                ...offer,\n                status: \"accepted\",\n                accepted_date: new Date().toISOString(),\n            })\n        );\n    }\n    emailByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        return this.find(\n            this.upsert({\n                ...offer,\n                status: \"pending\",\n                emailed_date: new Date().toISOString(),\n            })\n        );\n    }\n    nagByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        if (!offer.emailed_date) {\n            throw new Error(\n                `The active offer for assignment with id=${assignment.id} has not been emailed yet, so a nag email cannot be sent`\n            );\n        }\n        return this.find(\n            this.upsert({\n                ...offer,\n                nag_count: (offer.nag_count || 0) + 1,\n            })\n        );\n    }\n    createByAssignment(assignment) {\n        const matchingAssignment = this._ensureAssignment(assignment);\n        const offer = this.findByAssignment(matchingAssignment);\n        if (\n            offer &&\n            [\"pending\", \"accepted\", \"rejected\", \"provisional\"].includes(\n                offer.status\n            )\n        ) {\n            throw new Error(\n                `An offer already exists for assignment=${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n\n        // As a hack, sometimes a `_noActiveOffer` flag is set. Make sure to unset this flag\n        // before creating an offer.\n        new Assignment(this.data).upsert({\n            ...matchingAssignment,\n            _noActiveOffer: false,\n        });\n        return this.upsert(\n            this.find(\n                this.create({\n                    assignment_id: matchingAssignment.id,\n                    status: \"provisional\",\n                })\n            )\n        );\n    }\n}\n\nexport const assignmentsRoutes = {\n    get: {\n        \"/sessions/:session_id/assignments\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Assignment(data).findAllBySession(\n                        params.session_id\n                    );\n                }\n                if (params.role === \"instructor\") {\n                    const activeInstructor = new Instructor(\n                        data\n                    ).getFromActiveUser();\n                    if (!activeInstructor) {\n                        return [];\n                    }\n                    return new Assignment(data).findAllBySessionAndInstructor(\n                        params.session_id,\n                        activeInstructor\n                    );\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Get assignments associated with a session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.assignment),\n        }),\n        \"/assignments/:assignment_id\": documentCallback({\n            func: (data, params) =>\n                new Assignment(data).find(params.assignment_id),\n            summary: \"Get an assignment\",\n            returns: docApiPropTypes.assignment,\n        }),\n        \"/assignments/:assignment_id/active_offer\": documentCallback({\n            func: (data, params) =>\n                new Assignment(data).getActiveOffer(params.assignment_id),\n            summary: \"Get the active offer associated with an assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/wage_chunks\": documentCallback({\n            func: (data, params) =>\n                new Assignment(data).getWageChunkInfo(params.assignment_id)\n                    .wageChunks,\n            summary: \"Get the wage_chunks associated with an assignment\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.wageChunk),\n        }),\n    },\n    post: {\n        \"/assignments\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const existingAssignment = new Assignment(data).find(body);\n                if (existingAssignment) {\n                    const activeOffer = new Assignment(data).getActiveOffer(\n                        existingAssignment\n                    );\n                    if (!activeOffer) {\n                        return new Assignment(data).upsert(body);\n                    }\n                    if (\n                        [\"withdrawn\", \"provisional\"].includes(\n                            activeOffer.status\n                        )\n                    ) {\n                        // In this case, we can upsert the assignment, but we remove any active offer\n                        // in the process\n                        return new Assignment(data).upsert({\n                            ...body,\n                            _noActiveOffer: true,\n                        });\n                    }\n                    throw new Error(\n                        `Cannot update an assignment that has an active offer with status '${activeOffer.status}'`\n                    );\n                }\n                return new Assignment(data).upsert(body);\n            },\n            posts: docApiPropTypes.assignment,\n            summary: \"Upsert an assignment\",\n            returns: docApiPropTypes.assignment,\n        }),\n        \"/assignments/:assignment_id/wage_chunks\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new WageChunk(data).setAllByAssignment(\n                    body,\n                    params.assignment_id\n                );\n            },\n            summary:\n                \"Sets the wage chunks of an assignment to the specified list. The contents of the list are upserted. Omitted wage chunks are deleted.\",\n            posts: wrappedPropTypes.arrayOf(docApiPropTypes.wageChunk),\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.wageChunk),\n        }),\n        \"/assignments/:assignment_id/active_offer/withdraw\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).withdrawByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary: \"Withdraws the active offer for the specified assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/reject\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).rejectByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary: \"Rejects the active offer for the specified assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/accept\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).acceptByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary: \"Accepts the active offer for the specified assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/create\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).createByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary:\n                \"Creates an offer for the specified assignment, provided there are no active offers for this assignment.\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/email\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).emailByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary: \"Emails the active offer for the specified assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/nag\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).nagByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary:\n                \"Sends a nag email for the active offer for the specified assignment which has already been emailed once\",\n            returns: docApiPropTypes.offer,\n        }),\n    },\n};\n","import {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { User } from \"./active_user\";\n\n// persistent storage for the Debug class\nconst storage = {};\n\nexport class Debug {\n    constructor(data) {\n        this.data = data;\n    }\n    getAllData() {\n        return this.data;\n    }\n    makeSnapshot(name = \"snapshot\") {\n        storage[name] = JSON.stringify(this.getAllData());\n        return this.getAllData();\n    }\n    clearData() {\n        this.makeSnapshot(\"beforeclear\");\n        Object.keys(this.data).forEach((key) => {\n            // Contract templates are supposed to be stored on \"disk\"\n            // and so they shouldn't be cleared when we clear the database\n            if (\n                key === \"available_contract_templates\" ||\n                key === \"contract_templates_by_filename\"\n            ) {\n                return;\n            }\n            this.data[key] = createBlankCopy(this.data[key]);\n        });\n        return this.getAllData();\n    }\n    restoreSnapshot(name = \"snapshot\") {\n        const snapshot = JSON.parse(storage[name] || \"{}\");\n        this.clearData();\n        Object.assign(this.data, snapshot);\n        return this.getAllData();\n    }\n}\n\nexport const debugRoutes = {\n    get: {\n        \"/debug/active_user\": documentCallback({\n            func: (data) => new User(data).getActiveUser(),\n            summary:\n                \"Gets the active user; in debug mode this is specified by posting to `active_user`.\",\n            returns: docApiPropTypes.user,\n        }),\n        \"/debug/users\": documentCallback({\n            func: (data) => new User(data).findAll(),\n            summary: \"Get a list of all users\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n        }),\n    },\n    post: {\n        \"/debug/active_user\": documentCallback({\n            func: (data, params, body) => {\n                const user = new User(data);\n                const found_user = user.find(body);\n                if (!found_user) {\n                    throw new Error(\n                        `Could not find user matching ${JSON.stringify(body)}`\n                    );\n                }\n                user.setActiveUser(found_user);\n                return user.getActiveUser();\n            },\n            summary:\n                \"Sets the active user; this will override whatever credentials are passed to the server.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n            posts: docApiPropTypes.user,\n        }),\n        \"/debug/users\": documentCallback({\n            func: (data, params, body) => new User(data).upsert(body),\n            summary:\n                \"Adds a user; this is done without any permission checks, so it can be used to bootstrap permissions during debug.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n            posts: docApiPropTypes.user,\n        }),\n        \"/debug/clear_data\": documentCallback({\n            func: (data) => {\n                return new Debug(data).clearData();\n            },\n            summary: \"Deletes all data in the database\",\n        }),\n        \"/debug/snapshot\": documentCallback({\n            func: (data) => {\n                return new Debug(data).makeSnapshot();\n            },\n            summary: \"Makes a snapshot of the current state of the database\",\n        }),\n        \"/debug/restore_snapshot\": documentCallback({\n            func: (data) => {\n                return new Debug(data).restoreSnapshot();\n            },\n            summary: \"Restores the last snapshot of the database\",\n        }),\n    },\n};\n\n/**\n * Returns the blank value of the same type\n * as the passed-in data\n *\n * @param {*} data\n * @returns\n */\nfunction createBlankCopy(data) {\n    if (typeof data === \"object\") {\n        if (data instanceof Array) {\n            return [];\n        } else {\n            return {};\n        }\n    } else if (typeof data === \"string\") {\n        return \"\";\n    } else {\n        // If `data` is not of type string, array or object\n        // use the constructor, which will return blank value\n        // of that particular type.\n        return data.constructor();\n    }\n}\n","import {\n    getAttributesCheckMessage,\n    MockAPIController,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\nimport { Assignment } from \"./assignments\";\nimport { stringToNativeType } from \"../../libs/urlUtils\";\n\nexport class Ddah extends MockAPIController {\n    constructor(data) {\n        super(data, data.ddahs);\n    }\n    validateNew(ddah) {\n        const message = getAttributesCheckMessage(ddah, this.ownData, {\n            assignment_id: { required: true, unique: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        if (!matchingSession) {\n            throw new Error(\n                `Cannot find DDAHs by session because session ${JSON.stringify(\n                    session\n                )} cannot be found`\n            );\n        }\n        const assignments = new Assignment(this.data).findAllBySession(\n            matchingSession\n        );\n        const assignmentIds = assignments.map((assignment) => assignment.id);\n        return this.ownData.filter((ddah) =>\n            assignmentIds.includes(ddah.assignment_id)\n        );\n    }\n}\n\nexport const ddahsRoutes = {\n    get: {\n        \"/sessions/:session_id/ddahs\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Ddah(data).findAllBySession(params.session_id);\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary:\n                \"Get all ddah forms associated with assignments for the given session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.ddah),\n        }),\n        \"/sessions/:session_id/ddahs/accepted_list\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    throw new Error(\"Not implemented in mock API\");\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary:\n                \"Get a signature list of all TAs who have acknowledged their DDAH form for this session. Returns a base64 encoded html file.\",\n            returns: wrappedPropTypes.shape({\n                file_name: wrappedPropTypes.string,\n                mime_type: wrappedPropTypes.string,\n                content: wrappedPropTypes.string,\n            }),\n        }),\n        \"/sessions/:session_id/ddahs/accepted_list.pdf\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    throw new Error(\"Not implemented in mock API\");\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary:\n                \"Get a signature list of all TAs who have acknowledged their DDAH form for this session. Returns a base64 encoded html file.\",\n            returns: wrappedPropTypes.shape({\n                file_name: wrappedPropTypes.string,\n                mime_type: wrappedPropTypes.string,\n                content: wrappedPropTypes.string,\n            }),\n        }),\n        \"/ddahs/:ddah_id\": documentCallback({\n            func: (data, params) => new Ddah(data).find(params.ddah_id),\n            summary: \"Get a ddah\",\n            returns: docApiPropTypes.ddah,\n        }),\n        \"/assignments/:assignment_id/ddah\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\" || params.role === \"instructor\") {\n                    const assignment = new Assignment(data).find(\n                        params.assignment_id\n                    );\n                    if (!assignment) {\n                        throw new Error(\n                            `Cannot create a DDAH because an assignment with id '${params.assignment_id}' cannot be found.`\n                        );\n                    }\n                    return new Ddah(data)\n                        .findAll()\n                        .find((ddah) => ddah.assignment_id === assignment.id);\n                }\n                // If we make it here, we should error because of invalid permissions\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Find a DDAH associated with a specific assignment.\",\n            returns: docApiPropTypes.ddah,\n        }),\n    },\n    post: {\n        \"/ddahs\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const existingDdah = new Ddah(data).find({ id: body.id });\n                if (!existingDdah || !body.duties) {\n                    // Create a new DDAH if there isn't one already\n                    return new Ddah(data).upsert(body);\n                }\n                // If there is a DDAH already and we change the duties at all, we must\n                // remove the accepted date, the signature, and the approved date.\n                const overwriteFields = {\n                    accepted_date: null,\n                    approved_date: null,\n                    signature: null,\n                };\n                // Since we only care about a change to the duties, a quick-and-dirty way is to\n                // compare the JSONified duties\n                function sortByOrder(a, b) {\n                    return a.order - b.order;\n                }\n                if (\n                    JSON.stringify([...body.duties].sort(sortByOrder)) !==\n                    JSON.stringify([...existingDdah.duties].sort(sortByOrder))\n                ) {\n                    // If the DDAH has been accepted, its new (signatureless)\n                    // state will be \"revised\"\n                    if (\n                        existingDdah.accepted_date ||\n                        existingDdah.emailed_date\n                    ) {\n                        overwriteFields.revised_date = new Date();\n                    }\n                    return new Ddah(data).upsert({\n                        ...body,\n                        ...overwriteFields,\n                    });\n                }\n                return new Ddah(data).upsert(body);\n            },\n            summary: \"Upsert a ddah\",\n            posts: docApiPropTypes.ddah,\n            returns: docApiPropTypes.ddah,\n        }),\n        \"/ddahs/:ddah_id/approve\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                const ddah = new Ddah(data).find({ id: params.ddah_id });\n                if (!ddah) {\n                    throw new Error(\n                        `Could not find DDAH with id '${params.ddah_id}'`\n                    );\n                }\n                return new Ddah(data).upsert({\n                    ...ddah,\n                    approved_date: new Date().toISOString(),\n                });\n            },\n            summary: \"Approve a DDAH\",\n            returns: docApiPropTypes.ddah,\n        }),\n        \"/ddahs/:ddah_id/email\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\" || params.role === \"instructor\") {\n                    const ddah = new Ddah(data).find({ id: params.ddah_id });\n                    if (!ddah) {\n                        throw new Error(\n                            `Could not find DDAH with id '${params.ddah_id}'`\n                        );\n                    }\n                    return new Ddah(data).upsert({\n                        ...ddah,\n                        emailed_date: new Date().toISOString(),\n                    });\n                }\n                // If we make it here, we should error because of invalid permissions\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Email a DDAH\",\n            returns: docApiPropTypes.ddah,\n        }),\n        \"/assignments/:assignment_id/ddah\": documentCallback({\n            func: (data, params, body) => {\n                if (params.role === \"admin\" || params.role === \"instructor\") {\n                    const assignment = new Assignment(data).find(\n                        params.assignment_id\n                    );\n                    if (!assignment) {\n                        throw new Error(\n                            `Cannot create a DDAH because an assignment with id '${params.assignment_id}' cannot be found.`\n                        );\n                    }\n                    return new Ddah(data).upsert({\n                        ...body,\n                        assignment_id: stringToNativeType(params.assignment_id),\n                    });\n                }\n                // If we make it here, we should error because of invalid permissions\n                errorUnlessRole(params, \"\");\n            },\n            summary:\n                \"Create a DDAH associated with a specific assignment. You may specify the details of the DDAH in th body of this request.\",\n            posts: docApiPropTypes.ddah,\n            returns: docApiPropTypes.ddah,\n        }),\n    },\n};\n","import Route from \"route-parser\";\nimport { mockData } from \"./data\";\nimport { sessionsRoutes } from \"./sessions\";\nimport { templatesRoutes } from \"./contract_templates\";\nimport { positionsRoutes } from \"./positions\";\nimport { instructorsRoutes } from \"./instructors\";\nimport { documentCallback } from \"../defs/doc-generation\";\nimport { assignmentsRoutes } from \"./assignments\";\nimport { applicantsRoutes } from \"./applicants\";\nimport { applicationsRoutes } from \"./applications\";\nimport { wageChunkRoutes } from \"./wage_chunks\";\nimport { debugRoutes } from \"./debug\";\nimport { activeUserRoutes, User } from \"./active_user\";\nimport { ddahsRoutes } from \"./ddahs\";\n\n/**\n * Mock API server that runs locally; useuful for demo purposes.\n *\n * @module\n */\n\nexport class MockAPI {\n    routePrefix = \"/api/v1\";\n    // a list of selectors for each route\n    getRoutes = Object.assign(\n        {},\n        sessionsRoutes.get,\n        templatesRoutes.get,\n        positionsRoutes.get,\n        instructorsRoutes.get,\n        assignmentsRoutes.get,\n        applicantsRoutes.get,\n        applicationsRoutes.get,\n        wageChunkRoutes.get,\n        ddahsRoutes.get,\n        debugRoutes.get,\n        activeUserRoutes.get,\n        {\n            \"/all_data\": documentCallback({\n                func: (data) => data,\n                exclude: true,\n            }),\n        }\n    );\n    postRoutes = Object.assign(\n        {},\n        sessionsRoutes.post,\n        templatesRoutes.post,\n        positionsRoutes.post,\n        instructorsRoutes.post,\n        assignmentsRoutes.post,\n        applicantsRoutes.post,\n        applicationsRoutes.post,\n        wageChunkRoutes.post,\n        ddahsRoutes.post,\n        debugRoutes.post,\n        activeUserRoutes.post\n    );\n\n    constructor(seedData) {\n        this.active = false;\n        this.data = seedData;\n        this._getRoutesParsers = Object.keys(this.getRoutes).map((routeStr) => {\n            // We want to peel of the role from the start of the route, but we don't want\n            // to consider it part of the route for documentation purposes. Since `routeStr`\n            // is used to find the callback of the route, we hack `Route` so that `spec`\n            // is the same as `routeStr`.\n            const r = new Route(\"(/:role)\" + routeStr);\n            r.spec = routeStr;\n            return r;\n        });\n        this._postRoutesParsers = Object.keys(this.postRoutes).map(\n            (routeStr) => {\n                // We want to peel of the role from the start of the route, but we don't want\n                // to consider it part of the route for documentation purposes. Since `routeStr`\n                // is used to find the callback of the route, we hack `Route` so that `spec`\n                // is the same as `routeStr`.\n                const r = new Route(\"(/:role)\" + routeStr);\n                r.spec = routeStr;\n                return r;\n            }\n        );\n    }\n\n    /**\n     * Make a mock `apiGET` call. Always returns an object of\n     * the form\n     * `{status: ..., message: ..., payload: ...}`\n     * This method is bound, so it is safe to pass this function around.\n     *\n     * @memberof MockAPI\n     * @param {string} url An API route without `/api/v1` (e.g., `/sessions`)\n     */\n    apiGET = (url) => {\n        for (const route of this._getRoutesParsers) {\n            const match = route.match(url);\n            // if we have a match, run the selector with the parsed data\n            if (match) {\n                try {\n                    this.authenticateActiveUserBasedOnRole(match.role);\n                    const payload = this.getRoutes[route.spec](\n                        this.data,\n                        match\n                    );\n\n                    return {\n                        status: \"success\",\n                        message: \"\",\n                        payload,\n                    };\n                } catch (e) {\n                    return { status: \"error\", message: e.toString() };\n                }\n            }\n        }\n        return {\n            status: \"error\",\n            message: `could not find route matching ${url}`,\n        };\n    };\n\n    /**\n     * Make a mock `apiPOST` call. Always returns an object of\n     * the form\n     * `{status: ..., message: ..., payload: ...}`\n     * This method is bound, so it is safe to pass this function around.\n     *\n     * @memberof MockAPI\n     * @param {string} url An API route without `/api/v1` (e.g., `/sessions`)\n     * @param {object} body The body of a post request. This should be an object, *not* a JSON string.\n     */\n    apiPOST = (url, body) => {\n        for (const route of this._postRoutesParsers) {\n            const match = route.match(url);\n            // if we have a match, run the selector with the parsed data\n            if (match) {\n                try {\n                    this.authenticateActiveUserBasedOnRole(match.role);\n                    const payload = this.postRoutes[route.spec](\n                        this.data,\n                        match,\n                        body\n                    );\n                    return {\n                        status: \"success\",\n                        message: \"\",\n                        payload,\n                    };\n                } catch (e) {\n                    return { status: \"error\", message: e.toString() };\n                }\n            }\n        }\n        return {\n            status: \"error\",\n            message: `could not find route matching ${url}`,\n        };\n    };\n\n    /**\n     * Authenticates the `active_user` as having the role `role`.\n     * If the user is not authenticated, an error is thrown.\n     *\n     * @param {string} role\n     * @returns\n     * @memberof MockAPI\n     */\n    authenticateActiveUserBasedOnRole(role) {\n        if (role == null) {\n            return;\n        }\n        const active_user = new User(this.data).getActiveUser();\n        if (active_user == null) {\n            return;\n        }\n        if (!active_user.roles.includes(role)) {\n            throw new Error(\n                `Not authenticated for accessing routes with prefix /${role}`\n            );\n        }\n    }\n\n    /**\n     * Replaces the global `window.fetch` object with calls to `apiGET` and\n     * `apiPOST`. This means that true network requests will no longer\n     * work.\n     *\n     * @param {number} [delay=1000]\n     * @memberof MockAPI\n     */\n    replaceGlobalFetch(delay = 1000) {\n        if (this.active) {\n            return;\n        }\n        this.active = true;\n        this._origFetch = fetch;\n        window.fetch = async (url, init = {}) => {\n            // Parse the URL first. We only want the pathname\n            const parsedURL = new URL(url, \"http://dummy.com\");\n            url = parsedURL.pathname;\n            // Make sure the url doesn't start with \"/api/v1\"\n            url = url.startsWith(this.routePrefix)\n                ? url.replace(this.routePrefix, \"\")\n                : url;\n            let mockResponse;\n            if (init.method === \"GET\") {\n                mockResponse = this.apiGET(url);\n            } else {\n                let body = init.body;\n                if (typeof body === \"string\") {\n                    body = JSON.parse(body);\n                }\n                mockResponse = this.apiPOST(url, body);\n            }\n            // eslint-disable-next-line\n            console.log(\n                `MockAPI ${init.method} Request.`,\n                url,\n                init,\n                \"Responding with\",\n                mockResponse\n            );\n            // Create a `Response` object to return so that we fully immitate\n            // the `fetch` api.\n            const responseObj = new Response(\n                new Blob([JSON.stringify(mockResponse)], {\n                    type: \"application/json\",\n                }),\n                { status: 200, statusText: \"OK\" }\n            );\n            return new Promise((resolve) => {\n                window.setTimeout(() => resolve(responseObj), delay);\n            });\n        };\n    }\n\n    /**\n     * Restore the global `window.fetch` to what the browser provides.\n     * If `window.fetch` has not been overridden, this function does nothing.\n     *\n     * @memberof MockAPI\n     */\n    restoreGlobalFetch() {\n        this.active = false;\n        window.fetch = this._origFetch || fetch;\n    }\n}\n\nconst mockAPI = new MockAPI(mockData);\nexport { mockAPI, mockData };\n","/**\n * Tools for generating documentation\n */\n\nimport PropTypes from \"prop-types\";\nimport RouteParser from \"route-parser\";\nimport { generatePropTypes } from \"./prop-types\";\n\nclass CallAtom {\n    constructor(prop, args) {\n        this.name = prop;\n        this.args = args;\n    }\n    toString() {\n        if (this.args == null) {\n            return \"\" + this.name;\n        }\n        return \"\" + this.name + \"(\" + this.args.join(\", \") + \")\";\n    }\n}\nfunction createCallChain(chain = [], prop, args) {\n    return chain.concat([new CallAtom(prop, args)]);\n}\n/**\n * A proxy to wrap `PropTypes` so that the call chain can be recorded.\n * For example, `PropTypes.bool.isRequired` would have the added method `.callChain`\n * which would return an array of `CallAtom` objects consisting of `bool` and `isRequired`.\n * This can be used to generate documentation from existing proptype definitions.\n *\n * @param {*} obj\n * @param {*} [callChain=[]]\n * @returns\n */\nfunction propTypesProxy(obj, callChain = []) {\n    const handler = {\n        get(obj, prop, receiver) {\n            if (prop === \"callChain\") {\n                return callChain;\n            } else if (prop === \"toJSON\") {\n                return () => callChain;\n            }\n            const ret = Reflect.get(obj, prop, receiver);\n            if (ret instanceof Object) {\n                return propTypesProxy(ret, createCallChain(callChain, prop));\n            }\n            return ret;\n        },\n        apply(obj, thisArg, args) {\n            const lastProp = callChain.pop() || { name: \"<root>\" };\n            const ret = Reflect.apply(obj, thisArg, args);\n            if (ret instanceof Object) {\n                return propTypesProxy(\n                    ret,\n                    createCallChain(callChain, lastProp.name, args)\n                );\n            }\n            return ret;\n        },\n        ownKeys(obj) {\n            return [...Reflect.ownKeys(obj), \"callChain\", \"toJSON\"];\n        },\n    };\n\n    return new Proxy(obj, handler);\n}\nconst wrappedPropTypes = propTypesProxy(PropTypes);\n/**\n * PropType defintions for the API that have been wrapped in\n * a proxy so they can be convereted into documentation.\n */\nconst docApiPropTypes = generatePropTypes(wrappedPropTypes);\n\nconst PROPTYPES_TO_SWAGGER_TYPES = {\n    string: \"string\",\n    number: \"number\",\n    bool: \"boolean\",\n    object: \"object\",\n    array: \"array\",\n    any: {},\n};\n\nfunction wrappedPropTypesToSwagger(pt) {\n    const ret = {};\n    if (!pt.callChain) {\n        // eslint-disable-next-line\n        console.warn(\n            \"Attempting to compute swagger values for non-wrapped object\",\n            pt\n        );\n    } else {\n        // We are a proxied PropTypes object\n        //\n        // PropTypes calls can be at most two long with the second argument\n        // being `.isRequired`\n        const [type, isRequired] = pt.callChain;\n        const requiredList = [];\n        if (isRequired) {\n            ret[\"required\"] = true;\n        }\n        if (type.args) {\n            // in this case, we were a PropTypes function called with some arguments\n            switch (type.name) {\n                case \"shape\":\n                    // in this case we're passing in an object with properties to be validated\n                    ret[\"type\"] = \"object\";\n                    ret[\"properties\"] = {};\n                    for (const [key, val] of Object.entries(type.args[0])) {\n                        const swaggerVal = wrappedPropTypesToSwagger(val);\n                        if (swaggerVal[\"required\"]) {\n                            // Required properties in swagger must be listed up-front (i.e., as a list\n                            // of property names, not as an attribute of an individual property),\n                            // so hoist them.\n                            requiredList.push(key);\n                            delete swaggerVal[\"required\"];\n                        }\n                        ret[\"properties\"][key] = swaggerVal;\n                    }\n                    if (requiredList.length > 0) {\n                        ret[\"required\"] = requiredList;\n                    }\n                    break;\n                case \"arrayOf\":\n                    ret[\"type\"] = \"array\";\n                    ret[\"items\"] = wrappedPropTypesToSwagger(type.args[0]);\n                    break;\n                case \"oneOf\":\n                    // XXX assuming `oneOf` is only used for strings\n                    ret[\"type\"] = \"string\";\n                    ret[\"enum\"] = type.args[0];\n                    break;\n                case \"oneOfType\":\n                    ret[\"oneOf\"] = type.args[0].map(wrappedPropTypesToSwagger);\n                    break;\n                default:\n                    break;\n            }\n        } else {\n            if (PROPTYPES_TO_SWAGGER_TYPES[type.name]) {\n                // in this case, we're a basic swagger type\n                ret[\"type\"] = PROPTYPES_TO_SWAGGER_TYPES[type.name];\n            }\n        }\n    }\n\n    return ret;\n}\n\n/**\n * Wrap `payload` in a standard API response formatted\n * for openapi\n *\n * @param {object} payload\n * @returns {object}\n */\nfunction wrapInStandardApiResponseForSwagger(payload = { type: \"object\" }) {\n    return {\n        type: \"object\",\n        properties: {\n            status: {\n                type: \"string\",\n                enum: [\"success\", \"error\"],\n            },\n            message: { type: \"string\" },\n            payload,\n        },\n        required: [\"status\"],\n    };\n}\n\n/**\n * Take a path template in `\"route-parser\"`\n * form, e.g. `/sessions/:session_id`, and encode it for\n * consumption by swagger, e.g., `/sessions/{session_id}`.\n *\n * @param {string} url\n * @returns {string}\n */\nfunction urlTemplateToSwagger(url) {\n    // get the template variables\n    // using a trick: have the RoutePasers\n    // parse it's own template, giving us\n    // a list of variables in the process\n    const parsed = RouteParser(url);\n    const templateVars = Object.keys(parsed.match(parsed.spec));\n    const subs = {};\n    for (const templateVar of templateVars) {\n        subs[templateVar] = \"{\" + templateVar + \"}\";\n    }\n    return { url: decodeURI(parsed.reverse(subs)), templateVars };\n}\n\n/**\n * Convert the `docs` attribute from a callback that\n * has been documented with `documentCallback` into an openapi\n * object.\n *\n * @param {object} docs\n * @param {string[]} [templateVars=[]] - list of template variables in the route\n * @returns {object} - openapi object\n */\nfunction documentedCallbackToSwagger(docs, templateVars = []) {\n    const ret = { responses: { default: {} } };\n    if (!docs) {\n        return ret;\n    }\n    // Routes are all prefixed. `admin` can access all routes.\n    // other routes are restricted depending on the list specified in `roles`.\n    const prefixRoles = [\"admin\", ...(docs.roles || [])];\n    ret.summary =\n        `(prefixes: ${prefixRoles.map((x) => \"/\" + x).join(\", \")}) ` +\n        docs.summary;\n    // If there are templateVars, they should become `paramters`\n    if (templateVars.length > 0) {\n        ret.parameters = templateVars.map((x) => ({\n            name: x,\n            in: \"path\",\n            description: x,\n            required: true,\n        }));\n    }\n    // `docs.returns` holds information about what the route will return\n    if (docs.returns) {\n        ret.responses.default = {\n            content: {\n                \"application/json\": {\n                    schema: wrapInStandardApiResponseForSwagger(\n                        wrappedPropTypesToSwagger(docs.returns)\n                    ),\n                },\n            },\n        };\n    }\n    // `docs.posts` holds information about what you can put in the\n    // requestBody\n    if (docs.posts) {\n        ret.requestBody = {\n            content: {\n                \"application/json\": {\n                    schema: wrappedPropTypesToSwagger(docs.posts),\n                },\n            },\n        };\n    }\n\n    return ret;\n}\n\n/**\n * Turn mockAPI routes into swagger-ui JSON object\n *\n * @param {{getRoutes: object, postRoutes: object}} [mockAPI={}]\n * @returns {object} - openapi configuration\n */\nfunction mockApiRoutesAsSwaggerPaths(mockAPI = {}) {\n    const { getRoutes = {}, postRoutes = {} } = mockAPI;\n    const ret = {};\n    for (const [path, val] of Object.entries(getRoutes)) {\n        const { url: templatePath, templateVars } = urlTemplateToSwagger(path);\n        if (val.docs && val.docs.exclude) {\n            continue;\n        }\n        ret[templatePath] = Object.assign(ret[templatePath] || {}, {\n            get: documentedCallbackToSwagger(val.docs, templateVars),\n        });\n    }\n    for (const [path, val] of Object.entries(postRoutes)) {\n        const { url: templatePath, templateVars } = urlTemplateToSwagger(path);\n        if (val.docs && val.docs.exclude) {\n            continue;\n        }\n        ret[templatePath] = Object.assign(ret[templatePath] || {}, {\n            post: documentedCallbackToSwagger(val.docs, templateVars),\n        });\n    }\n\n    // The initial segment of each route is a \"tag\"; get a unique\n    // list of each of these tags and then for annotating the routes\n    const tags = Array.from(\n        new Set(\n            Object.keys(ret)\n                .map((x) => x.split(\"/\")[1])\n                .filter((x) => x)\n        )\n    );\n    // If a route contains one of the \"tags\", then it should be annotated\n    // accordingly (with each relavent tag)\n    for (const [path, info] of Object.entries(ret)) {\n        const applicableTags = tags.filter((x) => path.includes(x));\n        if (info.get && applicableTags.length > 0) {\n            info.get.tags = applicableTags;\n        }\n        if (info.post && applicableTags.length > 0) {\n            info.post.tags = applicableTags;\n        }\n    }\n\n    // Alphabetize the routes so they display in a sensible order.\n    const sortedRet = {};\n    for (const path of Object.keys(ret).sort()) {\n        sortedRet[path] = ret[path];\n    }\n\n    return sortedRet;\n}\n\n/**\n * Document a function with attributes for autogenerating openapi\n * specifications from.\n *\n * @param {*} { func, exclude = false, ...attrs }\n * @returns\n */\nfunction documentCallback({ func, exclude = false, ...attrs }) {\n    // create a wrapped function that we can stuff attributes onto\n    const ret = (...args) => func(...args);\n    ret.docs = {\n        exclude,\n        ...attrs,\n    };\n    return ret;\n}\n\nexport {\n    wrappedPropTypes,\n    wrappedPropTypesToSwagger,\n    urlTemplateToSwagger,\n    mockApiRoutesAsSwaggerPaths,\n    documentCallback,\n    docApiPropTypes,\n};\n"],"sourceRoot":""}